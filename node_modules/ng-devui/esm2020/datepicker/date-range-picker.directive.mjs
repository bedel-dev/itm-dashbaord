import { __decorate, __metadata } from "tslib";
import { CdkOverlayOrigin } from '@angular/cdk/overlay';
import { DOCUMENT } from '@angular/common';
import { ChangeDetectorRef, Component, ComponentRef, ElementRef, EventEmitter, forwardRef, HostListener, Inject, Input, Output, Renderer2, TemplateRef, ViewChild } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { I18nService } from 'ng-devui/i18n';
import { addClassToOrigin, DefaultDateConverter, DevConfigService, fadeInOut, formWithDropDown, removeClassFromOrigin, WithConfig } from 'ng-devui/utils';
import { fromEvent } from 'rxjs';
import { debounceTime, filter, map } from 'rxjs/operators';
import { DatePickerConfigService as DatePickerConfig } from './date-picker.config.service';
import { SelectDateRangeChangeReason } from './date-range-change-event-args.model';
import * as i0 from "@angular/core";
import * as i1 from "./date-picker.config.service";
import * as i2 from "ng-devui/i18n";
import * as i3 from "ng-devui/utils";
import * as i4 from "./date-range-picker.component";
import * as i5 from "@angular/cdk/overlay";
import * as i6 from "@angular/forms";
// tslint:disable-next-line: component-class-suffix
export class DateRangePickerDirective {
    constructor(elementRef, renderer, datePickerConfig, i18n, cdr, devConfigService, doc) {
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.datePickerConfig = datePickerConfig;
        this.i18n = i18n;
        this.cdr = cdr;
        this.devConfigService = devConfigService;
        this.doc = doc;
        this.hideOnRangeSelected = false;
        this.splitter = '  -  ';
        this.showAnimation = true;
        this.selectedRangeChange = new EventEmitter();
        this._selectedRange = [null, null];
        this._isOpen = false;
        this.datepickerPosition = 'bottom';
        this.valueList = [];
        this.startAnimation = false;
        this.onChange = (_) => null;
        this.onTouched = () => null;
        this.chooseDate = (range, reason, hide = true) => {
            if (this.dateRangePicker && this.dateRangePicker['chooseDate']) {
                this.dateRangePicker['chooseDate'](range, reason);
            }
            else {
                this._selectedRange = [...range];
                this.notifyValueChange({
                    reason: reason,
                    selectedRange: [...range]
                });
            }
            if (!this.showTime && this.hideOnRangeSelected && hide) {
                this.hide();
            }
        };
        this.onDocumentClick = ($event) => {
            let templateWrap;
            if (this.dateRangePicker && this.dateRangePicker['templateWrap']) {
                templateWrap = this.dateRangePicker['templateWrap'];
            }
            if (templateWrap && templateWrap.nativeElement.contains($event.target) && !this.hideOnRangeSelected) {
                this.isOpen = true;
            }
            else if (this.elementRef.nativeElement !== $event.target) {
                this.isOpen = false;
            }
            this.cdr.markForCheck();
        };
        this.clearAll = (reason, hide) => {
            const currentReason = typeof reason === 'number' ? reason : SelectDateRangeChangeReason.custom;
            this.chooseDate([null, null], currentReason, hide);
        };
        this._dateConfig = datePickerConfig['dateConfig'];
        this.dateConverter = datePickerConfig['dateConfig'].dateConverter || new DefaultDateConverter();
        this._minDate = this.minDate ? new Date(this.minDate) : new Date(this.dateConfig.min, 0, 1, 0, 0, 0);
        this._maxDate = this.maxDate ? new Date(this.maxDate) : new Date(this.dateConfig.max, 11, 31, 23, 59, 59);
        this.setI18nText();
        this.document = this.doc;
    }
    set maxDate(date) {
        this._maxDate = date;
    }
    get maxDate() {
        if (this.dateRangePicker && this.dateRangePicker['maxDate']) {
            return this.dateRangePicker['maxDate'];
        }
        else {
            return this._maxDate;
        }
    }
    set minDate(date) {
        this._minDate = date;
    }
    get minDate() {
        if (this.dateRangePicker && this.dateRangePicker['minDate']) {
            return this.dateRangePicker['minDate'];
        }
        else {
            return this._minDate;
        }
    }
    set selectedRange(range) {
        if (Array.isArray(range) && range.every(_ => (!!_ || _ === null))) {
            this._selectedRange = range;
        }
    }
    get selectedRange() {
        return this._selectedRange;
    }
    set showTime(showTime) {
        this._showTime = showTime;
    }
    get showTime() {
        return typeof this._showTime === 'boolean' ? this._showTime : this.dateConfig.timePicker;
    }
    set dateConfig(dateConfig) {
        if (this.checkDateConfig(dateConfig)) {
            this._dateConfig = dateConfig;
        }
        else {
            this._dateConfig = this.datePickerConfig.dateConfig;
        }
        this._dateFormat = this.showTime ? this._dateConfig.format.time : this._dateConfig.format.date;
    }
    get dateConfig() {
        return this._dateConfig;
    }
    set dateFormat(dateFormat) {
        if (dateFormat && this._dateFormat !== dateFormat) {
            this._dateFormat = dateFormat;
        }
    }
    get dateFormat() {
        return this._dateFormat || this.datePickerConfig.defaultFormat;
    }
    set rangeStart(rangeStart) {
        if (this.dateRangePicker) {
            this.dateRangePicker['rangeStart'] = rangeStart;
        }
    }
    get rangeEnd() {
        if (this.dateRangePicker) {
            return this.dateRangePicker['rangeEnd'];
        }
    }
    set isOpen(isOpen) {
        if (this._isOpen !== isOpen) {
            this._isOpen = isOpen;
            if (!isOpen && !this.rangeEnd) {
                this.rangeStart = null;
            }
            if (!isOpen) {
                this.startAnimation = false;
                removeClassFromOrigin(this.elementRef);
                this.document.removeEventListener('click', this.onDocumentClick);
            }
            else {
                setTimeout(() => {
                    addClassToOrigin(this.elementRef);
                    this.document.addEventListener('click', this.onDocumentClick);
                    this.startAnimation = true;
                    this.cdr.detectChanges();
                });
            }
        }
    }
    get isOpen() {
        return this._isOpen;
    }
    onBlur($event) {
        this.onTouched();
        if (!this.validateDate(this.elementRef.nativeElement.value)) {
            this.resetValue();
        }
    }
    checkDateConfig(dateConfig) {
        if (!dateConfig) {
            return false;
        }
        if (typeof (dateConfig.timePicker) !== 'boolean' || !dateConfig.max || !dateConfig.min || !dateConfig.format) {
            return false;
        }
        return true;
    }
    ngOnInit() {
        this.updateCdkConnectedOverlayOrigin();
        this.initInputChanges();
    }
    registerOnChange(fn) {
        this.onChange = fn;
    }
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    initInputChanges() {
        this.valueChangeSubscrip = fromEvent(this.elementRef.nativeElement, 'keyup').pipe(map((e) => e.target.value), filter(() => !this.disabled), debounceTime(300)).subscribe(value => {
            this.transUserInputToDatepicker(value);
        });
    }
    writeValue(selectedRange) {
        this._selectedRange = selectedRange;
        if (selectedRange) {
            this.writeModelValue(selectedRange);
        }
    }
    setI18nText() {
        this.i18nLocale = this.i18n.getI18nText().locale;
        this.i18nSubscription = this.i18n.langChange().subscribe((data) => {
            this.i18nLocale = data.locale;
        });
    }
    updateCdkConnectedOverlayOrigin() {
        if (this.elementRef.nativeElement) {
            this.cdkConnectedOverlayOrigin = new CdkOverlayOrigin(formWithDropDown(this.elementRef) || this.elementRef.nativeElement);
        }
    }
    toggle(clickShow) {
        if (clickShow === undefined) {
            this.isOpen = !this.isOpen;
        }
        else {
            this.isOpen = clickShow;
        }
    }
    hide(event) {
        if (event !== false) {
            this.isOpen = false;
        }
    }
    writeModelValue(input) {
        if (Array.isArray(input) && input.every(_ => !!_)) {
            this.renderer.setProperty(this.elementRef.nativeElement, 'value', this.formatDateRange(input));
        }
        else {
            this.renderer.setProperty(this.elementRef.nativeElement, 'value', '');
        }
    }
    formatDateRange(arr) {
        return arr.map((date, i) => {
            return (date ?
                this.dateConverter.format(date, this.dateFormat, this.locale || this.i18nLocale) :
                ['Start', 'End'][i]);
        }).join(this.splitter);
    }
    onPositionChange(position) {
        switch (position.connectionPair.overlayY) {
            case 'top':
            case 'center':
                this.datepickerPosition = 'bottom';
                break;
            case 'bottom':
                this.datepickerPosition = 'top';
        }
    }
    notifyValueChange(dateObj) {
        this.writeValue(dateObj.selectedRange);
        this.onChange(dateObj.selectedRange);
        this.onTouched();
        this.selectedRangeChange.emit({
            reason: dateObj.reason,
            selectedRange: dateObj.selectedRange
        });
        if (!this.showTime && this.hideOnRangeSelected) {
            this.hide();
        }
    }
    transUserInputToDatepicker(value) {
        if (!this.showTime && !this.disabled) {
            const _value = value || this.elementRef.nativeElement.value;
            if (!_value && !this.selectedRange.every(val => !!val)) {
                this.clearAll(undefined, false);
                return;
            }
            if (!_value) {
                this.clearAll(undefined, false);
                return;
            }
            if (this.validateDate(_value)) {
                this.chooseDate(this.valueList, undefined, false);
            }
        }
        else {
            this.resetValue();
        }
    }
    resetValue() {
        this.writeValue(this.selectedRange);
    }
    validateDate(value) {
        if (!value) {
            return true;
        }
        this.valueList = value.split(this.splitter);
        let valueFormat;
        // 如果拆出来6个，则为日期间分隔符和年月日间分隔符相同的情况，此情况允许
        if (this.valueList.length === 6 && this.valueList.every(val => !!val)) {
            const curValueList = [];
            this.valueList.forEach((val, index) => {
                // 根据下标，前三个组装在一起，后三个组装在一起，不需要考虑分隔符，后面会format
                if ((index + 1) % 3 === 1) {
                    curValueList.push(val);
                }
                else {
                    curValueList[Math.ceil(index / 3) - 1] = curValueList[Math.ceil(index / 3) - 1] + '-' + val;
                }
            });
            this.valueList = curValueList;
        }
        // 不管拆出来是6还是2个，都需要组装成2个日期
        if (this.valueList.length === 2 &&
            this.valueList.every(val => !!val) &&
            this.valueList.every((val, index) => new Date(val).getTime() === new Date(this.selectedRange[index]).getTime())) {
            this.valueList = this.valueList.map(t => new Date(t));
            return true;
        }
        if (!this.valueList.every(val => new Date(val).getTime())) {
            return false;
        }
        if (this.valueList.length === 2 && this.valueList.every(val => !!val)) {
            const valueTimeList = this.valueList.map(val => (new Date(`${val} 00:00:00`)).getTime());
            valueFormat = this.formatDateRange(this.valueList.map(numValue => new Date(numValue)));
            if (value === valueFormat &&
                !valueTimeList.every((val) => {
                    return (val >= this.minDate.getTime() && val <= this.maxDate.getTime());
                })) {
                return false;
            }
            else {
                // 判断前后俩日期是否大于最小，小于最大，若是则合法，进行如下操作
                // 此时包括value为NaN既日期格式不正确的情况，对其进行处理下方判断会过滤掉
                this.valueList = this.valueList.map(val => new Date(val).getTime()).sort((a, b) => a - b).map(numValue => new Date(numValue));
            }
            if (valueFormat && value === valueFormat) {
                return true;
            }
            return false;
        }
        else {
            return false;
        }
    }
    ngOnDestroy() {
        this.hide();
        if (this.i18nSubscription) {
            this.i18nSubscription.unsubscribe();
        }
        if (this.valueChangeSubscrip) {
            this.valueChangeSubscrip.unsubscribe();
        }
        this.document.removeEventListener('click', this.onDocumentClick);
    }
}
DateRangePickerDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DateRangePickerDirective, deps: [{ token: i0.ElementRef }, { token: i0.Renderer2 }, { token: i1.DatePickerConfigService }, { token: i2.I18nService }, { token: i0.ChangeDetectorRef }, { token: i3.DevConfigService }, { token: DOCUMENT }], target: i0.ɵɵFactoryTarget.Component });
DateRangePickerDirective.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.3", type: DateRangePickerDirective, selector: "[dDateRangePicker]", inputs: { locale: "locale", cssClass: "cssClass", disabled: "disabled", dateConverter: "dateConverter", hideOnRangeSelected: "hideOnRangeSelected", customViewTemplate: "customViewTemplate", splitter: "splitter", showAnimation: "showAnimation", maxDate: "maxDate", minDate: "minDate", selectedRange: "selectedRange", showTime: "showTime", dateConfig: "dateConfig", dateFormat: "dateFormat" }, outputs: { selectedRangeChange: "selectedRangeChange" }, host: { listeners: { "blur": "onBlur($event)" } }, providers: [{
            provide: NG_VALUE_ACCESSOR,
            useExisting: forwardRef(() => DateRangePickerDirective),
            multi: true
        }], viewQueries: [{ propertyName: "dateRangePicker", first: true, predicate: ["dateRangePicker"], descendants: true }], exportAs: ["dateRangePicker"], ngImport: i0, template: "<ng-template\n  cdk-connected-overlay\n  [cdkConnectedOverlayOrigin]=\"cdkConnectedOverlayOrigin\"\n  [cdkConnectedOverlayOpen]=\"isOpen\"\n  (backdropClick)=\"isOpen=false\"\n  (positionChange)=\"onPositionChange($event)\"\n>\n  <div [@fadeInOut]=\"startAnimation ? datepickerPosition : 'void'\" [@.disabled]=\"!showAnimation\" class=\"devui-date-range-wrapper\">\n    <d-date-range-picker\n      #dateRangePicker\n      [locale]=\"locale\"\n      [cssClass]=\"cssClass\"\n      [disabled]=\"disabled\"\n      [dateConverter]=\"dateConverter\"\n      [customViewTemplate]=\"customViewTemplate\"\n      [minDate]=\"minDate\"\n      [maxDate]=\"maxDate\"\n      [dateFormat]=\"dateFormat\"\n      [showTime]=\"showTime\"\n      [selectedRange]=\"selectedRange\"\n      (selectedRangeChange)=\"notifyValueChange($event)\"\n      (hide)=\"hide($event)\"\n      [(ngModel)]=\"_selectedRange\"\n    ></d-date-range-picker>\n  </div>\n</ng-template>\n", styles: [".devui-date-range-wrapper{display:inline-flex!important;box-shadow:0 2px 8px rgba(37,43,58,.2);box-shadow:var(--devui-shadow-connected-overlay, 0 2px 8px 0) var(--devui-shadow, rgba(37, 43, 58, .2));background-color:#fff;background-color:var(--devui-connected-overlay-bg, #ffffff);transform:perspective(1px) translate(0);flex-direction:column;border-radius:2px;border-radius:var(--devui-border-radius, 2px);margin:4px 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.devui-date-range-custom{width:500px;border-top:1px solid #d7d8da;border-top:1px solid var(--devui-line, #d7d8da)}.devui-date-picker:not(:last-child){margin-right:20px}\n"], components: [{ type: i4.DateRangePickerComponent, selector: "d-date-range-picker", inputs: ["locale", "cssClass", "disabled", "dateConverter", "selectedRange", "dateFormat", "customViewTemplate", "showTime", "dateConfig", "maxDate", "minDate"], outputs: ["selectedRangeChange", "hide"], exportAs: ["dateRangePicker"] }], directives: [{ type: i5.CdkConnectedOverlay, selector: "[cdk-connected-overlay], [connected-overlay], [cdkConnectedOverlay]", inputs: ["cdkConnectedOverlayOrigin", "cdkConnectedOverlayPositions", "cdkConnectedOverlayPositionStrategy", "cdkConnectedOverlayOffsetX", "cdkConnectedOverlayOffsetY", "cdkConnectedOverlayWidth", "cdkConnectedOverlayHeight", "cdkConnectedOverlayMinWidth", "cdkConnectedOverlayMinHeight", "cdkConnectedOverlayBackdropClass", "cdkConnectedOverlayPanelClass", "cdkConnectedOverlayViewportMargin", "cdkConnectedOverlayScrollStrategy", "cdkConnectedOverlayOpen", "cdkConnectedOverlayDisableClose", "cdkConnectedOverlayTransformOriginOn", "cdkConnectedOverlayHasBackdrop", "cdkConnectedOverlayLockPosition", "cdkConnectedOverlayFlexibleDimensions", "cdkConnectedOverlayGrowAfterOpen", "cdkConnectedOverlayPush"], outputs: ["backdropClick", "positionChange", "attach", "detach", "overlayKeydown", "overlayOutsideClick"], exportAs: ["cdkConnectedOverlay"] }, { type: i6.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i6.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }], animations: [
        fadeInOut
    ] });
__decorate([
    WithConfig(),
    __metadata("design:type", Object)
], DateRangePickerDirective.prototype, "showAnimation", void 0);
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DateRangePickerDirective, decorators: [{
            type: Component,
            args: [{ selector: '[dDateRangePicker]', providers: [{
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(() => DateRangePickerDirective),
                            multi: true
                        }], exportAs: 'dateRangePicker', animations: [
                        fadeInOut
                    ], preserveWhitespaces: false, template: "<ng-template\n  cdk-connected-overlay\n  [cdkConnectedOverlayOrigin]=\"cdkConnectedOverlayOrigin\"\n  [cdkConnectedOverlayOpen]=\"isOpen\"\n  (backdropClick)=\"isOpen=false\"\n  (positionChange)=\"onPositionChange($event)\"\n>\n  <div [@fadeInOut]=\"startAnimation ? datepickerPosition : 'void'\" [@.disabled]=\"!showAnimation\" class=\"devui-date-range-wrapper\">\n    <d-date-range-picker\n      #dateRangePicker\n      [locale]=\"locale\"\n      [cssClass]=\"cssClass\"\n      [disabled]=\"disabled\"\n      [dateConverter]=\"dateConverter\"\n      [customViewTemplate]=\"customViewTemplate\"\n      [minDate]=\"minDate\"\n      [maxDate]=\"maxDate\"\n      [dateFormat]=\"dateFormat\"\n      [showTime]=\"showTime\"\n      [selectedRange]=\"selectedRange\"\n      (selectedRangeChange)=\"notifyValueChange($event)\"\n      (hide)=\"hide($event)\"\n      [(ngModel)]=\"_selectedRange\"\n    ></d-date-range-picker>\n  </div>\n</ng-template>\n", styles: [".devui-date-range-wrapper{display:inline-flex!important;box-shadow:0 2px 8px rgba(37,43,58,.2);box-shadow:var(--devui-shadow-connected-overlay, 0 2px 8px 0) var(--devui-shadow, rgba(37, 43, 58, .2));background-color:#fff;background-color:var(--devui-connected-overlay-bg, #ffffff);transform:perspective(1px) translate(0);flex-direction:column;border-radius:2px;border-radius:var(--devui-border-radius, 2px);margin:4px 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.devui-date-range-custom{width:500px;border-top:1px solid #d7d8da;border-top:1px solid var(--devui-line, #d7d8da)}.devui-date-picker:not(:last-child){margin-right:20px}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.Renderer2 }, { type: i1.DatePickerConfigService }, { type: i2.I18nService }, { type: i0.ChangeDetectorRef }, { type: i3.DevConfigService }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }]; }, propDecorators: { locale: [{
                type: Input
            }], cssClass: [{
                type: Input
            }], disabled: [{
                type: Input
            }], dateConverter: [{
                type: Input
            }], hideOnRangeSelected: [{
                type: Input
            }], customViewTemplate: [{
                type: Input
            }], splitter: [{
                type: Input
            }], showAnimation: [{
                type: Input
            }], selectedRangeChange: [{
                type: Output
            }], dateRangePicker: [{
                type: ViewChild,
                args: ['dateRangePicker']
            }], maxDate: [{
                type: Input
            }], minDate: [{
                type: Input
            }], selectedRange: [{
                type: Input
            }], showTime: [{
                type: Input
            }], dateConfig: [{
                type: Input
            }], dateFormat: [{
                type: Input
            }], onBlur: [{
                type: HostListener,
                args: ['blur', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1yYW5nZS1waWNrZXIuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vZGV2dWkvZGF0ZXBpY2tlci9kYXRlLXJhbmdlLXBpY2tlci5kaXJlY3RpdmUudHMiLCIuLi8uLi8uLi9kZXZ1aS9kYXRlcGlja2VyL2RhdGUtcmFuZ2UtcGlja2VyLmRpcmVjdGl2ZS5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsZ0JBQWdCLEVBQXlELE1BQU0sc0JBQXNCLENBQUM7QUFDL0csT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFDTCxpQkFBaUIsRUFDakIsU0FBUyxFQUNULFlBQVksRUFDWixVQUFVLEVBQ1YsWUFBWSxFQUNaLFVBQVUsRUFDVixZQUFZLEVBQ1osTUFBTSxFQUNOLEtBQUssRUFHTCxNQUFNLEVBQ04sU0FBUyxFQUNULFdBQVcsRUFDWCxTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUF3QixpQkFBaUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pFLE9BQU8sRUFBaUIsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNELE9BQU8sRUFDTCxnQkFBZ0IsRUFFaEIsb0JBQW9CLEVBQUUsZ0JBQWdCLEVBQUUsU0FBUyxFQUNqRCxnQkFBZ0IsRUFDaEIscUJBQXFCLEVBQUUsVUFBVSxFQUNsQyxNQUFNLGdCQUFnQixDQUFDO0FBQ3hCLE9BQU8sRUFBRSxTQUFTLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQy9DLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNELE9BQU8sRUFBRSx1QkFBdUIsSUFBSSxnQkFBZ0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQzNGLE9BQU8sRUFBa0MsMkJBQTJCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQzs7Ozs7Ozs7QUFt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ZWN0ZWRPdmVybGF5UG9zaXRpb25DaGFuZ2UsIFZlcnRpY2FsQ29ubmVjdGlvblBvcyB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9vdmVybGF5JztcbmltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7XG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIENvbXBvbmVudFJlZixcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBmb3J3YXJkUmVmLFxuICBIb3N0TGlzdGVuZXIsXG4gIEluamVjdCxcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFJlbmRlcmVyMixcbiAgVGVtcGxhdGVSZWYsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEkxOG5JbnRlcmZhY2UsIEkxOG5TZXJ2aWNlIH0gZnJvbSAnbmctZGV2dWkvaTE4bic7XG5pbXBvcnQge1xuICBhZGRDbGFzc1RvT3JpZ2luLFxuICBEYXRlQ29udmVydGVyLFxuICBEZWZhdWx0RGF0ZUNvbnZlcnRlciwgRGV2Q29uZmlnU2VydmljZSwgZmFkZUluT3V0LFxuICBmb3JtV2l0aERyb3BEb3duLFxuICByZW1vdmVDbGFzc0Zyb21PcmlnaW4sIFdpdGhDb25maWdcbn0gZnJvbSAnbmctZGV2dWkvdXRpbHMnO1xuaW1wb3J0IHsgZnJvbUV2ZW50LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgZmlsdGVyLCBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBEYXRlUGlja2VyQ29uZmlnU2VydmljZSBhcyBEYXRlUGlja2VyQ29uZmlnIH0gZnJvbSAnLi9kYXRlLXBpY2tlci5jb25maWcuc2VydmljZSc7XG5pbXBvcnQgeyBTZWxlY3REYXRlUmFuZ2VDaGFuZ2VFdmVudEFyZ3MsIFNlbGVjdERhdGVSYW5nZUNoYW5nZVJlYXNvbiB9IGZyb20gJy4vZGF0ZS1yYW5nZS1jaGFuZ2UtZXZlbnQtYXJncy5tb2RlbCc7XG5pbXBvcnQgeyBEYXRlUmFuZ2VQaWNrZXJDb21wb25lbnQgfSBmcm9tICcuL2RhdGUtcmFuZ2UtcGlja2VyLmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGFuZ3VsYXItZXNsaW50L2NvbXBvbmVudC1zZWxlY3RvciovXG4gIHNlbGVjdG9yOiAnW2REYXRlUmFuZ2VQaWNrZXJdJyxcbiAgcHJvdmlkZXJzOiBbe1xuICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IERhdGVSYW5nZVBpY2tlckRpcmVjdGl2ZSksXG4gICAgbXVsdGk6IHRydWVcbiAgfV0sXG4gIGV4cG9ydEFzOiAnZGF0ZVJhbmdlUGlja2VyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2RhdGUtcmFuZ2UtcGlja2VyLmRpcmVjdGl2ZS5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vZGF0ZS1yYW5nZS1waWNrZXIuY29tcG9uZW50LnNjc3MnXSxcbiAgYW5pbWF0aW9uczogW1xuICAgIGZhZGVJbk91dFxuICBdLFxuICBwcmVzZXJ2ZVdoaXRlc3BhY2VzOiBmYWxzZSxcbn0pXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IGNvbXBvbmVudC1jbGFzcy1zdWZmaXhcbmV4cG9ydCBjbGFzcyBEYXRlUmFuZ2VQaWNrZXJEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKSBsb2NhbGU6IHN0cmluZztcbiAgQElucHV0KCkgY3NzQ2xhc3M6IHN0cmluZztcbiAgQElucHV0KCkgZGlzYWJsZWQ6IGJvb2xlYW47XG4gIEBJbnB1dCgpIGRhdGVDb252ZXJ0ZXI6IERhdGVDb252ZXJ0ZXI7XG4gIEBJbnB1dCgpIGhpZGVPblJhbmdlU2VsZWN0ZWQgPSBmYWxzZTtcbiAgQElucHV0KCkgY3VzdG9tVmlld1RlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xuICBASW5wdXQoKSBzcGxpdHRlciA9ICcgIC0gICc7XG4gIEBJbnB1dCgpIEBXaXRoQ29uZmlnKCkgc2hvd0FuaW1hdGlvbiA9IHRydWU7XG4gIEBPdXRwdXQoKSBzZWxlY3RlZFJhbmdlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxTZWxlY3REYXRlUmFuZ2VDaGFuZ2VFdmVudEFyZ3M+KCk7XG4gIEBWaWV3Q2hpbGQoJ2RhdGVSYW5nZVBpY2tlcicpIGRhdGVSYW5nZVBpY2tlcjogQ29tcG9uZW50UmVmPERhdGVSYW5nZVBpY2tlckNvbXBvbmVudD47XG4gIHByaXZhdGUgX21heERhdGU6IERhdGU7XG4gIHByaXZhdGUgX21pbkRhdGU6IERhdGU7XG4gIF9zZWxlY3RlZFJhbmdlID0gW251bGwsIG51bGxdO1xuICBwcml2YXRlIF9pc09wZW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfZGF0ZUNvbmZpZzogYW55O1xuICBwcml2YXRlIF9kYXRlRm9ybWF0OiBzdHJpbmc7XG4gIHByaXZhdGUgX3Nob3dUaW1lOiBib29sZWFuO1xuICBwdWJsaWMgY2RrQ29ubmVjdGVkT3ZlcmxheU9yaWdpbjogYW55O1xuICBwdWJsaWMgaTE4bkxvY2FsZTogSTE4bkludGVyZmFjZVsnbG9jYWxlJ107XG4gIHByaXZhdGUgaTE4blN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICBwcml2YXRlIHZhbHVlQ2hhbmdlU3Vic2NyaXA6IFN1YnNjcmlwdGlvbjtcbiAgZGF0ZXBpY2tlclBvc2l0aW9uOiBWZXJ0aWNhbENvbm5lY3Rpb25Qb3MgPSAnYm90dG9tJztcbiAgdmFsdWVMaXN0ID0gW107XG4gIHN0YXJ0QW5pbWF0aW9uID0gZmFsc2U7XG4gIGRvY3VtZW50OiBEb2N1bWVudDtcbiAgcHJpdmF0ZSBvbkNoYW5nZSA9IChfOiBhbnkpID0+IG51bGw7XG4gIHByaXZhdGUgb25Ub3VjaGVkID0gKCkgPT4gbnVsbDtcblxuICBASW5wdXQoKSBzZXQgbWF4RGF0ZShkYXRlOiBEYXRlIHwgYW55KSB7XG4gICAgdGhpcy5fbWF4RGF0ZSA9IGRhdGU7XG4gIH1cblxuICBnZXQgbWF4RGF0ZSgpIHtcbiAgICBpZiAodGhpcy5kYXRlUmFuZ2VQaWNrZXIgJiYgdGhpcy5kYXRlUmFuZ2VQaWNrZXJbJ21heERhdGUnXSkge1xuICAgICAgcmV0dXJuIHRoaXMuZGF0ZVJhbmdlUGlja2VyWydtYXhEYXRlJ107XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLl9tYXhEYXRlO1xuICAgIH1cbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBtaW5EYXRlKGRhdGU6IERhdGUgfCBhbnkpIHtcbiAgICB0aGlzLl9taW5EYXRlID0gZGF0ZTtcbiAgfVxuXG4gIGdldCBtaW5EYXRlKCkge1xuICAgIGlmICh0aGlzLmRhdGVSYW5nZVBpY2tlciAmJiB0aGlzLmRhdGVSYW5nZVBpY2tlclsnbWluRGF0ZSddKSB7XG4gICAgICByZXR1cm4gdGhpcy5kYXRlUmFuZ2VQaWNrZXJbJ21pbkRhdGUnXTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuX21pbkRhdGU7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IHNlbGVjdGVkUmFuZ2UocmFuZ2U6IEFycmF5PERhdGUgfCBudWxsPikge1xuICAgIGlmIChBcnJheS5pc0FycmF5KHJhbmdlKSAmJiByYW5nZS5ldmVyeShfID0+ICghIV8gfHwgXyA9PT0gbnVsbCkpKSB7XG4gICAgICB0aGlzLl9zZWxlY3RlZFJhbmdlID0gcmFuZ2U7XG4gICAgfVxuICB9XG5cbiAgZ2V0IHNlbGVjdGVkUmFuZ2UoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3NlbGVjdGVkUmFuZ2U7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgc2hvd1RpbWUoc2hvd1RpbWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9zaG93VGltZSA9IHNob3dUaW1lO1xuICB9XG5cbiAgZ2V0IHNob3dUaW1lKCkge1xuICAgIHJldHVybiB0eXBlb2YgdGhpcy5fc2hvd1RpbWUgPT09ICdib29sZWFuJyA/IHRoaXMuX3Nob3dUaW1lIDogdGhpcy5kYXRlQ29uZmlnLnRpbWVQaWNrZXI7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgZGF0ZUNvbmZpZyhkYXRlQ29uZmlnOiBhbnkpIHtcbiAgICBpZiAodGhpcy5jaGVja0RhdGVDb25maWcoZGF0ZUNvbmZpZykpIHtcbiAgICAgIHRoaXMuX2RhdGVDb25maWcgPSBkYXRlQ29uZmlnO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9kYXRlQ29uZmlnID0gdGhpcy5kYXRlUGlja2VyQ29uZmlnLmRhdGVDb25maWc7XG4gICAgfVxuICAgIHRoaXMuX2RhdGVGb3JtYXQgPSB0aGlzLnNob3dUaW1lID8gdGhpcy5fZGF0ZUNvbmZpZy5mb3JtYXQudGltZSA6IHRoaXMuX2RhdGVDb25maWcuZm9ybWF0LmRhdGU7XG4gIH1cblxuICBnZXQgZGF0ZUNvbmZpZygpIHtcbiAgICByZXR1cm4gdGhpcy5fZGF0ZUNvbmZpZztcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBkYXRlRm9ybWF0KGRhdGVGb3JtYXQ6IHN0cmluZykge1xuICAgIGlmIChkYXRlRm9ybWF0ICYmIHRoaXMuX2RhdGVGb3JtYXQgIT09IGRhdGVGb3JtYXQpIHtcbiAgICAgIHRoaXMuX2RhdGVGb3JtYXQgPSBkYXRlRm9ybWF0O1xuICAgIH1cbiAgfVxuXG4gIGdldCBkYXRlRm9ybWF0KCkge1xuICAgIHJldHVybiB0aGlzLl9kYXRlRm9ybWF0IHx8IHRoaXMuZGF0ZVBpY2tlckNvbmZpZy5kZWZhdWx0Rm9ybWF0O1xuICB9XG5cbiAgc2V0IHJhbmdlU3RhcnQocmFuZ2VTdGFydDogRGF0ZSkge1xuICAgIGlmICh0aGlzLmRhdGVSYW5nZVBpY2tlcikge1xuICAgICAgdGhpcy5kYXRlUmFuZ2VQaWNrZXJbJ3JhbmdlU3RhcnQnXSA9IHJhbmdlU3RhcnQ7XG4gICAgfVxuICB9XG5cbiAgZ2V0IHJhbmdlRW5kKCkge1xuICAgIGlmICh0aGlzLmRhdGVSYW5nZVBpY2tlcikge1xuICAgICAgcmV0dXJuIHRoaXMuZGF0ZVJhbmdlUGlja2VyWydyYW5nZUVuZCddO1xuICAgIH1cbiAgfVxuXG4gIHNldCBpc09wZW4oaXNPcGVuOiBib29sZWFuKSB7XG4gICAgaWYgKHRoaXMuX2lzT3BlbiAhPT0gaXNPcGVuKSB7XG4gICAgICB0aGlzLl9pc09wZW4gPSBpc09wZW47XG4gICAgICBpZiAoIWlzT3BlbiAmJiAhdGhpcy5yYW5nZUVuZCkge1xuICAgICAgICB0aGlzLnJhbmdlU3RhcnQgPSBudWxsO1xuICAgICAgfVxuICAgICAgaWYgKCFpc09wZW4pIHtcbiAgICAgICAgdGhpcy5zdGFydEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICByZW1vdmVDbGFzc0Zyb21PcmlnaW4odGhpcy5lbGVtZW50UmVmKTtcbiAgICAgICAgdGhpcy5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25Eb2N1bWVudENsaWNrKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGFkZENsYXNzVG9PcmlnaW4odGhpcy5lbGVtZW50UmVmKTtcbiAgICAgICAgICB0aGlzLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkRvY3VtZW50Q2xpY2spO1xuICAgICAgICAgIHRoaXMuc3RhcnRBbmltYXRpb24gPSB0cnVlO1xuICAgICAgICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZ2V0IGlzT3BlbigpIHtcbiAgICByZXR1cm4gdGhpcy5faXNPcGVuO1xuICB9XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgcHJpdmF0ZSBkYXRlUGlja2VyQ29uZmlnOiBEYXRlUGlja2VyQ29uZmlnLFxuICAgIHByaXZhdGUgaTE4bjogSTE4blNlcnZpY2UsXG4gICAgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgZGV2Q29uZmlnU2VydmljZTogRGV2Q29uZmlnU2VydmljZSxcbiAgICBASW5qZWN0KERPQ1VNRU5UKSBwcml2YXRlIGRvYzogYW55XG4gICkge1xuICAgIHRoaXMuX2RhdGVDb25maWcgPSBkYXRlUGlja2VyQ29uZmlnWydkYXRlQ29uZmlnJ107XG4gICAgdGhpcy5kYXRlQ29udmVydGVyID0gZGF0ZVBpY2tlckNvbmZpZ1snZGF0ZUNvbmZpZyddLmRhdGVDb252ZXJ0ZXIgfHwgbmV3IERlZmF1bHREYXRlQ29udmVydGVyKCk7XG4gICAgdGhpcy5fbWluRGF0ZSA9IHRoaXMubWluRGF0ZSA/IG5ldyBEYXRlKHRoaXMubWluRGF0ZSkgOiBuZXcgRGF0ZSh0aGlzLmRhdGVDb25maWcubWluLCAwLCAxLCAwLCAwLCAwKTtcbiAgICB0aGlzLl9tYXhEYXRlID0gdGhpcy5tYXhEYXRlID8gbmV3IERhdGUodGhpcy5tYXhEYXRlKSA6IG5ldyBEYXRlKHRoaXMuZGF0ZUNvbmZpZy5tYXgsIDExLCAzMSwgMjMsIDU5LCA1OSk7XG4gICAgdGhpcy5zZXRJMThuVGV4dCgpO1xuICAgIHRoaXMuZG9jdW1lbnQgPSB0aGlzLmRvYztcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2JsdXInLCBbJyRldmVudCddKVxuICBvbkJsdXIoJGV2ZW50KSB7XG4gICAgdGhpcy5vblRvdWNoZWQoKTtcbiAgICBpZiAoIXRoaXMudmFsaWRhdGVEYXRlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnZhbHVlKSkge1xuICAgICAgdGhpcy5yZXNldFZhbHVlKCk7XG4gICAgfVxuICB9XG5cbiAgY2hlY2tEYXRlQ29uZmlnKGRhdGVDb25maWc6IGFueSkge1xuICAgIGlmICghZGF0ZUNvbmZpZykgeyByZXR1cm4gZmFsc2U7IH1cbiAgICBpZiAodHlwZW9mKGRhdGVDb25maWcudGltZVBpY2tlcikgIT09ICdib29sZWFuJyB8fCAhZGF0ZUNvbmZpZy5tYXggfHwgIWRhdGVDb25maWcubWluIHx8ICFkYXRlQ29uZmlnLmZvcm1hdCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMudXBkYXRlQ2RrQ29ubmVjdGVkT3ZlcmxheU9yaWdpbigpO1xuICAgIHRoaXMuaW5pdElucHV0Q2hhbmdlcygpO1xuICB9XG5cbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vbkNoYW5nZSA9IGZuO1xuICB9XG5cbiAgcmVnaXN0ZXJPblRvdWNoZWQoZm46IGFueSk6IHZvaWQge1xuICAgIHRoaXMub25Ub3VjaGVkID0gZm47XG4gIH1cblxuICBpbml0SW5wdXRDaGFuZ2VzKCk6IHZvaWQge1xuICAgIHRoaXMudmFsdWVDaGFuZ2VTdWJzY3JpcCA9IGZyb21FdmVudCh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ2tleXVwJykucGlwZShcbiAgICAgIG1hcCgoZTogYW55KSA9PiBlLnRhcmdldC52YWx1ZSksXG4gICAgICBmaWx0ZXIoKCkgPT4gIXRoaXMuZGlzYWJsZWQpLFxuICAgICAgZGVib3VuY2VUaW1lKDMwMClcbiAgICApLnN1YnNjcmliZSh2YWx1ZSA9PiB7XG4gICAgICB0aGlzLnRyYW5zVXNlcklucHV0VG9EYXRlcGlja2VyKHZhbHVlKTtcbiAgICB9KTtcbiAgfVxuXG4gIHdyaXRlVmFsdWUoc2VsZWN0ZWRSYW5nZSk6IHZvaWQge1xuICAgIHRoaXMuX3NlbGVjdGVkUmFuZ2UgPSBzZWxlY3RlZFJhbmdlO1xuICAgIGlmIChzZWxlY3RlZFJhbmdlKSB7XG4gICAgICB0aGlzLndyaXRlTW9kZWxWYWx1ZShzZWxlY3RlZFJhbmdlKTtcbiAgICB9XG4gIH1cblxuICBzZXRJMThuVGV4dCgpIHtcbiAgICB0aGlzLmkxOG5Mb2NhbGUgPSB0aGlzLmkxOG4uZ2V0STE4blRleHQoKS5sb2NhbGU7XG4gICAgdGhpcy5pMThuU3Vic2NyaXB0aW9uID0gdGhpcy5pMThuLmxhbmdDaGFuZ2UoKS5zdWJzY3JpYmUoKGRhdGEpID0+IHtcbiAgICAgIHRoaXMuaTE4bkxvY2FsZSA9IGRhdGEubG9jYWxlO1xuICAgIH0pO1xuICB9XG5cbiAgY2hvb3NlRGF0ZSA9IChyYW5nZSwgcmVhc29uPywgaGlkZSA9IHRydWUpID0+IHtcbiAgICBpZiAodGhpcy5kYXRlUmFuZ2VQaWNrZXIgJiYgdGhpcy5kYXRlUmFuZ2VQaWNrZXJbJ2Nob29zZURhdGUnXSkge1xuICAgICAgdGhpcy5kYXRlUmFuZ2VQaWNrZXJbJ2Nob29zZURhdGUnXShyYW5nZSwgcmVhc29uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fc2VsZWN0ZWRSYW5nZSA9IFsuLi5yYW5nZV07XG4gICAgICB0aGlzLm5vdGlmeVZhbHVlQ2hhbmdlKHtcbiAgICAgICAgcmVhc29uOiByZWFzb24sXG4gICAgICAgIHNlbGVjdGVkUmFuZ2U6IFsuLi5yYW5nZV1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuc2hvd1RpbWUgJiYgdGhpcy5oaWRlT25SYW5nZVNlbGVjdGVkICYmIGhpZGUpIHsgdGhpcy5oaWRlKCk7IH1cbiAgfTtcblxuICB1cGRhdGVDZGtDb25uZWN0ZWRPdmVybGF5T3JpZ2luKCkge1xuICAgIGlmICh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCkge1xuICAgICAgdGhpcy5jZGtDb25uZWN0ZWRPdmVybGF5T3JpZ2luID0gbmV3IENka092ZXJsYXlPcmlnaW4oXG4gICAgICAgIGZvcm1XaXRoRHJvcERvd24odGhpcy5lbGVtZW50UmVmKSB8fCB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICB0b2dnbGUoY2xpY2tTaG93PzogYm9vbGVhbikge1xuICAgIGlmIChjbGlja1Nob3cgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5pc09wZW4gPSAhdGhpcy5pc09wZW47XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaXNPcGVuID0gY2xpY2tTaG93O1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBoaWRlKGV2ZW50Pykge1xuICAgIGlmIChldmVudCAhPT0gZmFsc2UpIHtcbiAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB3cml0ZU1vZGVsVmFsdWUoaW5wdXQpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShpbnB1dCkgJiYgaW5wdXQuZXZlcnkoXyA9PiAhIV8pKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFByb3BlcnR5KHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAndmFsdWUnLCB0aGlzLmZvcm1hdERhdGVSYW5nZShpbnB1dCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFByb3BlcnR5KHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAndmFsdWUnLCAnJyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBmb3JtYXREYXRlUmFuZ2UoYXJyKSB7XG4gICAgcmV0dXJuIGFyci5tYXAoKGRhdGUsIGkpID0+IHtcbiAgICAgIHJldHVybiAoZGF0ZSA/XG4gICAgICAgIHRoaXMuZGF0ZUNvbnZlcnRlci5mb3JtYXQoZGF0ZSwgdGhpcy5kYXRlRm9ybWF0LCB0aGlzLmxvY2FsZSB8fCB0aGlzLmkxOG5Mb2NhbGUpIDpcbiAgICAgICAgWydTdGFydCcsICdFbmQnXVtpXSk7XG4gICAgfSkuam9pbih0aGlzLnNwbGl0dGVyKTtcbiAgfVxuXG4gIG9uRG9jdW1lbnRDbGljayA9ICgkZXZlbnQpID0+IHtcbiAgICBsZXQgdGVtcGxhdGVXcmFwO1xuICAgIGlmICh0aGlzLmRhdGVSYW5nZVBpY2tlciAmJiB0aGlzLmRhdGVSYW5nZVBpY2tlclsndGVtcGxhdGVXcmFwJ10pIHtcbiAgICAgIHRlbXBsYXRlV3JhcCA9IHRoaXMuZGF0ZVJhbmdlUGlja2VyWyd0ZW1wbGF0ZVdyYXAnXTtcbiAgICB9XG4gICAgaWYgKHRlbXBsYXRlV3JhcCAmJiB0ZW1wbGF0ZVdyYXAubmF0aXZlRWxlbWVudC5jb250YWlucygkZXZlbnQudGFyZ2V0KSAmJiAhdGhpcy5oaWRlT25SYW5nZVNlbGVjdGVkKSB7XG4gICAgICB0aGlzLmlzT3BlbiA9IHRydWU7XG4gICAgfSBlbHNlIGlmICh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCAhPT0gJGV2ZW50LnRhcmdldCkge1xuICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gIH07XG5cbiAgb25Qb3NpdGlvbkNoYW5nZShwb3NpdGlvbjogQ29ubmVjdGVkT3ZlcmxheVBvc2l0aW9uQ2hhbmdlKSB7XG4gICAgc3dpdGNoIChwb3NpdGlvbi5jb25uZWN0aW9uUGFpci5vdmVybGF5WSkge1xuICAgIGNhc2UgJ3RvcCc6XG4gICAgY2FzZSAnY2VudGVyJzpcbiAgICAgIHRoaXMuZGF0ZXBpY2tlclBvc2l0aW9uID0gJ2JvdHRvbSc7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdib3R0b20nOlxuICAgICAgdGhpcy5kYXRlcGlja2VyUG9zaXRpb24gPSAndG9wJztcbiAgICB9XG4gIH1cblxuICBub3RpZnlWYWx1ZUNoYW5nZShkYXRlT2JqKSB7XG4gICAgdGhpcy53cml0ZVZhbHVlKGRhdGVPYmouc2VsZWN0ZWRSYW5nZSk7XG4gICAgdGhpcy5vbkNoYW5nZShkYXRlT2JqLnNlbGVjdGVkUmFuZ2UpO1xuICAgIHRoaXMub25Ub3VjaGVkKCk7XG4gICAgdGhpcy5zZWxlY3RlZFJhbmdlQ2hhbmdlLmVtaXQoe1xuICAgICAgcmVhc29uOiBkYXRlT2JqLnJlYXNvbixcbiAgICAgIHNlbGVjdGVkUmFuZ2U6IGRhdGVPYmouc2VsZWN0ZWRSYW5nZVxuICAgIH0pO1xuICAgIGlmICghdGhpcy5zaG93VGltZSAmJiB0aGlzLmhpZGVPblJhbmdlU2VsZWN0ZWQpIHsgdGhpcy5oaWRlKCk7IH1cbiAgfVxuXG4gIHByaXZhdGUgdHJhbnNVc2VySW5wdXRUb0RhdGVwaWNrZXIodmFsdWU/OiBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMuc2hvd1RpbWUgJiYgIXRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIGNvbnN0IF92YWx1ZTogc3RyaW5nID0gdmFsdWUgfHwgdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQudmFsdWU7XG4gICAgICBpZiAoIV92YWx1ZSAmJiAhdGhpcy5zZWxlY3RlZFJhbmdlLmV2ZXJ5KHZhbCA9PiAhIXZhbCkpIHtcbiAgICAgICAgdGhpcy5jbGVhckFsbCh1bmRlZmluZWQsIGZhbHNlKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKCFfdmFsdWUpIHtcbiAgICAgICAgdGhpcy5jbGVhckFsbCh1bmRlZmluZWQsIGZhbHNlKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMudmFsaWRhdGVEYXRlKF92YWx1ZSkpIHtcbiAgICAgICAgdGhpcy5jaG9vc2VEYXRlKHRoaXMudmFsdWVMaXN0LCB1bmRlZmluZWQsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yZXNldFZhbHVlKCk7XG4gICAgfVxuICB9XG5cbiAgcmVzZXRWYWx1ZSgpOiB2b2lkIHtcbiAgICB0aGlzLndyaXRlVmFsdWUodGhpcy5zZWxlY3RlZFJhbmdlKTtcbiAgfVxuXG4gIHZhbGlkYXRlRGF0ZSh2YWx1ZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHRoaXMudmFsdWVMaXN0ID0gdmFsdWUuc3BsaXQodGhpcy5zcGxpdHRlcik7XG4gICAgbGV0IHZhbHVlRm9ybWF0O1xuICAgIC8vIOWmguaenOaLhuWHuuadpTbkuKrvvIzliJnkuLrml6XmnJ/pl7TliIbpmpTnrKblkozlubTmnIjml6Xpl7TliIbpmpTnrKbnm7jlkIznmoTmg4XlhrXvvIzmraTmg4XlhrXlhYHorrhcbiAgICBpZiAodGhpcy52YWx1ZUxpc3QubGVuZ3RoID09PSA2ICYmIHRoaXMudmFsdWVMaXN0LmV2ZXJ5KHZhbCA9PiAhIXZhbCkpIHtcbiAgICAgIGNvbnN0IGN1clZhbHVlTGlzdCA9IFtdO1xuICAgICAgdGhpcy52YWx1ZUxpc3QuZm9yRWFjaCgodmFsLCBpbmRleCkgPT4ge1xuICAgICAgICAvLyDmoLnmja7kuIvmoIfvvIzliY3kuInkuKrnu4Too4XlnKjkuIDotbfvvIzlkI7kuInkuKrnu4Too4XlnKjkuIDotbfvvIzkuI3pnIDopoHogIPomZHliIbpmpTnrKbvvIzlkI7pnaLkvJpmb3JtYXRcbiAgICAgICAgaWYgKChpbmRleCArIDEpICUgMyA9PT0gMSkge1xuICAgICAgICAgIGN1clZhbHVlTGlzdC5wdXNoKHZhbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY3VyVmFsdWVMaXN0W01hdGguY2VpbChpbmRleCAvIDMpIC0gMV0gPSBjdXJWYWx1ZUxpc3RbTWF0aC5jZWlsKGluZGV4IC8gMykgLSAxXSArICctJyArIHZhbDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLnZhbHVlTGlzdCA9IGN1clZhbHVlTGlzdDtcbiAgICB9XG4gICAgLy8g5LiN566h5ouG5Ye65p2l5pivNui/mOaYrzLkuKrvvIzpg73pnIDopoHnu4Too4XmiJAy5Liq5pel5pyfXG4gICAgaWYgKFxuICAgICAgdGhpcy52YWx1ZUxpc3QubGVuZ3RoID09PSAyICYmXG4gICAgICB0aGlzLnZhbHVlTGlzdC5ldmVyeSh2YWwgPT4gISF2YWwpICYmXG4gICAgICB0aGlzLnZhbHVlTGlzdC5ldmVyeSgodmFsLCBpbmRleCkgPT4gbmV3IERhdGUodmFsKS5nZXRUaW1lKCkgPT09IG5ldyBEYXRlKHRoaXMuc2VsZWN0ZWRSYW5nZVtpbmRleF0pLmdldFRpbWUoKSlcbiAgICApIHtcbiAgICAgIHRoaXMudmFsdWVMaXN0ID0gdGhpcy52YWx1ZUxpc3QubWFwKHQgPT4gbmV3IERhdGUodCkpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmICghdGhpcy52YWx1ZUxpc3QuZXZlcnkodmFsID0+IG5ldyBEYXRlKHZhbCkuZ2V0VGltZSgpKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAodGhpcy52YWx1ZUxpc3QubGVuZ3RoID09PSAyICYmIHRoaXMudmFsdWVMaXN0LmV2ZXJ5KHZhbCA9PiAhIXZhbCkpIHtcbiAgICAgIGNvbnN0IHZhbHVlVGltZUxpc3QgPSB0aGlzLnZhbHVlTGlzdC5tYXAodmFsID0+IChuZXcgRGF0ZShgJHt2YWx9IDAwOjAwOjAwYCkpLmdldFRpbWUoKSk7XG4gICAgICB2YWx1ZUZvcm1hdCA9IHRoaXMuZm9ybWF0RGF0ZVJhbmdlKHRoaXMudmFsdWVMaXN0Lm1hcChudW1WYWx1ZSA9PiBuZXcgRGF0ZShudW1WYWx1ZSkpKTtcbiAgICAgIGlmIChcbiAgICAgICAgdmFsdWUgPT09IHZhbHVlRm9ybWF0ICYmXG4gICAgICAgICF2YWx1ZVRpbWVMaXN0LmV2ZXJ5KCh2YWwpID0+IHtcbiAgICAgICAgICByZXR1cm4gKHZhbCA+PSB0aGlzLm1pbkRhdGUuZ2V0VGltZSgpICYmIHZhbCA8PSB0aGlzLm1heERhdGUuZ2V0VGltZSgpKTtcbiAgICAgICAgfSlcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyDliKTmlq3liY3lkI7kv6nml6XmnJ/mmK/lkKblpKfkuo7mnIDlsI/vvIzlsI/kuo7mnIDlpKfvvIzoi6XmmK/liJnlkIjms5XvvIzov5vooYzlpoLkuIvmk43kvZxcbiAgICAgICAgLy8g5q2k5pe25YyF5ousdmFsdWXkuLpOYU7ml6Lml6XmnJ/moLzlvI/kuI3mraPnoa7nmoTmg4XlhrXvvIzlr7nlhbbov5vooYzlpITnkIbkuIvmlrnliKTmlq3kvJrov4fmu6TmjolcbiAgICAgICAgdGhpcy52YWx1ZUxpc3QgPSB0aGlzLnZhbHVlTGlzdC5tYXAodmFsID0+IG5ldyBEYXRlKHZhbCkuZ2V0VGltZSgpKS5zb3J0KChhLCBiKSA9PiBhIC0gYikubWFwKG51bVZhbHVlID0+IG5ldyBEYXRlKG51bVZhbHVlKSk7XG4gICAgICB9XG4gICAgICBpZiAodmFsdWVGb3JtYXQgJiYgdmFsdWUgPT09IHZhbHVlRm9ybWF0KSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5oaWRlKCk7XG4gICAgaWYgKHRoaXMuaTE4blN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy5pMThuU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnZhbHVlQ2hhbmdlU3Vic2NyaXApIHtcbiAgICAgIHRoaXMudmFsdWVDaGFuZ2VTdWJzY3JpcC51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgICB0aGlzLmRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkRvY3VtZW50Q2xpY2spO1xuICB9XG5cbiAgY2xlYXJBbGwgPSAocmVhc29uPzogU2VsZWN0RGF0ZVJhbmdlQ2hhbmdlUmVhc29uLCBoaWRlPzogYm9vbGVhbikgPT4ge1xuICAgIGNvbnN0IGN1cnJlbnRSZWFzb24gPSB0eXBlb2YgcmVhc29uID09PSAnbnVtYmVyJyA/IHJlYXNvbiA6IFNlbGVjdERhdGVSYW5nZUNoYW5nZVJlYXNvbi5jdXN0b207XG4gICAgdGhpcy5jaG9vc2VEYXRlKFtudWxsLCBudWxsXSwgY3VycmVudFJlYXNvbiwgaGlkZSk7XG4gIH07XG5cbn1cbiIsIjxuZy10ZW1wbGF0ZVxuICBjZGstY29ubmVjdGVkLW92ZXJsYXlcbiAgW2Nka0Nvbm5lY3RlZE92ZXJsYXlPcmlnaW5dPVwiY2RrQ29ubmVjdGVkT3ZlcmxheU9yaWdpblwiXG4gIFtjZGtDb25uZWN0ZWRPdmVybGF5T3Blbl09XCJpc09wZW5cIlxuICAoYmFja2Ryb3BDbGljayk9XCJpc09wZW49ZmFsc2VcIlxuICAocG9zaXRpb25DaGFuZ2UpPVwib25Qb3NpdGlvbkNoYW5nZSgkZXZlbnQpXCJcbj5cbiAgPGRpdiBbQGZhZGVJbk91dF09XCJzdGFydEFuaW1hdGlvbiA/IGRhdGVwaWNrZXJQb3NpdGlvbiA6ICd2b2lkJ1wiIFtALmRpc2FibGVkXT1cIiFzaG93QW5pbWF0aW9uXCIgY2xhc3M9XCJkZXZ1aS1kYXRlLXJhbmdlLXdyYXBwZXJcIj5cbiAgICA8ZC1kYXRlLXJhbmdlLXBpY2tlclxuICAgICAgI2RhdGVSYW5nZVBpY2tlclxuICAgICAgW2xvY2FsZV09XCJsb2NhbGVcIlxuICAgICAgW2Nzc0NsYXNzXT1cImNzc0NsYXNzXCJcbiAgICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiXG4gICAgICBbZGF0ZUNvbnZlcnRlcl09XCJkYXRlQ29udmVydGVyXCJcbiAgICAgIFtjdXN0b21WaWV3VGVtcGxhdGVdPVwiY3VzdG9tVmlld1RlbXBsYXRlXCJcbiAgICAgIFttaW5EYXRlXT1cIm1pbkRhdGVcIlxuICAgICAgW21heERhdGVdPVwibWF4RGF0ZVwiXG4gICAgICBbZGF0ZUZvcm1hdF09XCJkYXRlRm9ybWF0XCJcbiAgICAgIFtzaG93VGltZV09XCJzaG93VGltZVwiXG4gICAgICBbc2VsZWN0ZWRSYW5nZV09XCJzZWxlY3RlZFJhbmdlXCJcbiAgICAgIChzZWxlY3RlZFJhbmdlQ2hhbmdlKT1cIm5vdGlmeVZhbHVlQ2hhbmdlKCRldmVudClcIlxuICAgICAgKGhpZGUpPVwiaGlkZSgkZXZlbnQpXCJcbiAgICAgIFsobmdNb2RlbCldPVwiX3NlbGVjdGVkUmFuZ2VcIlxuICAgID48L2QtZGF0ZS1yYW5nZS1waWNrZXI+XG4gIDwvZGl2PlxuPC9uZy10ZW1wbGF0ZT5cbiJdfQ==