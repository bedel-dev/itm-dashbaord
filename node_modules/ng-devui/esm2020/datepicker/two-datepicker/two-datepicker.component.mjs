import { __decorate, __metadata } from "tslib";
import { CdkOverlayOrigin } from '@angular/cdk/overlay';
import { DOCUMENT } from '@angular/common';
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, Inject, Input, Output, ViewChild } from '@angular/core';
import { I18nService } from 'ng-devui/i18n';
import { DefaultDateConverter, DevConfigService, fadeInOut, WithConfig } from 'ng-devui/utils';
import { Subject } from 'rxjs';
import { distinctUntilChanged } from 'rxjs/operators';
import { DatePickerConfigService as DatePickerConfig } from '../date-picker.config.service';
import * as i0 from "@angular/core";
import * as i1 from "../date-picker.config.service";
import * as i2 from "ng-devui/i18n";
import * as i3 from "ng-devui/utils";
import * as i4 from "./two-datepicker-single.component";
import * as i5 from "ng-devui/button";
import * as i6 from "@angular/cdk/overlay";
import * as i7 from "@angular/common";
export class TwoDatePickerComponent {
    constructor(el, datePickerConfig, i18n, cdr, devConfigService, doc) {
        this.el = el;
        this.datePickerConfig = datePickerConfig;
        this.i18n = i18n;
        this.cdr = cdr;
        this.devConfigService = devConfigService;
        this.doc = doc;
        this.showAnimation = true;
        this.showTime = false;
        this.selectedRange = [null, null];
        this.hideOnRangeSelected = true;
        this.selectedRangeChange = new EventEmitter();
        this.datePosition = 'bottom';
        this.selectDateSubject = new Subject();
        this.hoverOnDate = new Subject();
        this.switchOriginPositionSub = new Subject();
        this.today = new Date();
        this.startAnimation = false;
        this.currentCalendars = [null, null];
        this._isOpen = false;
        this.onDocumentClick = ($event) => {
            if (!this.el.nativeElement.contains($event.target)) {
                this.whichOpen = false;
                this.isOpen = false;
            }
            this.cdr.markForCheck();
        };
        this.toggle = (side = 'start') => {
            if (this.isOpen) {
                if (side === 'start') {
                    if (this.whichOpen === 'start') {
                        this.whichOpen = false;
                        this.isOpen = false;
                    }
                    else { // this.whichOpen === 'end'
                        this.whichOpen = 'start';
                    }
                }
                else { // side === 'end'
                    if (this.whichOpen === 'start') {
                        this.whichOpen = 'end';
                    }
                    else { // this.whichOpen === 'end'
                        this.whichOpen = false;
                        this.isOpen = false;
                    }
                }
            }
            else {
                this.whichOpen = side;
                this.isOpen = true;
            }
        };
        this.chooseDate = (range) => {
            if (range && Array.isArray(this.selectedRange)) {
                this.selectedRange = range;
                [this.rangeStart, this.rangeEnd] = this.selectedRange;
                this.notifyValueChange();
            }
        };
        this.clear = (side) => {
            if (this.disabled) {
                return;
            }
            if (side === 'start') {
                this.selectStart(null);
            }
            else if (side === 'end') {
                this.selectEnd(null);
            }
            [this.rangeStart, this.rangeEnd] = this.selectedRange;
        };
        this._dateConfig = datePickerConfig['dateConfig'];
        this.dateConverter = datePickerConfig['dateConfig'].dateConverter || new DefaultDateConverter();
        this.setI18nText();
        this.document = this.doc;
    }
    set dateConfig(dateConfig) {
        if (this.checkDateConfig(dateConfig)) {
            this._dateConfig = dateConfig;
        }
        else {
            this._dateConfig = this.datePickerConfig.dateConfig;
        }
        this._dateFormat = this.showTime ? this._dateConfig.format.time : this._dateConfig.format.date;
    }
    get dateConfig() {
        return this._dateConfig;
    }
    set dateFormat(dateFormat) {
        if (dateFormat && this._dateFormat !== dateFormat) {
            this._dateFormat = dateFormat;
        }
    }
    get dateFormat() {
        return this._dateFormat || this.datePickerConfig.defaultFormat;
    }
    set maxDate(date) {
        const parseDate = this.convertDate(date);
        if (parseDate) {
            this._maxDate = parseDate;
        }
    }
    get maxDate() {
        return this._maxDate;
    }
    set minDate(date) {
        const parseDate = this.convertDate(date);
        if (parseDate) {
            this._minDate = parseDate;
        }
    }
    get minDate() {
        return this._minDate;
    }
    set whichOpen(side) {
        this._whichOpen = side;
        this.switchOriginPositionSub.next(side);
    }
    get whichOpen() {
        return this._whichOpen;
    }
    set isOpen(isOpen) {
        this._isOpen = isOpen;
        if (!isOpen) {
            this.startAnimation = false;
            this.document.removeEventListener('click', this.onDocumentClick);
        }
        else {
            setTimeout(() => {
                this.startAnimation = true;
                this.cdr.detectChanges();
                this.document.addEventListener('click', this.onDocumentClick);
            });
        }
    }
    get isOpen() {
        return this._isOpen;
    }
    checkDateConfig(dateConfig) {
        if (!dateConfig) {
            return false;
        }
        if (typeof (dateConfig.timePicker) !== 'boolean' || !dateConfig.max || !dateConfig.min || !dateConfig.format) {
            return false;
        }
        return true;
    }
    ngOnInit() {
        this._minDate = this.minDate ? new Date(this.minDate) : new Date(this.dateConfig.min, 0, 1, 0, 0, 0);
        this._maxDate = this.maxDate ? new Date(this.maxDate) : new Date(this.dateConfig.max, 11, 31, 23, 59, 59);
        this.updateCdkConnectedOverlayOrigin(this.el.nativeElement);
        this.subscribeHoverActions();
    }
    isDisableToday() {
        if ((this.minDate.getTime() >= (this.today).getTime()) || (this.maxDate.getTime() <= (this.today).getTime())) {
            this.disableToday = true;
        }
        else {
            this.disableToday = false;
        }
    }
    onPositionChange(position) {
        switch (position.connectionPair.overlayY) {
            case 'top':
            case 'center':
                this.datePosition = 'bottom';
                break;
            case 'bottom':
                this.datePosition = 'top';
        }
        this.switchOriginPositionSub.next(this.whichOpen);
    }
    convertDate(date) {
        return date ?
            this.dateConverter.parse(date, this.dateFormat) : null;
    }
    formatDate(date) {
        return date ?
            this.dateConverter.format(date, this.dateFormat, this.locale || this.i18nLocale) : null;
    }
    updateCdkConnectedOverlayOrigin(el) {
        if (el) {
            this.cdkConnectedOverlayOrigin = new CdkOverlayOrigin(el);
        }
        else {
            this.cdkConnectedOverlayOrigin = undefined;
        }
    }
    syncPickerPair(currentCalender, orientation) {
        switch (orientation) {
            case 'left':
                this.currentCalendars[0] = currentCalender;
                break;
            case 'right':
                this.currentCalendars[1] = currentCalender;
                break;
        }
    }
    rangeChange(data) {
        this.chooseDate(data.selectedRange);
        this.selectDateSubject.next({ side: 'start', date: this.rangeStart, onlyWrite: true });
        this.selectDateSubject.next({ side: 'end', date: this.rangeEnd, onlyWrite: true });
    }
    notifyValueChange() {
        this.selectedRangeChange.emit(this.selectedRange);
    }
    selectingDate(event) {
        this.hoverOnDate.next(event);
    }
    subscribeHoverActions() {
        this.hoverOnDate.pipe(distinctUntilChanged()).subscribe((date) => {
            this.previewRangeEnd(date);
        });
    }
    previewRangeEnd(date) {
        this.leftPicker['previewEnd'] = date;
        this.rightPicker['previewEnd'] = date;
    }
    syncRangeStart(rangeStart, picker) {
        if (this.whichOpen === 'end') {
            this.selectEnd(rangeStart);
        }
        else { // this.whichOpen === 'start'
            this.selectStart(rangeStart);
        }
        picker.selectRange(rangeStart, true);
    }
    selectStart(date, passive = false) {
        this.selectedRange[0] = date;
        this.rangeStart = date;
        this.isDisableToday();
        if (!passive) {
            this.selectDateSubject.next({ side: 'start', date });
            this.whichOpen = 'end';
        }
    }
    selectEnd(date, passive = false) {
        this.selectedRange[1] = date;
        this.rangeEnd = date;
        this.isDisableToday();
        if (!passive) {
            this.selectDateSubject.next({ side: 'end', date: date });
            if (!this.showTime && this.hideOnRangeSelected) {
                this.isOpen = false;
                this.whichOpen = false;
            }
        }
    }
    chooseToday(event) {
        event.preventDefault();
        event.stopPropagation();
        if ((this.minDate.getTime() <= (this.today).getTime()) && (this.maxDate.getTime() >= (this.today).getTime())) {
            if (this.whichOpen === 'start') {
                this.selectStart(this.today);
            }
            else if (this.whichOpen === 'end') {
                this.selectEnd(this.today);
            }
            [this.rangeStart, this.rangeEnd] = this.selectedRange;
        }
    }
    clearBtn(event) {
        event.preventDefault();
        event.stopPropagation();
        if (this.whichOpen) {
            this.clear(this.whichOpen);
        }
    }
    setI18nText() {
        this.i18nText = this.i18n.getI18nText().datePicker;
        this.i18nLocale = this.i18n.getI18nText().locale;
        this.i18nSubscription = this.i18n.langChange().subscribe((data) => {
            this.i18nText = data.datePicker;
            this.i18nLocale = data.locale;
        });
    }
    ngOnDestroy() {
        this.isOpen = false;
        if (this.i18nSubscription) {
            this.i18nSubscription.unsubscribe();
        }
        this.document.removeEventListener('click', this.onDocumentClick);
    }
}
TwoDatePickerComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: TwoDatePickerComponent, deps: [{ token: i0.ElementRef }, { token: i1.DatePickerConfigService }, { token: i2.I18nService }, { token: i0.ChangeDetectorRef }, { token: i3.DevConfigService }, { token: DOCUMENT }], target: i0.ɵɵFactoryTarget.Component });
TwoDatePickerComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.3", type: TwoDatePickerComponent, selector: "[dTwoDatePicker]", inputs: { locale: "locale", cssClass: "cssClass", disabled: "disabled", dateConverter: "dateConverter", showAnimation: "showAnimation", hideOnRangeSelected: "hideOnRangeSelected", dateConfig: "dateConfig", dateFormat: "dateFormat", maxDate: "maxDate", minDate: "minDate" }, outputs: { selectedRangeChange: "selectedRangeChange" }, viewQueries: [{ propertyName: "leftPicker", first: true, predicate: ["leftPicker"], descendants: true }, { propertyName: "rightPicker", first: true, predicate: ["rightPicker"], descendants: true }, { propertyName: "templateWrap", first: true, predicate: ["templateWrap"], descendants: true }], exportAs: ["twoDatePicker"], ngImport: i0, template: "<ng-content></ng-content>\n<ng-template\n  cdk-connected-overlay\n  [cdkConnectedOverlayOrigin]=\"cdkConnectedOverlayOrigin\"\n  [cdkConnectedOverlayOpen]=\"isOpen\"\n  (backdropClick)=\"isOpen = false\"\n  (positionChange)=\"onPositionChange($event)\"\n>\n  <div [@fadeInOut]=\"startAnimation ? datePosition : 'void'\" [@.disabled]=\"!showAnimation\" class=\"devui-two-date-wrapper\">\n    <div class=\"devui-two-date-picker\">\n      <d-two-datepicker-single\n        class=\"devui-date-picker\"\n        [locale]=\"locale\"\n        [cssClass]=\"cssClass\"\n        [disabled]=\"disabled\"\n        [dateConverter]=\"dateConverter\"\n        [dateConfig]=\"dateConfig\"\n        [maxDate]=\"maxDate\"\n        [minDate]=\"minDate\"\n        [rangePicker]=\"true\"\n        [selectedRange]=\"[rangeStart, rangeEnd]\"\n        [currentCalendars]=\"currentCalendars\"\n        [showTime]=\"showTime\"\n        (rangeSelected)=\"rangeChange($event)\"\n        (hoverOnDate)=\"selectingDate($event)\"\n        (rangeSelecting)=\"syncRangeStart($event, rightPicker)\"\n        (syncPickerPair)=\"syncPickerPair($event, 'left')\"\n        [whichOpen]=\"whichOpen\"\n        #leftPicker\n      >\n      </d-two-datepicker-single>\n      <d-two-datepicker-single\n        class=\"devui-date-picker\"\n        [locale]=\"locale\"\n        [cssClass]=\"cssClass\"\n        [disabled]=\"disabled\"\n        [dateConverter]=\"dateConverter\"\n        [dateConfig]=\"dateConfig\"\n        [maxDate]=\"maxDate\"\n        [minDate]=\"minDate\"\n        [rangePicker]=\"true\"\n        [selectedRange]=\"[rangeStart, rangeEnd]\"\n        [currentCalendars]=\"currentCalendars\"\n        [showTime]=\"showTime\"\n        (rangeSelected)=\"rangeChange($event)\"\n        (hoverOnDate)=\"selectingDate($event)\"\n        (rangeSelecting)=\"syncRangeStart($event, leftPicker)\"\n        (syncPickerPair)=\"syncPickerPair($event, 'right')\"\n        [isAuxiliary]=\"true\"\n        [whichOpen]=\"whichOpen\"\n        #rightPicker\n      >\n      </d-two-datepicker-single>\n    </div>\n    <div *ngIf=\"!customViewTemplate\" class=\"devui-two-date-footer devui-two-date-custom\">\n      <a\n        [ngClass]=\"{\n          disabled: disableToday\n        }\"\n        (click)=\"chooseToday($event)\"\n        >{{ i18nText.today }}</a\n      >\n      <d-button bsStyle=\"common\" (btnClick)=\"clearBtn($event)\" bsSize=\"sm\">{{ i18nText.clear }}</d-button>\n    </div>\n  </div>\n</ng-template>\n", styles: [".devui-two-date-wrapper{display:inline-flex!important;box-shadow:0 2px 8px rgba(37,43,58,.2);box-shadow:var(--devui-shadow-connected-overlay, 0 2px 8px 0) var(--devui-shadow, rgba(37, 43, 58, .2));background-color:#fff;background-color:var(--devui-connected-overlay-bg, #ffffff);transform:perspective(1px) translate(0);flex-direction:column;border-radius:2px;border-radius:var(--devui-border-radius, 2px);margin:4px 0}.devui-two-date-wrapper .devui-two-date-picker{display:inline-flex!important;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.devui-two-date-wrapper .devui-two-date-custom{width:500px;border-top:1px solid #d7d8da;border-top:1px solid var(--devui-line, #d7d8da)}.devui-two-date-wrapper .devui-two-date-footer{padding:10px;display:flex;justify-content:space-between;align-items:center}.devui-two-date-wrapper .devui-two-date-footer a{color:#526ecc;color:var(--devui-link, #526ecc);text-decoration:none;cursor:pointer}.devui-two-date-wrapper .devui-two-date-footer a.disabled{color:#d7d8da;color:var(--devui-line, #d7d8da);cursor:not-allowed}.devui-date-picker:not(:last-child){margin-right:20px}.host-wrapper{color:red}\n"], components: [{ type: i4.TwoDatepickerSingleComponent, selector: "d-two-datepicker-single", inputs: ["selectedRange", "rangePicker", "isAuxiliary", "currentCalendars", "whichOpen"], outputs: ["hoverOnDate", "rangeSelected", "rangeSelecting", "syncPickerPair", "consolidateTime"] }, { type: i5.ButtonComponent, selector: "d-button", inputs: ["id", "type", "bsStyle", "shape", "bsSize", "bsPosition", "bordered", "icon", "disabled", "showLoading", "width", "autofocus", "loadingTemplateRef"], outputs: ["btnClick"] }], directives: [{ type: i6.CdkConnectedOverlay, selector: "[cdk-connected-overlay], [connected-overlay], [cdkConnectedOverlay]", inputs: ["cdkConnectedOverlayOrigin", "cdkConnectedOverlayPositions", "cdkConnectedOverlayPositionStrategy", "cdkConnectedOverlayOffsetX", "cdkConnectedOverlayOffsetY", "cdkConnectedOverlayWidth", "cdkConnectedOverlayHeight", "cdkConnectedOverlayMinWidth", "cdkConnectedOverlayMinHeight", "cdkConnectedOverlayBackdropClass", "cdkConnectedOverlayPanelClass", "cdkConnectedOverlayViewportMargin", "cdkConnectedOverlayScrollStrategy", "cdkConnectedOverlayOpen", "cdkConnectedOverlayDisableClose", "cdkConnectedOverlayTransformOriginOn", "cdkConnectedOverlayHasBackdrop", "cdkConnectedOverlayLockPosition", "cdkConnectedOverlayFlexibleDimensions", "cdkConnectedOverlayGrowAfterOpen", "cdkConnectedOverlayPush"], outputs: ["backdropClick", "positionChange", "attach", "detach", "overlayKeydown", "overlayOutsideClick"], exportAs: ["cdkConnectedOverlay"] }, { type: i7.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i7.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }], animations: [
        fadeInOut
    ] });
__decorate([
    WithConfig(),
    __metadata("design:type", Object)
], TwoDatePickerComponent.prototype, "showAnimation", void 0);
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: TwoDatePickerComponent, decorators: [{
            type: Component,
            args: [{ selector: '[dTwoDatePicker]', exportAs: 'twoDatePicker', animations: [
                        fadeInOut
                    ], template: "<ng-content></ng-content>\n<ng-template\n  cdk-connected-overlay\n  [cdkConnectedOverlayOrigin]=\"cdkConnectedOverlayOrigin\"\n  [cdkConnectedOverlayOpen]=\"isOpen\"\n  (backdropClick)=\"isOpen = false\"\n  (positionChange)=\"onPositionChange($event)\"\n>\n  <div [@fadeInOut]=\"startAnimation ? datePosition : 'void'\" [@.disabled]=\"!showAnimation\" class=\"devui-two-date-wrapper\">\n    <div class=\"devui-two-date-picker\">\n      <d-two-datepicker-single\n        class=\"devui-date-picker\"\n        [locale]=\"locale\"\n        [cssClass]=\"cssClass\"\n        [disabled]=\"disabled\"\n        [dateConverter]=\"dateConverter\"\n        [dateConfig]=\"dateConfig\"\n        [maxDate]=\"maxDate\"\n        [minDate]=\"minDate\"\n        [rangePicker]=\"true\"\n        [selectedRange]=\"[rangeStart, rangeEnd]\"\n        [currentCalendars]=\"currentCalendars\"\n        [showTime]=\"showTime\"\n        (rangeSelected)=\"rangeChange($event)\"\n        (hoverOnDate)=\"selectingDate($event)\"\n        (rangeSelecting)=\"syncRangeStart($event, rightPicker)\"\n        (syncPickerPair)=\"syncPickerPair($event, 'left')\"\n        [whichOpen]=\"whichOpen\"\n        #leftPicker\n      >\n      </d-two-datepicker-single>\n      <d-two-datepicker-single\n        class=\"devui-date-picker\"\n        [locale]=\"locale\"\n        [cssClass]=\"cssClass\"\n        [disabled]=\"disabled\"\n        [dateConverter]=\"dateConverter\"\n        [dateConfig]=\"dateConfig\"\n        [maxDate]=\"maxDate\"\n        [minDate]=\"minDate\"\n        [rangePicker]=\"true\"\n        [selectedRange]=\"[rangeStart, rangeEnd]\"\n        [currentCalendars]=\"currentCalendars\"\n        [showTime]=\"showTime\"\n        (rangeSelected)=\"rangeChange($event)\"\n        (hoverOnDate)=\"selectingDate($event)\"\n        (rangeSelecting)=\"syncRangeStart($event, leftPicker)\"\n        (syncPickerPair)=\"syncPickerPair($event, 'right')\"\n        [isAuxiliary]=\"true\"\n        [whichOpen]=\"whichOpen\"\n        #rightPicker\n      >\n      </d-two-datepicker-single>\n    </div>\n    <div *ngIf=\"!customViewTemplate\" class=\"devui-two-date-footer devui-two-date-custom\">\n      <a\n        [ngClass]=\"{\n          disabled: disableToday\n        }\"\n        (click)=\"chooseToday($event)\"\n        >{{ i18nText.today }}</a\n      >\n      <d-button bsStyle=\"common\" (btnClick)=\"clearBtn($event)\" bsSize=\"sm\">{{ i18nText.clear }}</d-button>\n    </div>\n  </div>\n</ng-template>\n", styles: [".devui-two-date-wrapper{display:inline-flex!important;box-shadow:0 2px 8px rgba(37,43,58,.2);box-shadow:var(--devui-shadow-connected-overlay, 0 2px 8px 0) var(--devui-shadow, rgba(37, 43, 58, .2));background-color:#fff;background-color:var(--devui-connected-overlay-bg, #ffffff);transform:perspective(1px) translate(0);flex-direction:column;border-radius:2px;border-radius:var(--devui-border-radius, 2px);margin:4px 0}.devui-two-date-wrapper .devui-two-date-picker{display:inline-flex!important;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.devui-two-date-wrapper .devui-two-date-custom{width:500px;border-top:1px solid #d7d8da;border-top:1px solid var(--devui-line, #d7d8da)}.devui-two-date-wrapper .devui-two-date-footer{padding:10px;display:flex;justify-content:space-between;align-items:center}.devui-two-date-wrapper .devui-two-date-footer a{color:#526ecc;color:var(--devui-link, #526ecc);text-decoration:none;cursor:pointer}.devui-two-date-wrapper .devui-two-date-footer a.disabled{color:#d7d8da;color:var(--devui-line, #d7d8da);cursor:not-allowed}.devui-date-picker:not(:last-child){margin-right:20px}.host-wrapper{color:red}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i1.DatePickerConfigService }, { type: i2.I18nService }, { type: i0.ChangeDetectorRef }, { type: i3.DevConfigService }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }]; }, propDecorators: { locale: [{
                type: Input
            }], cssClass: [{
                type: Input
            }], disabled: [{
                type: Input
            }], dateConverter: [{
                type: Input
            }], showAnimation: [{
                type: Input
            }], hideOnRangeSelected: [{
                type: Input
            }], selectedRangeChange: [{
                type: Output
            }], leftPicker: [{
                type: ViewChild,
                args: ['leftPicker']
            }], rightPicker: [{
                type: ViewChild,
                args: ['rightPicker']
            }], templateWrap: [{
                type: ViewChild,
                args: ['templateWrap']
            }], dateConfig: [{
                type: Input
            }], dateFormat: [{
                type: Input
            }], maxDate: [{
                type: Input
            }], minDate: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHdvLWRhdGVwaWNrZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vZGV2dWkvZGF0ZXBpY2tlci90d28tZGF0ZXBpY2tlci90d28tZGF0ZXBpY2tlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9kZXZ1aS9kYXRlcGlja2VyL3R3by1kYXRlcGlja2VyL3R3by1kYXRlcGlja2VyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsZ0JBQWdCLEVBQXlELE1BQU0sc0JBQXNCLENBQUM7QUFDL0csT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFDTCxpQkFBaUIsRUFDakIsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osTUFBTSxFQUNOLEtBQUssRUFHTCxNQUFNLEVBRU4sU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBaUIsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNELE9BQU8sRUFBaUIsb0JBQW9CLEVBQUUsZ0JBQWdCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzlHLE9BQU8sRUFBRSxPQUFPLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQzdDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3RELE9BQU8sRUFBRSx1QkFBdUIsSUFBSSxnQkFBZ0IsRUFBRSxNQUFNLCtCQUErQixDQUFDOzs7Ozs7Ozs7QUFZNUYsTUFBTSxPQUFPLHNCQUFzQjtJQWtHakMsWUFDUyxFQUFjLEVBQ1gsZ0JBQWtDLEVBQ3BDLElBQWlCLEVBQ2pCLEdBQXNCLEVBQ3RCLGdCQUFrQyxFQUNoQixHQUFRO1FBTDNCLE9BQUUsR0FBRixFQUFFLENBQVk7UUFDWCxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ3BDLFNBQUksR0FBSixJ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SSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsRUFBRSxDQUFDO1NBQ3JDO1FBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQ25FLENBQUM7O21IQWxVVSxzQkFBc0IsK0tBd0d2QixRQUFRO3VHQXhHUCxzQkFBc0Isc3NCQy9CbkMsZzdFQWtFQSxxeUZEdkNjO1FBQ1YsU0FBUztLQUNWO0FBT3NCO0lBQWIsVUFBVSxFQUFFOzs2REFBc0I7MkZBTGpDLHNCQUFzQjtrQkFWbEMsU0FBUzsrQkFFRSxrQkFBa0IsWUFDbEIsZUFBZSxjQUdiO3dCQUNWLFNBQVM7cUJBQ1Y7OzBCQTBHRSxNQUFNOzJCQUFDLFFBQVE7NENBdkdULE1BQU07c0JBQWQsS0FBSztnQkFDRyxRQUFRO3NCQUFoQixLQUFLO2dCQUNHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBQ0csYUFBYTtzQkFBckIsS0FBSztnQkFDaUIsYUFBYTtzQkFBbkMsS0FBSztnQkFHRyxtQkFBbUI7c0JBQTNCLEtBQUs7Z0JBRUksbUJBQW1CO3NCQUE1QixNQUFNO2dCQUNrQixVQUFVO3NCQUFsQyxTQUFTO3VCQUFDLFlBQVk7Z0JBQ0csV0FBVztzQkFBcEMsU0FBUzt1QkFBQyxhQUFhO2dCQUNHLFlBQVk7c0JBQXRDLFNBQVM7dUJBQUMsY0FBYztnQkF3QlosVUFBVTtzQkFBdEIsS0FBSztnQkFXTyxVQUFVO3NCQUF0QixLQUFLO2dCQVFPLE9BQU87c0JBQW5CLEtBQUs7Z0JBU08sT0FBTztzQkFBbkIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENka092ZXJsYXlPcmlnaW4sIENvbm5lY3RlZE92ZXJsYXlQb3NpdGlvbkNoYW5nZSwgVmVydGljYWxDb25uZWN0aW9uUG9zIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL292ZXJsYXknO1xuaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBJbmplY3QsXG4gIElucHV0LFxuICBPbkRlc3Ryb3ksXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBUZW1wbGF0ZVJlZixcbiAgVmlld0NoaWxkXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSTE4bkludGVyZmFjZSwgSTE4blNlcnZpY2UgfSBmcm9tICduZy1kZXZ1aS9pMThuJztcbmltcG9ydCB7IERhdGVDb252ZXJ0ZXIsIERlZmF1bHREYXRlQ29udmVydGVyLCBEZXZDb25maWdTZXJ2aWNlLCBmYWRlSW5PdXQsIFdpdGhDb25maWcgfSBmcm9tICduZy1kZXZ1aS91dGlscyc7XG5pbXBvcnQgeyBTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgRGF0ZVBpY2tlckNvbmZpZ1NlcnZpY2UgYXMgRGF0ZVBpY2tlckNvbmZpZyB9IGZyb20gJy4uL2RhdGUtcGlja2VyLmNvbmZpZy5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvY29tcG9uZW50LXNlbGVjdG9yKi9cbiAgc2VsZWN0b3I6ICdbZFR3b0RhdGVQaWNrZXJdJyxcbiAgZXhwb3J0QXM6ICd0d29EYXRlUGlja2VyJyxcbiAgdGVtcGxhdGVVcmw6ICd0d28tZGF0ZXBpY2tlci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3R3by1kYXRlcGlja2VyLmNvbXBvbmVudC5zY3NzJ10sXG4gIGFuaW1hdGlvbnM6IFtcbiAgICBmYWRlSW5PdXRcbiAgXVxufSlcbmV4cG9ydCBjbGFzcyBUd29EYXRlUGlja2VyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKSBsb2NhbGU6IHN0cmluZztcbiAgQElucHV0KCkgY3NzQ2xhc3M6IHN0cmluZztcbiAgQElucHV0KCkgZGlzYWJsZWQ6IGJvb2xlYW47XG4gIEBJbnB1dCgpIGRhdGVDb252ZXJ0ZXI6IERhdGVDb252ZXJ0ZXI7XG4gIEBJbnB1dCgpIEBXaXRoQ29uZmlnKCkgc2hvd0FuaW1hdGlvbiA9IHRydWU7XG4gIHNob3dUaW1lID0gZmFsc2U7XG4gIHNlbGVjdGVkUmFuZ2UgPSBbbnVsbCwgbnVsbF07XG4gIEBJbnB1dCgpIGhpZGVPblJhbmdlU2VsZWN0ZWQgPSB0cnVlO1xuICBjdXN0b21WaWV3VGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG4gIEBPdXRwdXQoKSBzZWxlY3RlZFJhbmdlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBWaWV3Q2hpbGQoJ2xlZnRQaWNrZXInKSBsZWZ0UGlja2VyOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdyaWdodFBpY2tlcicpIHJpZ2h0UGlja2VyOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCd0ZW1wbGF0ZVdyYXAnKSB0ZW1wbGF0ZVdyYXA6IEVsZW1lbnRSZWY7XG5cbiAgZGF0ZVBvc2l0aW9uOiBWZXJ0aWNhbENvbm5lY3Rpb25Qb3MgPSAnYm90dG9tJztcbiAgc2VsZWN0RGF0ZVN1YmplY3QgPSBuZXcgU3ViamVjdDx7c2lkZTogc3RyaW5nOyBkYXRlOiBEYXRlOyBvbmx5V3JpdGU/OiBib29sZWFufT4oKTtcbiAgaG92ZXJPbkRhdGU6IFN1YmplY3Q8b2JqZWN0PiA9IG5ldyBTdWJqZWN0PG9iamVjdD4oKTtcbiAgc3dpdGNoT3JpZ2luUG9zaXRpb25TdWI6IFN1YmplY3Q8J3N0YXJ0J3wnZW5kJ3xmYWxzZT4gPSBuZXcgU3ViamVjdDwnc3RhcnQnfCdlbmQnfGZhbHNlPigpO1xuICB0b2RheSA9IG5ldyBEYXRlKCk7XG4gIHJhbmdlU3RhcnQ7XG4gIHJhbmdlRW5kO1xuICBkaXNhYmxlVG9kYXk7XG4gIGkxOG5UZXh0OiBJMThuSW50ZXJmYWNlWydkYXRlUGlja2VyJ107XG4gIGkxOG5Mb2NhbGU6IEkxOG5JbnRlcmZhY2VbJ2xvY2FsZSddO1xuICBpMThuU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gIHN0YXJ0QW5pbWF0aW9uID0gZmFsc2U7XG5cbiAgcHVibGljIGN1cnJlbnRDYWxlbmRhcnMgPSBbbnVsbCwgbnVsbF07XG4gIHB1YmxpYyBjZGtDb25uZWN0ZWRPdmVybGF5T3JpZ2luOiBDZGtPdmVybGF5T3JpZ2luO1xuICBwcml2YXRlIF9pc09wZW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfd2hpY2hPcGVuOiAnc3RhcnQnfCdlbmQnfGZhbHNlO1xuICBwcml2YXRlIF9kYXRlQ29uZmlnOiBhbnk7XG4gIHByaXZhdGUgX2RhdGVGb3JtYXQ6IHN0cmluZztcbiAgcHJpdmF0ZSBfbWF4RGF0ZTogRGF0ZTtcbiAgcHJpdmF0ZSBfbWluRGF0ZTogRGF0ZTtcbiAgZG9jdW1lbnQ6IERvY3VtZW50O1xuICBASW5wdXQoKSBzZXQgZGF0ZUNvbmZpZyhkYXRlQ29uZmlnOiBhbnkpIHtcbiAgICBpZiAodGhpcy5jaGVja0RhdGVDb25maWcoZGF0ZUNvbmZpZykpIHtcbiAgICAgIHRoaXMuX2RhdGVDb25maWcgPSBkYXRlQ29uZmlnO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9kYXRlQ29uZmlnID0gdGhpcy5kYXRlUGlja2VyQ29uZmlnLmRhdGVDb25maWc7XG4gICAgfVxuICAgIHRoaXMuX2RhdGVGb3JtYXQgPSB0aGlzLnNob3dUaW1lID8gdGhpcy5fZGF0ZUNvbmZpZy5mb3JtYXQudGltZSA6IHRoaXMuX2RhdGVDb25maWcuZm9ybWF0LmRhdGU7XG4gIH1cbiAgZ2V0IGRhdGVDb25maWcoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2RhdGVDb25maWc7XG4gIH1cbiAgQElucHV0KCkgc2V0IGRhdGVGb3JtYXQoZGF0ZUZvcm1hdDogc3RyaW5nKSB7XG4gICAgaWYgKGRhdGVGb3JtYXQgJiYgdGhpcy5fZGF0ZUZvcm1hdCAhPT0gZGF0ZUZvcm1hdCkge1xuICAgICAgdGhpcy5fZGF0ZUZvcm1hdCA9IGRhdGVGb3JtYXQ7XG4gICAgfVxuICB9XG4gIGdldCBkYXRlRm9ybWF0KCkge1xuICAgIHJldHVybiB0aGlzLl9kYXRlRm9ybWF0IHx8IHRoaXMuZGF0ZVBpY2tlckNvbmZpZy5kZWZhdWx0Rm9ybWF0O1xuICB9XG4gIEBJbnB1dCgpIHNldCBtYXhEYXRlKGRhdGU6IERhdGUgfCBhbnkpIHtcbiAgICBjb25zdCBwYXJzZURhdGUgPSB0aGlzLmNvbnZlcnREYXRlKGRhdGUpO1xuICAgIGlmIChwYXJzZURhdGUpIHtcbiAgICAgIHRoaXMuX21heERhdGUgPSBwYXJzZURhdGU7XG4gICAgfVxuICB9XG4gIGdldCBtYXhEYXRlKCkge1xuICAgIHJldHVybiB0aGlzLl9tYXhEYXRlO1xuICB9XG4gIEBJbnB1dCgpIHNldCBtaW5EYXRlKGRhdGU6IERhdGUgfCBhbnkpIHtcbiAgICBjb25zdCBwYXJzZURhdGUgPSB0aGlzLmNvbnZlcnREYXRlKGRhdGUpO1xuICAgIGlmIChwYXJzZURhdGUpIHtcbiAgICAgIHRoaXMuX21pbkRhdGUgPSBwYXJzZURhdGU7XG4gICAgfVxuICB9XG4gIGdldCBtaW5EYXRlKCkge1xuICAgIHJldHVybiB0aGlzLl9taW5EYXRlO1xuICB9XG4gIHNldCB3aGljaE9wZW4oc2lkZTogJ3N0YXJ0J3wnZW5kJ3xmYWxzZSkge1xuICAgIHRoaXMuX3doaWNoT3BlbiA9IHNpZGU7XG4gICAgdGhpcy5zd2l0Y2hPcmlnaW5Qb3NpdGlvblN1Yi5uZXh0KHNpZGUpO1xuICB9XG4gIGdldCB3aGljaE9wZW4oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3doaWNoT3BlbjtcbiAgfVxuICBzZXQgaXNPcGVuKGlzT3BlbjogYm9vbGVhbikge1xuICAgIHRoaXMuX2lzT3BlbiA9IGlzT3BlbjtcbiAgICBpZiAoIWlzT3Blbikge1xuICAgICAgdGhpcy5zdGFydEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgdGhpcy5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25Eb2N1bWVudENsaWNrKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMuc3RhcnRBbmltYXRpb24gPSB0cnVlO1xuICAgICAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICAgIHRoaXMuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uRG9jdW1lbnRDbGljayk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgZ2V0IGlzT3BlbigpIHtcbiAgICByZXR1cm4gdGhpcy5faXNPcGVuO1xuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGVsOiBFbGVtZW50UmVmLFxuICAgIHByb3RlY3RlZCBkYXRlUGlja2VyQ29uZmlnOiBEYXRlUGlja2VyQ29uZmlnLFxuICAgIHByaXZhdGUgaTE4bjogSTE4blNlcnZpY2UsXG4gICAgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgZGV2Q29uZmlnU2VydmljZTogRGV2Q29uZmlnU2VydmljZSxcbiAgICBASW5qZWN0KERPQ1VNRU5UKSBwcml2YXRlIGRvYzogYW55XG4gICkge1xuICAgIHRoaXMuX2RhdGVDb25maWcgPSBkYXRlUGlja2VyQ29uZmlnWydkYXRlQ29uZmlnJ107XG4gICAgdGhpcy5kYXRlQ29udmVydGVyID0gZGF0ZVBpY2tlckNvbmZpZ1snZGF0ZUNvbmZpZyddLmRhdGVDb252ZXJ0ZXIgfHwgbmV3IERlZmF1bHREYXRlQ29udmVydGVyKCk7XG4gICAgdGhpcy5zZXRJMThuVGV4dCgpO1xuICAgIHRoaXMuZG9jdW1lbnQgPSB0aGlzLmRvYztcbiAgfVxuXG4gIGNoZWNrRGF0ZUNvbmZpZyhkYXRlQ29uZmlnOiBhbnkpIHtcbiAgICBpZiAoIWRhdGVDb25maWcpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgaWYgKHR5cGVvZihkYXRlQ29uZmlnLnRpbWVQaWNrZXIpICE9PSAnYm9vbGVhbicgfHwgIWRhdGVDb25maWcubWF4IHx8ICFkYXRlQ29uZmlnLm1pbiB8fCAhZGF0ZUNvbmZpZy5mb3JtYXQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBvbkRvY3VtZW50Q2xpY2sgPSAoJGV2ZW50KSA9PiB7XG4gICAgaWYgKCF0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoJGV2ZW50LnRhcmdldCkpIHtcbiAgICAgIHRoaXMud2hpY2hPcGVuID0gZmFsc2U7XG4gICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgfTtcblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLl9taW5EYXRlID0gdGhpcy5taW5EYXRlID8gbmV3IERhdGUodGhpcy5taW5EYXRlKSA6IG5ldyBEYXRlKHRoaXMuZGF0ZUNvbmZpZy5taW4sIDAsIDEsIDAsIDAsIDApO1xuICAgIHRoaXMuX21heERhdGUgPSB0aGlzLm1heERhdGUgPyBuZXcgRGF0ZSh0aGlzLm1heERhdGUpIDogbmV3IERhdGUodGhpcy5kYXRlQ29uZmlnLm1heCwgMTEsIDMxLCAyMywgNTksIDU5KTtcbiAgICB0aGlzLnVwZGF0ZUNka0Nvbm5lY3RlZE92ZXJsYXlPcmlnaW4odGhpcy5lbC5uYXRpdmVFbGVtZW50KTtcbiAgICB0aGlzLnN1YnNjcmliZUhvdmVyQWN0aW9ucygpO1xuICB9XG5cbiAgaXNEaXNhYmxlVG9kYXkoKSB7XG4gICAgaWYgKCh0aGlzLm1pbkRhdGUuZ2V0VGltZSgpID49ICh0aGlzLnRvZGF5KS5nZXRUaW1lKCkpIHx8ICh0aGlzLm1heERhdGUuZ2V0VGltZSgpIDw9ICh0aGlzLnRvZGF5KS5nZXRUaW1lKCkpKSB7XG4gICAgICB0aGlzLmRpc2FibGVUb2RheSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZGlzYWJsZVRvZGF5ID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgdG9nZ2xlID0gKHNpZGU6ICdzdGFydCd8J2VuZCcgPSAnc3RhcnQnKSA9PiB7XG4gICAgaWYgKHRoaXMuaXNPcGVuKSB7XG4gICAgICBpZiAoc2lkZSA9PT0gJ3N0YXJ0Jykge1xuICAgICAgICBpZiAodGhpcy53aGljaE9wZW4gPT09ICdzdGFydCcpIHtcbiAgICAgICAgICB0aGlzLndoaWNoT3BlbiA9IGZhbHNlO1xuICAgICAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7IC8vIHRoaXMud2hpY2hPcGVuID09PSAnZW5kJ1xuICAgICAgICAgIHRoaXMud2hpY2hPcGVuID0gJ3N0YXJ0JztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHsgLy8gc2lkZSA9PT0gJ2VuZCdcbiAgICAgICAgaWYgKHRoaXMud2hpY2hPcGVuID09PSAnc3RhcnQnKSB7XG4gICAgICAgICAgdGhpcy53aGljaE9wZW4gPSAnZW5kJztcbiAgICAgICAgfSBlbHNlIHsgLy8gdGhpcy53aGljaE9wZW4gPT09ICdlbmQnXG4gICAgICAgICAgdGhpcy53aGljaE9wZW4gPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMud2hpY2hPcGVuID0gc2lkZTtcbiAgICAgIHRoaXMuaXNPcGVuID0gdHJ1ZTtcbiAgICB9XG4gIH07XG5cbiAgb25Qb3NpdGlvbkNoYW5nZShwb3NpdGlvbjogQ29ubmVjdGVkT3ZlcmxheVBvc2l0aW9uQ2hhbmdlKSB7XG4gICAgc3dpdGNoIChwb3NpdGlvbi5jb25uZWN0aW9uUGFpci5vdmVybGF5WSkge1xuICAgIGNhc2UgJ3RvcCc6XG4gICAgY2FzZSAnY2VudGVyJzpcbiAgICAgIHRoaXMuZGF0ZVBvc2l0aW9uID0gJ2JvdHRvbSc7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdib3R0b20nOlxuICAgICAgdGhpcy5kYXRlUG9zaXRpb24gPSAndG9wJztcbiAgICB9XG4gICAgdGhpcy5zd2l0Y2hPcmlnaW5Qb3NpdGlvblN1Yi5uZXh0KHRoaXMud2hpY2hPcGVuKTtcbiAgfVxuXG4gIGNvbnZlcnREYXRlKGRhdGUpIHtcbiAgICByZXR1cm4gZGF0ZSA/XG4gICAgICB0aGlzLmRhdGVDb252ZXJ0ZXIucGFyc2UoZGF0ZSwgdGhpcy5kYXRlRm9ybWF0KSA6IG51bGw7XG4gIH1cblxuICBmb3JtYXREYXRlKGRhdGUpIHtcbiAgICByZXR1cm4gZGF0ZSA/XG4gICAgICB0aGlzLmRhdGVDb252ZXJ0ZXIuZm9ybWF0KGRhdGUsIHRoaXMuZGF0ZUZvcm1hdCwgdGhpcy5sb2NhbGUgfHwgdGhpcy5pMThuTG9jYWxlKSA6IG51bGw7XG4gIH1cblxuICB1cGRhdGVDZGtDb25uZWN0ZWRPdmVybGF5T3JpZ2luKGVsOiBFbGVtZW50UmVmKSB7XG4gICAgaWYgKGVsKSB7XG4gICAgICB0aGlzLmNka0Nvbm5lY3RlZE92ZXJsYXlPcmlnaW4gPSBuZXcgQ2RrT3ZlcmxheU9yaWdpbihlbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2RrQ29ubmVjdGVkT3ZlcmxheU9yaWdpbiA9IHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICBzeW5jUGlja2VyUGFpcihjdXJyZW50Q2FsZW5kZXI6IG9iamVjdCwgb3JpZW50YXRpb246IHN0cmluZykge1xuICAgIHN3aXRjaCAob3JpZW50YXRpb24pIHtcbiAgICBjYXNlICdsZWZ0JzpcbiAgICAgIHRoaXMuY3VycmVudENhbGVuZGFyc1swXSA9IGN1cnJlbnRDYWxlbmRlcjtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgIHRoaXMuY3VycmVudENhbGVuZGFyc1sxXSA9IGN1cnJlbnRDYWxlbmRlcjtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHJhbmdlQ2hhbmdlKGRhdGEpIHtcbiAgICB0aGlzLmNob29zZURhdGUoZGF0YS5zZWxlY3RlZFJhbmdlKTtcbiAgICB0aGlzLnNlbGVjdERhdGVTdWJqZWN0Lm5leHQoe3NpZGU6ICdzdGFydCcsIGRhdGU6IHRoaXMucmFuZ2VTdGFydCwgb25seVdyaXRlOiB0cnVlfSk7XG4gICAgdGhpcy5zZWxlY3REYXRlU3ViamVjdC5uZXh0KHtzaWRlOiAnZW5kJywgZGF0ZTogdGhpcy5yYW5nZUVuZCwgb25seVdyaXRlOiB0cnVlfSk7XG4gIH1cblxuICBjaG9vc2VEYXRlID0gKHJhbmdlKSA9PiB7XG4gICAgaWYgKHJhbmdlICYmIEFycmF5LmlzQXJyYXkodGhpcy5zZWxlY3RlZFJhbmdlKSkge1xuICAgICAgdGhpcy5zZWxlY3RlZFJhbmdlID0gcmFuZ2U7XG4gICAgICBbdGhpcy5yYW5nZVN0YXJ0LCB0aGlzLnJhbmdlRW5kXSA9IHRoaXMuc2VsZWN0ZWRSYW5nZTtcbiAgICAgIHRoaXMubm90aWZ5VmFsdWVDaGFuZ2UoKTtcbiAgICB9XG4gIH07XG5cbiAgbm90aWZ5VmFsdWVDaGFuZ2UoKSB7XG4gICAgdGhpcy5zZWxlY3RlZFJhbmdlQ2hhbmdlLmVtaXQodGhpcy5zZWxlY3RlZFJhbmdlKTtcbiAgfVxuXG4gIHNlbGVjdGluZ0RhdGUoZXZlbnQpIHtcbiAgICB0aGlzLmhvdmVyT25EYXRlLm5leHQoZXZlbnQpO1xuICB9XG5cbiAgc3Vic2NyaWJlSG92ZXJBY3Rpb25zKCkge1xuICAgIHRoaXMuaG92ZXJPbkRhdGUucGlwZShcbiAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKClcbiAgICApLnN1YnNjcmliZSgoZGF0ZSkgPT4ge1xuICAgICAgdGhpcy5wcmV2aWV3UmFuZ2VFbmQoZGF0ZSk7XG4gICAgfSk7XG4gIH1cblxuICBwcmV2aWV3UmFuZ2VFbmQoZGF0ZSkge1xuICAgIHRoaXMubGVmdFBpY2tlclsncHJldmlld0VuZCddID0gZGF0ZTtcbiAgICB0aGlzLnJpZ2h0UGlja2VyWydwcmV2aWV3RW5kJ10gPSBkYXRlO1xuICB9XG5cbiAgc3luY1JhbmdlU3RhcnQocmFuZ2VTdGFydCwgcGlja2VyOiBhbnkpIHtcbiAgICBpZiAodGhpcy53aGljaE9wZW4gPT09ICdlbmQnKSB7XG4gICAgICB0aGlzLnNlbGVjdEVuZChyYW5nZVN0YXJ0KTtcbiAgICB9IGVsc2UgeyAvLyB0aGlzLndoaWNoT3BlbiA9PT0gJ3N0YXJ0J1xuICAgICAgdGhpcy5zZWxlY3RTdGFydChyYW5nZVN0YXJ0KTtcbiAgICB9XG4gICAgcGlja2VyLnNlbGVjdFJhbmdlKHJhbmdlU3RhcnQsIHRydWUpO1xuICB9XG5cbiAgc2VsZWN0U3RhcnQoZGF0ZTogRGF0ZSwgcGFzc2l2ZSA9IGZhbHNlKSB7XG4gICAgdGhpcy5zZWxlY3RlZFJhbmdlWzBdID0gZGF0ZTtcbiAgICB0aGlzLnJhbmdlU3RhcnQgPSBkYXRlO1xuICAgIHRoaXMuaXNEaXNhYmxlVG9kYXkoKTtcbiAgICBpZiAoIXBhc3NpdmUpIHtcbiAgICAgIHRoaXMuc2VsZWN0RGF0ZVN1YmplY3QubmV4dCh7c2lkZTogJ3N0YXJ0JywgZGF0ZX0pO1xuICAgICAgdGhpcy53aGljaE9wZW4gPSAnZW5kJztcbiAgICB9XG4gIH1cblxuICBzZWxlY3RFbmQoZGF0ZTogRGF0ZSwgcGFzc2l2ZSA9IGZhbHNlKSB7XG4gICAgdGhpcy5zZWxlY3RlZFJhbmdlWzFdID0gZGF0ZTtcbiAgICB0aGlzLnJhbmdlRW5kID0gZGF0ZTtcbiAgICB0aGlzLmlzRGlzYWJsZVRvZGF5KCk7XG4gICAgaWYgKCFwYXNzaXZlKSB7XG4gICAgICB0aGlzLnNlbGVjdERhdGVTdWJqZWN0Lm5leHQoe3NpZGU6ICdlbmQnLCBkYXRlOiBkYXRlfSk7XG4gICAgICBpZiAoIXRoaXMuc2hvd1RpbWUgJiYgdGhpcy5oaWRlT25SYW5nZVNlbGVjdGVkKSB7XG4gICAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7XG4gICAgICAgIHRoaXMud2hpY2hPcGVuID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgY2hvb3NlVG9kYXkoZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIGlmICgodGhpcy5taW5EYXRlLmdldFRpbWUoKSA8PSAodGhpcy50b2RheSkuZ2V0VGltZSgpKSAmJiAodGhpcy5tYXhEYXRlLmdldFRpbWUoKSA+PSAodGhpcy50b2RheSkuZ2V0VGltZSgpKSkge1xuICAgICAgaWYgKHRoaXMud2hpY2hPcGVuID09PSAnc3RhcnQnKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0U3RhcnQodGhpcy50b2RheSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMud2hpY2hPcGVuID09PSAnZW5kJykge1xuICAgICAgICB0aGlzLnNlbGVjdEVuZCh0aGlzLnRvZGF5KTtcbiAgICAgIH1cbiAgICAgIFt0aGlzLnJhbmdlU3RhcnQsIHRoaXMucmFuZ2VFbmRdID0gdGhpcy5zZWxlY3RlZFJhbmdlO1xuICAgIH1cbiAgfVxuXG4gIGNsZWFyQnRuKGV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBpZiAodGhpcy53aGljaE9wZW4pIHtcbiAgICAgIHRoaXMuY2xlYXIodGhpcy53aGljaE9wZW4pO1xuICAgIH1cbiAgfVxuXG4gIGNsZWFyID0gKHNpZGU6ICdzdGFydCd8J2VuZCcpID0+IHtcbiAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoc2lkZSA9PT0gJ3N0YXJ0Jykge1xuICAgICAgdGhpcy5zZWxlY3RTdGFydChudWxsKTtcbiAgICB9IGVsc2UgaWYgKHNpZGUgPT09ICdlbmQnKSB7XG4gICAgICB0aGlzLnNlbGVjdEVuZChudWxsKTtcbiAgICB9XG4gICAgW3RoaXMucmFuZ2VTdGFydCwgdGhpcy5yYW5nZUVuZF0gPSB0aGlzLnNlbGVjdGVkUmFuZ2U7XG4gIH07XG5cbiAgc2V0STE4blRleHQoKSB7XG4gICAgdGhpcy5pMThuVGV4dCA9IHRoaXMuaTE4bi5nZXRJMThuVGV4dCgpLmRhdGVQaWNrZXI7XG4gICAgdGhpcy5pMThuTG9jYWxlID0gdGhpcy5pMThuLmdldEkxOG5UZXh0KCkubG9jYWxlO1xuICAgIHRoaXMuaTE4blN1YnNjcmlwdGlvbiA9IHRoaXMuaTE4bi5sYW5nQ2hhbmdlKCkuc3Vic2NyaWJlKChkYXRhKSA9PiB7XG4gICAgICB0aGlzLmkxOG5UZXh0ID0gZGF0YS5kYXRlUGlja2VyO1xuICAgICAgdGhpcy5pMThuTG9jYWxlID0gZGF0YS5sb2NhbGU7XG4gICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xuICAgIGlmICh0aGlzLmkxOG5TdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMuaTE4blN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgICB0aGlzLmRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkRvY3VtZW50Q2xpY2spO1xuICB9XG59XG4iLCI8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG48bmctdGVtcGxhdGVcbiAgY2RrLWNvbm5lY3RlZC1vdmVybGF5XG4gIFtjZGtDb25uZWN0ZWRPdmVybGF5T3JpZ2luXT1cImNka0Nvbm5lY3RlZE92ZXJsYXlPcmlnaW5cIlxuICBbY2RrQ29ubmVjdGVkT3ZlcmxheU9wZW5dPVwiaXNPcGVuXCJcbiAgKGJhY2tkcm9wQ2xpY2spPVwiaXNPcGVuID0gZmFsc2VcIlxuICAocG9zaXRpb25DaGFuZ2UpPVwib25Qb3NpdGlvbkNoYW5nZSgkZXZlbnQpXCJcbj5cbiAgPGRpdiBbQGZhZGVJbk91dF09XCJzdGFydEFuaW1hdGlvbiA/IGRhdGVQb3NpdGlvbiA6ICd2b2lkJ1wiIFtALmRpc2FibGVkXT1cIiFzaG93QW5pbWF0aW9uXCIgY2xhc3M9XCJkZXZ1aS10d28tZGF0ZS13cmFwcGVyXCI+XG4gICAgPGRpdiBjbGFzcz1cImRldnVpLXR3by1kYXRlLXBpY2tlclwiPlxuICAgICAgPGQtdHdvLWRhdGVwaWNrZXItc2luZ2xlXG4gICAgICAgIGNsYXNzPVwiZGV2dWktZGF0ZS1waWNrZXJcIlxuICAgICAgICBbbG9jYWxlXT1cImxvY2FsZVwiXG4gICAgICAgIFtjc3NDbGFzc109XCJjc3NDbGFzc1wiXG4gICAgICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiXG4gICAgICAgIFtkYXRlQ29udmVydGVyXT1cImRhdGVDb252ZXJ0ZXJcIlxuICAgICAgICBbZGF0ZUNvbmZpZ109XCJkYXRlQ29uZmlnXCJcbiAgICAgICAgW21heERhdGVdPVwibWF4RGF0ZVwiXG4gICAgICAgIFttaW5EYXRlXT1cIm1pbkRhdGVcIlxuICAgICAgICBbcmFuZ2VQaWNrZXJdPVwidHJ1ZVwiXG4gICAgICAgIFtzZWxlY3RlZFJhbmdlXT1cIltyYW5nZVN0YXJ0LCByYW5nZUVuZF1cIlxuICAgICAgICBbY3VycmVudENhbGVuZGFyc109XCJjdXJyZW50Q2FsZW5kYXJzXCJcbiAgICAgICAgW3Nob3dUaW1lXT1cInNob3dUaW1lXCJcbiAgICAgICAgKHJhbmdlU2VsZWN0ZWQpPVwicmFuZ2VDaGFuZ2UoJGV2ZW50KVwiXG4gICAgICAgIChob3Zlck9uRGF0ZSk9XCJzZWxlY3RpbmdEYXRlKCRldmVudClcIlxuICAgICAgICAocmFuZ2VTZWxlY3RpbmcpPVwic3luY1JhbmdlU3RhcnQoJGV2ZW50LCByaWdodFBpY2tlcilcIlxuICAgICAgICAoc3luY1BpY2tlclBhaXIpPVwic3luY1BpY2tlclBhaXIoJGV2ZW50LCAnbGVmdCcpXCJcbiAgICAgICAgW3doaWNoT3Blbl09XCJ3aGljaE9wZW5cIlxuICAgICAgICAjbGVmdFBpY2tlclxuICAgICAgPlxuICAgICAgPC9kLXR3by1kYXRlcGlja2VyLXNpbmdsZT5cbiAgICAgIDxkLXR3by1kYXRlcGlja2VyLXNpbmdsZVxuICAgICAgICBjbGFzcz1cImRldnVpLWRhdGUtcGlja2VyXCJcbiAgICAgICAgW2xvY2FsZV09XCJsb2NhbGVcIlxuICAgICAgICBbY3NzQ2xhc3NdPVwiY3NzQ2xhc3NcIlxuICAgICAgICBbZGlzYWJsZWRdPVwiZGlzYWJsZWRcIlxuICAgICAgICBbZGF0ZUNvbnZlcnRlcl09XCJkYXRlQ29udmVydGVyXCJcbiAgICAgICAgW2RhdGVDb25maWddPVwiZGF0ZUNvbmZpZ1wiXG4gICAgICAgIFttYXhEYXRlXT1cIm1heERhdGVcIlxuICAgICAgICBbbWluRGF0ZV09XCJtaW5EYXRlXCJcbiAgICAgICAgW3JhbmdlUGlja2VyXT1cInRydWVcIlxuICAgICAgICBbc2VsZWN0ZWRSYW5nZV09XCJbcmFuZ2VTdGFydCwgcmFuZ2VFbmRdXCJcbiAgICAgICAgW2N1cnJlbnRDYWxlbmRhcnNdPVwiY3VycmVudENhbGVuZGFyc1wiXG4gICAgICAgIFtzaG93VGltZV09XCJzaG93VGltZVwiXG4gICAgICAgIChyYW5nZVNlbGVjdGVkKT1cInJhbmdlQ2hhbmdlKCRldmVudClcIlxuICAgICAgICAoaG92ZXJPbkRhdGUpPVwic2VsZWN0aW5nRGF0ZSgkZXZlbnQpXCJcbiAgICAgICAgKHJhbmdlU2VsZWN0aW5nKT1cInN5bmNSYW5nZVN0YXJ0KCRldmVudCwgbGVmdFBpY2tlcilcIlxuICAgICAgICAoc3luY1BpY2tlclBhaXIpPVwic3luY1BpY2tlclBhaXIoJGV2ZW50LCAncmlnaHQnKVwiXG4gICAgICAgIFtpc0F1eGlsaWFyeV09XCJ0cnVlXCJcbiAgICAgICAgW3doaWNoT3Blbl09XCJ3aGljaE9wZW5cIlxuICAgICAgICAjcmlnaHRQaWNrZXJcbiAgICAgID5cbiAgICAgIDwvZC10d28tZGF0ZXBpY2tlci1zaW5nbGU+XG4gICAgPC9kaXY+XG4gICAgPGRpdiAqbmdJZj1cIiFjdXN0b21WaWV3VGVtcGxhdGVcIiBjbGFzcz1cImRldnVpLXR3by1kYXRlLWZvb3RlciBkZXZ1aS10d28tZGF0ZS1jdXN0b21cIj5cbiAgICAgIDxhXG4gICAgICAgIFtuZ0NsYXNzXT1cIntcbiAgICAgICAgICBkaXNhYmxlZDogZGlzYWJsZVRvZGF5XG4gICAgICAgIH1cIlxuICAgICAgICAoY2xpY2spPVwiY2hvb3NlVG9kYXkoJGV2ZW50KVwiXG4gICAgICAgID57eyBpMThuVGV4dC50b2RheSB9fTwvYVxuICAgICAgPlxuICAgICAgPGQtYnV0dG9uIGJzU3R5bGU9XCJjb21tb25cIiAoYnRuQ2xpY2spPVwiY2xlYXJCdG4oJGV2ZW50KVwiIGJzU2l6ZT1cInNtXCI+e3sgaTE4blRleHQuY2xlYXIgfX08L2QtYnV0dG9uPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG4iXX0=