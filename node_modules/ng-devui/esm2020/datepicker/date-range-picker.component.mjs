import { Component, ElementRef, EventEmitter, forwardRef, Input, Output, TemplateRef, ViewChild } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { I18nService } from 'ng-devui/i18n';
import { DefaultDateConverter } from 'ng-devui/utils';
import { Subject } from 'rxjs';
import { distinctUntilChanged } from 'rxjs/operators';
import { DatePickerConfigService as DatePickerConfig } from './date-picker.config.service';
import { SelectDateRangeChangeReason } from './date-range-change-event-args.model';
import * as i0 from "@angular/core";
import * as i1 from "./date-picker.config.service";
import * as i2 from "ng-devui/i18n";
import * as i3 from "./single-date-range-picker.component";
import * as i4 from "@angular/common";
export class DateRangePickerComponent {
    constructor(datePickerConfig, i18n) {
        this.datePickerConfig = datePickerConfig;
        this.i18n = i18n;
        this.selectedRange = [null, null];
        this.selectedRangeChange = new EventEmitter();
        this.hide = new EventEmitter();
        this.currentCalendars = [null, null];
        this.hoverOnDate = new Subject();
        this.onChange = (_) => null;
        this.onTouched = () => null;
        this.chooseDate = (range, reason) => {
            const currentReason = typeof reason === 'number' ? reason : SelectDateRangeChangeReason.custom;
            this.writeValue(range);
            this.notifyValueChange(range, currentReason);
        };
        this.clearAll = (reason) => {
            const currentReason = typeof reason === 'number' ? reason : SelectDateRangeChangeReason.custom;
            this.chooseDate([null, null], currentReason);
        };
        this._dateConfig = datePickerConfig['dateConfig'];
        this.dateConverter = datePickerConfig['dateConfig'].dateConverter || new DefaultDateConverter();
        this.setI18nText();
    }
    set showTime(showTime) {
        this._showTime = showTime;
    }
    get showTime() {
        return typeof this._showTime === 'boolean' ? this._showTime : this.dateConfig.timePicker;
    }
    set dateConfig(dateConfig) {
        if (this.checkDateConfig(dateConfig)) {
            this._dateConfig = dateConfig;
        }
        else {
            this._dateConfig = this.datePickerConfig.dateConfig;
        }
    }
    get dateConfig() {
        return this._dateConfig;
    }
    set maxDate(date) {
        const parseDate = this.dateConverter.parse(date, this.dateFormat) || null;
        if (parseDate) {
            this._maxDate = parseDate;
        }
    }
    get maxDate() {
        return this._maxDate;
    }
    set minDate(date) {
        const parseDate = this.dateConverter.parse(date, this.dateFormat) || null;
        if (parseDate) {
            this._minDate = parseDate;
        }
    }
    get minDate() {
        return this._minDate;
    }
    checkDateConfig(dateConfig) {
        if (!dateConfig) {
            return false;
        }
        if (typeof (dateConfig.timePicker) !== 'boolean' || !dateConfig.max || !dateConfig.min || !dateConfig.format) {
            return false;
        }
        return true;
    }
    ngOnChanges(changes) {
        if (changes && changes['selectedRange'] && changes['selectedRange'].currentValue) {
            this.writeValue(this.selectedRange);
        }
    }
    ngOnInit() {
        this._minDate = this.minDate ? new Date(this.minDate) : new Date(this.dateConfig.min, 0, 1, 0, 0, 0);
        this._maxDate = this.maxDate ? new Date(this.maxDate) : new Date(this.dateConfig.max, 11, 31, 23, 59, 59);
        this.subscribeHoverActions();
    }
    registerOnChange(fn) {
        this.onChange = fn;
    }
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    writeValue(selectedRange) {
        if (selectedRange) {
            this.selectedRange = selectedRange;
            if (this.leftPicker) {
                this.leftPicker['selectedRange'] = selectedRange;
            }
            if (this.rightPicker) {
                this.rightPicker['selectedRange'] = selectedRange;
            }
            [this.rangeStart, this.rangeEnd] = this.selectedRange;
        }
    }
    setI18nText() {
        this.i18nLocale = this.i18n.getI18nText().locale;
        this.i18nText = this.i18n.getI18nText().datePicker;
        this.i18nSubscription = this.i18n.langChange().subscribe((data) => {
            this.i18nLocale = data.locale;
            this.i18nText = data.datePicker;
        });
    }
    rangeChange(data) {
        this.chooseDate(data.selectedRange, data.reason);
    }
    selectingDate(event) {
        this.hoverOnDate.next(event);
    }
    subscribeHoverActions() {
        this.hoverOnDate.pipe(distinctUntilChanged()).subscribe((date) => {
            this.previewRangeEnd(date);
        });
    }
    previewRangeEnd(date) {
        this.leftPicker['previewEnd'] = date;
        this.rightPicker['previewEnd'] = date;
    }
    syncRangeStart(rangeStart, picker) {
        picker.selectRange(rangeStart, true);
    }
    syncPickerPair(currentCalender, orientation) {
        switch (orientation) {
            case 'left':
                this.currentCalendars[0] = currentCalender;
                break;
            case 'right':
                this.currentCalendars[1] = currentCalender;
                break;
        }
    }
    notifyValueChange(range, reason) {
        this.onChange(range);
        this.onTouched();
        this.selectedRangeChange.emit({
            reason,
            selectedRange: range
        });
    }
    consolidateTime() {
        const rangeStart = this.rangeStart;
        const rangeEnd = this.rangeEnd;
        const rangeStartTime = this.leftPicker['currentTime'];
        const rangeEndTime = this.rightPicker['currentTime'];
        this.rangeStart = new Date(rangeStart.getFullYear(), rangeStart.getMonth(), rangeStart.getDate(), rangeStartTime.hour, rangeStartTime.minute, rangeStartTime.second);
        this.rangeEnd = new Date(rangeEnd.getFullYear(), rangeEnd.getMonth(), rangeEnd.getDate(), rangeEndTime.hour, rangeEndTime.minute, rangeEndTime.second);
        const newRange = [this.rangeStart, this.rangeEnd];
        this.onTouched();
        this.writeValue(newRange);
        this.notifyValueChange(newRange, SelectDateRangeChangeReason.button);
        this.hide.emit(true);
    }
    ngOnDestroy() {
        if (this.i18nSubscription) {
            this.i18nSubscription.unsubscribe();
        }
    }
}
DateRangePickerComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DateRangePickerComponent, deps: [{ token: i1.DatePickerConfigService }, { token: i2.I18nService }], target: i0.ɵɵFactoryTarget.Component });
DateRangePickerComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.3", type: DateRangePickerComponent, selector: "d-date-range-picker", inputs: { locale: "locale", cssClass: "cssClass", disabled: "disabled", dateConverter: "dateConverter", selectedRange: "selectedRange", dateFormat: "dateFormat", customViewTemplate: "customViewTemplate", showTime: "showTime", dateConfig: "dateConfig", maxDate: "maxDate", minDate: "minDate" }, outputs: { selectedRangeChange: "selectedRangeChange", hide: "hide" }, providers: [{
            provide: NG_VALUE_ACCESSOR,
            useExisting: forwardRef(() => DateRangePickerComponent),
            multi: true
        }], viewQueries: [{ propertyName: "leftPicker", first: true, predicate: ["leftPicker"], descendants: true }, { propertyName: "rightPicker", first: true, predicate: ["rightPicker"], descendants: true }, { propertyName: "templateWrap", first: true, predicate: ["templateWrap"], descendants: true }], exportAs: ["dateRangePicker"], usesOnChanges: true, ngImport: i0, template: "<div class=\"devui-date-range-picker\">\n  <d-datepicker-range-single\n    [locale]=\"locale || i18nLocale\"\n    class=\"devui-date-picker\"\n    [cssClass]=\"cssClass\"\n    [disabled]=\"disabled\"\n    [dateConverter]=\"dateConverter\"\n    (rangeSelected)=\"rangeChange($event)\"\n    [dateConfig]=\"dateConfig\"\n    [maxDate]=\"maxDate\"\n    [minDate]=\"minDate\"\n    (hoverOnDate)=\"selectingDate($event)\"\n    [rangePicker]=\"true\"\n    [selectedRange]=\"[rangeStart, rangeEnd]\"\n    (rangeSelecting)=\"syncRangeStart($event, rightPicker)\"\n    (syncPickerPair)=\"syncPickerPair($event, 'left')\"\n    [currentCalendars]=\"currentCalendars\"\n    [showTime]=\"showTime\"\n    #leftPicker\n  ></d-datepicker-range-single>\n  <d-datepicker-range-single\n    [locale]=\"locale || i18nLocale\"\n    class=\"devui-date-picker\"\n    [cssClass]=\"cssClass\"\n    [disabled]=\"disabled\"\n    [dateConverter]=\"dateConverter\"\n    (rangeSelected)=\"rangeChange($event)\"\n    [dateConfig]=\"dateConfig\"\n    [maxDate]=\"maxDate\"\n    [minDate]=\"minDate\"\n    (hoverOnDate)=\"selectingDate($event)\"\n    [rangePicker]=\"true\"\n    [selectedRange]=\"[rangeStart, rangeEnd]\"\n    (rangeSelecting)=\"syncRangeStart($event, leftPicker)\"\n    (syncPickerPair)=\"syncPickerPair($event, 'right')\"\n    [isAuxiliary]=\"true\"\n    [currentCalendars]=\"currentCalendars\"\n    [showTime]=\"showTime\"\n    (consolidateTime)=\"consolidateTime()\"\n    #rightPicker\n  ></d-datepicker-range-single>\n</div>\n<div class=\"devui-date-range-custom\" *ngIf=\"customViewTemplate\" #templateWrap>\n  <ng-template\n    [ngTemplateOutlet]=\"customViewTemplate\"\n    [ngTemplateOutletContext]=\"{\n      $implicit: this,\n      clearAll: clearAll,\n      chooseDate: chooseDate,\n      rangeStart: rangeStart,\n      rangeEnd: rangeEnd\n    }\"\n  ></ng-template>\n</div>\n", styles: [".devui-date-range-wrapper{display:inline-flex!important;box-shadow:0 2px 8px rgba(37,43,58,.2);box-shadow:var(--devui-shadow-connected-overlay, 0 2px 8px 0) var(--devui-shadow, rgba(37, 43, 58, .2));background-color:#fff;background-color:var(--devui-connected-overlay-bg, #ffffff);transform:perspective(1px) translate(0);flex-direction:column;border-radius:2px;border-radius:var(--devui-border-radius, 2px);margin:4px 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.devui-date-range-custom{width:500px;border-top:1px solid #d7d8da;border-top:1px solid var(--devui-line, #d7d8da)}.devui-date-picker:not(:last-child){margin-right:20px}\n"], components: [{ type: i3.SingleDateRangePickerComponent, selector: "d-datepicker-range-single", inputs: ["selectedRange", "rangePicker", "isAuxiliary", "currentCalendars"], outputs: ["hoverOnDate", "rangeSelected", "rangeSelecting", "syncPickerPair", "consolidateTime"] }], directives: [{ type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i4.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DateRangePickerComponent, decorators: [{
            type: Component,
            args: [{ selector: 'd-date-range-picker', providers: [{
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(() => DateRangePickerComponent),
                            multi: true
                        }], exportAs: 'dateRangePicker', preserveWhitespaces: false, template: "<div class=\"devui-date-range-picker\">\n  <d-datepicker-range-single\n    [locale]=\"locale || i18nLocale\"\n    class=\"devui-date-picker\"\n    [cssClass]=\"cssClass\"\n    [disabled]=\"disabled\"\n    [dateConverter]=\"dateConverter\"\n    (rangeSelected)=\"rangeChange($event)\"\n    [dateConfig]=\"dateConfig\"\n    [maxDate]=\"maxDate\"\n    [minDate]=\"minDate\"\n    (hoverOnDate)=\"selectingDate($event)\"\n    [rangePicker]=\"true\"\n    [selectedRange]=\"[rangeStart, rangeEnd]\"\n    (rangeSelecting)=\"syncRangeStart($event, rightPicker)\"\n    (syncPickerPair)=\"syncPickerPair($event, 'left')\"\n    [currentCalendars]=\"currentCalendars\"\n    [showTime]=\"showTime\"\n    #leftPicker\n  ></d-datepicker-range-single>\n  <d-datepicker-range-single\n    [locale]=\"locale || i18nLocale\"\n    class=\"devui-date-picker\"\n    [cssClass]=\"cssClass\"\n    [disabled]=\"disabled\"\n    [dateConverter]=\"dateConverter\"\n    (rangeSelected)=\"rangeChange($event)\"\n    [dateConfig]=\"dateConfig\"\n    [maxDate]=\"maxDate\"\n    [minDate]=\"minDate\"\n    (hoverOnDate)=\"selectingDate($event)\"\n    [rangePicker]=\"true\"\n    [selectedRange]=\"[rangeStart, rangeEnd]\"\n    (rangeSelecting)=\"syncRangeStart($event, leftPicker)\"\n    (syncPickerPair)=\"syncPickerPair($event, 'right')\"\n    [isAuxiliary]=\"true\"\n    [currentCalendars]=\"currentCalendars\"\n    [showTime]=\"showTime\"\n    (consolidateTime)=\"consolidateTime()\"\n    #rightPicker\n  ></d-datepicker-range-single>\n</div>\n<div class=\"devui-date-range-custom\" *ngIf=\"customViewTemplate\" #templateWrap>\n  <ng-template\n    [ngTemplateOutlet]=\"customViewTemplate\"\n    [ngTemplateOutletContext]=\"{\n      $implicit: this,\n      clearAll: clearAll,\n      chooseDate: chooseDate,\n      rangeStart: rangeStart,\n      rangeEnd: rangeEnd\n    }\"\n  ></ng-template>\n</div>\n", styles: [".devui-date-range-wrapper{display:inline-flex!important;box-shadow:0 2px 8px rgba(37,43,58,.2);box-shadow:var(--devui-shadow-connected-overlay, 0 2px 8px 0) var(--devui-shadow, rgba(37, 43, 58, .2));background-color:#fff;background-color:var(--devui-connected-overlay-bg, #ffffff);transform:perspective(1px) translate(0);flex-direction:column;border-radius:2px;border-radius:var(--devui-border-radius, 2px);margin:4px 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.devui-date-range-custom{width:500px;border-top:1px solid #d7d8da;border-top:1px solid var(--devui-line, #d7d8da)}.devui-date-picker:not(:last-child){margin-right:20px}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.DatePickerConfigService }, { type: i2.I18nService }]; }, propDecorators: { locale: [{
                type: Input
            }], cssClass: [{
                type: Input
            }], disabled: [{
                type: Input
            }], dateConverter: [{
                type: Input
            }], selectedRange: [{
                type: Input
            }], dateFormat: [{
                type: Input
            }], customViewTemplate: [{
                type: Input
            }], selectedRangeChange: [{
                type: Output
            }], hide: [{
                type: Output
            }], leftPicker: [{
                type: ViewChild,
                args: ['leftPicker']
            }], rightPicker: [{
                type: ViewChild,
                args: ['rightPicker']
            }], templateWrap: [{
                type: ViewChild,
                args: ['templateWrap']
            }], showTime: [{
                type: Input
            }], dateConfig: [{
                type: Input
            }], maxDate: [{
                type: Input
            }], minDate: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1yYW5nZS1waWNrZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vZGV2dWkvZGF0ZXBpY2tlci9kYXRlLXJhbmdlLXBpY2tlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi9kZXZ1aS9kYXRlcGlja2VyL2RhdGUtcmFuZ2UtcGlja2VyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixVQUFVLEVBQ1YsS0FBSyxFQUlMLE1BQU0sRUFFTixXQUFXLEVBQ1gsU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBd0IsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6RSxPQUFPLEVBQWlCLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzRCxPQUFPLEVBQWlCLG9CQUFvQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDckUsT0FBTyxFQUFFLE9BQU8sRUFBZ0IsTUFBTSxNQUFNLENBQUM7QUFDN0MsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEQsT0FBTyxFQUFFLHVCQUF1QixJQUFJLGdCQUFnQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDM0YsT0FBTyxFQUFrQywyQkFBMkIsRUFBRSxNQUFNLHNDQUFzQyxDQUFDOzs7Ozs7QUFjbkgsTUFBTSxPQUFPLHdCQUF3QjtJQXFFbkMsWUFBb0IsZ0JBQWtDLEVBQVUsSUFBaUI7UUFBN0QscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUFVLFNBQUksR0FBSixJQUFJLENBQWE7UUFoRXhFLGtCQUFhLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFHNUIsd0JBQW1CLEdBQUcsSUFBSSxZQUFZLEVBQWtDLENBQUM7UUFDekUsU0FBSSxHQUFHLElBQUksWUFBWSxFQUFXLENBQUM7UUFR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ZXIsXG4gIGZvcndhcmRSZWYsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFRlbXBsYXRlUmVmLFxuICBWaWV3Q2hpbGRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBJMThuSW50ZXJmYWNlLCBJMThuU2VydmljZSB9IGZyb20gJ25nLWRldnVpL2kxOG4nO1xuaW1wb3J0IHsgRGF0ZUNvbnZlcnRlciwgRGVmYXVsdERhdGVDb252ZXJ0ZXIgfSBmcm9tICduZy1kZXZ1aS91dGlscyc7XG5pbXBvcnQgeyBTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgRGF0ZVBpY2tlckNvbmZpZ1NlcnZpY2UgYXMgRGF0ZVBpY2tlckNvbmZpZyB9IGZyb20gJy4vZGF0ZS1waWNrZXIuY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHsgU2VsZWN0RGF0ZVJhbmdlQ2hhbmdlRXZlbnRBcmdzLCBTZWxlY3REYXRlUmFuZ2VDaGFuZ2VSZWFzb24gfSBmcm9tICcuL2RhdGUtcmFuZ2UtY2hhbmdlLWV2ZW50LWFyZ3MubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdkLWRhdGUtcmFuZ2UtcGlja2VyJyxcbiAgcHJvdmlkZXJzOiBbe1xuICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IERhdGVSYW5nZVBpY2tlckNvbXBvbmVudCksXG4gICAgbXVsdGk6IHRydWVcbiAgfV0sXG4gIGV4cG9ydEFzOiAnZGF0ZVJhbmdlUGlja2VyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2RhdGUtcmFuZ2UtcGlja2VyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vZGF0ZS1yYW5nZS1waWNrZXIuY29tcG9uZW50LnNjc3MnXSxcbiAgcHJlc2VydmVXaGl0ZXNwYWNlczogZmFsc2UsXG59KVxuZXhwb3J0IGNsYXNzIERhdGVSYW5nZVBpY2tlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgT25Jbml0LCBDb250cm9sVmFsdWVBY2Nlc3NvciwgT25EZXN0cm95IHtcbiAgQElucHV0KCkgbG9jYWxlOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGNzc0NsYXNzOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGRpc2FibGVkOiBib29sZWFuO1xuICBASW5wdXQoKSBkYXRlQ29udmVydGVyOiBEYXRlQ29udmVydGVyO1xuICBASW5wdXQoKSBzZWxlY3RlZFJhbmdlID0gW251bGwsIG51bGxdO1xuICBASW5wdXQoKSBkYXRlRm9ybWF0OiBzdHJpbmc7XG4gIEBJbnB1dCgpIGN1c3RvbVZpZXdUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcbiAgQE91dHB1dCgpIHNlbGVjdGVkUmFuZ2VDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPFNlbGVjdERhdGVSYW5nZUNoYW5nZUV2ZW50QXJncz4oKTtcbiAgQE91dHB1dCgpIGhpZGUgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG4gIEBWaWV3Q2hpbGQoJ2xlZnRQaWNrZXInKSBsZWZ0UGlja2VyOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdyaWdodFBpY2tlcicpIHJpZ2h0UGlja2VyOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCd0ZW1wbGF0ZVdyYXAnKSB0ZW1wbGF0ZVdyYXA6IEVsZW1lbnRSZWY7XG4gIHByaXZhdGUgX2RhdGVDb25maWc6IGFueTtcbiAgcHJpdmF0ZSBfbWF4RGF0ZTogRGF0ZTtcbiAgcHJpdmF0ZSBfbWluRGF0ZTogRGF0ZTtcbiAgcHJpdmF0ZSBfc2hvd1RpbWU6IGJvb2xlYW47XG4gIHB1YmxpYyBjdXJyZW50Q2FsZW5kYXJzID0gW251bGwsIG51bGxdO1xuICBwdWJsaWMgaTE4bkxvY2FsZTogSTE4bkludGVyZmFjZVsnbG9jYWxlJ107XG4gIHB1YmxpYyBpMThuVGV4dDogSTE4bkludGVyZmFjZVsnZGF0ZVBpY2tlciddO1xuICBwcml2YXRlIGkxOG5TdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgaG92ZXJPbkRhdGU6IFN1YmplY3Q8b2JqZWN0PiA9IG5ldyBTdWJqZWN0PG9iamVjdD4oKTtcbiAgcmFuZ2VTdGFydDtcbiAgcmFuZ2VFbmQ7XG4gIHByaXZhdGUgb25DaGFuZ2UgPSAoXzogYW55KSA9PiBudWxsO1xuICBwcml2YXRlIG9uVG91Y2hlZCA9ICgpID0+IG51bGw7XG5cbiAgQElucHV0KCkgc2V0IHNob3dUaW1lKHNob3dUaW1lOiBib29sZWFuKSB7XG4gICAgdGhpcy5fc2hvd1RpbWUgPSBzaG93VGltZTtcbiAgfVxuXG4gIGdldCBzaG93VGltZSgpIHtcbiAgICByZXR1cm4gdHlwZW9mIHRoaXMuX3Nob3dUaW1lID09PSAnYm9vbGVhbicgPyB0aGlzLl9zaG93VGltZSA6IHRoaXMuZGF0ZUNvbmZpZy50aW1lUGlja2VyO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IGRhdGVDb25maWcoZGF0ZUNvbmZpZzogYW55KSB7XG4gICAgaWYgKHRoaXMuY2hlY2tEYXRlQ29uZmlnKGRhdGVDb25maWcpKSB7XG4gICAgICB0aGlzLl9kYXRlQ29uZmlnID0gZGF0ZUNvbmZpZztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fZGF0ZUNvbmZpZyA9IHRoaXMuZGF0ZVBpY2tlckNvbmZpZy5kYXRlQ29uZmlnO1xuICAgIH1cbiAgfVxuXG4gIGdldCBkYXRlQ29uZmlnKCkge1xuICAgIHJldHVybiB0aGlzLl9kYXRlQ29uZmlnO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IG1heERhdGUoZGF0ZTogRGF0ZSB8IGFueSkge1xuICAgIGNvbnN0IHBhcnNlRGF0ZSA9IHRoaXMuZGF0ZUNvbnZlcnRlci5wYXJzZShkYXRlLCB0aGlzLmRhdGVGb3JtYXQpIHx8IG51bGw7XG4gICAgaWYgKHBhcnNlRGF0ZSkge1xuICAgICAgdGhpcy5fbWF4RGF0ZSA9IHBhcnNlRGF0ZTtcbiAgICB9XG4gIH1cblxuICBnZXQgbWF4RGF0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fbWF4RGF0ZTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBtaW5EYXRlKGRhdGU6IERhdGUgfCBhbnkpIHtcbiAgICBjb25zdCBwYXJzZURhdGUgPSB0aGlzLmRhdGVDb252ZXJ0ZXIucGFyc2UoZGF0ZSwgdGhpcy5kYXRlRm9ybWF0KSB8fCBudWxsO1xuICAgIGlmIChwYXJzZURhdGUpIHtcbiAgICAgIHRoaXMuX21pbkRhdGUgPSBwYXJzZURhdGU7XG4gICAgfVxuICB9XG5cbiAgZ2V0IG1pbkRhdGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21pbkRhdGU7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGRhdGVQaWNrZXJDb25maWc6IERhdGVQaWNrZXJDb25maWcsIHByaXZhdGUgaTE4bjogSTE4blNlcnZpY2UpIHtcbiAgICB0aGlzLl9kYXRlQ29uZmlnID0gZGF0ZVBpY2tlckNvbmZpZ1snZGF0ZUNvbmZpZyddO1xuICAgIHRoaXMuZGF0ZUNvbnZlcnRlciA9IGRhdGVQaWNrZXJDb25maWdbJ2RhdGVDb25maWcnXS5kYXRlQ29udmVydGVyIHx8IG5ldyBEZWZhdWx0RGF0ZUNvbnZlcnRlcigpO1xuICAgIHRoaXMuc2V0STE4blRleHQoKTtcbiAgfVxuXG4gIGNoZWNrRGF0ZUNvbmZpZyhkYXRlQ29uZmlnOiBhbnkpIHtcbiAgICBpZiAoIWRhdGVDb25maWcpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgaWYgKHR5cGVvZihkYXRlQ29uZmlnLnRpbWVQaWNrZXIpICE9PSAnYm9vbGVhbicgfHwgIWRhdGVDb25maWcubWF4IHx8ICFkYXRlQ29uZmlnLm1pbiB8fCAhZGF0ZUNvbmZpZy5mb3JtYXQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgaWYgKGNoYW5nZXMgJiYgY2hhbmdlc1snc2VsZWN0ZWRSYW5nZSddICYmIGNoYW5nZXNbJ3NlbGVjdGVkUmFuZ2UnXS5jdXJyZW50VmFsdWUpIHtcbiAgICAgIHRoaXMud3JpdGVWYWx1ZSh0aGlzLnNlbGVjdGVkUmFuZ2UpO1xuICAgIH1cbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuX21pbkRhdGUgPSB0aGlzLm1pbkRhdGUgPyBuZXcgRGF0ZSh0aGlzLm1pbkRhdGUpIDogbmV3IERhdGUodGhpcy5kYXRlQ29uZmlnLm1pbiwgMCwgMSwgMCwgMCwgMCk7XG4gICAgdGhpcy5fbWF4RGF0ZSA9IHRoaXMubWF4RGF0ZSA/IG5ldyBEYXRlKHRoaXMubWF4RGF0ZSkgOiBuZXcgRGF0ZSh0aGlzLmRhdGVDb25maWcubWF4LCAxMSwgMzEsIDIzLCA1OSwgNTkpO1xuICAgIHRoaXMuc3Vic2NyaWJlSG92ZXJBY3Rpb25zKCk7XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLm9uQ2hhbmdlID0gZm47XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoZWQgPSBmbjtcbiAgfVxuXG4gIHdyaXRlVmFsdWUoc2VsZWN0ZWRSYW5nZSk6IHZvaWQge1xuICAgIGlmIChzZWxlY3RlZFJhbmdlKSB7XG4gICAgICB0aGlzLnNlbGVjdGVkUmFuZ2UgPSBzZWxlY3RlZFJhbmdlO1xuICAgICAgaWYgKHRoaXMubGVmdFBpY2tlcikge1xuICAgICAgICB0aGlzLmxlZnRQaWNrZXJbJ3NlbGVjdGVkUmFuZ2UnXSA9IHNlbGVjdGVkUmFuZ2U7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5yaWdodFBpY2tlcikge1xuICAgICAgICB0aGlzLnJpZ2h0UGlja2VyWydzZWxlY3RlZFJhbmdlJ10gPSBzZWxlY3RlZFJhbmdlO1xuICAgICAgfVxuICAgICAgW3RoaXMucmFuZ2VTdGFydCwgdGhpcy5yYW5nZUVuZF0gPSB0aGlzLnNlbGVjdGVkUmFuZ2U7XG4gICAgfVxuICB9XG5cbiAgc2V0STE4blRleHQoKSB7XG4gICAgdGhpcy5pMThuTG9jYWxlID0gdGhpcy5pMThuLmdldEkxOG5UZXh0KCkubG9jYWxlO1xuICAgIHRoaXMuaTE4blRleHQgPSB0aGlzLmkxOG4uZ2V0STE4blRleHQoKS5kYXRlUGlja2VyO1xuICAgIHRoaXMuaTE4blN1YnNjcmlwdGlvbiA9IHRoaXMuaTE4bi5sYW5nQ2hhbmdlKCkuc3Vic2NyaWJlKChkYXRhKSA9PiB7XG4gICAgICB0aGlzLmkxOG5Mb2NhbGUgPSBkYXRhLmxvY2FsZTtcbiAgICAgIHRoaXMuaTE4blRleHQgPSBkYXRhLmRhdGVQaWNrZXI7XG4gICAgfSk7XG4gIH1cblxuICByYW5nZUNoYW5nZShkYXRhKSB7XG4gICAgdGhpcy5jaG9vc2VEYXRlKGRhdGEuc2VsZWN0ZWRSYW5nZSwgZGF0YS5yZWFzb24pO1xuICB9XG5cbiAgY2hvb3NlRGF0ZSA9IChyYW5nZSwgcmVhc29uPykgPT4ge1xuICAgIGNvbnN0IGN1cnJlbnRSZWFzb24gPSB0eXBlb2YgcmVhc29uID09PSAnbnVtYmVyJyA/IHJlYXNvbiA6IFNlbGVjdERhdGVSYW5nZUNoYW5nZVJlYXNvbi5jdXN0b207XG4gICAgdGhpcy53cml0ZVZhbHVlKHJhbmdlKTtcbiAgICB0aGlzLm5vdGlmeVZhbHVlQ2hhbmdlKHJhbmdlLCBjdXJyZW50UmVhc29uKTtcbiAgfTtcblxuICBzZWxlY3RpbmdEYXRlKGV2ZW50KSB7XG4gICAgdGhpcy5ob3Zlck9uRGF0ZS5uZXh0KGV2ZW50KTtcbiAgfVxuXG4gIHN1YnNjcmliZUhvdmVyQWN0aW9ucygpIHtcbiAgICB0aGlzLmhvdmVyT25EYXRlLnBpcGUoXG4gICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpXG4gICAgKS5zdWJzY3JpYmUoKGRhdGUpID0+IHtcbiAgICAgIHRoaXMucHJldmlld1JhbmdlRW5kKGRhdGUpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJldmlld1JhbmdlRW5kKGRhdGUpIHtcbiAgICB0aGlzLmxlZnRQaWNrZXJbJ3ByZXZpZXdFbmQnXSA9IGRhdGU7XG4gICAgdGhpcy5yaWdodFBpY2tlclsncHJldmlld0VuZCddID0gZGF0ZTtcbiAgfVxuXG4gIHN5bmNSYW5nZVN0YXJ0KHJhbmdlU3RhcnQsIHBpY2tlcjogYW55KSB7XG4gICAgcGlja2VyLnNlbGVjdFJhbmdlKHJhbmdlU3RhcnQsIHRydWUpO1xuICB9XG5cbiAgc3luY1BpY2tlclBhaXIoY3VycmVudENhbGVuZGVyOiBvYmplY3QsIG9yaWVudGF0aW9uOiBzdHJpbmcpIHtcbiAgICBzd2l0Y2ggKG9yaWVudGF0aW9uKSB7XG4gICAgY2FzZSAnbGVmdCc6XG4gICAgICB0aGlzLmN1cnJlbnRDYWxlbmRhcnNbMF0gPSBjdXJyZW50Q2FsZW5kZXI7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdyaWdodCc6XG4gICAgICB0aGlzLmN1cnJlbnRDYWxlbmRhcnNbMV0gPSBjdXJyZW50Q2FsZW5kZXI7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBub3RpZnlWYWx1ZUNoYW5nZShyYW5nZSwgcmVhc29uKSB7XG4gICAgdGhpcy5vbkNoYW5nZShyYW5nZSk7XG4gICAgdGhpcy5vblRvdWNoZWQoKTtcbiAgICB0aGlzLnNlbGVjdGVkUmFuZ2VDaGFuZ2UuZW1pdCh7XG4gICAgICByZWFzb24sXG4gICAgICBzZWxlY3RlZFJhbmdlOiByYW5nZVxuICAgIH0pO1xuICB9XG5cbiAgY29uc29saWRhdGVUaW1lKCkge1xuICAgIGNvbnN0IHJhbmdlU3RhcnQgPSB0aGlzLnJhbmdlU3RhcnQ7XG4gICAgY29uc3QgcmFuZ2VFbmQgPSB0aGlzLnJhbmdlRW5kO1xuICAgIGNvbnN0IHJhbmdlU3RhcnRUaW1lID0gdGhpcy5sZWZ0UGlja2VyWydjdXJyZW50VGltZSddO1xuICAgIGNvbnN0IHJhbmdlRW5kVGltZSA9IHRoaXMucmlnaHRQaWNrZXJbJ2N1cnJlbnRUaW1lJ107XG4gICAgdGhpcy5yYW5nZVN0YXJ0ID0gbmV3IERhdGUocmFuZ2VTdGFydC5nZXRGdWxsWWVhcigpLCByYW5nZVN0YXJ0LmdldE1vbnRoKCksIHJhbmdlU3RhcnQuZ2V0RGF0ZSgpLFxuICAgICAgcmFuZ2VTdGFydFRpbWUuaG91ciwgcmFuZ2VTdGFydFRpbWUubWludXRlLCByYW5nZVN0YXJ0VGltZS5zZWNvbmQpO1xuICAgIHRoaXMucmFuZ2VFbmQgPSBuZXcgRGF0ZShyYW5nZUVuZC5nZXRGdWxsWWVhcigpLCByYW5nZUVuZC5nZXRNb250aCgpLCByYW5nZUVuZC5nZXREYXRlKCksXG4gICAgICByYW5nZUVuZFRpbWUuaG91ciwgcmFuZ2VFbmRUaW1lLm1pbnV0ZSwgcmFuZ2VFbmRUaW1lLnNlY29uZCk7XG4gICAgY29uc3QgbmV3UmFuZ2UgPSBbdGhpcy5yYW5nZVN0YXJ0LCB0aGlzLnJhbmdlRW5kXTtcbiAgICB0aGlzLm9uVG91Y2hlZCgpO1xuICAgIHRoaXMud3JpdGVWYWx1ZShuZXdSYW5nZSk7XG4gICAgdGhpcy5ub3RpZnlWYWx1ZUNoYW5nZShuZXdSYW5nZSwgU2VsZWN0RGF0ZVJhbmdlQ2hhbmdlUmVhc29uLmJ1dHRvbik7XG4gICAgdGhpcy5oaWRlLmVtaXQodHJ1ZSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5pMThuU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLmkxOG5TdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cblxuICBjbGVhckFsbCA9IChyZWFzb24/OiBTZWxlY3REYXRlUmFuZ2VDaGFuZ2VSZWFzb24pID0+IHtcbiAgICBjb25zdCBjdXJyZW50UmVhc29uID0gdHlwZW9mIHJlYXNvbiA9PT0gJ251bWJlcicgPyByZWFzb24gOiBTZWxlY3REYXRlUmFuZ2VDaGFuZ2VSZWFzb24uY3VzdG9tO1xuICAgIHRoaXMuY2hvb3NlRGF0ZShbbnVsbCwgbnVsbF0sIGN1cnJlbnRSZWFzb24pO1xuICB9O1xuXG59XG4iLCI8ZGl2IGNsYXNzPVwiZGV2dWktZGF0ZS1yYW5nZS1waWNrZXJcIj5cbiAgPGQtZGF0ZXBpY2tlci1yYW5nZS1zaW5nbGVcbiAgICBbbG9jYWxlXT1cImxvY2FsZSB8fCBpMThuTG9jYWxlXCJcbiAgICBjbGFzcz1cImRldnVpLWRhdGUtcGlja2VyXCJcbiAgICBbY3NzQ2xhc3NdPVwiY3NzQ2xhc3NcIlxuICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiXG4gICAgW2RhdGVDb252ZXJ0ZXJdPVwiZGF0ZUNvbnZlcnRlclwiXG4gICAgKHJhbmdlU2VsZWN0ZWQpPVwicmFuZ2VDaGFuZ2UoJGV2ZW50KVwiXG4gICAgW2RhdGVDb25maWddPVwiZGF0ZUNvbmZpZ1wiXG4gICAgW21heERhdGVdPVwibWF4RGF0ZVwiXG4gICAgW21pbkRhdGVdPVwibWluRGF0ZVwiXG4gICAgKGhvdmVyT25EYXRlKT1cInNlbGVjdGluZ0RhdGUoJGV2ZW50KVwiXG4gICAgW3JhbmdlUGlja2VyXT1cInRydWVcIlxuICAgIFtzZWxlY3RlZFJhbmdlXT1cIltyYW5nZVN0YXJ0LCByYW5nZUVuZF1cIlxuICAgIChyYW5nZVNlbGVjdGluZyk9XCJzeW5jUmFuZ2VTdGFydCgkZXZlbnQsIHJpZ2h0UGlja2VyKVwiXG4gICAgKHN5bmNQaWNrZXJQYWlyKT1cInN5bmNQaWNrZXJQYWlyKCRldmVudCwgJ2xlZnQnKVwiXG4gICAgW2N1cnJlbnRDYWxlbmRhcnNdPVwiY3VycmVudENhbGVuZGFyc1wiXG4gICAgW3Nob3dUaW1lXT1cInNob3dUaW1lXCJcbiAgICAjbGVmdFBpY2tlclxuICA+PC9kLWRhdGVwaWNrZXItcmFuZ2Utc2luZ2xlPlxuICA8ZC1kYXRlcGlja2VyLXJhbmdlLXNpbmdsZVxuICAgIFtsb2NhbGVdPVwibG9jYWxlIHx8IGkxOG5Mb2NhbGVcIlxuICAgIGNsYXNzPVwiZGV2dWktZGF0ZS1waWNrZXJcIlxuICAgIFtjc3NDbGFzc109XCJjc3NDbGFzc1wiXG4gICAgW2Rpc2FibGVkXT1cImRpc2FibGVkXCJcbiAgICBbZGF0ZUNvbnZlcnRlcl09XCJkYXRlQ29udmVydGVyXCJcbiAgICAocmFuZ2VTZWxlY3RlZCk9XCJyYW5nZUNoYW5nZSgkZXZlbnQpXCJcbiAgICBbZGF0ZUNvbmZpZ109XCJkYXRlQ29uZmlnXCJcbiAgICBbbWF4RGF0ZV09XCJtYXhEYXRlXCJcbiAgICBbbWluRGF0ZV09XCJtaW5EYXRlXCJcbiAgICAoaG92ZXJPbkRhdGUpPVwic2VsZWN0aW5nRGF0ZSgkZXZlbnQpXCJcbiAgICBbcmFuZ2VQaWNrZXJdPVwidHJ1ZVwiXG4gICAgW3NlbGVjdGVkUmFuZ2VdPVwiW3JhbmdlU3RhcnQsIHJhbmdlRW5kXVwiXG4gICAgKHJhbmdlU2VsZWN0aW5nKT1cInN5bmNSYW5nZVN0YXJ0KCRldmVudCwgbGVmdFBpY2tlcilcIlxuICAgIChzeW5jUGlja2VyUGFpcik9XCJzeW5jUGlja2VyUGFpcigkZXZlbnQsICdyaWdodCcpXCJcbiAgICBbaXNBdXhpbGlhcnldPVwidHJ1ZVwiXG4gICAgW2N1cnJlbnRDYWxlbmRhcnNdPVwiY3VycmVudENhbGVuZGFyc1wiXG4gICAgW3Nob3dUaW1lXT1cInNob3dUaW1lXCJcbiAgICAoY29uc29saWRhdGVUaW1lKT1cImNvbnNvbGlkYXRlVGltZSgpXCJcbiAgICAjcmlnaHRQaWNrZXJcbiAgPjwvZC1kYXRlcGlja2VyLXJhbmdlLXNpbmdsZT5cbjwvZGl2PlxuPGRpdiBjbGFzcz1cImRldnVpLWRhdGUtcmFuZ2UtY3VzdG9tXCIgKm5nSWY9XCJjdXN0b21WaWV3VGVtcGxhdGVcIiAjdGVtcGxhdGVXcmFwPlxuICA8bmctdGVtcGxhdGVcbiAgICBbbmdUZW1wbGF0ZU91dGxldF09XCJjdXN0b21WaWV3VGVtcGxhdGVcIlxuICAgIFtuZ1RlbXBsYXRlT3V0bGV0Q29udGV4dF09XCJ7XG4gICAgICAkaW1wbGljaXQ6IHRoaXMsXG4gICAgICBjbGVhckFsbDogY2xlYXJBbGwsXG4gICAgICBjaG9vc2VEYXRlOiBjaG9vc2VEYXRlLFxuICAgICAgcmFuZ2VTdGFydDogcmFuZ2VTdGFydCxcbiAgICAgIHJhbmdlRW5kOiByYW5nZUVuZFxuICAgIH1cIlxuICA+PC9uZy10ZW1wbGF0ZT5cbjwvZGl2PlxuIl19