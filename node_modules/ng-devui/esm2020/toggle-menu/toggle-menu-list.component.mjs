import { CdkVirtualScrollViewport } from '@angular/cdk/scrolling';
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, EventEmitter, Input, Output, TemplateRef, ViewChild } from '@angular/core';
import { I18nService } from 'ng-devui/i18n';
import { fadeInOut } from 'ng-devui/utils';
import * as i0 from "@angular/core";
import * as i1 from "ng-devui/i18n";
import * as i2 from "@angular/cdk/scrolling";
import * as i3 from "ng-devui/checkbox";
import * as i4 from "ng-devui/loading";
import * as i5 from "@angular/common";
import * as i6 from "ng-devui/utils";
import * as i7 from "@angular/forms";
export class ToggleMenuListComponent {
    constructor(changeDetectorRef, i18n) {
        this.changeDetectorRef = changeDetectorRef;
        this.i18n = i18n;
        /**
         * 【必选】下拉选项资源，支持Array<string>, Array<{key: value}>
         */
        this.options = [];
        /**
         * 【当传入资源（options）类型为Array<{key: value}，必选】针对传入资源options的每项对应字段做禁用操作的key
         */
        this.optionDisabledKey = '';
        /**
         * 【当传入资源（options）类型为Array<{key: value}，必选】针对传入资源options的每项对应字段禁止变更的key
         */
        this.optionImmutableKey = '';
        /**
         * 【当传入资源（options）类型为Array<{key: value}，可选】如使用分组需设置
         */
        this.optionGroupKey = '';
        /**
         * 【可选】是否在搜索过滤状态中
         */
        this.isFiltering = false;
        /**
         *  【可选】启用数据懒加载，默认不启用
         */
        this.enableLazyLoad = false;
        /**
         * 【可选】是否虚拟滚动
         */
        this.virtualScroll = false;
        /**
         * customViewTemplate的方向，支持下方和右方
         */
        this.customViewDirection = 'bottom';
        this.selectIndex = -1;
        this.multiItems = [];
        /**
         * 【可选】是否支持全选
         */
        this.isSelectAll = false;
        /**
         * 【可选】配置多选的时候是否维持原数组排序还是用户选择的顺序排序，默认是用户顺序
         */
        this.keepMultipleOrder = 'user-select';
        this.closeScope = 'all';
        /**
         * select下拉toggle事件，值为true或false
         */
        this.toggleChange = new EventEmitter();
        this.valueChange = new EventEmitter();
        this.loadMore = new EventEmitter();
        this._scrollHeight = '300px';
        this.availableOptions = [];
        this.activeIndex = -1;
        this.allChecked = false;
        this.halfChecked = false;
        this.showLoading = false;
        this.virtualScrollViewportSizeMightChange = false;
        this.virtualScrollItemSize = {
            sm: 30,
            normal: 36,
            lg: 50,
            space: 4,
        };
        this.choose = ({ option, index, event }) => {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            if (typeof option === 'object' && Object.keys(option).length === 0) {
                this.toggleChange.emit(false);
                return;
            }
            if (this.optionDisabledKey && option[this.optionDisabledKey]) {
                return;
            }
            if (this.optionImmutableKey && option[this.optionImmutableKey]) {
                return;
            }
            if (this.optionGroupKey && option[this.optionGroupKey]) {
                return;
            }
            if (this.multiple) {
                const indexOfOption = this.multiItems.findIndex((item) => JSON.stringify(item.option) === JSON.stringify(option));
                if (indexOfOption === -1) {
                    this.multiItems.push({ id: index, option });
                }
                else {
                    this.multiItems.splice(indexOfOption, 1);
                }
                if (this.keepMultipleOrder === 'origin') {
                    this.multiItems.sort((a, b) => a.id - b.id);
                }
                this.value = this.multiItems.map((item) => item.option);
            }
            else {
                this.value = option;
                this.activeIndex = index;
                this.selectIndex = index;
                if (this.closeScope === 'all') {
                    this.toggleChange.emit(false);
                }
                if (this.virtualScrollViewportSizeMightChange) {
                    // 解决虚拟滚动更新options长度展开前无法获取正确高度影响
                    setTimeout(() => {
                        if (this.virtualScrollViewportSizeMightChange && this.virtualScrollViewport) {
                            this.virtualScrollViewportSizeMightChange = false;
                            this.virtualScrollViewport.checkViewportSize();
                        }
                    }, 0);
                }
            }
            this.valueChange.emit({ value: this.value, multiItems: this.multiItems, option, event, index });
            this.setAvailableOptions();
            this.setChecked(this.value);
        };
    }
    /**
     * 【可选】下拉菜单高度，建议使用px作为高度单位
     */
    set scrollHeight(value) {
        this._scrollHeight = `${parseInt(value, 10)}px`;
    }
    get scrollHeight() {
        return this._scrollHeight;
    }
    get realVirtualScrollItemSize() {
        const itemSize = (this.templateItemSize || this.virtualScrollItemSize[this.size || 'normal']) + this.virtualScrollItemSize.space;
        const num = Math.round(this.scrollHeightNum / itemSize) || 10;
        this.minBuffer = num * 1.5 * itemSize;
        this.maxBuffer = num * 2.5 * itemSize;
        return itemSize;
    }
    ngOnInit() {
        this.setI18nText();
    }
    ngOnChanges(changes) {
        if (changes.options) {
            this.availableOptions = this.options;
            this.setAvailableOptions();
            // 显示数据变更，需要判断全选半选状态
            if (this.isSelectAll) {
                const selectedItemForFilterOptions = [];
                this.multiItems.forEach((item) => {
                    this.availableOptions.forEach((option) => {
                        if (item['id'] === option['id']) {
                            selectedItemForFilterOptions.push(item);
                        }
                    });
                });
                this.setChecked(selectedItemForFilterOptions);
            }
            if (!this.hasSelectIndex &&
                !this.multiple &&
                (!this.value || (this.availableOptions && !this.availableOptions.find((option) => option.option === this.value)))) {
                this.selectIndex = this.isFiltering && this.availableOptions && this.availableOptions.length > 0 ? 0 : -1;
            }
            if (this.virtualScroll && this.virtualScrollViewport) {
                this.virtualScrollViewportSizeMightChange = true;
                this.virtualScrollViewport.checkViewportSize();
            }
            this.changeDetectorRef.markForCheck();
        }
        if (changes.value) {
            this.setAvailableOptions();
        }
        if (changes.eventHandle && changes.eventHandle.currentValue) {
            const evt = changes['eventHandle'].currentValue;
            const { event, type } = evt;
            switch (type) {
                case 'keydown.esc':
                    this.onEscKeyup(event);
                    break;
                case 'keydown.ArrowUp':
                    this.handleKeyUpEvent(event);
                    break;
                case 'keydown.ArrowDown':
                    this.handleKeyDownEvent(event);
                    break;
                case 'keydown.enter':
                    this.handleKeyEnterEvent(event);
                    break;
            }
        }
    }
    ngOnDestroy() {
        if (this.i18nSubscription) {
            this.i18nSubscription.unsubscribe();
        }
    }
    setI18nText() {
        this.i18nCommonText = this.i18n.getI18nText().common;
        this.i18nSubscription = this.i18n.langChange().subscribe((data) => {
            this.i18nCommonText = data.common;
        });
    }
    setAvailableOptions() {
        if (!Array.isArray(this.availableOptions)) {
            return;
        }
        const _value = this.value ? (this.multiple ? this.value : [this.value]) : [];
        this.availableOptions = this.availableOptions.map((item, index) => item.id >= 0 && item.option
            ? {
                isChecked: _value.findIndex((i) => JSON.stringify(i) === JSON.stringify(item.option)) > -1,
                id: item.id,
                option: item.option,
            }
            : { isChecked: _value.findIndex((i) => JSON.stringify(i) === JSON.stringify(item)) > -1, id: index, option: item });
    }
    setChecked(selectedItem) {
        if (!selectedItem) {
            return;
        }
        if (!this.isSelectAll) {
            return;
        }
        this.halfChecked = false;
        if (selectedItem.length === this.availableOptions.length) {
            this.allChecked = true;
        }
        else if (selectedItem.length === 0) {
            this.allChecked = false;
        }
        else {
            this.halfChecked = true;
        }
    }
    selectAll() {
        const mutableOption = this.optionImmutableKey
            ? this.availableOptions.filter((item) => !item.option[this.optionImmutableKey])
            : this.availableOptions;
        const selectedImmutableOption = this.optionImmutableKey ? this.multiItems.filter((item) => item.option[this.optionImmutableKey]) : [];
        if (mutableOption && mutableOption.length > this.multiItems.length - selectedImmutableOption.length) {
            mutableOption.forEach((item) => {
                const indexOfOption = this.multiItems.findIndex((i) => JSON.stringify(i.option) === JSON.stringify(item.option));
                if (indexOfOption === -1) {
                    this.multiItems.push({ id: item.id, option: item.option });
                }
            });
        }
        else {
            this.multiItems = [...selectedImmutableOption];
        }
        this.value = this.multiItems.map((item) => item.option);
        this.valueChange.emit({ value: this.value, multiItems: this.multiItems });
        this.setChecked(this.value);
    }
    trackByFn(index, item) {
        return index;
    }
    onEscKeyup(event) {
        if (event) {
            event.stopPropagation();
        }
        this.toggleChange.emit(false);
    }
    handleKeyUpEvent(event) {
        if (event) {
            event.preventDefault();
            event.stopPropagation();
        }
        this.selectIndex = this.selectIndex === 0 || this.selectIndex === -1 ? this.availableOptions.length - 1 : this.selectIndex - 1;
        this.scrollToActive();
    }
    handleKeyDownEvent(event) {
        if (event) {
            event.preventDefault();
            event.stopPropagation();
        }
        this.selectIndex = this.selectIndex === this.availableOptions.length - 1 ? 0 : this.selectIndex + 1;
        this.scrollToActive();
    }
    handleKeyEnterEvent(event) {
        if (event) {
            event.preventDefault();
            event.stopPropagation();
        }
        const item = this.availableOptions[this.selectIndex];
        if (item) {
            this.choose({ option: item.option, index: item.id, event: null });
        }
        else if (this.closeScope === 'all') {
            this.toggleChange.emit(false);
        }
    }
    scrollToActive() {
        const that = this;
        setTimeout(() => {
            try {
                const selectIndex = that.selectIndex + (that.isSelectAll ? 1 : 0); // 多了个全选会导致问题，index需要加1
                const scrollPane = that.dropdownUl.nativeElement.children[selectIndex];
                if (scrollPane.scrollIntoViewIfNeeded) {
                    scrollPane.scrollIntoViewIfNeeded(false);
                }
                else {
                    const containerInfo = that.dropdownUl.nativeElement.getBoundingClientRect();
                    const elementInfo = scrollPane.getBoundingClientRect();
                    if (elementInfo.bottom > containerInfo.bottom || elementInfo.top < containerInfo.top) {
                        scrollPane.scrollIntoView(false);
                    }
                }
            }
            catch (e) { }
        });
    }
    resetIndex(resetSelectIndex = true) {
        this.selectIndex = resetSelectIndex ? -1 : 0;
        this.activeIndex = -1;
        this.changeDetectorRef.markForCheck();
    }
    showSelectAll() {
        return this.isSelectAll && this.multiple && this.availableOptions.length > 0;
    }
    getVirtualScrollHeight(len, size) {
        if (len > 0) {
            let height = (this.templateItemSize || this.virtualScrollItemSize[size || 'normal']) * len + this.virtualScrollItemSize.space * (len - 1);
            if (this.isSelectAll && this.multiple) {
                height += this.virtualScrollItemSize[size ? size : 'normal'] + this.virtualScrollItemSize.space;
            }
            const scrollHeight = parseInt(this.scrollHeight, 10);
            this.scrollHeightNum = height > scrollHeight ? scrollHeight : height;
            return `${this.scrollHeightNum}px`;
        }
    }
    loadMoreEvent(event) {
        this.showLoading = true;
        this.loadMore.emit({ instance: this, event });
    }
    loadStart() {
        this.showLoading = true;
        this.changeDetectorRef.detectChanges();
    }
    loadFinish() {
        this.showLoading = false;
        this.changeDetectorRef.detectChanges();
    }
}
ToggleMenuListComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: ToggleMenuListComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: i1.I18nService }], target: i0.ɵɵFactoryTarget.Component });
ToggleMenuListComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.3", type: ToggleMenuListComponent, selector: "d-toggle-menu-list", inputs: { options: "options", optionDisabledKey: "optionDisabledKey", optionImmutableKey: "optionImmutableKey", optionGroupKey: "optionGroupKey", size: "size", keyword: "keyword", isFiltering: "isFiltering", enableLazyLoad: "enableLazyLoad", virtualScroll: "virtualScroll", listItemTemplate: "listItemTemplate", loadingTemplateRef: "loadingTemplateRef", noResultItemTemplate: "noResultItemTemplate", customViewTemplate: "customViewTemplate", customViewDirection: "customViewDirection", templateItemSize: "templateItemSize", scrollHeight: "scrollHeight", selectIndex: "selectIndex", hasSelectIndex: "hasSelectIndex", multiple: "multiple", multiItems: "multiItems", value: "value", isSelectAll: "isSelectAll", keepMultipleOrder: "keepMultipleOrder", eventHandle: "eventHandle", closeScope: "closeScope" }, outputs: { toggleChange: "toggleChange", valueChange: "valueChange", loadMore: "loadMore" }, viewQueries: [{ propertyName: "dropdownUl", first: true, predicate: ["dropdownUl"], descendants: true }, { propertyName: "virtualScrollViewport", first: true, predicate: CdkVirtualScrollViewport, descendants: true }], usesOnChanges: true, ngImport: i0, template: "<ul\n  class=\"devui-dropdown-menu-wrap {{ size ? 'devui-dropdown-menu-' + size : '' }}\"\n  dLoading\n  positionType=\"relative\"\n  [showLoading]=\"showLoading\"\n  [message]=\"i18nCommonText?.loading\"\n  [loadingTemplateRef]=\"loadingTemplateRef\"\n  [backdrop]=\"true\"\n  (click)=\"$event.stopPropagation(); $event.preventDefault()\"\n>\n  <ng-content></ng-content>\n  <ul\n    #dropdownUl\n    *ngIf=\"!virtualScroll || enableLazyLoad; else scrollViewTpl\"\n    class=\"devui-select-list-unstyled devui-scrollbar\"\n    [ngStyle]=\"{ 'max-height': scrollHeight, width: '100%' }\"\n    dLazyLoad\n    [enableLazyLoad]=\"enableLazyLoad\"\n    (loadMore)=\"loadMoreEvent($event)\"\n  >\n    <ng-template [ngTemplateOutlet]=\"selectAllTpl\"></ng-template>\n    <ng-container *ngFor=\"let item of availableOptions; let index = index; trackBy: trackByFn\">\n      <!--list-item \u5355\u4E2A\u9009\u9879\u6A21\u677F-->\n      <ng-template\n        [ngTemplateOutlet]=\"listItemTemplate\"\n        [ngTemplateOutletContext]=\"{\n          item: item,\n          index: index,\n          selectIndex: selectIndex,\n          activeIndex: activeIndex,\n          choose: choose\n        }\"\n      ></ng-template>\n    </ng-container>\n    <div *ngIf=\"availableOptions?.length === 0\" class=\"devui-no-data-tip\">\n      <ng-container *ngIf=\"noResultItemTemplate; else noResultDefaultTpl\">\n        <ng-template [ngTemplateOutlet]=\"noResultItemTemplate\" [ngTemplateOutletContext]=\"{ options: options }\"></ng-template>\n      </ng-container>\n    </div>\n  </ul>\n</ul>\n<ng-container *ngIf=\"customViewTemplate\">\n  <div class=\"devui-select-custom-area\">\n    <ng-template [ngTemplateOutlet]=\"customViewTemplate\" [ngTemplateOutletContext]=\"{ $implicit: this, choose: choose }\"></ng-template>\n  </div>\n</ng-container>\n\n<!--\u865A\u62DF\u6EDA\u52A8\u6A21\u677F-->\n<ng-template #scrollViewTpl>\n  <cdk-virtual-scroll-viewport\n    [ngStyle]=\"{\n      height: getVirtualScrollHeight(availableOptions.length, size),\n      width: '100%',\n      'max-height': scrollHeight\n    }\"\n    [itemSize]=\"realVirtualScrollItemSize\"\n    [minBufferPx]=\"minBuffer\"\n    [maxBufferPx]=\"maxBuffer\"\n    class=\"viewport-wrapper devui-select-list-unstyled devui-scrollbar\"\n    #dropdownUl\n  >\n    <ng-template [ngTemplateOutlet]=\"selectAllTpl\"></ng-template>\n    <ng-container *cdkVirtualFor=\"let item of availableOptions; let index = index; trackBy: trackByFn\">\n      <ng-template\n        [ngTemplateOutlet]=\"listItemTemplate\"\n        [ngTemplateOutletContext]=\"{\n          item: item,\n          index: index,\n          selectIndex: selectIndex,\n          activeIndex: activeIndex,\n          choose: choose\n        }\"\n      ></ng-template>\n    </ng-container>\n  </cdk-virtual-scroll-viewport>\n</ng-template>\n\n<!--\u5168\u9009\u6A21\u677F-->\n<ng-template #selectAllTpl>\n  <li class=\"devui-dropdown-item\" *ngIf=\"showSelectAll()\" (click)=\"selectAll()\">\n    <span>\n      <d-checkbox [label]=\"i18nCommonText.checkAll\" [isShowTitle]=\"false\" [halfchecked]=\"halfChecked\" [(ngModel)]=\"allChecked\"></d-checkbox>\n    </span>\n  </li>\n</ng-template>\n\n<!--\u65E0\u5185\u5BB9\u6A21\u677F-->\n<ng-template #noResultDefaultTpl>{{ isFiltering ? i18nCommonText?.noRecordsFound : i18nCommonText?.noData }}</ng-template>\n", styles: [".devui-font-size-base{font-size:12px;font-size:var(--devui-font-size, 12px)}.devui-font-base{font-size:12px;font-size:var(--devui-font-size, 12px);font-weight:400;line-height:1.5}.devui-font-size-modal-title{font-size:18px;font-size:var(--devui-font-size-modal-title, 18px)}.devui-font-modal-title{font-size:18px;font-size:var(--devui-font-size-modal-title, 18px);font-weight:700;line-height:1.5}.devui-font-size-page-title{font-size:16px;font-size:var(--devui-font-size-page-title, 16px)}.devui-font-page-title{font-size:16px;font-size:var(--devui-font-size-page-title, 16px);font-weight:700;line-height:1.5}.devui-font-size-secondary-title{font-size:14px;font-size:var(--devui-font-size-card-title, 14px)}.devui-font-secondary-title{font-size:14px;font-size:var(--devui-font-size-card-title, 14px);font-weight:700;line-height:1.5}:host li{font-size:14px;font-size:var(--devui-font-size-lg, 14px);min-height:40px;line-height:28px;padding:8px 12px;width:100%;display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;border:0;background-color:transparent;color:#252b3a;color:var(--devui-text, #252b3a);cursor:pointer}:host li:hover{background-color:#f2f2f3;background-color:var(--devui-list-item-hover-bg, #f2f2f3);color:#252b3a;color:var(--devui-list-item-hover-text, #252b3a)}:host ::ng-deep d-toggle-menu-search .devui-toggle-menu-search>input{background-color:#f2f2f3;background-color:var(--devui-embed-search-bg, #f2f2f3)}\n"], components: [{ type: i2.CdkVirtualScrollViewport, selector: "cdk-virtual-scroll-viewport", inputs: ["orientation", "appendOnly"], outputs: ["scrolledIndexChange"] }, { type: i3.CheckBoxComponent, selector: "d-checkbox", inputs: ["name", "label", "cssClass", "color", "disabled", "isShowTitle", "title", "labelTemplate", "halfchecked", "showAnimation", "beforeChange"], outputs: ["change"] }], directives: [{ type: i4.LoadingDirective, selector: "[dLoading]", inputs: ["message", "backdrop", "loadingTemplateRef", "positionType", "view", "showLoading", "loading", "zIndex"], exportAs: ["dLoading"] }, { type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i6.LazyLoadDirective, selector: "[dLazyLoad]", inputs: ["enableLazyLoad", "contentMode", "target", "imgLoadSrc"], outputs: ["loadMore"] }, { type: i5.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { type: i5.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }, { type: i5.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i2.CdkFixedSizeVirtualScroll, selector: "cdk-virtual-scroll-viewport[itemSize]", inputs: ["itemSize", "minBufferPx", "maxBufferPx"] }, { type: i2.CdkVirtualForOf, selector: "[cdkVirtualFor][cdkVirtualForOf]", inputs: ["cdkVirtualForOf", "cdkVirtualForTrackBy", "cdkVirtualForTemplate", "cdkVirtualForTemplateCacheSize"] }, { type: i7.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i7.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }], animations: [fadeInOut], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: ToggleMenuListComponent, decorators: [{
            type: Component,
            args: [{ selector: 'd-toggle-menu-list', animations: [fadeInOut], changeDetection: ChangeDetectionStrategy.OnPush, preserveWhitespaces: false, template: "<ul\n  class=\"devui-dropdown-menu-wrap {{ size ? 'devui-dropdown-menu-' + size : '' }}\"\n  dLoading\n  positionType=\"relative\"\n  [showLoading]=\"showLoading\"\n  [message]=\"i18nCommonText?.loading\"\n  [loadingTemplateRef]=\"loadingTemplateRef\"\n  [backdrop]=\"true\"\n  (click)=\"$event.stopPropagation(); $event.preventDefault()\"\n>\n  <ng-content></ng-content>\n  <ul\n    #dropdownUl\n    *ngIf=\"!virtualScroll || enableLazyLoad; else scrollViewTpl\"\n    class=\"devui-select-list-unstyled devui-scrollbar\"\n    [ngStyle]=\"{ 'max-height': scrollHeight, width: '100%' }\"\n    dLazyLoad\n    [enableLazyLoad]=\"enableLazyLoad\"\n    (loadMore)=\"loadMoreEvent($event)\"\n  >\n    <ng-template [ngTemplateOutlet]=\"selectAllTpl\"></ng-template>\n    <ng-container *ngFor=\"let item of availableOptions; let index = index; trackBy: trackByFn\">\n      <!--list-item \u5355\u4E2A\u9009\u9879\u6A21\u677F-->\n      <ng-template\n        [ngTemplateOutlet]=\"listItemTemplate\"\n        [ngTemplateOutletContext]=\"{\n          item: item,\n          index: index,\n          selectIndex: selectIndex,\n          activeIndex: activeIndex,\n          choose: choose\n        }\"\n      ></ng-template>\n    </ng-container>\n    <div *ngIf=\"availableOptions?.length === 0\" class=\"devui-no-data-tip\">\n      <ng-container *ngIf=\"noResultItemTemplate; else noResultDefaultTpl\">\n        <ng-template [ngTemplateOutlet]=\"noResultItemTemplate\" [ngTemplateOutletContext]=\"{ options: options }\"></ng-template>\n      </ng-container>\n    </div>\n  </ul>\n</ul>\n<ng-container *ngIf=\"customViewTemplate\">\n  <div class=\"devui-select-custom-area\">\n    <ng-template [ngTemplateOutlet]=\"customViewTemplate\" [ngTemplateOutletContext]=\"{ $implicit: this, choose: choose }\"></ng-template>\n  </div>\n</ng-container>\n\n<!--\u865A\u62DF\u6EDA\u52A8\u6A21\u677F-->\n<ng-template #scrollViewTpl>\n  <cdk-virtual-scroll-viewport\n    [ngStyle]=\"{\n      height: getVirtualScrollHeight(availableOptions.length, size),\n      width: '100%',\n      'max-height': scrollHeight\n    }\"\n    [itemSize]=\"realVirtualScrollItemSize\"\n    [minBufferPx]=\"minBuffer\"\n    [maxBufferPx]=\"maxBuffer\"\n    class=\"viewport-wrapper devui-select-list-unstyled devui-scrollbar\"\n    #dropdownUl\n  >\n    <ng-template [ngTemplateOutlet]=\"selectAllTpl\"></ng-template>\n    <ng-container *cdkVirtualFor=\"let item of availableOptions; let index = index; trackBy: trackByFn\">\n      <ng-template\n        [ngTemplateOutlet]=\"listItemTemplate\"\n        [ngTemplateOutletContext]=\"{\n          item: item,\n          index: index,\n          selectIndex: selectIndex,\n          activeIndex: activeIndex,\n          choose: choose\n        }\"\n      ></ng-template>\n    </ng-container>\n  </cdk-virtual-scroll-viewport>\n</ng-template>\n\n<!--\u5168\u9009\u6A21\u677F-->\n<ng-template #selectAllTpl>\n  <li class=\"devui-dropdown-item\" *ngIf=\"showSelectAll()\" (click)=\"selectAll()\">\n    <span>\n      <d-checkbox [label]=\"i18nCommonText.checkAll\" [isShowTitle]=\"false\" [halfchecked]=\"halfChecked\" [(ngModel)]=\"allChecked\"></d-checkbox>\n    </span>\n  </li>\n</ng-template>\n\n<!--\u65E0\u5185\u5BB9\u6A21\u677F-->\n<ng-template #noResultDefaultTpl>{{ isFiltering ? i18nCommonText?.noRecordsFound : i18nCommonText?.noData }}</ng-template>\n", styles: [".devui-font-size-base{font-size:12px;font-size:var(--devui-font-size, 12px)}.devui-font-base{font-size:12px;font-size:var(--devui-font-size, 12px);font-weight:400;line-height:1.5}.devui-font-size-modal-title{font-size:18px;font-size:var(--devui-font-size-modal-title, 18px)}.devui-font-modal-title{font-size:18px;font-size:var(--devui-font-size-modal-title, 18px);font-weight:700;line-height:1.5}.devui-font-size-page-title{font-size:16px;font-size:var(--devui-font-size-page-title, 16px)}.devui-font-page-title{font-size:16px;font-size:var(--devui-font-size-page-title, 16px);font-weight:700;line-height:1.5}.devui-font-size-secondary-title{font-size:14px;font-size:var(--devui-font-size-card-title, 14px)}.devui-font-secondary-title{font-size:14px;font-size:var(--devui-font-size-card-title, 14px);font-weight:700;line-height:1.5}:host li{font-size:14px;font-size:var(--devui-font-size-lg, 14px);min-height:40px;line-height:28px;padding:8px 12px;width:100%;display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;border:0;background-color:transparent;color:#252b3a;color:var(--devui-text, #252b3a);cursor:pointer}:host li:hover{background-color:#f2f2f3;background-color:var(--devui-list-item-hover-bg, #f2f2f3);color:#252b3a;color:var(--devui-list-item-hover-text, #252b3a)}:host ::ng-deep d-toggle-menu-search .devui-toggle-menu-search>input{background-color:#f2f2f3;background-color:var(--devui-embed-search-bg, #f2f2f3)}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: i1.I18nService }]; }, propDecorators: { options: [{
                type: Input
            }], optionDisabledKey: [{
                type: Input
            }], optionImmutableKey: [{
                type: Input
            }], optionGroupKey: [{
                type: Input
            }], size: [{
                type: Input
            }], keyword: [{
                type: Input
            }], isFiltering: [{
                type: Input
            }], enableLazyLoad: [{
                type: Input
            }], virtualScroll: [{
                type: Input
            }], listItemTemplate: [{
                type: Input
            }], loadingTemplateRef: [{
                type: Input
            }], noResultItemTemplate: [{
                type: Input
            }], customViewTemplate: [{
                type: Input
            }], customViewDirection: [{
                type: Input
            }], templateItemSize: [{
                type: Input
            }], scrollHeight: [{
                type: Input
            }], selectIndex: [{
                type: Input
            }], hasSelectIndex: [{
                type: Input
            }], multiple: [{
                type: Input
            }], multiItems: [{
                type: Input
            }], value: [{
                type: Input
            }], isSelectAll: [{
                type: Input
            }], keepMultipleOrder: [{
                type: Input
            }], eventHandle: [{
                type: Input
            }], closeScope: [{
                type: Input
            }], toggleChange: [{
                type: Output
            }], valueChange: [{
                type: Output
            }], loadMore: [{
                type: Output
            }], dropdownUl: [{
                type: ViewChild,
                args: ['dropdownUl']
            }], virtualScrollViewport: [{
                type: ViewChild,
                args: [CdkVirtualScrollViewport]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9nZ2xlLW1lbnUtbGlzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9kZXZ1aS90b2dnbGUtbWVudS90b2dnbGUtbWVudS1saXN0LmNvbXBvbmVudC50cyIsIi4uLy4uLy4uL2RldnVpL3RvZ2dsZS1tZW51L3RvZ2dsZS1tZW51LWxpc3QuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDbEUsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osS0FBSyxFQUlMLE1BQU0sRUFFTixXQUFXLEVBQ1gsU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBaUIsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7Ozs7O0FBWTNDLE1BQU0sT0FBTyx1QkFBdUI7SUErSGxDLFlBQW9CLGlCQUFvQyxFQUFVLElBQWlCO1FBQS9ELHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFBVSxTQUFJLEdBQUosSUFBSSxDQUFhO1FBOUhuRjs7V0FFRztRQUNNLFlBQU8sR0FBOEIsRUFBRSxDQUFDO1FBQ2pEOztXQUVHO1FBQ00sc0JBQWlCLEdBQUcsRUFBRSxDQUFDO1FBQ2hDOztXQUVHO1FBQ00sdUJBQWtCLEdBQUcsRUFBRSxDQUFDO1FBQ2pDOztXQUVHO1FBQ00sbUJBQWMsR0FBRyxFQUFFLENBQUM7UUFNN0I7O1dBRUc7UUFDTSxnQkFBVyxHQUFHLEtBQUssQ0FBQztRQUM3Qjs7V0FFRztRQUNNLG1CQUFjLEdBQUcsS0FBSyxDQUFDO1FBQ2hDOztXQUVHO1FBQ00sa0JBQWEsR0FBRyxLQUFLLENBQUM7UUFrQi9COztXQUVHO1FBQ00sd0JBQW1CLEdBQXdDLFFB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LEtBQUs7Z0JBQ0csVUFBVTtzQkFBbEIsS0FBSztnQkFJSSxZQUFZO3NCQUFyQixNQUFNO2dCQUNHLFdBQVc7c0JBQXBCLE1BQU07Z0JBQ0csUUFBUTtzQkFBakIsTUFBTTtnQkFDa0IsVUFBVTtzQkFBbEMsU0FBUzt1QkFBQyxZQUFZO2dCQUNjLHFCQUFxQjtzQkFBekQsU0FBUzt1QkFBQyx3QkFBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDZGtWaXJ0dWFsU2Nyb2xsVmlld3BvcnQgfSBmcm9tICdAYW5ndWxhci9jZGsvc2Nyb2xsaW5nJztcbmltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFRlbXBsYXRlUmVmLFxuICBWaWV3Q2hpbGRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBJMThuSW50ZXJmYWNlLCBJMThuU2VydmljZSB9IGZyb20gJ25nLWRldnVpL2kxOG4nO1xuaW1wb3J0IHsgZmFkZUluT3V0IH0gZnJvbSAnbmctZGV2dWkvdXRpbHMnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBUb2dnbGVNZW51TGlzdEl0ZW0gfSBmcm9tICcuL3RvZ2dsZS1tZW51LnR5cGUnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdkLXRvZ2dsZS1tZW51LWxpc3QnLFxuICB0ZW1wbGF0ZVVybDogJy4vdG9nZ2xlLW1lbnUtbGlzdC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogW2AuL3RvZ2dsZS1tZW51LWxpc3QuY29tcG9uZW50LnNjc3NgXSxcbiAgYW5pbWF0aW9uczogW2ZhZGVJbk91dF0sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBwcmVzZXJ2ZVdoaXRlc3BhY2VzOiBmYWxzZSxcbn0pXG5leHBvcnQgY2xhc3MgVG9nZ2xlTWVudUxpc3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcbiAgLyoqXG4gICAqIOOAkOW/hemAieOAkeS4i+aLiemAiemhuei1hOa6kO+8jOaUr+aMgUFycmF5PHN0cmluZz4sIEFycmF5PHtrZXk6IHZhbHVlfT5cbiAgICovXG4gIEBJbnB1dCgpIG9wdGlvbnM6IEFycmF5PFRvZ2dsZU1lbnVMaXN0SXRlbT4gPSBbXTtcbiAgLyoqXG4gICAqIOOAkOW9k+S8oOWFpei1hOa6kO+8iG9wdGlvbnPvvInnsbvlnovkuLpBcnJheTx7a2V5OiB2YWx1ZX3vvIzlv4XpgInjgJHpkojlr7nkvKDlhaXotYTmupBvcHRpb25z55qE5q+P6aG55a+55bqU5a2X5q615YGa56aB55So5pON5L2c55qEa2V5XG4gICAqL1xuICBASW5wdXQoKSBvcHRpb25EaXNhYmxlZEtleSA9ICcnO1xuICAvKipcbiAgICog44CQ5b2T5Lyg5YWl6LWE5rqQ77yIb3B0aW9uc++8ieexu+Wei+S4ukFycmF5PHtrZXk6IHZhbHVlfe+8jOW/hemAieOAkemSiOWvueS8oOWFpei1hOa6kG9wdGlvbnPnmoTmr4/pobnlr7nlupTlrZfmrrXnpoHmraLlj5jmm7TnmoRrZXlcbiAgICovXG4gIEBJbnB1dCgpIG9wdGlvbkltbXV0YWJsZUtleSA9ICcnO1xuICAvKipcbiAgICog44CQ5b2T5Lyg5YWl6LWE5rqQ77yIb3B0aW9uc++8ieexu+Wei+S4ukFycmF5PHtrZXk6IHZhbHVlfe+8jOWPr+mAieOAkeWmguS9v+eUqOWIhue7hOmcgOiuvue9rlxuICAgKi9cbiAgQElucHV0KCkgb3B0aW9uR3JvdXBLZXkgPSAnJztcbiAgLyoqXG4gICAqIOOAkOWPr+mAieOAkeS4i+aLiemAieahhuWwuuWvuFxuICAgKi9cbiAgQElucHV0KCkgc2l6ZTogJycgfCAnc20nIHwgJ2xnJztcbiAgQElucHV0KCkga2V5d29yZDogc3RyaW5nO1xuICAvKipcbiAgICog44CQ5Y+v6YCJ44CR5piv5ZCm5Zyo5pCc57Si6L+H5ruk54q25oCB5LitXG4gICAqL1xuICBASW5wdXQoKSBpc0ZpbHRlcmluZyA9IGZhbHNlO1xuICAvKipcbiAgICogIOOAkOWPr+mAieOAkeWQr+eUqOaVsOaNruaHkuWKoOi9ve+8jOm7mOiupOS4jeWQr+eUqFxuICAgKi9cbiAgQElucHV0KCkgZW5hYmxlTGF6eUxvYWQgPSBmYWxzZTtcbiAgLyoqXG4gICAqIOOAkOWPr+mAieOAkeaYr+WQpuiZmuaLn+a7muWKqFxuICAgKi9cbiAgQElucHV0KCkgdmlydHVhbFNjcm9sbCA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiDjgJDlv4XpgInjgJHkuIvmi4nliJfooajljZXpobnmqKHmnb9cbiAgICovXG4gIEBJbnB1dCgpIGxpc3RJdGVtVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG4gIC8qKlxuICAgKiDjgJDlj6/pgInjgJHoh6rlrprkuYkgbG9hZGluZyDmqKHmnb9cbiAgICovXG4gIEBJbnB1dCgpIGxvYWRpbmdUZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8YW55PjtcbiAgLyoqXG4gICAqIOOAkOWPr+mAieOAkemFjee9ruaXoOaVsOaNruWxleekulxuICAgKi9cbiAgQElucHV0KCkgbm9SZXN1bHRJdGVtVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG4gIC8qKlxuICAgKiDjgJDlj6/pgInjgJHmlK/mjIHoh6rlrprkuYnljLrln5/mmL7npLrlhoXlrrlcbiAgICovXG4gIEBJbnB1dCgpIGN1c3RvbVZpZXdUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcbiAgLyoqXG4gICAqIGN1c3RvbVZpZXdUZW1wbGF0ZeeahOaWueWQke+8jOaUr+aMgeS4i+aWueWSjOWPs+aWuVxuICAgKi9cbiAgQElucHV0KCkgY3VzdG9tVmlld0RpcmVjdGlvbjogJ3RvcCcgfCAnYm90dG9tJyB8ICdyaWdodCcgfCAnbGVmdCcgPSAnYm90dG9tJztcbiAgLyoqXG4gICAqIOOAkOWPr+mAieOAkeaooeadv+mrmOW6plxuICAgKi9cbiAgQElucHV0KCkgdGVtcGxhdGVJdGVtU2l6ZTogbnVtYmVyOyAvLyDmqKHmnb9pdGVtU2l6Ze+8jGFwcGVuZFRvQm9keeS4unRydWVcbiAgLyoqXG4gICAqIOOAkOWPr+mAieOAkeS4i+aLieiPnOWNlemrmOW6pu+8jOW7uuiuruS9v+eUqHB45L2c5Li66auY5bqm5Y2V5L2NXG4gICAqL1xuICBASW5wdXQoKSBzZXQgc2Nyb2xsSGVpZ2h0KHZhbHVlKSB7XG4gICAgdGhpcy5fc2Nyb2xsSGVpZ2h0ID0gYCR7cGFyc2VJbnQodmFsdWUsIDEwKX1weGA7XG4gIH1cblxuICBnZXQgc2Nyb2xsSGVpZ2h0KCkge1xuICAgIHJldHVybiB0aGlzLl9zY3JvbGxIZWlnaHQ7XG4gIH1cblxuICBASW5wdXQoKSBzZWxlY3RJbmRleCA9IC0xO1xuICAvKipcbiAgICog44CQ5Y+v6YCJ44CR5piv5ZCm5YWB6K645Y2V6YCJ54q25oCB5LiL5peg6YCJ5Lit5YC85pe26auY5Lqu5p+Q6aG5XG4gICAqL1xuICBASW5wdXQoKSBoYXNTZWxlY3RJbmRleDogYm9vbGVhbjtcbiAgLyoqXG4gICAqIOOAkOWPr+mAieOAkeaYr+WQpuaUr+aMgeWkmumAiVxuICAgKi9cbiAgQElucHV0KCkgbXVsdGlwbGU6IGJvb2xlYW47XG4gIEBJbnB1dCgpIG11bHRpSXRlbXMgPSBbXTtcbiAgQElucHV0KCkgdmFsdWU6IFRvZ2dsZU1lbnVMaXN0SXRlbSB8IEFycmF5PFRvZ2dsZU1lbnVMaXN0SXRlbT47XG4gIC8qKlxuICAgKiDjgJDlj6/pgInjgJHmmK/lkKbmlK/mjIHlhajpgIlcbiAgICovXG4gIEBJbnB1dCgpIGlzU2VsZWN0QWxsID0gZmFsc2U7XG4gIC8qKlxuICAgKiDjgJDlj6/pgInjgJHphY3nva7lpJrpgInnmoTml7blgJnmmK/lkKbnu7TmjIHljp/mlbDnu4TmjpLluo/ov5jmmK/nlKjmiLfpgInmi6nnmoTpobrluo/mjpLluo/vvIzpu5jorqTmmK/nlKjmiLfpobrluo9cbiAgICovXG4gIEBJbnB1dCgpIGtlZXBNdWx0aXBsZU9yZGVyOiAnb3JpZ2luJyB8ICd1c2VyLXNlbGVjdCcgPSAndXNlci1zZWxlY3QnO1xuICBASW5wdXQoKSBldmVudEhhbmRsZTogYW55O1xuICBASW5wdXQoKSBjbG9zZVNjb3BlOiAnYWxsJyB8ICdibGFuaycgfCAnbm9uZScgPSAnYWxsJztcbiAgLyoqXG4gICAqIHNlbGVjdOS4i+aLiXRvZ2dsZeS6i+S7tu+8jOWAvOS4unRydWXmiJZmYWxzZVxuICAgKi9cbiAgQE91dHB1dCgpIHRvZ2dsZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgdmFsdWVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgpIGxvYWRNb3JlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBWaWV3Q2hpbGQoJ2Ryb3Bkb3duVWwnKSBkcm9wZG93blVsOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKENka1ZpcnR1YWxTY3JvbGxWaWV3cG9ydCkgdmlydHVhbFNjcm9sbFZpZXdwb3J0OiBDZGtWaXJ0dWFsU2Nyb2xsVmlld3BvcnQ7XG5cbiAgZ2V0IHJlYWxWaXJ0dWFsU2Nyb2xsSXRlbVNpemUoKSB7XG4gICAgY29uc3QgaXRlbVNpemUgPSAodGhpcy50ZW1wbGF0ZUl0ZW1TaXplIHx8IHRoaXMudmlydHVhbFNjcm9sbEl0ZW1TaXplW3RoaXMuc2l6ZSB8fCAnbm9ybWFsJ10pICsgdGhpcy52aXJ0dWFsU2Nyb2xsSXRlbVNpemUuc3BhY2U7XG4gICAgY29uc3QgbnVtID0gTWF0aC5yb3VuZCh0aGlzLnNjcm9sbEhlaWdodE51bSAvIGl0ZW1TaXplKSB8fCAxMDtcbiAgICB0aGlzLm1pbkJ1ZmZlciA9IG51bSAqIDEuNSAqIGl0ZW1TaXplO1xuICAgIHRoaXMubWF4QnVmZmVyID0gbnVtICogMi41ICogaXRlbVNpemU7XG4gICAgcmV0dXJuIGl0ZW1TaXplO1xuICB9XG5cbiAgX3Njcm9sbEhlaWdodCA9ICczMDBweCc7XG4gIGkxOG5Db21tb25UZXh0OiBJMThuSW50ZXJmYWNlWydjb21tb24nXTtcbiAgaTE4blN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICBhdmFpbGFibGVPcHRpb25zID0gW107XG4gIGFjdGl2ZUluZGV4ID0gLTE7XG4gIGFsbENoZWNrZWQgPSBmYWxzZTtcbiAgaGFsZkNoZWNrZWQgPSBmYWxzZTtcbiAgc2hvd0xvYWRpbmcgPSBmYWxzZTtcbiAgc2Nyb2xsSGVpZ2h0TnVtOiBudW1iZXI7XG4gIG1pbkJ1ZmZlcjogbnVtYmVyO1xuICBtYXhCdWZmZXI6IG51bWJlcjtcbiAgdmlydHVhbFNjcm9sbFZpZXdwb3J0U2l6ZU1pZ2h0Q2hhbmdlID0gZmFsc2U7XG4gIHZpcnR1YWxTY3JvbGxJdGVtU2l6ZTogYW55ID0ge1xuICAgIHNtOiAzMCxcbiAgICBub3JtYWw6IDM2LFxuICAgIGxnOiA1MCxcbiAgICBzcGFjZTogNCxcbiAgfTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZiwgcHJpdmF0ZSBpMThuOiBJMThuU2VydmljZSkge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLnNldEkxOG5UZXh0KCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKGNoYW5nZXMub3B0aW9ucykge1xuICAgICAgdGhpcy5hdmFpbGFibGVPcHRpb25zID0gdGhpcy5vcHRpb25zO1xuICAgICAgdGhpcy5zZXRBdmFpbGFibGVPcHRpb25zKCk7XG4gICAgICAvLyDmmL7npLrmlbDmja7lj5jmm7TvvIzpnIDopoHliKTmlq3lhajpgInljYrpgInnirbmgIFcbiAgICAgIGlmICh0aGlzLmlzU2VsZWN0QWxsKSB7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkSXRlbUZvckZpbHRlck9wdGlvbnMgPSBbXTtcbiAgICAgICAgdGhpcy5tdWx0aUl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICB0aGlzLmF2YWlsYWJsZU9wdGlvbnMuZm9yRWFjaCgob3B0aW9uKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXRlbVsnaWQnXSA9PT0gb3B0aW9uWydpZCddKSB7XG4gICAgICAgICAgICAgIHNlbGVjdGVkSXRlbUZvckZpbHRlck9wdGlvbnMucHVzaChpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2V0Q2hlY2tlZChzZWxlY3RlZEl0ZW1Gb3JGaWx0ZXJPcHRpb25zKTtcbiAgICAgIH1cbiAgICAgIGlmIChcbiAgICAgICAgIXRoaXMuaGFzU2VsZWN0SW5kZXggJiZcbiAgICAgICAgIXRoaXMubXVsdGlwbGUgJiZcbiAgICAgICAgKCF0aGlzLnZhbHVlIHx8ICh0aGlzLmF2YWlsYWJsZU9wdGlvbnMgJiYgIXRoaXMuYXZhaWxhYmxlT3B0aW9ucy5maW5kKChvcHRpb24pID0+IG9wdGlvbi5vcHRpb24gPT09IHRoaXMudmFsdWUpKSlcbiAgICAgICkge1xuICAgICAgICB0aGlzLnNlbGVjdEluZGV4ID0gdGhpcy5pc0ZpbHRlcmluZyAmJiB0aGlzLmF2YWlsYWJsZU9wdGlvbnMgJiYgdGhpcy5hdmFpbGFibGVPcHRpb25zLmxlbmd0aCA+IDAgPyAwIDogLTE7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy52aXJ0dWFsU2Nyb2xsICYmIHRoaXMudmlydHVhbFNjcm9sbFZpZXdwb3J0KSB7XG4gICAgICAgIHRoaXMudmlydHVhbFNjcm9sbFZpZXdwb3J0U2l6ZU1pZ2h0Q2hhbmdlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy52aXJ0dWFsU2Nyb2xsVmlld3BvcnQuY2hlY2tWaWV3cG9ydFNpemUoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuICAgIGlmIChjaGFuZ2VzLnZhbHVlKSB7XG4gICAgICB0aGlzLnNldEF2YWlsYWJsZU9wdGlvbnMoKTtcbiAgICB9XG4gICAgaWYgKGNoYW5nZXMuZXZlbnRIYW5kbGUgJiYgY2hhbmdlcy5ldmVudEhhbmRsZS5jdXJyZW50VmFsdWUpIHtcbiAgICAgIGNvbnN0IGV2dCA9IGNoYW5nZXNbJ2V2ZW50SGFuZGxlJ10uY3VycmVudFZhbHVlO1xuICAgICAgY29uc3QgeyBldmVudCwgdHlwZSB9ID0gZXZ0O1xuICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlICdrZXlkb3duLmVzYyc6XG4gICAgICAgIHRoaXMub25Fc2NLZXl1cChldmVudCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAna2V5ZG93bi5BcnJvd1VwJzpcbiAgICAgICAgdGhpcy5oYW5kbGVLZXlVcEV2ZW50KGV2ZW50KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdrZXlkb3duLkFycm93RG93bic6XG4gICAgICAgIHRoaXMuaGFuZGxlS2V5RG93bkV2ZW50KGV2ZW50KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdrZXlkb3duLmVudGVyJzpcbiAgICAgICAgdGhpcy5oYW5kbGVLZXlFbnRlckV2ZW50KGV2ZW50KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaTE4blN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy5pMThuU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgc2V0STE4blRleHQoKSB7XG4gICAgdGhpcy5pMThuQ29tbW9uVGV4dCA9IHRoaXMuaTE4bi5nZXRJMThuVGV4dCgpLmNvbW1vbjtcbiAgICB0aGlzLmkxOG5TdWJzY3JpcHRpb24gPSB0aGlzLmkxOG4ubGFuZ0NoYW5nZSgpLnN1YnNjcmliZSgoZGF0YSkgPT4ge1xuICAgICAgdGhpcy5pMThuQ29tbW9uVGV4dCA9IGRhdGEuY29tbW9uO1xuICAgIH0pO1xuICB9XG5cbiAgc2V0QXZhaWxhYmxlT3B0aW9ucygpIHtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkodGhpcy5hdmFpbGFibGVPcHRpb25zKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBfdmFsdWUgPSB0aGlzLnZhbHVlID8gKHRoaXMubXVsdGlwbGUgPyB0aGlzLnZhbHVlIDogW3RoaXMudmFsdWVdKSA6IFtdO1xuICAgIHRoaXMuYXZhaWxhYmxlT3B0aW9ucyA9IHRoaXMuYXZhaWxhYmxlT3B0aW9ucy5tYXAoKGl0ZW0sIGluZGV4KSA9PlxuICAgICAgaXRlbS5pZCA+PSAwICYmIGl0ZW0ub3B0aW9uXG4gICAgICAgID8ge1xuICAgICAgICAgIGlzQ2hlY2tlZDogX3ZhbHVlLmZpbmRJbmRleCgoaSkgPT4gSlNPTi5zdHJpbmdpZnkoaSkgPT09IEpTT04uc3RyaW5naWZ5KGl0ZW0ub3B0aW9uKSkgPiAtMSxcbiAgICAgICAgICBpZDogaXRlbS5pZCxcbiAgICAgICAgICBvcHRpb246IGl0ZW0ub3B0aW9uLFxuICAgICAgICB9XG4gICAgICAgIDogeyBpc0NoZWNrZWQ6IF92YWx1ZS5maW5kSW5kZXgoKGkpID0+IEpTT04uc3RyaW5naWZ5KGkpID09PSBKU09OLnN0cmluZ2lmeShpdGVtKSkgPiAtMSwgaWQ6IGluZGV4LCBvcHRpb246IGl0ZW0gfVxuICAgICk7XG4gIH1cblxuICBzZXRDaGVja2VkKHNlbGVjdGVkSXRlbSkge1xuICAgIGlmICghc2VsZWN0ZWRJdGVtKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghdGhpcy5pc1NlbGVjdEFsbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmhhbGZDaGVja2VkID0gZmFsc2U7XG4gICAgaWYgKHNlbGVjdGVkSXRlbS5sZW5ndGggPT09IHRoaXMuYXZhaWxhYmxlT3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgIHRoaXMuYWxsQ2hlY2tlZCA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChzZWxlY3RlZEl0ZW0ubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLmFsbENoZWNrZWQgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5oYWxmQ2hlY2tlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgc2VsZWN0QWxsKCkge1xuICAgIGNvbnN0IG11dGFibGVPcHRpb24gPSB0aGlzLm9wdGlvbkltbXV0YWJsZUtleVxuICAgICAgPyB0aGlzLmF2YWlsYWJsZU9wdGlvbnMuZmlsdGVyKChpdGVtKSA9PiAhaXRlbS5vcHRpb25bdGhpcy5vcHRpb25JbW11dGFibGVLZXldKVxuICAgICAgOiB0aGlzLmF2YWlsYWJsZU9wdGlvbnM7XG4gICAgY29uc3Qgc2VsZWN0ZWRJbW11dGFibGVPcHRpb24gPSB0aGlzLm9wdGlvbkltbXV0YWJsZUtleSA/IHRoaXMubXVsdGlJdGVtcy5maWx0ZXIoKGl0ZW0pID0+IGl0ZW0ub3B0aW9uW3RoaXMub3B0aW9uSW1tdXRhYmxlS2V5XSkgOiBbXTtcblxuICAgIGlmIChtdXRhYmxlT3B0aW9uICYmIG11dGFibGVPcHRpb24ubGVuZ3RoID4gdGhpcy5tdWx0aUl0ZW1zLmxlbmd0aCAtIHNlbGVjdGVkSW1tdXRhYmxlT3B0aW9uLmxlbmd0aCkge1xuICAgICAgbXV0YWJsZU9wdGlvbi5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgIGNvbnN0IGluZGV4T2ZPcHRpb24gPSB0aGlzLm11bHRpSXRlbXMuZmluZEluZGV4KChpKSA9PiBKU09OLnN0cmluZ2lmeShpLm9wdGlvbikgPT09IEpTT04uc3RyaW5naWZ5KGl0ZW0ub3B0aW9uKSk7XG4gICAgICAgIGlmIChpbmRleE9mT3B0aW9uID09PSAtMSkge1xuICAgICAgICAgIHRoaXMubXVsdGlJdGVtcy5wdXNoKHsgaWQ6IGl0ZW0uaWQsIG9wdGlvbjogaXRlbS5vcHRpb24gfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm11bHRpSXRlbXMgPSBbLi4uc2VsZWN0ZWRJbW11dGFibGVPcHRpb25dO1xuICAgIH1cbiAgICB0aGlzLnZhbHVlID0gdGhpcy5tdWx0aUl0ZW1zLm1hcCgoaXRlbSkgPT4gaXRlbS5vcHRpb24pO1xuICAgIHRoaXMudmFsdWVDaGFuZ2UuZW1pdCh7IHZhbHVlOiB0aGlzLnZhbHVlLCBtdWx0aUl0ZW1zOiB0aGlzLm11bHRpSXRlbXMgfSk7XG4gICAgdGhpcy5zZXRDaGVja2VkKHRoaXMudmFsdWUpO1xuICB9XG5cbiAgdHJhY2tCeUZuKGluZGV4LCBpdGVtKSB7XG4gICAgcmV0dXJuIGluZGV4O1xuICB9XG5cbiAgb25Fc2NLZXl1cChldmVudD86IEV2ZW50KSB7XG4gICAgaWYgKGV2ZW50KSB7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG4gICAgdGhpcy50b2dnbGVDaGFuZ2UuZW1pdChmYWxzZSk7XG4gIH1cblxuICBoYW5kbGVLZXlVcEV2ZW50KGV2ZW50PzogRXZlbnQpIHtcbiAgICBpZiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG4gICAgdGhpcy5zZWxlY3RJbmRleCA9IHRoaXMuc2VsZWN0SW5kZXggPT09IDAgfHwgdGhpcy5zZWxlY3RJbmRleCA9PT0gLTEgPyB0aGlzLmF2YWlsYWJsZU9wdGlvbnMubGVuZ3RoIC0gMSA6IHRoaXMuc2VsZWN0SW5kZXggLSAxO1xuICAgIHRoaXMuc2Nyb2xsVG9BY3RpdmUoKTtcbiAgfVxuXG4gIGhhbmRsZUtleURvd25FdmVudChldmVudD86IEV2ZW50KSB7XG4gICAgaWYgKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfVxuICAgIHRoaXMuc2VsZWN0SW5kZXggPSB0aGlzLnNlbGVjdEluZGV4ID09PSB0aGlzLmF2YWlsYWJsZU9wdGlvbnMubGVuZ3RoIC0gMSA/IDAgOiB0aGlzLnNlbGVjdEluZGV4ICsgMTtcbiAgICB0aGlzLnNjcm9sbFRvQWN0aXZlKCk7XG4gIH1cblxuICBoYW5kbGVLZXlFbnRlckV2ZW50KGV2ZW50PzogRXZlbnQpIHtcbiAgICBpZiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG4gICAgY29uc3QgaXRlbSA9IHRoaXMuYXZhaWxhYmxlT3B0aW9uc1t0aGlzLnNlbGVjdEluZGV4XTtcbiAgICBpZiAoaXRlbSkge1xuICAgICAgdGhpcy5jaG9vc2UoeyBvcHRpb246IGl0ZW0ub3B0aW9uLCBpbmRleDogaXRlbS5pZCwgZXZlbnQ6IG51bGwgfSk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmNsb3NlU2NvcGUgPT09ICdhbGwnKSB7XG4gICAgICB0aGlzLnRvZ2dsZUNoYW5nZS5lbWl0KGZhbHNlKTtcbiAgICB9XG4gIH1cblxuICBzY3JvbGxUb0FjdGl2ZSgpOiB2b2lkIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHNlbGVjdEluZGV4ID0gdGhhdC5zZWxlY3RJbmRleCArICh0aGF0LmlzU2VsZWN0QWxsID8gMSA6IDApOyAvLyDlpJrkuobkuKrlhajpgInkvJrlr7zoh7Tpl67popjvvIxpbmRleOmcgOimgeWKoDFcbiAgICAgICAgY29uc3Qgc2Nyb2xsUGFuZTogYW55ID0gdGhhdC5kcm9wZG93blVsLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bc2VsZWN0SW5kZXhdO1xuICAgICAgICBpZiAoc2Nyb2xsUGFuZS5zY3JvbGxJbnRvVmlld0lmTmVlZGVkKSB7XG4gICAgICAgICAgc2Nyb2xsUGFuZS5zY3JvbGxJbnRvVmlld0lmTmVlZGVkKGZhbHNlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBjb250YWluZXJJbmZvID0gdGhhdC5kcm9wZG93blVsLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgY29uc3QgZWxlbWVudEluZm8gPSBzY3JvbGxQYW5lLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgIGlmIChlbGVtZW50SW5mby5ib3R0b20gPiBjb250YWluZXJJbmZvLmJvdHRvbSB8fCBlbGVtZW50SW5mby50b3AgPCBjb250YWluZXJJbmZvLnRvcCkge1xuICAgICAgICAgICAgc2Nyb2xsUGFuZS5zY3JvbGxJbnRvVmlldyhmYWxzZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7fVxuICAgIH0pO1xuICB9XG5cbiAgcmVzZXRJbmRleChyZXNldFNlbGVjdEluZGV4ID0gdHJ1ZSkge1xuICAgIHRoaXMuc2VsZWN0SW5kZXggPSByZXNldFNlbGVjdEluZGV4ID8gLTEgOiAwO1xuICAgIHRoaXMuYWN0aXZlSW5kZXggPSAtMTtcbiAgICB0aGlzLmNoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgY2hvb3NlID0gKHsgb3B0aW9uLCBpbmRleCwgZXZlbnQgfSkgPT4ge1xuICAgIGlmIChldmVudCkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG9wdGlvbiA9PT0gJ29iamVjdCcgJiYgT2JqZWN0LmtleXMob3B0aW9uKS5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoaXMudG9nZ2xlQ2hhbmdlLmVtaXQoZmFsc2UpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy5vcHRpb25EaXNhYmxlZEtleSAmJiBvcHRpb25bdGhpcy5vcHRpb25EaXNhYmxlZEtleV0pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHRoaXMub3B0aW9uSW1tdXRhYmxlS2V5ICYmIG9wdGlvblt0aGlzLm9wdGlvbkltbXV0YWJsZUtleV0pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHRoaXMub3B0aW9uR3JvdXBLZXkgJiYgb3B0aW9uW3RoaXMub3B0aW9uR3JvdXBLZXldKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLm11bHRpcGxlKSB7XG4gICAgICBjb25zdCBpbmRleE9mT3B0aW9uID0gdGhpcy5tdWx0aUl0ZW1zLmZpbmRJbmRleCgoaXRlbSkgPT4gSlNPTi5zdHJpbmdpZnkoaXRlbS5vcHRpb24pID09PSBKU09OLnN0cmluZ2lmeShvcHRpb24pKTtcbiAgICAgIGlmIChpbmRleE9mT3B0aW9uID09PSAtMSkge1xuICAgICAgICB0aGlzLm11bHRpSXRlbXMucHVzaCh7IGlkOiBpbmRleCwgb3B0aW9uIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5tdWx0aUl0ZW1zLnNwbGljZShpbmRleE9mT3B0aW9uLCAxKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmtlZXBNdWx0aXBsZU9yZGVyID09PSAnb3JpZ2luJykge1xuICAgICAgICB0aGlzLm11bHRpSXRlbXMuc29ydCgoYSwgYikgPT4gYS5pZCAtIGIuaWQpO1xuICAgICAgfVxuICAgICAgdGhpcy52YWx1ZSA9IHRoaXMubXVsdGlJdGVtcy5tYXAoKGl0ZW0pID0+IGl0ZW0ub3B0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy52YWx1ZSA9IG9wdGlvbjtcbiAgICAgIHRoaXMuYWN0aXZlSW5kZXggPSBpbmRleDtcbiAgICAgIHRoaXMuc2VsZWN0SW5kZXggPSBpbmRleDtcbiAgICAgIGlmICh0aGlzLmNsb3NlU2NvcGUgPT09ICdhbGwnKSB7XG4gICAgICAgIHRoaXMudG9nZ2xlQ2hhbmdlLmVtaXQoZmFsc2UpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMudmlydHVhbFNjcm9sbFZpZXdwb3J0U2l6ZU1pZ2h0Q2hhbmdlKSB7XG4gICAgICAgIC8vIOino+WGs+iZmuaLn+a7muWKqOabtOaWsG9wdGlvbnPplb/luqblsZXlvIDliY3ml6Dms5Xojrflj5bmraPnoa7pq5jluqblvbHlk41cbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgaWYgKHRoaXMudmlydHVhbFNjcm9sbFZpZXdwb3J0U2l6ZU1pZ2h0Q2hhbmdlICYmIHRoaXMudmlydHVhbFNjcm9sbFZpZXdwb3J0KSB7XG4gICAgICAgICAgICB0aGlzLnZpcnR1YWxTY3JvbGxWaWV3cG9ydFNpemVNaWdodENoYW5nZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy52aXJ0dWFsU2Nyb2xsVmlld3BvcnQuY2hlY2tWaWV3cG9ydFNpemUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIDApO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQoeyB2YWx1ZTogdGhpcy52YWx1ZSwgbXVsdGlJdGVtczogdGhpcy5tdWx0aUl0ZW1zLCBvcHRpb24sIGV2ZW50LCBpbmRleCB9KTtcbiAgICB0aGlzLnNldEF2YWlsYWJsZU9wdGlvbnMoKTtcbiAgICB0aGlzLnNldENoZWNrZWQodGhpcy52YWx1ZSk7XG4gIH07XG5cbiAgc2hvd1NlbGVjdEFsbCgpIHtcbiAgICByZXR1cm4gdGhpcy5pc1NlbGVjdEFsbCAmJiB0aGlzLm11bHRpcGxlICYmIHRoaXMuYXZhaWxhYmxlT3B0aW9ucy5sZW5ndGggPiAwO1xuICB9XG5cbiAgZ2V0VmlydHVhbFNjcm9sbEhlaWdodChsZW4sIHNpemUpIHtcbiAgICBpZiAobGVuID4gMCkge1xuICAgICAgbGV0IGhlaWdodCA9XG4gICAgICAgICh0aGlzLnRlbXBsYXRlSXRlbVNpemUgfHwgdGhpcy52aXJ0dWFsU2Nyb2xsSXRlbVNpemVbc2l6ZSB8fCAnbm9ybWFsJ10pICogbGVuICsgdGhpcy52aXJ0dWFsU2Nyb2xsSXRlbVNpemUuc3BhY2UgKiAobGVuIC0gMSk7XG4gICAgICBpZiAodGhpcy5pc1NlbGVjdEFsbCAmJiB0aGlzLm11bHRpcGxlKSB7XG4gICAgICAgIGhlaWdodCArPSB0aGlzLnZpcnR1YWxTY3JvbGxJdGVtU2l6ZVtzaXplID8gc2l6ZSA6ICdub3JtYWwnXSArIHRoaXMudmlydHVhbFNjcm9sbEl0ZW1TaXplLnNwYWNlO1xuICAgICAgfVxuICAgICAgY29uc3Qgc2Nyb2xsSGVpZ2h0ID0gcGFyc2VJbnQodGhpcy5zY3JvbGxIZWlnaHQsIDEwKTtcbiAgICAgIHRoaXMuc2Nyb2xsSGVpZ2h0TnVtID0gaGVpZ2h0ID4gc2Nyb2xsSGVpZ2h0ID8gc2Nyb2xsSGVpZ2h0IDogaGVpZ2h0O1xuICAgICAgcmV0dXJuIGAke3RoaXMuc2Nyb2xsSGVpZ2h0TnVtfXB4YDtcbiAgICB9XG4gIH1cblxuICBsb2FkTW9yZUV2ZW50KGV2ZW50KSB7XG4gICAgdGhpcy5zaG93TG9hZGluZyA9IHRydWU7XG4gICAgdGhpcy5sb2FkTW9yZS5lbWl0KHsgaW5zdGFuY2U6IHRoaXMsIGV2ZW50IH0pO1xuICB9XG5cbiAgbG9hZFN0YXJ0KCkge1xuICAgIHRoaXMuc2hvd0xvYWRpbmcgPSB0cnVlO1xuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgbG9hZEZpbmlzaCgpIHtcbiAgICB0aGlzLnNob3dMb2FkaW5nID0gZmFsc2U7XG4gICAgdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cbn1cbiIsIjx1bFxuICBjbGFzcz1cImRldnVpLWRyb3Bkb3duLW1lbnUtd3JhcCB7eyBzaXplID8gJ2RldnVpLWRyb3Bkb3duLW1lbnUtJyArIHNpemUgOiAnJyB9fVwiXG4gIGRMb2FkaW5nXG4gIHBvc2l0aW9uVHlwZT1cInJlbGF0aXZlXCJcbiAgW3Nob3dMb2FkaW5nXT1cInNob3dMb2FkaW5nXCJcbiAgW21lc3NhZ2VdPVwiaTE4bkNvbW1vblRleHQ/LmxvYWRpbmdcIlxuICBbbG9hZGluZ1RlbXBsYXRlUmVmXT1cImxvYWRpbmdUZW1wbGF0ZVJlZlwiXG4gIFtiYWNrZHJvcF09XCJ0cnVlXCJcbiAgKGNsaWNrKT1cIiRldmVudC5zdG9wUHJvcGFnYXRpb24oKTsgJGV2ZW50LnByZXZlbnREZWZhdWx0KClcIlxuPlxuICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG4gIDx1bFxuICAgICNkcm9wZG93blVsXG4gICAgKm5nSWY9XCIhdmlydHVhbFNjcm9sbCB8fCBlbmFibGVMYXp5TG9hZDsgZWxzZSBzY3JvbGxWaWV3VHBsXCJcbiAgICBjbGFzcz1cImRldnVpLXNlbGVjdC1saXN0LXVuc3R5bGVkIGRldnVpLXNjcm9sbGJhclwiXG4gICAgW25nU3R5bGVdPVwieyAnbWF4LWhlaWdodCc6IHNjcm9sbEhlaWdodCwgd2lkdGg6ICcxMDAlJyB9XCJcbiAgICBkTGF6eUxvYWRcbiAgICBbZW5hYmxlTGF6eUxvYWRdPVwiZW5hYmxlTGF6eUxvYWRcIlxuICAgIChsb2FkTW9yZSk9XCJsb2FkTW9yZUV2ZW50KCRldmVudClcIlxuICA+XG4gICAgPG5nLXRlbXBsYXRlIFtuZ1RlbXBsYXRlT3V0bGV0XT1cInNlbGVjdEFsbFRwbFwiPjwvbmctdGVtcGxhdGU+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdGb3I9XCJsZXQgaXRlbSBvZiBhdmFpbGFibGVPcHRpb25zOyBsZXQgaW5kZXggPSBpbmRleDsgdHJhY2tCeTogdHJhY2tCeUZuXCI+XG4gICAgICA8IS0tbGlzdC1pdGVtIOWNleS4qumAiemhueaooeadvy0tPlxuICAgICAgPG5nLXRlbXBsYXRlXG4gICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImxpc3RJdGVtVGVtcGxhdGVcIlxuICAgICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwie1xuICAgICAgICAgIGl0ZW06IGl0ZW0sXG4gICAgICAgICAgaW5kZXg6IGluZGV4LFxuICAgICAgICAgIHNlbGVjdEluZGV4OiBzZWxlY3RJbmRleCxcbiAgICAgICAgICBhY3RpdmVJbmRleDogYWN0aXZlSW5kZXgsXG4gICAgICAgICAgY2hvb3NlOiBjaG9vc2VcbiAgICAgICAgfVwiXG4gICAgICA+PC9uZy10ZW1wbGF0ZT5cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgICA8ZGl2ICpuZ0lmPVwiYXZhaWxhYmxlT3B0aW9ucz8ubGVuZ3RoID09PSAwXCIgY2xhc3M9XCJkZXZ1aS1uby1kYXRhLXRpcFwiPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIm5vUmVzdWx0SXRlbVRlbXBsYXRlOyBlbHNlIG5vUmVzdWx0RGVmYXVsdFRwbFwiPlxuICAgICAgICA8bmctdGVtcGxhdGUgW25nVGVtcGxhdGVPdXRsZXRdPVwibm9SZXN1bHRJdGVtVGVtcGxhdGVcIiBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwieyBvcHRpb25zOiBvcHRpb25zIH1cIj48L25nLXRlbXBsYXRlPlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgPC9kaXY+XG4gIDwvdWw+XG48L3VsPlxuPG5nLWNvbnRhaW5lciAqbmdJZj1cImN1c3RvbVZpZXdUZW1wbGF0ZVwiPlxuICA8ZGl2IGNsYXNzPVwiZGV2dWktc2VsZWN0LWN1c3RvbS1hcmVhXCI+XG4gICAgPG5nLXRlbXBsYXRlIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImN1c3RvbVZpZXdUZW1wbGF0ZVwiIFtuZ1RlbXBsYXRlT3V0bGV0Q29udGV4dF09XCJ7ICRpbXBsaWNpdDogdGhpcywgY2hvb3NlOiBjaG9vc2UgfVwiPjwvbmctdGVtcGxhdGU+XG4gIDwvZGl2PlxuPC9uZy1jb250YWluZXI+XG5cbjwhLS3omZrmi5/mu5rliqjmqKHmnb8tLT5cbjxuZy10ZW1wbGF0ZSAjc2Nyb2xsVmlld1RwbD5cbiAgPGNkay12aXJ0dWFsLXNjcm9sbC12aWV3cG9ydFxuICAgIFtuZ1N0eWxlXT1cIntcbiAgICAgIGhlaWdodDogZ2V0VmlydHVhbFNjcm9sbEhlaWdodChhdmFpbGFibGVPcHRpb25zLmxlbmd0aCwgc2l6ZSksXG4gICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgJ21heC1oZWlnaHQnOiBzY3JvbGxIZWlnaHRcbiAgICB9XCJcbiAgICBbaXRlbVNpemVdPVwicmVhbFZpcnR1YWxTY3JvbGxJdGVtU2l6ZVwiXG4gICAgW21pbkJ1ZmZlclB4XT1cIm1pbkJ1ZmZlclwiXG4gICAgW21heEJ1ZmZlclB4XT1cIm1heEJ1ZmZlclwiXG4gICAgY2xhc3M9XCJ2aWV3cG9ydC13cmFwcGVyIGRldnVpLXNlbGVjdC1saXN0LXVuc3R5bGVkIGRldnVpLXNjcm9sbGJhclwiXG4gICAgI2Ryb3Bkb3duVWxcbiAgPlxuICAgIDxuZy10ZW1wbGF0ZSBbbmdUZW1wbGF0ZU91dGxldF09XCJzZWxlY3RBbGxUcGxcIj48L25nLXRlbXBsYXRlPlxuICAgIDxuZy1jb250YWluZXIgKmNka1ZpcnR1YWxGb3I9XCJsZXQgaXRlbSBvZiBhdmFpbGFibGVPcHRpb25zOyBsZXQgaW5kZXggPSBpbmRleDsgdHJhY2tCeTogdHJhY2tCeUZuXCI+XG4gICAgICA8bmctdGVtcGxhdGVcbiAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwibGlzdEl0ZW1UZW1wbGF0ZVwiXG4gICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0Q29udGV4dF09XCJ7XG4gICAgICAgICAgaXRlbTogaXRlbSxcbiAgICAgICAgICBpbmRleDogaW5kZXgsXG4gICAgICAgICAgc2VsZWN0SW5kZXg6IHNlbGVjdEluZGV4LFxuICAgICAgICAgIGFjdGl2ZUluZGV4OiBhY3RpdmVJbmRleCxcbiAgICAgICAgICBjaG9vc2U6IGNob29zZVxuICAgICAgICB9XCJcbiAgICAgID48L25nLXRlbXBsYXRlPlxuICAgIDwvbmctY29udGFpbmVyPlxuICA8L2Nkay12aXJ0dWFsLXNjcm9sbC12aWV3cG9ydD5cbjwvbmctdGVtcGxhdGU+XG5cbjwhLS3lhajpgInmqKHmnb8tLT5cbjxuZy10ZW1wbGF0ZSAjc2VsZWN0QWxsVHBsPlxuICA8bGkgY2xhc3M9XCJkZXZ1aS1kcm9wZG93bi1pdGVtXCIgKm5nSWY9XCJzaG93U2VsZWN0QWxsKClcIiAoY2xpY2spPVwic2VsZWN0QWxsKClcIj5cbiAgICA8c3Bhbj5cbiAgICAgIDxkLWNoZWNrYm94IFtsYWJlbF09XCJpMThuQ29tbW9uVGV4dC5jaGVja0FsbFwiIFtpc1Nob3dUaXRsZV09XCJmYWxzZVwiIFtoYWxmY2hlY2tlZF09XCJoYWxmQ2hlY2tlZFwiIFsobmdNb2RlbCldPVwiYWxsQ2hlY2tlZFwiPjwvZC1jaGVja2JveD5cbiAgICA8L3NwYW4+XG4gIDwvbGk+XG48L25nLXRlbXBsYXRlPlxuXG48IS0t5peg5YaF5a655qih5p2/LS0+XG48bmctdGVtcGxhdGUgI25vUmVzdWx0RGVmYXVsdFRwbD57eyBpc0ZpbHRlcmluZyA/IGkxOG5Db21tb25UZXh0Py5ub1JlY29yZHNGb3VuZCA6IGkxOG5Db21tb25UZXh0Py5ub0RhdGEgfX08L25nLXRlbXBsYXRlPlxuIl19