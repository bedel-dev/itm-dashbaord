import cssVars from 'css-vars-ponyfill';
import { THEME_KEY } from './key-config';
import { devuiDarkTheme, devuiLightTheme } from './theme-data';
import { ThemeService } from './theme-service';
import { EventBus } from './utils';
/**
 * usage
 * main.ts
 ```ts
 import { ThemeServiceInit } from 'ng-devui/theme';
 ThemeServiceInit();
 ```
 *
*/
export function ThemeServiceInit(themes, defaultThemeName, extraData, ieSupport = false, // TODO：css-var-ponyflll 仍有一些问题待定位
allowDynamicTheme = false) {
    window[THEME_KEY.themeCollection] = themes || {
        'devui-light-theme': devuiLightTheme,
        'devui-dark-theme': devuiDarkTheme,
    };
    window[THEME_KEY.currentTheme] = defaultThemeName || 'devui-light-theme';
    const eventBus = window['globalEventBus'] || new EventBus(); // window.globalEventBus 为 框架的事件总线
    const themeService = new ThemeService(eventBus);
    window[THEME_KEY.themeService] = themeService;
    themeService.setExtraData(extraData || {
        'devui-dark-theme': {
            appendClasses: ['dark-mode']
        }
    });
    themeService.initializeTheme(null, allowDynamicTheme);
    if (ieSupport) {
        ieSupportCssVar();
    }
    return themeService;
}
export function ThemeServiceFollowSystemOn(themeConfig) {
    const themeService = window[THEME_KEY.themeService];
    themeService.registerMediaQuery();
    return themeService.mediaQuery.prefersColorSchemeChange.subscribe(value => {
        if (value === 'dark') {
            themeService.applyTheme(window[THEME_KEY.themeCollection][themeConfig && themeConfig.darkThemeName || 'devui-dark-theme']);
        }
        else {
            themeService.applyTheme(window[THEME_KEY.themeCollection][themeConfig && themeConfig.lightThemeName || 'devui-light-theme']);
        }
    });
}
export function ThemeServiceFollowSystemOff(sub) {
    if (sub) {
        sub.unsubscribe();
    }
    const themeService = window[THEME_KEY.themeService];
    themeService.unregisterMediaQuery();
}
export function ieSupportCssVar() {
    const isNativeSupport = window['CSS'] && CSS.supports && CSS.supports('(--a: 0)') || false;
    if (isNativeSupport) {
        return;
    }
    cssVars({ watch: true, silent: true });
    const observer = new MutationObserver(function (mutations) {
        mutations.forEach(function (mutation) {
            cssVars({ watch: false, silent: true });
            cssVars({ watch: true, silent: true });
        });
    });
    const config = { attributes: true, attributeFilter: [THEME_KEY.uiThemeAttributeName] };
    observer.observe(document.querySelector(`#${THEME_KEY.styleElementId}`), config);
}
// TODO: management should handle add / remove theme from theme collection.
// TODO: move global variables（window.xxxx） to single namespace
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhlbWUtbWFuYWdlbWVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2RldnVpL3RoZW1lL3RoZW1lLW1hbmFnZW1lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxPQUFPLE1BQU0sbUJBQW1CLENBQUM7QUFFeEMsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUV6QyxPQUFPLEVBQUUsY0FBYyxFQUFFLGVBQWUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUMvRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUVuQzs7Ozs7Ozs7RUFRRTtBQUNGLE1BQU0sVUFBVSxnQkFBZ0IsQ0FDOUIsTUFBdUMsRUFDdkMsZ0JBQXlCLEVBQ3pCLFNBT0MsRUFDRCxTQUFTLEdBQUcsS0FBSyxFQUFFLGtDQUFrQztBQUNyRCxpQkFBaUIsR0FBRyxLQUFLO0lBRXpCLE1BQU0sQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLEdBQUcsTUFBTSxJQUFJO1FBQzVDLG1CQUFtQixFQUFFLGVBQWU7UUFDcEMsa0JBQWtCLEVBQUUsY0FBYztLQUNuQyxDQUFDO0lBQ0YsTUFBTSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsR0FBRyxnQkFBZ0IsSUFBSSxtQkFBbUIsQ0FBQztJQUN6RSxNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxJQUFJLFFBQVEsRUFBRSxDQUFDLENBQUMsa0NBQWtDO0lBQy9GLE1BQU0sWUFBWSxHQUFHLElBQUksWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ2hELE1BQU0sQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLEdBQUcsWUFBWSxDQUFDO0lBRTlDLFlBQVksQ0FBQyxZQUFZLENBQUMsU0FBUyxJQUFJO1FBQ3JDLGtCQUFrQixFQUFFO1lBQ2xCLGFBQWEsRUFBRSxDQUFDLFdBQVcsQ0FBQztTQUM3QjtLQUNGLENBQUMsQ0FBQztJQUNILFlBQVksQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFLGlCQUFpQixDQUFDLENBQUM7SUFDdEQsSUFBSSxTQUFTLEVBQUU7UUFDYixlQUFlLEVBQUUsQ0FBQztLQUNuQjtJQUNELE9BQU8sWUFBWSxDQUFDO0FBQ3RCLENBQUM7QUFFRCxNQUFNLFVBQVUsMEJBQTBCLENBQUMsV0FBK0Q7SUFDeEcsTUFBTSxZQUFZLEdBQWlCLE1BQU0sQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDbEUsWUFBWSxDQUFDLGtCQUFrQixFQUFFLENBQUM7SUFDbEMsT0FBTyxZQUFZLENBQUMsVUFBVSxDQUFDLHdCQUF3QixDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUN4RSxJQUFJLEtBQUssS0FBSyxNQUFNLEVBQUU7WUFDcEIsWUFBWSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxDQUFDLFdBQVcsSUFBSSxXQUFXLENBQUMsYUFBYSxJQUFJLGtCQUFrQixDQUFDLENBQUMsQ0FBQztTQUM1SDthQUFNO1lBQ0wsWUFBWSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxDQUFDLFdBQVcsSUFBSSxXQUFXLENBQUMsY0FBYyxJQUFJLG1CQUFtQixDQUFDLENBQUMsQ0FBQztTQUM5SDtJQUNILENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQUNELE1BQU0sVUFBVSwyQkFBMkIsQ0FBQyxHQUFrQjtJQUM1RCxJQUFJLEdBQUcsRUFBRTtRQUNQLEdBQUcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztLQUNuQjtJQUNELE1BQU0sWUFBWSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDcEQsWUFBWSxDQUFDLG9CQUFvQixFQUFFLENBQUM7QUFDdEMsQ0FBQztBQUVELE1BQU0sVUFBVSxlQUFlO0lBQzdCLE1BQU0sZUFBZSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLENBQUMsUUFBUSxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLElBQUksS0FBSyxDQUFDO0lBQzNGLElBQUksZUFBZSxFQUFFO1FBQUUsT0FBTztLQUFFO0lBQ2hDLE9BQU8sQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7SUFDdkMsTUFBTSxRQUFRLEdBQUcsSUFBSSxnQkFBZ0IsQ0FBQyxVQUFVLFNBQVM7UUFDdkQsU0FBUyxDQUFDLE9BQU8sQ0FBQyxVQUFVLFFBQVE7WUFDbEMsT0FBTyxDQUFDLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUN4QyxPQUFPLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ3pDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxNQUFNLE1BQU0sR0FBRyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsZUFBZSxFQUFFLENBQUMsU0FBUyxDQUFDLG9CQUFvQixDQUFDLEVBQUUsQ0FBQztJQUV2RixRQUFRLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsSUFBSSxTQUFTLENBQUMsY0FBYyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztBQUNuRixDQUFDO0FBRUQsMkVBQTJFO0FBQzNFLCtEQUErRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjc3NWYXJzIGZyb20gJ2Nzcy12YXJzLXBvbnlmaWxsJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgVEhFTUVfS0VZIH0gZnJvbSAnLi9rZXktY29uZmlnJztcbmltcG9ydCB7IFRoZW1lIH0gZnJvbSAnLi90aGVtZSc7XG5pbXBvcnQgeyBkZXZ1aURhcmtUaGVtZSwgZGV2dWlMaWdodFRoZW1lIH0gZnJvbSAnLi90aGVtZS1kYXRhJztcbmltcG9ydCB7IFRoZW1lU2VydmljZSB9IGZyb20gJy4vdGhlbWUtc2VydmljZSc7XG5pbXBvcnQgeyBFdmVudEJ1cyB9IGZyb20gJy4vdXRpbHMnO1xuXG4vKipcbiAqIHVzYWdlXG4gKiBtYWluLnRzXG4gYGBgdHNcbiBpbXBvcnQgeyBUaGVtZVNlcnZpY2VJbml0IH0gZnJvbSAnbmctZGV2dWkvdGhlbWUnO1xuIFRoZW1lU2VydmljZUluaXQoKTtcbiBgYGBcbiAqXG4qL1xuZXhwb3J0IGZ1bmN0aW9uIFRoZW1lU2VydmljZUluaXQoXG4gIHRoZW1lcz86IHsgW3RoZW1lTmFtZTogc3RyaW5nXTogVGhlbWUgfSxcbiAgZGVmYXVsdFRoZW1lTmFtZT86IHN0cmluZyxcbiAgZXh0cmFEYXRhPzoge1xuICAgIFt0aGVtZU5hbWU6IHN0cmluZ106IHtcbiAgICAgIGFwcGVuZENsYXNzZXM/OiBBcnJheTxzdHJpbmc+O1xuICAgICAgY3NzVmFyaWFibGVzPzoge1xuICAgICAgICBbY3NzVmFyTmFtZTogc3RyaW5nXTogc3RyaW5nO1xuICAgICAgfTtcbiAgICB9O1xuICB9LFxuICBpZVN1cHBvcnQgPSBmYWxzZSwgLy8gVE9ET++8mmNzcy12YXItcG9ueWZsbGwg5LuN5pyJ5LiA5Lqb6Zeu6aKY5b6F5a6a5L2NXG4gIGFsbG93RHluYW1pY1RoZW1lID0gZmFsc2Vcbikge1xuICB3aW5kb3dbVEhFTUVfS0VZLnRoZW1lQ29sbGVjdGlvbl0gPSB0aGVtZXMgfHwge1xuICAgICdkZXZ1aS1saWdodC10aGVtZSc6IGRldnVpTGlnaHRUaGVtZSxcbiAgICAnZGV2dWktZGFyay10aGVtZSc6IGRldnVpRGFya1RoZW1lLFxuICB9O1xuICB3aW5kb3dbVEhFTUVfS0VZLmN1cnJlbnRUaGVtZV0gPSBkZWZhdWx0VGhlbWVOYW1lIHx8ICdkZXZ1aS1saWdodC10aGVtZSc7XG4gIGNvbnN0IGV2ZW50QnVzID0gd2luZG93WydnbG9iYWxFdmVudEJ1cyddIHx8IG5ldyBFdmVudEJ1cygpOyAvLyB3aW5kb3cuZ2xvYmFsRXZlbnRCdXMg5Li6IOahhuaetueahOS6i+S7tuaAu+e6v1xuICBjb25zdCB0aGVtZVNlcnZpY2UgPSBuZXcgVGhlbWVTZXJ2aWNlKGV2ZW50QnVzKTtcbiAgd2luZG93W1RIRU1FX0tFWS50aGVtZVNlcnZpY2VdID0gdGhlbWVTZXJ2aWNlO1xuXG4gIHRoZW1lU2VydmljZS5zZXRFeHRyYURhdGEoZXh0cmFEYXRhIHx8IHtcbiAgICAnZGV2dWktZGFyay10aGVtZSc6IHtcbiAgICAgIGFwcGVuZENsYXNzZXM6IFsnZGFyay1tb2RlJ11cbiAgICB9XG4gIH0pO1xuICB0aGVtZVNlcnZpY2UuaW5pdGlhbGl6ZVRoZW1lKG51bGwsIGFsbG93RHluYW1pY1RoZW1lKTtcbiAgaWYgKGllU3VwcG9ydCkge1xuICAgIGllU3VwcG9ydENzc1ZhcigpO1xuICB9XG4gIHJldHVybiB0aGVtZVNlcnZpY2U7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBUaGVtZVNlcnZpY2VGb2xsb3dTeXN0ZW1Pbih0aGVtZUNvbmZpZz86IHsgbGlnaHRUaGVtZU5hbWU6IHN0cmluZzsgZGFya1RoZW1lTmFtZTogc3RyaW5nIH0pOiBTdWJzY3JpcHRpb24ge1xuICBjb25zdCB0aGVtZVNlcnZpY2U6IFRoZW1lU2VydmljZSA9IHdpbmRvd1tUSEVNRV9LRVkudGhlbWVTZXJ2aWNlXTtcbiAgdGhlbWVTZXJ2aWNlLnJlZ2lzdGVyTWVkaWFRdWVyeSgpO1xuICByZXR1cm4gdGhlbWVTZXJ2aWNlLm1lZGlhUXVlcnkucHJlZmVyc0NvbG9yU2NoZW1lQ2hhbmdlLnN1YnNjcmliZSh2YWx1ZSA9PiB7XG4gICAgaWYgKHZhbHVlID09PSAnZGFyaycpIHtcbiAgICAgIHRoZW1lU2VydmljZS5hcHBseVRoZW1lKHdpbmRvd1tUSEVNRV9LRVkudGhlbWVDb2xsZWN0aW9uXVt0aGVtZUNvbmZpZyAmJiB0aGVtZUNvbmZpZy5kYXJrVGhlbWVOYW1lIHx8ICdkZXZ1aS1kYXJrLXRoZW1lJ10pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGVtZVNlcnZpY2UuYXBwbHlUaGVtZSh3aW5kb3dbVEhFTUVfS0VZLnRoZW1lQ29sbGVjdGlvbl1bdGhlbWVDb25maWcgJiYgdGhlbWVDb25maWcubGlnaHRUaGVtZU5hbWUgfHwgJ2RldnVpLWxpZ2h0LXRoZW1lJ10pO1xuICAgIH1cbiAgfSk7XG59XG5leHBvcnQgZnVuY3Rpb24gVGhlbWVTZXJ2aWNlRm9sbG93U3lzdGVtT2ZmKHN1Yj86IFN1YnNjcmlwdGlvbikge1xuICBpZiAoc3ViKSB7XG4gICAgc3ViLnVuc3Vic2NyaWJlKCk7XG4gIH1cbiAgY29uc3QgdGhlbWVTZXJ2aWNlID0gd2luZG93W1RIRU1FX0tFWS50aGVtZVNlcnZpY2VdO1xuICB0aGVtZVNlcnZpY2UudW5yZWdpc3Rlck1lZGlhUXVlcnkoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGllU3VwcG9ydENzc1ZhcigpIHtcbiAgY29uc3QgaXNOYXRpdmVTdXBwb3J0ID0gd2luZG93WydDU1MnXSAmJiBDU1Muc3VwcG9ydHMgJiYgQ1NTLnN1cHBvcnRzKCcoLS1hOiAwKScpIHx8IGZhbHNlO1xuICBpZiAoaXNOYXRpdmVTdXBwb3J0KSB7IHJldHVybjsgfVxuICBjc3NWYXJzKHsgd2F0Y2g6IHRydWUsIHNpbGVudDogdHJ1ZSB9KTtcbiAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbiAobXV0YXRpb25zKSB7XG4gICAgbXV0YXRpb25zLmZvckVhY2goZnVuY3Rpb24gKG11dGF0aW9uKSB7XG4gICAgICBjc3NWYXJzKHsgd2F0Y2g6IGZhbHNlLCBzaWxlbnQ6IHRydWUgfSk7XG4gICAgICBjc3NWYXJzKHsgd2F0Y2g6IHRydWUsIHNpbGVudDogdHJ1ZSB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgY29uc3QgY29uZmlnID0geyBhdHRyaWJ1dGVzOiB0cnVlLCBhdHRyaWJ1dGVGaWx0ZXI6IFtUSEVNRV9LRVkudWlUaGVtZUF0dHJpYnV0ZU5hbWVdIH07XG5cbiAgb2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHtUSEVNRV9LRVkuc3R5bGVFbGVtZW50SWR9YCksIGNvbmZpZyk7XG59XG5cbi8vIFRPRE86IG1hbmFnZW1lbnQgc2hvdWxkIGhhbmRsZSBhZGQgLyByZW1vdmUgdGhlbWUgZnJvbSB0aGVtZSBjb2xsZWN0aW9uLlxuLy8gVE9ETzogbW92ZSBnbG9iYWwgdmFyaWFibGVz77yId2luZG93Lnh4eHjvvIkgdG8gc2luZ2xlIG5hbWVzcGFjZVxuIl19