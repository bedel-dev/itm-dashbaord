import { forEach, isUndefined, omitBy, pickBy, reduce, trim, values } from 'lodash-es';
import { BehaviorSubject } from 'rxjs';
export class TreeNode {
    constructor(id, parentId, data) {
        this.id = id;
        this.parentId = parentId;
        this.data = data;
    }
}
export class TreeFactory {
    constructor(isVirtualScroll) {
        this.isVirtualScroll = isVirtualScroll;
        this._checked = new Set();
        this._treeRoot = [];
        this.flattenNodes = new BehaviorSubject([]);
        this.mapTreeItems = ({ treeItems, parentId, treeNodeChildrenKey = 'items', treeNodeIdKey = 'id', checkboxDisabledKey = 'disabled', selectDisabledKey = 'disableSelect', toggleDisabledKey = 'disableToggle', treeNodeTitleKey = 'title', }, renderTree = true) => {
            forEach(treeItems, (item) => {
                const node = this.addNode({
                    id: item[treeNodeIdKey],
                    parentId,
                    title: item[treeNodeTitleKey],
                    isOpen: !!item.open,
                    data: item.data || {},
                    originItem: item,
                    isParent: !!item.isParent || !!(item[treeNodeChildrenKey] && item[treeNodeChildrenKey].length > 0),
                    loading: !!item.loading,
                    isMatch: !!item.isMatch,
                    isHide: !!item.isHide,
                    isChecked: !!item.isChecked,
                    halfChecked: !!item.halfChecked,
                    isActive: !!item.isActive,
                    disabled: !!item[checkboxDisabledKey],
                    disableSelect: !!item[selectDisabledKey],
                    disableToggle: !!item[toggleDisabledKey],
                    disableAdd: !!item.disableAdd,
                    disableEdit: !!item.disableEdit,
                    disableDelete: !!item.disableDelete,
                    children: [],
                    showCheckbox: item.showCheckbox,
                }, undefined, renderTree);
                if (item.isChecked) {
                    this._checked.add(node);
                }
                this.mapTreeItems({
                    treeItems: item[treeNodeChildrenKey] || [],
                    parentId: node.id,
                    treeNodeChildrenKey,
                    treeNodeIdKey,
                    checkboxDisabledKey,
                    selectDisabledKey,
                    toggleDisabledKey,
                    treeNodeTitleKey,
                }, renderTree);
            });
            return this;
        };
        this.virtualScroll = isVirtualScroll;
        this.idx = 0;
        this.nodes = {};
    }
    static create(isVirtualScroll) {
        return new TreeFactory(isVirtualScroll);
    }
    // tree model with items
    static fromTree({ treeItems, isVirtualScroll = false, treeNodeChildrenKey = 'items', treeNodeIdKey = 'id', checkboxDisabledKey = 'disabled', selectDisabledKey = 'disabled', // 默认值与checkboxDisabledKey相同，为了兼容以前tree的disable情况
    toggleDisabledKey = 'disabledToggle', treeNodeTitleKey = 'title', }) {
        const treeFactory = TreeFactory.create(isVirtualScroll);
        treeFactory.mapTreeItems({
            treeItems,
            parentId: undefined,
            treeNodeChildrenKey,
            treeNodeIdKey,
            checkboxDisabledKey,
            selectDisabledKey,
            toggleDisabledKey,
            treeNodeTitleKey,
        }, false);
        return treeFactory;
    }
    addNode({ id, parentId, ...data }, index, renderTree = true) {
        let newId = id;
        if (isUndefined(id)) {
            this.idx++;
            newId = this.idx;
        }
        const treeNode = new TreeNode(newId, parentId, data);
        if (Object.prototype.hasOwnProperty.call(this.nodes, treeNode.id)) {
            throw new Error(`Duplicated id: ${treeNode.id} detected, please specify unique ids in the tree.`);
        }
        this.nodes[treeNode.id] = treeNode;
        this.addChildNode(this.nodes[parentId], treeNode, index);
        // 兼容当前用户外部直接调用addNode方法创建节点
        if (renderTree) {
            this.renderFlattenTree();
        }
        return treeNode;
    }
    editNodeTitle(id) {
        if (!this.nodes[id]) {
            return;
        }
        this.nodes[id].data.editable = true;
    }
    deleteNodeById(id, renderTree = true) {
        const node = this.nodes[id];
        const parentNode = this.nodes[node.parentId];
        this.removeChildNode(parentNode, node);
        const deleteItems = (nodeId) => {
            this.maintainCheckedNodeList(this.nodes[nodeId], false);
            const children = this.getChildrenById(nodeId);
            this.nodes = omitBy(this.nodes, (_node) => {
                return _node.id === nodeId;
            });
            forEach(children, (child) => {
                deleteItems(child.id);
            });
        };
        deleteItems(id);
        if (parentNode && (!parentNode.data.children || !parentNode.data.children.length)) {
            parentNode.data.isParent = false;
        }
        if (renderTree) {
            this.renderFlattenTree();
        }
        return this;
    }
    toggleNodeById(id) {
        if (!this.nodes[id]) {
            return;
        }
        this.nodes[id].data.isOpen = !this.nodes[id].data.isOpen;
        this.renderFlattenTree();
        return this;
    }
    openNodesById(id) {
        if (!this.nodes[id]) {
            return;
        }
        this.nodes[id].data.isOpen = true;
        if (this.nodes[id].parentId !== undefined) {
            this.openNodesById(this.nodes[id].parentId);
        }
        this.renderFlattenTree();
        return this;
    }
    closeNodesById(id, closeChildren = false) {
        if (!this.nodes[id]) {
            return;
        }
        this.nodes[id].data.isOpen = false;
        if (closeChildren) {
            if (this.nodes[id] && this.nodes[id].data.children) {
                this.nodes[id].data.children.forEach((node) => {
                    this.closeNodesById(node.id);
                });
            }
        }
        this.renderFlattenTree();
        return this;
    }
    disabledNodesById(id) {
        if (!this.nodes[id]) {
            return;
        }
        this.nodes[id].data.disabled = true;
        const parentId = this.nodes[id].parentId;
        this._disabledParentNodes(parentId);
        const disabledNodes = (nodeId) => {
            const children = this.getChildrenById(nodeId);
            if (children.length > 0) {
                children.forEach((child) => {
                    this.nodes[child.id].data.disabled = true;
                    disabledNodes(child.id);
                });
            }
        };
        disabledNodes(id);
        return this;
    }
    _disabledParentNodes(parentId) {
        const children = this.getChildrenById(parentId);
        if (children.length < 1) {
            return;
        }
        const result = reduce(children, (status, child) => {
            return status && child.data.disabled;
        }, true);
        if (this.nodes[parentId]) {
            this.nodes[parentId].data.disabled = result;
        }
    }
    checkNodesById(id, checked, checkableRelation = 'both') {
        if (!this.nodes[id]) {
            return;
        }
        this.nodes[id].data.halfChecked = false;
        this.nodes[id].data.isChecked = checked;
        switch (checkableRelation) {
            case 'upward':
                this.checkParentNodes(this.nodes[id]);
                break;
            case 'downward':
                this.checkChildNodes(this.nodes[id], checked);
                break;
            case 'both':
                this.checkParentNodes(this.nodes[id]);
                this.checkChildNodes(this.nodes[id], checked);
                break;
            case 'none':
                break;
            default:
                break;
        }
        this.maintainCheckedNodeList(this.nodes[id], checked);
        return this.getCheckedNodes();
    }
    checkParentNodes(node) {
        const { parentId } = node;
        const parentNode = this.nodes[parentId];
        if (parentNode) {
            const childrenNode = this.getChildrenById(parentId);
            if (childrenNode.every((childNode) => childNode.data.isChecked && !childNode.data.halfChecked)) {
                parentNode.data.isChecked = true;
                parentNode.data.halfChecked = false;
            }
            else if (childrenNode.some((childNode) => childNode.data.halfChecked || childNode.data.isChecked)) {
                parentNode.data.isChecked = true;
                parentNode.data.halfChecked = true;
            }
            else {
                parentNode.data.isChecked = false;
                parentNode.data.halfChecked = false;
            }
            this.maintainCheckedNodeList(parentNode, parentNode.data.isChecked);
            this.checkParentNodes(parentNode);
        }
    }
    checkChildNodes(node, checked) {
        const { id } = node;
        const childrenNode = this.getChildrenById(id);
        if (childrenNode.length > 0) {
            childrenNode.forEach((childNode) => {
                const { id: childId } = childNode;
                const { data: nodeData } = this.nodes[childId];
                if (!nodeData.disabled) {
                    nodeData.isChecked = checked;
                    nodeData.halfChecked = false;
                    this.maintainCheckedNodeList(childNode, checked);
                }
                this.checkChildNodes(childNode, checked);
            });
            const childrenFullCheckedCount = childrenNode.filter(({ data: nodeData }) => nodeData.isChecked).length;
            const childrenCheckedCount = childrenNode.filter(({ data: nodeData }) => nodeData.isChecked || nodeData.halfChecked).length;
            node.data.halfChecked = childrenCheckedCount > 0 && childrenNode.length > childrenFullCheckedCount;
        }
    }
    getCheckedNodes() {
        return Array.from(this._checked);
    }
    getActivatedNodes() {
        const results = pickBy(this.nodes, (node) => node.data.isActive === true);
        return values(results);
    }
    getDisabledNodes() {
        const results = pickBy(this.nodes, (node) => node.data.disabled === true);
        return values(results);
    }
    activeNodeById(id, isMultiple) {
        if (!this.nodes[id]) {
            return;
        }
        if (!isMultiple) {
            this.deactivateAllNodes();
        }
        this.nodes[id].data.isActive = !this.nodes[id].data.isActive;
    }
    getChildrenById(id) {
        if (this.nodes[id]) {
            return this.nodes[id].data.children || [];
        }
        else if (id === undefined) {
            return this._treeRoot;
        }
        return [];
    }
    startLoading(id) {
        if (!this.nodes[id]) {
            return;
        }
        this.nodes[id].data.loading = true;
    }
    endLoading(id) {
        if (!this.nodes[id]) {
            return;
        }
        this.nodes[id].data.loading = false;
    }
    getNodeById(id) {
        if (!this.nodes[id]) {
            return;
        }
        return this.nodes[id].data;
    }
    getCompleteNodeById(id) {
        return this.nodes[id];
    }
    hideNodeById(id, hide) {
        if (!this.nodes[id]) {
            return;
        }
        this.nodes[id].data.isHide = hide;
        this.renderFlattenTree();
        return this;
    }
    maintainCheckedNodeList(node, checked) {
        if (checked && !node.data.halfChecked) {
            this._checked.add(node);
        }
        else {
            this._checked.delete(node);
        }
    }
    dfs(target, tree, hideUnmatched, keyword, pattern) {
        if (!tree) {
            return false;
        }
        if (!target) {
            return false;
        }
        if (Array.isArray(tree)) {
            return tree.map((treeNode) => {
                return this.dfs(target, treeNode, hideUnmatched, keyword, pattern);
            });
        }
        else {
            const treeNode = tree;
            const treeChildren = this.getChildrenById(treeNode.id);
            const key = keyword ? treeNode.data.originItem[keyword] : treeNode.data.title;
            const selfMatched = pattern ? pattern.test(key) : key.toLowerCase().includes(target);
            if (selfMatched) {
                treeNode.data.isMatch = true;
                treeNode.data.isCustomSearch = keyword;
            }
            // Test if children matches target recursively, do not hide children if parent is matched.
            const childrenMatched = this.dfs(target, treeChildren, hideUnmatched && !selfMatched, keyword, pattern).some((_) => !!_);
            if (selfMatched || childrenMatched) {
                if (childrenMatched && treeChildren.length > 0) {
                    this.openNodesById(treeNode.id);
                }
                return true;
            }
            else {
                treeNode.data.isHide = hideUnmatched;
                return false;
            }
        }
    }
    addChildNode(parentNode, childNode, index) {
        if (parentNode) {
            Array.isArray(parentNode.data.children)
                ? index !== undefined
                    ? parentNode.data.children.splice(index, 0, childNode)
                    : parentNode.data.children.push(childNode)
                : (parentNode.data.children = [childNode]);
        }
        else {
            index !== undefined ? this._treeRoot.splice(index, 0, childNode) : this._treeRoot.push(childNode);
        }
    }
    removeChildNode(parentNode, childNode) {
        if (parentNode) {
            parentNode.data.children = parentNode.data.children.filter((node) => node.id !== childNode.id);
        }
        else {
            this._treeRoot = this._treeRoot.filter((node) => node.id !== childNode.id);
        }
    }
    resetSearchResults() {
        Object.keys(this.nodes).forEach((key) => {
            const treeNode = this.nodes[key];
            treeNode.data.isMatch = false;
            treeNode.data.isHide = false;
            treeNode.data.isCustomSearch = false;
        });
    }
    searchTree(target, hideUnmatched = false, keyword, pattern) {
        this.searchItem = target;
        const TrimmedTarget = trim(target);
        this.resetSearchResults();
        return this.dfs(TrimmedTarget.toLowerCase(), this._treeRoot, hideUnmatched, keyword, pattern);
    }
    get treeRoot() {
        return this._treeRoot;
    }
    deactivateAllNodes() {
        for (const id of Object.keys(this.nodes)) {
            this.nodes[id].data.isActive = false;
        }
    }
    checkAllNodes(checked) {
        for (const id of Object.keys(this.nodes)) {
            if (!this.nodes[id].data.disabled) {
                this.nodes[id].data.halfChecked = false;
                this.nodes[id].data.isChecked = checked;
            }
            this.maintainCheckedNodeList(this.nodes[id], this.nodes[id].data.isChecked);
        }
    }
    getNodeIndex(node) {
        let parentNode;
        let children;
        if (node.parentId !== undefined) {
            parentNode = this.getNodeById(node.parentId);
            children = parentNode.children;
        }
        else {
            children = this.treeRoot;
        }
        for (let i = 0; i < children.length; i++) {
            if (children[i].id === node.id) {
                return i;
            }
        }
        return -1;
    }
    checkIsParent(childNodeId, parentNodeId) {
        const realParentId = this.nodes[childNodeId].parentId;
        if (realParentId === parentNodeId) {
            return true;
        }
        else if (realParentId !== undefined) {
            return this.checkIsParent(realParentId, parentNodeId);
        }
        else {
            return false;
        }
    }
    getFlattenNodes() {
        this.flattenNodes.next(this.flattenTree());
    }
    flattenTree() {
        const flattenTree = [];
        const flatTree = (nodes) => {
            for (let i = 0; i < nodes.length; i++) {
                nodes[i].data.depth = nodes[i].parentId ? this.nodes[nodes[i].parentId].data.depth + 1 : 0;
                nodes[i].data.hideInVirtualScroll =
                    nodes[i].data.isHide ||
                        (nodes[i].parentId
                            ? this.nodes[nodes[i].parentId].data.hideInVirtualScroll || !this.nodes[nodes[i].parentId].data.isOpen
                            : false);
                nodes[i].data.isLast = i === nodes.length - 1;
                flattenTree.push(nodes[i]);
                if (nodes[i].data.children) {
                    flatTree(nodes[i].data.children);
                }
            }
        };
        flatTree(this.treeRoot);
        return flattenTree;
    }
    mergeTreeNodes(targetNode = this.treeRoot) {
        const mergeToNode = (node) => {
            if (node.data.children?.length === 1 && node.data.children[0]?.data?.children?.length !== 0) {
                node.data.title = node.data.title + ' / ' + node.data.children[0]?.data?.title;
                node.data.children = node.data.children[0]?.data?.children;
                mergeToNode(node);
            }
            if (node.data.children?.length > 1) {
                node.data.children.forEach((element) => {
                    mergeToNode(element);
                });
            }
        };
        if (targetNode === this.treeRoot) {
            this.treeRoot.forEach((element) => {
                mergeToNode(element);
            });
        }
        else {
            mergeToNode(targetNode);
        }
    }
    renderFlattenTree() {
        if (!this.virtualScroll) {
            return;
        }
        this.getFlattenNodes();
    }
    disableAllNodesChecked(disabled = true) {
        for (const id of Object.keys(this.nodes)) {
            this.nodes[id].data.disabled = disabled;
        }
    }
    disableAllNodesSelected(disabled = true) {
        for (const id of Object.keys(this.nodes)) {
            this.nodes[id].data.disableSelect = disabled;
        }
    }
    disableAllNodesToggled(disabled = true) {
        for (const id of Object.keys(this.nodes)) {
            this.nodes[id].data.disableToggle = disabled;
        }
    }
    transferToTreeNode(originNode, parentId, treeNodeChildrenKey = 'items', treeNodeIdKey = 'id', checkboxDisabledKey = 'disabled', selectDisabledKey = 'disableSelect', toggleDisabledKey = 'disableToggle', treeNodeTitleKey = 'title') {
        const node = {
            id: originNode[treeNodeIdKey],
            parentId,
            title: originNode[treeNodeTitleKey],
            isOpen: !!originNode.open,
            data: originNode.data || {},
            originItem: originNode,
            isParent: !!originNode.isParent || !!(originNode[treeNodeChildrenKey] && originNode[treeNodeChildrenKey].length > 0),
            loading: !!originNode.loading,
            isMatch: !!originNode.isMatch,
            isHide: !!originNode.isHide,
            isChecked: !!originNode.isChecked,
            halfChecked: !!originNode.halfChecked,
            isActive: !!originNode.isActive,
            disabled: !!originNode[checkboxDisabledKey],
            disableSelect: !!originNode[selectDisabledKey],
            disableToggle: !!originNode[toggleDisabledKey],
            disableAdd: !!originNode.disableAdd,
            disableEdit: !!originNode.disableEdit,
            disableDelete: !!originNode.disableDelete,
            children: [],
        };
        return new TreeNode(node.id, node.parentId, { ...node });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS1mYWN0b3J5LmNsYXNzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vZGV2dWkvdHJlZS90cmVlLWZhY3RvcnkuY2xhc3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUN2RixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBK0R2QyxNQUFNLE9BQU8sUUFBUTtJQUNuQixZQUFtQixFQUFFLEVBQVMsUUFBUSxFQUFTLElBQUk7UUFBaEMsT0FBRSxHQUFGLEVBQUUsQ0FBQTtRQUFTLGFBQVEsR0FBUixRQUFRLENBQUE7UUFBUyxTQUFJLEdBQUosSUFBSSxDQUFBO0lBQUcsQ0FBQztDQUN4RDtBQUVELE1BQU0sT0FBTyxXQUFXO0lBd0N0QixZQUFtQixlQUFlO1FBQWYsb0JBQWUsR0FBZixlQUFlLENBQUE7UUFyQzFCLGFBQVEsR0FBRyxJQUFJLEdBQUcsRUFBVSxDQUFDO1FBQzdCLGNBQVMsR0FBZSxFQUFFLENBQUM7UUFFbkMsaUJBQVksR0FBRyxJQUFJLGVBQWUsQ0FBYSxFQUFFLENBQUMsQ0FBQztRQXdDbkQsaUJBQVksR0FBRyxDQUNiLEVBQ0UsU0FBUyxFQUNULFFBQVEsRUFDUixtQkFBbUIsR0FBRyxPQUFPLEVBQzdCLGFBQWEsR0FBRyxJQUFJLEVBQ3BCLG1CQUFtQixHQUFHLFVBQVUsRUFDaEMsaUJBQWlCLEdBQUcsZUFBZSxFQUNuQyxpQkFBaUIsR0FBRyxlQUFlLEVBQ25DLGdCQUFnQixHQUFHLE9BQU8sR0FDZixFQUNiLFVBQVUsR0FBRyxJQUFJLEVBQ2pCLEVBQUU7WUFDRixPQUFPLENBQUMsU0FBUyxFQUFFLENBQUMsSUFBZSxFQUFFLEVBQUU7Z0JBQ3JDLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFP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QzNELENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGZvckVhY2gsIGlzVW5kZWZpbmVkLCBvbWl0QnksIHBpY2tCeSwgcmVkdWNlLCB0cmltLCB2YWx1ZXMgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5leHBvcnQgaW50ZXJmYWNlIERpY3Rpb25hcnk8VD4ge1xuICBbaWQ6IG51bWJlcl06IFQ7XG59XG5leHBvcnQgaW50ZXJmYWNlIElUcmVlTm9kZURhdGEge1xuICBpZD86IG51bWJlciB8IHN0cmluZztcbiAgcGFyZW50SWQ/OiBudW1iZXIgfCBzdHJpbmc7XG4gIHRpdGxlPzogc3RyaW5nO1xuICBpc09wZW4/OiBib29sZWFuO1xuICBkYXRhPzogYW55O1xuICBpc1BhcmVudD86IGJvb2xlYW47XG4gIGxvYWRpbmc/OiBib29sZWFuO1xuICBpc01hdGNoPzogYm9vbGVhbjtcbiAgaXNIaWRlPzogYm9vbGVhbjtcbiAgaXNBY3RpdmU/OiBib29sZWFuO1xuICBpc0NoZWNrZWQ/OiBib29sZWFuO1xuICBkaXNhYmxlZD86IGJvb2xlYW47XG5cbiAgW3Byb3A6IHN0cmluZ106IGFueTtcblxuICBjaGlsZHJlbj86IFtdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElUcmVlTWFwIHtcbiAgW2luZGV4OiBudW1iZXJdOiBJVHJlZU5vZGVEYXRhO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElUcmVlSXRlbSB7XG4gIHRpdGxlPzogc3RyaW5nO1xuICBvcGVuPzogYm9vbGVhbjtcbiAgbG9hZGluZz86IGJvb2xlYW47XG4gIGlzTWF0Y2g/OiBib29sZWFuO1xuICBpdGVtcz86IElUcmVlSXRlbVtdO1xuICBpc1BhcmVudD86IGJvb2xlYW47XG4gIGRhdGE/OiBhbnk7XG4gIGlkPzogbnVtYmVyIHwgc3RyaW5nO1xuICBpc0hpZGU/OiBib29sZWFuO1xuICBpc0FjdGl2ZT86IGJvb2xlYW47XG4gIGlzQ2hlY2tlZD86IGJvb2xlYW47XG4gIGhhbGZDaGVja2VkPzogYm9vbGVhbjtcbiAgZGlzYWJsZWQ/OiBib29sZWFuO1xuICBzaG93Q2hlY2tib3g/OiBib29sZWFuO1xuICBbcHJvcDogc3RyaW5nXTogYW55O1xuXG4gIGRpc2FibGVBZGQ/OiBib29sZWFuO1xuICBkaXNhYmxlRWRpdD86IGJvb2xlYW47XG4gIGRpc2FibGVEZWxldGU/OiBib29sZWFuO1xuICBkaXNhYmxlU2VsZWN0PzogYm9vbGVhbjtcbiAgZGlzYWJsZVRvZ2dsZT86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVRyZWVJbnB1dCB7XG4gIHRyZWVJdGVtczogQXJyYXk8SVRyZWVJdGVtPjtcbiAgcGFyZW50SWQ/OiBudW1iZXIgfCBzdHJpbmc7XG4gIHRyZWVOb2RlQ2hpbGRyZW5LZXk/OiBzdHJpbmc7XG4gIHRyZWVOb2RlSWRLZXk/OiBzdHJpbmc7XG4gIGNoZWNrYm94RGlzYWJsZWRLZXk/OiBzdHJpbmc7XG4gIHNlbGVjdERpc2FibGVkS2V5Pzogc3RyaW5nO1xuICB0b2dnbGVEaXNhYmxlZEtleT86IHN0cmluZztcbiAgdHJlZU5vZGVUaXRsZUtleT86IHN0cmluZztcbiAgaXNWaXJ0dWFsU2Nyb2xsPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNsYXNzIFRyZWVOb2RlIGltcGxlbWVudHMgSVRyZWVOb2RlRGF0YSB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBpZCwgcHVibGljIHBhcmVudElkLCBwdWJsaWMgZGF0YSkge31cbn1cblxuZXhwb3J0IGNsYXNzIFRyZWVGYWN0b3J5IHtcbiAgbm9kZXM6IERpY3Rpb25hcnk8VHJlZU5vZGU+O1xuICBwcml2YXRlIGlkeDogbnVtYmVyO1xuICBwcml2YXRlIF9jaGVja2VkID0gbmV3IFNldDxPYmplY3Q+KCk7XG4gIHByaXZhdGUgX3RyZWVSb290OiBUcmVlTm9kZVtdID0gW107XG4gIHNlYXJjaEl0ZW06IHN0cmluZztcbiAgZmxhdHRlbk5vZGVzID0gbmV3IEJlaGF2aW9yU3ViamVjdDxUcmVlTm9kZVtdPihbXSk7XG4gIHZpcnR1YWxTY3JvbGw6IGJvb2xlYW47XG4gIHN0YXRpYyBjcmVhdGUoaXNWaXJ0dWFsU2Nyb2xsKSB7XG4gICAgcmV0dXJuIG5ldyBUcmVlRmFjdG9yeShpc1ZpcnR1YWxTY3JvbGwpO1xuICB9XG5cbiAgLy8gdHJlZSBtb2RlbCB3aXRoIGl0ZW1zXG4gIHN0YXRpYyBmcm9tVHJlZSh7XG4gICAgdHJlZUl0ZW1zLFxuICAgIGlzVmlydHVhbFNjcm9sbCA9IGZhbHNlLFxuICAgIHRyZWVOb2RlQ2hpbGRyZW5LZXkgPSAnaXRlbXMnLFxuICAgIHRyZWVOb2RlSWRLZXkgPSAnaWQnLFxuICAgIGNoZWNrYm94RGlzYWJsZWRLZXkgPSAnZGlzYWJsZWQnLFxuICAgIHNlbGVjdERpc2FibGVkS2V5ID0gJ2Rpc2FibGVkJywgLy8g6buY6K6k5YC85LiOY2hlY2tib3hEaXNhYmxlZEtleeebuOWQjO+8jOS4uuS6huWFvOWuueS7peWJjXRyZWXnmoRkaXNhYmxl5oOF5Ya1XG4gICAgdG9nZ2xlRGlzYWJsZWRLZXkgPSAnZGlzYWJsZWRUb2dnbGUnLFxuICAgIHRyZWVOb2RlVGl0bGVLZXkgPSAndGl0bGUnLFxuICB9OiBJVHJlZUlucHV0KTogVHJlZUZhY3Rvcnkge1xuICAgIGNvbnN0IHRyZWVGYWN0b3J5ID0gVHJlZUZhY3RvcnkuY3JlYXRlKGlzVmlydHVhbFNjcm9sbCk7XG4gICAgdHJlZUZhY3RvcnkubWFwVHJlZUl0ZW1zKFxuICAgICAge1xuICAgICAgICB0cmVlSXRlbXMsXG4gICAgICAgIHBhcmVudElkOiB1bmRlZmluZWQsXG4gICAgICAgIHRyZWVOb2RlQ2hpbGRyZW5LZXksXG4gICAgICAgIHRyZWVOb2RlSWRLZXksXG4gICAgICAgIGNoZWNrYm94RGlzYWJsZWRLZXksXG4gICAgICAgIHNlbGVjdERpc2FibGVkS2V5LFxuICAgICAgICB0b2dnbGVEaXNhYmxlZEtleSxcbiAgICAgICAgdHJlZU5vZGVUaXRsZUtleSxcbiAgICAgIH0sXG4gICAgICBmYWxzZVxuICAgICk7XG4gICAgcmV0dXJuIHRyZWVGYWN0b3J5O1xuICB9XG5cbiAgY29uc3RydWN0b3IocHVibGljIGlzVmlydHVhbFNjcm9sbCkge1xuICAgIHRoaXMudmlydHVhbFNjcm9sbCA9IGlzVmlydHVhbFNjcm9sbDtcbiAgICB0aGlzLmlkeCA9IDA7XG4gICAgdGhpcy5ub2RlcyA9IHt9O1xuICB9XG5cbiAgbWFwVHJlZUl0ZW1zID0gKFxuICAgIHtcbiAgICAgIHRyZWVJdGVtcyxcbiAgICAgIHBhcmVudElkLFxuICAgICAgdHJlZU5vZGVDaGlsZHJlbktleSA9ICdpdGVtcycsXG4gICAgICB0cmVlTm9kZUlkS2V5ID0gJ2lkJyxcbiAgICAgIGNoZWNrYm94RGlzYWJsZWRLZXkgPSAnZGlzYWJsZWQnLFxuICAgICAgc2VsZWN0RGlzYWJsZWRLZXkgPSAnZGlzYWJsZVNlbGVjdCcsXG4gICAgICB0b2dnbGVEaXNhYmxlZEtleSA9ICdkaXNhYmxlVG9nZ2xlJyxcbiAgICAgIHRyZWVOb2RlVGl0bGVLZXkgPSAndGl0bGUnLFxuICAgIH06IElUcmVlSW5wdXQsXG4gICAgcmVuZGVyVHJlZSA9IHRydWVcbiAgKSA9PiB7XG4gICAgZm9yRWFjaCh0cmVlSXRlbXMsIChpdGVtOiBJVHJlZUl0ZW0pID0+IHtcbiAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLmFkZE5vZGUoXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogaXRlbVt0cmVlTm9kZUlkS2V5XSxcbiAgICAgICAgICBwYXJlbnRJZCxcbiAgICAgICAgICB0aXRsZTogaXRlbVt0cmVlTm9kZVRpdGxlS2V5XSxcbiAgICAgICAgICBpc09wZW46ICEhaXRlbS5vcGVuLFxuICAgICAgICAgIGRhdGE6IGl0ZW0uZGF0YSB8fCB7fSxcbiAgICAgICAgICBvcmlnaW5JdGVtOiBpdGVtLFxuICAgICAgICAgIGlzUGFyZW50OiAhIWl0ZW0uaXNQYXJlbnQgfHwgISEoaXRlbVt0cmVlTm9kZUNoaWxkcmVuS2V5XSAmJiBpdGVtW3RyZWVOb2RlQ2hpbGRyZW5LZXldLmxlbmd0aCA+IDApLFxuICAgICAgICAgIGxvYWRpbmc6ICEhaXRlbS5sb2FkaW5nLFxuICAgICAgICAgIGlzTWF0Y2g6ICEhaXRlbS5pc01hdGNoLFxuICAgICAgICAgIGlzSGlkZTogISFpdGVtLmlzSGlkZSxcbiAgICAgICAgICBpc0NoZWNrZWQ6ICEhaXRlbS5pc0NoZWNrZWQsXG4gICAgICAgICAgaGFsZkNoZWNrZWQ6ICEhaXRlbS5oYWxmQ2hlY2tlZCxcbiAgICAgICAgICBpc0FjdGl2ZTogISFpdGVtLmlzQWN0aXZlLFxuICAgICAgICAgIGRpc2FibGVkOiAhIWl0ZW1bY2hlY2tib3hEaXNhYmxlZEtleV0sXG4gICAgICAgICAgZGlzYWJsZVNlbGVjdDogISFpdGVtW3NlbGVjdERpc2FibGVkS2V5XSxcbiAgICAgICAgICBkaXNhYmxlVG9nZ2xlOiAhIWl0ZW1bdG9nZ2xlRGlzYWJsZWRLZXldLFxuICAgICAgICAgIGRpc2FibGVBZGQ6ICEhaXRlbS5kaXNhYmxlQWRkLFxuICAgICAgICAgIGRpc2FibGVFZGl0OiAhIWl0ZW0uZGlzYWJsZUVkaXQsXG4gICAgICAgICAgZGlzYWJsZURlbGV0ZTogISFpdGVtLmRpc2FibGVEZWxldGUsXG4gICAgICAgICAgY2hpbGRyZW46IFtdLFxuICAgICAgICAgIHNob3dDaGVja2JveDogaXRlbS5zaG93Q2hlY2tib3gsXG4gICAgICAgIH0sXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgcmVuZGVyVHJlZVxuICAgICAgKTtcblxuICAgICAgaWYgKGl0ZW0uaXNDaGVja2VkKSB7XG4gICAgICAgIHRoaXMuX2NoZWNrZWQuYWRkKG5vZGUpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLm1hcFRyZWVJdGVtcyhcbiAgICAgICAge1xuICAgICAgICAgIHRyZWVJdGVtczogaXRlbVt0cmVlTm9kZUNoaWxkcmVuS2V5XSB8fCBbXSxcbiAgICAgICAgICBwYXJlbnRJZDogbm9kZS5pZCxcbiAgICAgICAgICB0cmVlTm9kZUNoaWxkcmVuS2V5LFxuICAgICAgICAgIHRyZWVOb2RlSWRLZXksXG4gICAgICAgICAgY2hlY2tib3hEaXNhYmxlZEtleSxcbiAgICAgICAgICBzZWxlY3REaXNhYmxlZEtleSxcbiAgICAgICAgICB0b2dnbGVEaXNhYmxlZEtleSxcbiAgICAgICAgICB0cmVlTm9kZVRpdGxlS2V5LFxuICAgICAgICB9LFxuICAgICAgICByZW5kZXJUcmVlXG4gICAgICApO1xuICAgIH0pO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIGFkZE5vZGUoeyBpZCwgcGFyZW50SWQsIC4uLmRhdGEgfTogSVRyZWVOb2RlRGF0YSwgaW5kZXg/LCByZW5kZXJUcmVlID0gdHJ1ZSk6IFRyZWVOb2RlIHtcbiAgICBsZXQgbmV3SWQgPSBpZDtcbiAgICBpZiAoaXNVbmRlZmluZWQoaWQpKSB7XG4gICAgICB0aGlzLmlkeCsrO1xuICAgICAgbmV3SWQgPSB0aGlzLmlkeDtcbiAgICB9XG4gICAgY29uc3QgdHJlZU5vZGUgPSBuZXcgVHJlZU5vZGUobmV3SWQsIHBhcmVudElkLCBkYXRhKTtcbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMubm9kZXMsIHRyZWVOb2RlLmlkKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBEdXBsaWNhdGVkIGlkOiAke3RyZWVOb2RlLmlkfSBkZXRlY3RlZCwgcGxlYXNlIHNwZWNpZnkgdW5pcXVlIGlkcyBpbiB0aGUgdHJlZS5gKTtcbiAgICB9XG4gICAgdGhpcy5ub2Rlc1t0cmVlTm9kZS5pZF0gPSB0cmVlTm9kZTtcbiAgICB0aGlzLmFkZENoaWxkTm9kZSh0aGlzLm5vZGVzW3BhcmVudElkXSwgdHJlZU5vZGUsIGluZGV4KTtcbiAgICAvLyDlhbzlrrnlvZPliY3nlKjmiLflpJbpg6jnm7TmjqXosIPnlKhhZGROb2Rl5pa55rOV5Yib5bu66IqC54K5XG4gICAgaWYgKHJlbmRlclRyZWUpIHtcbiAgICAgIHRoaXMucmVuZGVyRmxhdHRlblRyZWUoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRyZWVOb2RlO1xuICB9XG5cbiAgZWRpdE5vZGVUaXRsZShpZDogbnVtYmVyIHwgc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLm5vZGVzW2lkXSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLm5vZGVzW2lkXS5kYXRhLmVkaXRhYmxlID0gdHJ1ZTtcbiAgfVxuXG4gIGRlbGV0ZU5vZGVCeUlkKGlkOiBudW1iZXIgfCBzdHJpbmcsIHJlbmRlclRyZWUgPSB0cnVlKSB7XG4gICAgY29uc3Qgbm9kZSA9IHRoaXMubm9kZXNbaWRdO1xuICAgIGNvbnN0IHBhcmVudE5vZGUgPSB0aGlzLm5vZGVzW25vZGUucGFyZW50SWRdO1xuICAgIHRoaXMucmVtb3ZlQ2hpbGROb2RlKHBhcmVudE5vZGUsIG5vZGUpO1xuXG4gICAgY29uc3QgZGVsZXRlSXRlbXMgPSAobm9kZUlkKSA9PiB7XG4gICAgICB0aGlzLm1haW50YWluQ2hlY2tlZE5vZGVMaXN0KHRoaXMubm9kZXNbbm9kZUlkXSwgZmFsc2UpO1xuICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmdldENoaWxkcmVuQnlJZChub2RlSWQpO1xuICAgICAgdGhpcy5ub2RlcyA9IG9taXRCeTxEaWN0aW9uYXJ5PFRyZWVOb2RlPj4odGhpcy5ub2RlcywgKF9ub2RlKSA9PiB7XG4gICAgICAgIHJldHVybiBfbm9kZS5pZCA9PT0gbm9kZUlkO1xuICAgICAgfSk7XG4gICAgICBmb3JFYWNoKGNoaWxkcmVuLCAoY2hpbGQpID0+IHtcbiAgICAgICAgZGVsZXRlSXRlbXMoY2hpbGQuaWQpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICBkZWxldGVJdGVtcyhpZCk7XG4gICAgaWYgKHBhcmVudE5vZGUgJiYgKCFwYXJlbnROb2RlLmRhdGEuY2hpbGRyZW4gfHwgIXBhcmVudE5vZGUuZGF0YS5jaGlsZHJlbi5sZW5ndGgpKSB7XG4gICAgICBwYXJlbnROb2RlLmRhdGEuaXNQYXJlbnQgPSBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHJlbmRlclRyZWUpIHtcbiAgICAgIHRoaXMucmVuZGVyRmxhdHRlblRyZWUoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICB0b2dnbGVOb2RlQnlJZChpZDogbnVtYmVyIHwgc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLm5vZGVzW2lkXSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLm5vZGVzW2lkXS5kYXRhLmlzT3BlbiA9ICF0aGlzLm5vZGVzW2lkXS5kYXRhLmlzT3BlbjtcbiAgICB0aGlzLnJlbmRlckZsYXR0ZW5UcmVlKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBvcGVuTm9kZXNCeUlkKGlkOiBudW1iZXIgfCBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMubm9kZXNbaWRdKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMubm9kZXNbaWRdLmRhdGEuaXNPcGVuID0gdHJ1ZTtcbiAgICBpZiAodGhpcy5ub2Rlc1tpZF0ucGFyZW50SWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5vcGVuTm9kZXNCeUlkKHRoaXMubm9kZXNbaWRdLnBhcmVudElkKTtcbiAgICB9XG4gICAgdGhpcy5yZW5kZXJGbGF0dGVuVHJlZSgpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgY2xvc2VOb2Rlc0J5SWQoaWQ6IG51bWJlciB8IHN0cmluZywgY2xvc2VDaGlsZHJlbiA9IGZhbHNlKSB7XG4gICAgaWYgKCF0aGlzLm5vZGVzW2lkXSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLm5vZGVzW2lkXS5kYXRhLmlzT3BlbiA9IGZhbHNlO1xuICAgIGlmIChjbG9zZUNoaWxkcmVuKSB7XG4gICAgICBpZiAodGhpcy5ub2Rlc1tpZF0gJiYgdGhpcy5ub2Rlc1tpZF0uZGF0YS5jaGlsZHJlbikge1xuICAgICAgICB0aGlzLm5vZGVzW2lkXS5kYXRhLmNoaWxkcmVuLmZvckVhY2goKG5vZGUpID0+IHtcbiAgICAgICAgICB0aGlzLmNsb3NlTm9kZXNCeUlkKG5vZGUuaWQpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5yZW5kZXJGbGF0dGVuVHJlZSgpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZGlzYWJsZWROb2Rlc0J5SWQoaWQ6IG51bWJlciB8IHN0cmluZykge1xuICAgIGlmICghdGhpcy5ub2Rlc1tpZF0pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5ub2Rlc1tpZF0uZGF0YS5kaXNhYmxlZCA9IHRydWU7XG5cbiAgICBjb25zdCBwYXJlbnRJZCA9IHRoaXMubm9kZXNbaWRdLnBhcmVudElkO1xuICAgIHRoaXMuX2Rpc2FibGVkUGFyZW50Tm9kZXMocGFyZW50SWQpO1xuXG4gICAgY29uc3QgZGlzYWJsZWROb2RlcyA9IChub2RlSWQ6IG51bWJlciB8IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmdldENoaWxkcmVuQnlJZChub2RlSWQpO1xuICAgICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQpID0+IHtcbiAgICAgICAgICB0aGlzLm5vZGVzW2NoaWxkLmlkXS5kYXRhLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICBkaXNhYmxlZE5vZGVzKGNoaWxkLmlkKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBkaXNhYmxlZE5vZGVzKGlkKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHByaXZhdGUgX2Rpc2FibGVkUGFyZW50Tm9kZXMocGFyZW50SWQ6IG51bWJlciB8IHN0cmluZyB8IHVuZGVmaW5lZCkge1xuICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5nZXRDaGlsZHJlbkJ5SWQocGFyZW50SWQpO1xuXG4gICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA8IDEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0ID0gcmVkdWNlKFxuICAgICAgY2hpbGRyZW4sXG4gICAgICAoc3RhdHVzOiBib29sZWFuLCBjaGlsZCkgPT4ge1xuICAgICAgICByZXR1cm4gc3RhdHVzICYmIGNoaWxkLmRhdGEuZGlzYWJsZWQ7XG4gICAgICB9LFxuICAgICAgdHJ1ZVxuICAgICk7XG5cbiAgICBpZiAodGhpcy5ub2Rlc1twYXJlbnRJZF0pIHtcbiAgICAgIHRoaXMubm9kZXNbcGFyZW50SWRdLmRhdGEuZGlzYWJsZWQgPSByZXN1bHQ7XG4gICAgfVxuICB9XG5cbiAgY2hlY2tOb2Rlc0J5SWQoXG4gICAgaWQ6IG51bWJlciB8IHN0cmluZyxcbiAgICBjaGVja2VkOiBib29sZWFuLFxuICAgIGNoZWNrYWJsZVJlbGF0aW9uOiAndXB3YXJkJyB8ICdkb3dud2FyZCcgfCAnYm90aCcgfCAnbm9uZScgPSAnYm90aCdcbiAgKTogQXJyYXk8T2JqZWN0PiB7XG4gICAgaWYgKCF0aGlzLm5vZGVzW2lkXSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLm5vZGVzW2lkXS5kYXRhLmhhbGZDaGVja2VkID0gZmFsc2U7XG4gICAgdGhpcy5ub2Rlc1tpZF0uZGF0YS5pc0NoZWNrZWQgPSBjaGVja2VkO1xuICAgIHN3aXRjaCAoY2hlY2thYmxlUmVsYXRpb24pIHtcbiAgICBjYXNlICd1cHdhcmQnOlxuICAgICAgdGhpcy5jaGVja1BhcmVudE5vZGVzKHRoaXMubm9kZXNbaWRdKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2Rvd253YXJkJzpcbiAgICAgIHRoaXMuY2hlY2tDaGlsZE5vZGVzKHRoaXMubm9kZXNbaWRdLCBjaGVja2VkKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2JvdGgnOlxuICAgICAgdGhpcy5jaGVja1BhcmVudE5vZGVzKHRoaXMubm9kZXNbaWRdKTtcbiAgICAgIHRoaXMuY2hlY2tDaGlsZE5vZGVzKHRoaXMubm9kZXNbaWRdLCBjaGVja2VkKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ25vbmUnOlxuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICB0aGlzLm1haW50YWluQ2hlY2tlZE5vZGVMaXN0KHRoaXMubm9kZXNbaWRdLCBjaGVja2VkKTtcbiAgICByZXR1cm4gdGhpcy5nZXRDaGVja2VkTm9kZXMoKTtcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tQYXJlbnROb2Rlcyhub2RlOiBUcmVlTm9kZSkge1xuICAgIGNvbnN0IHsgcGFyZW50SWQgfSA9IG5vZGU7XG4gICAgY29uc3QgcGFyZW50Tm9kZSA9IHRoaXMubm9kZXNbcGFyZW50SWRdO1xuICAgIGlmIChwYXJlbnROb2RlKSB7XG4gICAgICBjb25zdCBjaGlsZHJlbk5vZGUgPSB0aGlzLmdldENoaWxkcmVuQnlJZChwYXJlbnRJZCk7XG4gICAgICBpZiAoY2hpbGRyZW5Ob2RlLmV2ZXJ5KChjaGlsZE5vZGUpID0+IGNoaWxkTm9kZS5kYXRhLmlzQ2hlY2tlZCAmJiAhY2hpbGROb2RlLmRhdGEuaGFsZkNoZWNrZWQpKSB7XG4gICAgICAgIHBhcmVudE5vZGUuZGF0YS5pc0NoZWNrZWQgPSB0cnVlO1xuICAgICAgICBwYXJlbnROb2RlLmRhdGEuaGFsZkNoZWNrZWQgPSBmYWxzZTtcbiAgICAgIH0gZWxzZSBpZiAoY2hpbGRyZW5Ob2RlLnNvbWUoKGNoaWxkTm9kZSkgPT4gY2hpbGROb2RlLmRhdGEuaGFsZkNoZWNrZWQgfHwgY2hpbGROb2RlLmRhdGEuaXNDaGVja2VkKSkge1xuICAgICAgICBwYXJlbnROb2RlLmRhdGEuaXNDaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgcGFyZW50Tm9kZS5kYXRhLmhhbGZDaGVja2VkID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBhcmVudE5vZGUuZGF0YS5pc0NoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgcGFyZW50Tm9kZS5kYXRhLmhhbGZDaGVja2VkID0gZmFsc2U7XG4gICAgICB9XG4gICAgICB0aGlzLm1haW50YWluQ2hlY2tlZE5vZGVMaXN0KHBhcmVudE5vZGUsIHBhcmVudE5vZGUuZGF0YS5pc0NoZWNrZWQpO1xuICAgICAgdGhpcy5jaGVja1BhcmVudE5vZGVzKHBhcmVudE5vZGUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tDaGlsZE5vZGVzKG5vZGU6IFRyZWVOb2RlLCBjaGVja2VkOiBib29sZWFuKSB7XG4gICAgY29uc3QgeyBpZCB9ID0gbm9kZTtcbiAgICBjb25zdCBjaGlsZHJlbk5vZGUgPSB0aGlzLmdldENoaWxkcmVuQnlJZChpZCk7XG4gICAgaWYgKGNoaWxkcmVuTm9kZS5sZW5ndGggPiAwKSB7XG4gICAgICBjaGlsZHJlbk5vZGUuZm9yRWFjaCgoY2hpbGROb2RlKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgaWQ6IGNoaWxkSWQgfSA9IGNoaWxkTm9kZTtcbiAgICAgICAgY29uc3QgeyBkYXRhOiBub2RlRGF0YSB9ID0gdGhpcy5ub2Rlc1tjaGlsZElkXTtcbiAgICAgICAgaWYgKCFub2RlRGF0YS5kaXNhYmxlZCkge1xuICAgICAgICAgIG5vZGVEYXRhLmlzQ2hlY2tlZCA9IGNoZWNrZWQ7XG4gICAgICAgICAgbm9kZURhdGEuaGFsZkNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLm1haW50YWluQ2hlY2tlZE5vZGVMaXN0KGNoaWxkTm9kZSwgY2hlY2tlZCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jaGVja0NoaWxkTm9kZXMoY2hpbGROb2RlLCBjaGVja2VkKTtcbiAgICAgIH0pO1xuICAgICAgY29uc3QgY2hpbGRyZW5GdWxsQ2hlY2tlZENvdW50ID0gY2hpbGRyZW5Ob2RlLmZpbHRlcigoeyBkYXRhOiBub2RlRGF0YSB9KSA9PiBub2RlRGF0YS5pc0NoZWNrZWQpLmxlbmd0aDtcbiAgICAgIGNvbnN0IGNoaWxkcmVuQ2hlY2tlZENvdW50ID0gY2hpbGRyZW5Ob2RlLmZpbHRlcigoeyBkYXRhOiBub2RlRGF0YSB9KSA9PiBub2RlRGF0YS5pc0NoZWNrZWQgfHwgbm9kZURhdGEuaGFsZkNoZWNrZWQpLmxlbmd0aDtcbiAgICAgIG5vZGUuZGF0YS5oYWxmQ2hlY2tlZCA9IGNoaWxkcmVuQ2hlY2tlZENvdW50ID4gMCAmJiBjaGlsZHJlbk5vZGUubGVuZ3RoID4gY2hpbGRyZW5GdWxsQ2hlY2tlZENvdW50O1xuICAgIH1cbiAgfVxuXG4gIGdldENoZWNrZWROb2RlcygpOiBBcnJheTxhbnk+IHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLl9jaGVja2VkKTtcbiAgfVxuXG4gIGdldEFjdGl2YXRlZE5vZGVzKCk6IEFycmF5PGFueT4ge1xuICAgIGNvbnN0IHJlc3VsdHMgPSBwaWNrQnkodGhpcy5ub2RlcywgKG5vZGUpID0+IG5vZGUuZGF0YS5pc0FjdGl2ZSA9PT0gdHJ1ZSk7XG4gICAgcmV0dXJuIHZhbHVlcyhyZXN1bHRzKTtcbiAgfVxuXG4gIGdldERpc2FibGVkTm9kZXMoKTogQXJyYXk8YW55PiB7XG4gICAgY29uc3QgcmVzdWx0cyA9IHBpY2tCeSh0aGlzLm5vZGVzLCAobm9kZSkgPT4gbm9kZS5kYXRhLmRpc2FibGVkID09PSB0cnVlKTtcbiAgICByZXR1cm4gdmFsdWVzKHJlc3VsdHMpO1xuICB9XG5cbiAgYWN0aXZlTm9kZUJ5SWQoaWQ6IG51bWJlciB8IHN0cmluZywgaXNNdWx0aXBsZT86IGJvb2xlYW4pIHtcbiAgICBpZiAoIXRoaXMubm9kZXNbaWRdKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghaXNNdWx0aXBsZSkge1xuICAgICAgdGhpcy5kZWFjdGl2YXRlQWxsTm9kZXMoKTtcbiAgICB9XG4gICAgdGhpcy5ub2Rlc1tpZF0uZGF0YS5pc0FjdGl2ZSA9ICF0aGlzLm5vZGVzW2lkXS5kYXRhLmlzQWN0aXZlO1xuICB9XG5cbiAgZ2V0Q2hpbGRyZW5CeUlkKGlkOiBudW1iZXIgfCBzdHJpbmcpOiBBcnJheTxUcmVlTm9kZT4ge1xuICAgIGlmICh0aGlzLm5vZGVzW2lkXSkge1xuICAgICAgcmV0dXJuIHRoaXMubm9kZXNbaWRdLmRhdGEuY2hpbGRyZW4gfHwgW107XG4gICAgfSBlbHNlIGlmIChpZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gdGhpcy5fdHJlZVJvb3Q7XG4gICAgfVxuXG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgc3RhcnRMb2FkaW5nKGlkOiBudW1iZXIgfCBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMubm9kZXNbaWRdKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMubm9kZXNbaWRdLmRhdGEubG9hZGluZyA9IHRydWU7XG4gIH1cblxuICBlbmRMb2FkaW5nKGlkOiBudW1iZXIgfCBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMubm9kZXNbaWRdKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMubm9kZXNbaWRdLmRhdGEubG9hZGluZyA9IGZhbHNlO1xuICB9XG5cbiAgZ2V0Tm9kZUJ5SWQoaWQ6IG51bWJlciB8IHN0cmluZyk6IGFueSB7XG4gICAgaWYgKCF0aGlzLm5vZGVzW2lkXSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5ub2Rlc1tpZF0uZGF0YTtcbiAgfVxuXG4gIGdldENvbXBsZXRlTm9kZUJ5SWQoaWQ6IG51bWJlciB8IHN0cmluZyk6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMubm9kZXNbaWRdO1xuICB9XG5cbiAgaGlkZU5vZGVCeUlkKGlkOiBudW1iZXIgfCBzdHJpbmcsIGhpZGU6IGJvb2xlYW4pIHtcbiAgICBpZiAoIXRoaXMubm9kZXNbaWRdKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMubm9kZXNbaWRdLmRhdGEuaXNIaWRlID0gaGlkZTtcbiAgICB0aGlzLnJlbmRlckZsYXR0ZW5UcmVlKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBwcml2YXRlIG1haW50YWluQ2hlY2tlZE5vZGVMaXN0KG5vZGU6IFRyZWVOb2RlLCBjaGVja2VkOiBib29sZWFuKSB7XG4gICAgaWYgKGNoZWNrZWQgJiYgIW5vZGUuZGF0YS5oYWxmQ2hlY2tlZCkge1xuICAgICAgdGhpcy5fY2hlY2tlZC5hZGQobm9kZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2NoZWNrZWQuZGVsZXRlKG5vZGUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZGZzKHRhcmdldCwgdHJlZSwgaGlkZVVubWF0Y2hlZD86IGJvb2xlYW4sIGtleXdvcmQ/LCBwYXR0ZXJuPykge1xuICAgIGlmICghdHJlZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoIXRhcmdldCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheSh0cmVlKSkge1xuICAgICAgcmV0dXJuIHRyZWUubWFwKCh0cmVlTm9kZSkgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5kZnModGFyZ2V0LCB0cmVlTm9kZSwgaGlkZVVubWF0Y2hlZCwga2V5d29yZCwgcGF0dGVybik7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgdHJlZU5vZGUgPSB0cmVlO1xuICAgICAgY29uc3QgdHJlZUNoaWxkcmVuID0gdGhpcy5nZXRDaGlsZHJlbkJ5SWQodHJlZU5vZGUuaWQpO1xuICAgICAgY29uc3Qga2V5ID0ga2V5d29yZCA/IHRyZWVOb2RlLmRhdGEub3JpZ2luSXRlbVtrZXl3b3JkXSA6IHRyZWVOb2RlLmRhdGEudGl0bGU7XG4gICAgICBjb25zdCBzZWxmTWF0Y2hlZCA9IHBhdHRlcm4gPyBwYXR0ZXJuLnRlc3Qoa2V5KSA6IGtleS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRhcmdldCk7XG4gICAgICBpZiAoc2VsZk1hdGNoZWQpIHtcbiAgICAgICAgdHJlZU5vZGUuZGF0YS5pc01hdGNoID0gdHJ1ZTtcbiAgICAgICAgdHJlZU5vZGUuZGF0YS5pc0N1c3RvbVNlYXJjaCA9IGtleXdvcmQ7XG4gICAgICB9XG4gICAgICAvLyBUZXN0IGlmIGNoaWxkcmVuIG1hdGNoZXMgdGFyZ2V0IHJlY3Vyc2l2ZWx5LCBkbyBub3QgaGlkZSBjaGlsZHJlbiBpZiBwYXJlbnQgaXMgbWF0Y2hlZC5cbiAgICAgIGNvbnN0IGNoaWxkcmVuTWF0Y2hlZCA9IHRoaXMuZGZzKHRhcmdldCwgdHJlZUNoaWxkcmVuLCBoaWRlVW5tYXRjaGVkICYmICFzZWxmTWF0Y2hlZCwga2V5d29yZCwgcGF0dGVybikuc29tZSgoXykgPT4gISFfKTtcbiAgICAgIGlmIChzZWxmTWF0Y2hlZCB8fCBjaGlsZHJlbk1hdGNoZWQpIHtcbiAgICAgICAgaWYgKGNoaWxkcmVuTWF0Y2hlZCAmJiB0cmVlQ2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHRoaXMub3Blbk5vZGVzQnlJZCh0cmVlTm9kZS5pZCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0cmVlTm9kZS5kYXRhLmlzSGlkZSA9IGhpZGVVbm1hdGNoZWQ7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYWRkQ2hpbGROb2RlKHBhcmVudE5vZGU6IFRyZWVOb2RlLCBjaGlsZE5vZGU6IFRyZWVOb2RlLCBpbmRleD8pIHtcbiAgICBpZiAocGFyZW50Tm9kZSkge1xuICAgICAgQXJyYXkuaXNBcnJheShwYXJlbnROb2RlLmRhdGEuY2hpbGRyZW4pXG4gICAgICAgID8gaW5kZXggIT09IHVuZGVmaW5lZFxuICAgICAgICAgID8gcGFyZW50Tm9kZS5kYXRhLmNoaWxkcmVuLnNwbGljZShpbmRleCwgMCwgY2hpbGROb2RlKVxuICAgICAgICAgIDogcGFyZW50Tm9kZS5kYXRhLmNoaWxkcmVuLnB1c2goY2hpbGROb2RlKVxuICAgICAgICA6IChwYXJlbnROb2RlLmRhdGEuY2hpbGRyZW4gPSBbY2hpbGROb2RlXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGluZGV4ICE9PSB1bmRlZmluZWQgPyB0aGlzLl90cmVlUm9vdC5zcGxpY2UoaW5kZXgsIDAsIGNoaWxkTm9kZSkgOiB0aGlzLl90cmVlUm9vdC5wdXNoKGNoaWxkTm9kZSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVDaGlsZE5vZGUocGFyZW50Tm9kZTogVHJlZU5vZGUsIGNoaWxkTm9kZTogVHJlZU5vZGUpIHtcbiAgICBpZiAocGFyZW50Tm9kZSkge1xuICAgICAgcGFyZW50Tm9kZS5kYXRhLmNoaWxkcmVuID0gcGFyZW50Tm9kZS5kYXRhLmNoaWxkcmVuLmZpbHRlcigobm9kZSkgPT4gbm9kZS5pZCAhPT0gY2hpbGROb2RlLmlkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fdHJlZVJvb3QgPSB0aGlzLl90cmVlUm9vdC5maWx0ZXIoKG5vZGUpID0+IG5vZGUuaWQgIT09IGNoaWxkTm9kZS5pZCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZXNldFNlYXJjaFJlc3VsdHMoKSB7XG4gICAgT2JqZWN0LmtleXModGhpcy5ub2RlcykuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICBjb25zdCB0cmVlTm9kZSA9IHRoaXMubm9kZXNba2V5XTtcbiAgICAgIHRyZWVOb2RlLmRhdGEuaXNNYXRjaCA9IGZhbHNlO1xuICAgICAgdHJlZU5vZGUuZGF0YS5pc0hpZGUgPSBmYWxzZTtcbiAgICAgIHRyZWVOb2RlLmRhdGEuaXNDdXN0b21TZWFyY2ggPSBmYWxzZTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBzZWFyY2hUcmVlKHRhcmdldDogc3RyaW5nLCBoaWRlVW5tYXRjaGVkID0gZmFsc2UsIGtleXdvcmQ/LCBwYXR0ZXJuPykge1xuICAgIHRoaXMuc2VhcmNoSXRlbSA9IHRhcmdldDtcbiAgICBjb25zdCBUcmltbWVkVGFyZ2V0ID0gdHJpbSh0YXJnZXQpO1xuICAgIHRoaXMucmVzZXRTZWFyY2hSZXN1bHRzKCk7XG4gICAgcmV0dXJuIHRoaXMuZGZzKFRyaW1tZWRUYXJnZXQudG9Mb3dlckNhc2UoKSwgdGhpcy5fdHJlZVJvb3QsIGhpZGVVbm1hdGNoZWQsIGtleXdvcmQsIHBhdHRlcm4pO1xuICB9XG5cbiAgZ2V0IHRyZWVSb290KCkge1xuICAgIHJldHVybiB0aGlzLl90cmVlUm9vdDtcbiAgfVxuXG4gIHB1YmxpYyBkZWFjdGl2YXRlQWxsTm9kZXMoKSB7XG4gICAgZm9yIChjb25zdCBpZCBvZiBPYmplY3Qua2V5cyh0aGlzLm5vZGVzKSkge1xuICAgICAgdGhpcy5ub2Rlc1tpZF0uZGF0YS5pc0FjdGl2ZSA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBjaGVja0FsbE5vZGVzKGNoZWNrZWQ6IGJvb2xlYW4pIHtcbiAgICBmb3IgKGNvbnN0IGlkIG9mIE9iamVjdC5rZXlzKHRoaXMubm9kZXMpKSB7XG4gICAgICBpZiAoIXRoaXMubm9kZXNbaWRdLmRhdGEuZGlzYWJsZWQpIHtcbiAgICAgICAgdGhpcy5ub2Rlc1tpZF0uZGF0YS5oYWxmQ2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5vZGVzW2lkXS5kYXRhLmlzQ2hlY2tlZCA9IGNoZWNrZWQ7XG4gICAgICB9XG4gICAgICB0aGlzLm1haW50YWluQ2hlY2tlZE5vZGVMaXN0KHRoaXMubm9kZXNbaWRdLCB0aGlzLm5vZGVzW2lkXS5kYXRhLmlzQ2hlY2tlZCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldE5vZGVJbmRleChub2RlOiBUcmVlTm9kZSkge1xuICAgIGxldCBwYXJlbnROb2RlO1xuICAgIGxldCBjaGlsZHJlbjtcbiAgICBpZiAobm9kZS5wYXJlbnRJZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBwYXJlbnROb2RlID0gdGhpcy5nZXROb2RlQnlJZChub2RlLnBhcmVudElkKTtcbiAgICAgIGNoaWxkcmVuID0gcGFyZW50Tm9kZS5jaGlsZHJlbjtcbiAgICB9IGVsc2Uge1xuICAgICAgY2hpbGRyZW4gPSB0aGlzLnRyZWVSb290O1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoY2hpbGRyZW5baV0uaWQgPT09IG5vZGUuaWQpIHtcbiAgICAgICAgcmV0dXJuIGk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiAtMTtcbiAgfVxuXG4gIHB1YmxpYyBjaGVja0lzUGFyZW50KGNoaWxkTm9kZUlkOiBudW1iZXIgfCBzdHJpbmcsIHBhcmVudE5vZGVJZDogbnVtYmVyIHwgc3RyaW5nKSB7XG4gICAgY29uc3QgcmVhbFBhcmVudElkID0gdGhpcy5ub2Rlc1tjaGlsZE5vZGVJZF0ucGFyZW50SWQ7XG4gICAgaWYgKHJlYWxQYXJlbnRJZCA9PT0gcGFyZW50Tm9kZUlkKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKHJlYWxQYXJlbnRJZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gdGhpcy5jaGVja0lzUGFyZW50KHJlYWxQYXJlbnRJZCwgcGFyZW50Tm9kZUlkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRGbGF0dGVuTm9kZXMoKSB7XG4gICAgdGhpcy5mbGF0dGVuTm9kZXMubmV4dCh0aGlzLmZsYXR0ZW5UcmVlKCkpO1xuICB9XG5cbiAgcHVibGljIGZsYXR0ZW5UcmVlKCkge1xuICAgIGNvbnN0IGZsYXR0ZW5UcmVlID0gW107XG4gICAgY29uc3QgZmxhdFRyZWUgPSAobm9kZXMpID0+IHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbm9kZXNbaV0uZGF0YS5kZXB0aCA9IG5vZGVzW2ldLnBhcmVudElkID8gdGhpcy5ub2Rlc1tub2Rlc1tpXS5wYXJlbnRJZF0uZGF0YS5kZXB0aCArIDEgOiAwO1xuICAgICAgICBub2Rlc1tpXS5kYXRhLmhpZGVJblZpcnR1YWxTY3JvbGwgPVxuICAgICAgICAgIG5vZGVzW2ldLmRhdGEuaXNIaWRlIHx8XG4gICAgICAgICAgKG5vZGVzW2ldLnBhcmVudElkXG4gICAgICAgICAgICA/IHRoaXMubm9kZXNbbm9kZXNbaV0ucGFyZW50SWRdLmRhdGEuaGlkZUluVmlydHVhbFNjcm9sbCB8fCAhdGhpcy5ub2Rlc1tub2Rlc1tpXS5wYXJlbnRJZF0uZGF0YS5pc09wZW5cbiAgICAgICAgICAgIDogZmFsc2UpO1xuICAgICAgICBub2Rlc1tpXS5kYXRhLmlzTGFzdCA9IGkgPT09IG5vZGVzLmxlbmd0aCAtIDE7XG4gICAgICAgIGZsYXR0ZW5UcmVlLnB1c2gobm9kZXNbaV0pO1xuICAgICAgICBpZiAobm9kZXNbaV0uZGF0YS5jaGlsZHJlbikge1xuICAgICAgICAgIGZsYXRUcmVlKG5vZGVzW2ldLmRhdGEuY2hpbGRyZW4pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICBmbGF0VHJlZSh0aGlzLnRyZWVSb290KTtcbiAgICByZXR1cm4gZmxhdHRlblRyZWU7XG4gIH1cblxuICBwdWJsaWMgbWVyZ2VUcmVlTm9kZXModGFyZ2V0Tm9kZSA9IHRoaXMudHJlZVJvb3QpIHtcbiAgICBjb25zdCBtZXJnZVRvTm9kZSA9IChub2RlKSA9PiB7XG4gICAgICBpZiAobm9kZS5kYXRhLmNoaWxkcmVuPy5sZW5ndGggPT09IDEgJiYgbm9kZS5kYXRhLmNoaWxkcmVuWzBdPy5kYXRhPy5jaGlsZHJlbj8ubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgIG5vZGUuZGF0YS50aXRsZSA9IG5vZGUuZGF0YS50aXRsZSArICcgLyAnICsgbm9kZS5kYXRhLmNoaWxkcmVuWzBdPy5kYXRhPy50aXRsZTtcbiAgICAgICAgbm9kZS5kYXRhLmNoaWxkcmVuID0gbm9kZS5kYXRhLmNoaWxkcmVuWzBdPy5kYXRhPy5jaGlsZHJlbjtcbiAgICAgICAgbWVyZ2VUb05vZGUobm9kZSk7XG4gICAgICB9XG4gICAgICBpZiAobm9kZS5kYXRhLmNoaWxkcmVuPy5sZW5ndGggPiAxKSB7XG4gICAgICAgIG5vZGUuZGF0YS5jaGlsZHJlbi5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICAgICAgbWVyZ2VUb05vZGUoZWxlbWVudCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgaWYgKHRhcmdldE5vZGUgPT09IHRoaXMudHJlZVJvb3QpIHtcbiAgICAgIHRoaXMudHJlZVJvb3QuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgICBtZXJnZVRvTm9kZShlbGVtZW50KTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBtZXJnZVRvTm9kZSh0YXJnZXROb2RlKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgcmVuZGVyRmxhdHRlblRyZWUoKSB7XG4gICAgaWYgKCF0aGlzLnZpcnR1YWxTY3JvbGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5nZXRGbGF0dGVuTm9kZXMoKTtcbiAgfVxuXG4gIHB1YmxpYyBkaXNhYmxlQWxsTm9kZXNDaGVja2VkKGRpc2FibGVkID0gdHJ1ZSkge1xuICAgIGZvciAoY29uc3QgaWQgb2YgT2JqZWN0LmtleXModGhpcy5ub2RlcykpIHtcbiAgICAgIHRoaXMubm9kZXNbaWRdLmRhdGEuZGlzYWJsZWQgPSBkaXNhYmxlZDtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZGlzYWJsZUFsbE5vZGVzU2VsZWN0ZWQoZGlzYWJsZWQgPSB0cnVlKSB7XG4gICAgZm9yIChjb25zdCBpZCBvZiBPYmplY3Qua2V5cyh0aGlzLm5vZGVzKSkge1xuICAgICAgdGhpcy5ub2Rlc1tpZF0uZGF0YS5kaXNhYmxlU2VsZWN0ID0gZGlzYWJsZWQ7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGRpc2FibGVBbGxOb2Rlc1RvZ2dsZWQoZGlzYWJsZWQgPSB0cnVlKSB7XG4gICAgZm9yIChjb25zdCBpZCBvZiBPYmplY3Qua2V5cyh0aGlzLm5vZGVzKSkge1xuICAgICAgdGhpcy5ub2Rlc1tpZF0uZGF0YS5kaXNhYmxlVG9nZ2xlID0gZGlzYWJsZWQ7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHRyYW5zZmVyVG9UcmVlTm9kZShcbiAgICBvcmlnaW5Ob2RlLFxuICAgIHBhcmVudElkPyxcbiAgICB0cmVlTm9kZUNoaWxkcmVuS2V5ID0gJ2l0ZW1zJyxcbiAgICB0cmVlTm9kZUlkS2V5ID0gJ2lkJyxcbiAgICBjaGVja2JveERpc2FibGVkS2V5ID0gJ2Rpc2FibGVkJyxcbiAgICBzZWxlY3REaXNhYmxlZEtleSA9ICdkaXNhYmxlU2VsZWN0JyxcbiAgICB0b2dnbGVEaXNhYmxlZEtleSA9ICdkaXNhYmxlVG9nZ2xlJyxcbiAgICB0cmVlTm9kZVRpdGxlS2V5ID0gJ3RpdGxlJ1xuICApIHtcbiAgICBjb25zdCBub2RlID0ge1xuICAgICAgaWQ6IG9yaWdpbk5vZGVbdHJlZU5vZGVJZEtleV0sXG4gICAgICBwYXJlbnRJZCxcbiAgICAgIHRpdGxlOiBvcmlnaW5Ob2RlW3RyZWVOb2RlVGl0bGVLZXldLFxuICAgICAgaXNPcGVuOiAhIW9yaWdpbk5vZGUub3BlbixcbiAgICAgIGRhdGE6IG9yaWdpbk5vZGUuZGF0YSB8fCB7fSxcbiAgICAgIG9yaWdpbkl0ZW06IG9yaWdpbk5vZGUsXG4gICAgICBpc1BhcmVudDogISFvcmlnaW5Ob2RlLmlzUGFyZW50IHx8ICEhKG9yaWdpbk5vZGVbdHJlZU5vZGVDaGlsZHJlbktleV0gJiYgb3JpZ2luTm9kZVt0cmVlTm9kZUNoaWxkcmVuS2V5XS5sZW5ndGggPiAwKSxcbiAgICAgIGxvYWRpbmc6ICEhb3JpZ2luTm9kZS5sb2FkaW5nLFxuICAgICAgaXNNYXRjaDogISFvcmlnaW5Ob2RlLmlzTWF0Y2gsXG4gICAgICBpc0hpZGU6ICEhb3JpZ2luTm9kZS5pc0hpZGUsXG4gICAgICBpc0NoZWNrZWQ6ICEhb3JpZ2luTm9kZS5pc0NoZWNrZWQsXG4gICAgICBoYWxmQ2hlY2tlZDogISFvcmlnaW5Ob2RlLmhhbGZDaGVja2VkLFxuICAgICAgaXNBY3RpdmU6ICEhb3JpZ2luTm9kZS5pc0FjdGl2ZSxcbiAgICAgIGRpc2FibGVkOiAhIW9yaWdpbk5vZGVbY2hlY2tib3hEaXNhYmxlZEtleV0sXG4gICAgICBkaXNhYmxlU2VsZWN0OiAhIW9yaWdpbk5vZGVbc2VsZWN0RGlzYWJsZWRLZXldLFxuICAgICAgZGlzYWJsZVRvZ2dsZTogISFvcmlnaW5Ob2RlW3RvZ2dsZURpc2FibGVkS2V5XSxcbiAgICAgIGRpc2FibGVBZGQ6ICEhb3JpZ2luTm9kZS5kaXNhYmxlQWRkLFxuICAgICAgZGlzYWJsZUVkaXQ6ICEhb3JpZ2luTm9kZS5kaXNhYmxlRWRpdCxcbiAgICAgIGRpc2FibGVEZWxldGU6ICEhb3JpZ2luTm9kZS5kaXNhYmxlRGVsZXRlLFxuICAgICAgY2hpbGRyZW46IFtdLFxuICAgIH07XG4gICAgcmV0dXJuIG5ldyBUcmVlTm9kZShub2RlLmlkLCBub2RlLnBhcmVudElkLCB7IC4uLm5vZGUgfSk7XG4gIH1cbn1cbiJdfQ==