import { Component, ElementRef, EventEmitter, HostBinding, Input, Output } from '@angular/core';
import { fromEvent } from 'rxjs';
import { tap } from 'rxjs/operators';
import { EditableTip } from '../../../data-table.model';
import { TableTdService } from './td.service';
import * as i0 from "@angular/core";
import * as i1 from "./td.service";
import * as i2 from "@angular/common";
import * as i3 from "ng-devui/utils";
export class TableTdComponent {
    constructor(elementRef, tdService) {
        this.elementRef = elementRef;
        this.tdService = tdService;
        this.editableTip = EditableTip.hover;
        this.nestedColumn = false;
        this.nestedColumnIndent = 16;
        this.toggleChildTableEvent = new EventEmitter();
        this.editStatusEvent = new EventEmitter();
        /**
         * 编辑状态调整 @deprecated
         */
        this.editingChange = new EventEmitter();
        this.currentEditing = false;
    }
    get isEditable() {
        return this.editable && !this.editing && this.editableTip !== 'btn';
    }
    ngOnInit() { }
    ngOnChanges(changes) {
        if (changes['fixedLeft']) {
            if (this.fixedLeft) {
                this.stickyLeftClass = true;
                this.stickyLeftStyle = this.fixedLeft;
            }
            else {
                this.stickyLeftClass = false;
                this.stickyLeftStyle = null;
            }
        }
        if (changes['fixedRight']) {
            if (this.fixedRight) {
                this.stickyRightClass = true;
                this.stickyRightStyle = this.fixedRight;
            }
            else {
                this.stickyRightClass = false;
                this.stickyRightStyle = null;
            }
        }
        if (changes['editing'] && changes['editing'].currentValue && !this.currentEditing) {
            this.bindEditClickEvent();
        }
    }
    startEditing(event) {
        event.stopPropagation();
        event.preventDefault();
        let beforePromise = Promise.resolve(true);
        if (this.beforeEditStart) {
            const result = this.beforeEditStart(this.rowItem, this.field);
            if (typeof result !== 'undefined') {
                if (result.then) {
                    beforePromise = result;
                }
                else if (result.subscribe) {
                    beforePromise = result.toPromise();
                }
                else {
                    beforePromise = Promise.resolve(result);
                }
            }
        }
        beforePromise.then((canStart) => {
            if (canStart) {
                this.editing = true;
                this.currentEditing = true;
                this.editingChange.emit(true);
                this.editStatusEvent.emit(true);
                this.tdService.tableCellClickEvent.emit(event);
                this.bindEditClickEvent();
            }
        });
    }
    bindEditClickEvent() {
        this.documentClickSubscription = fromEvent(document, 'click').pipe(tap((e) => {
            e.stopPropagation();
        })).subscribe((clickEvent) => {
            if (!this.elementRef.nativeElement.contains(clickEvent.target) && !this.clickInTd) {
                this.finishCellEdit();
            }
            this.clickInTd = false;
        });
        this.tdMousedownSubscription = fromEvent(this.elementRef.nativeElement, 'mousedown').subscribe(event => {
            this.clickInTd = true;
        });
        this.tdMouseupSubscription = fromEvent(this.elementRef.nativeElement, 'mouseup').subscribe(event => {
            this.clickInTd = false;
        });
        this.tdClickSubscription = this.tdService.tableCellClickEvent.subscribe((clickEvent) => {
            if (!this.elementRef.nativeElement.contains(clickEvent.target)) {
                this.finishCellEdit();
            }
        });
    }
    removeEditClickEvent() {
        if (this.documentClickSubscription) {
            this.documentClickSubscription.unsubscribe();
            this.documentClickSubscription = null;
        }
        if (this.tdClickSubscription) {
            this.tdClickSubscription.unsubscribe();
            this.tdClickSubscription = null;
        }
    }
    finishCellEdit() {
        let beforePromise = Promise.resolve(true);
        if (this.beforeEditEnd) {
            const result = this.beforeEditEnd(this.rowItem, this.field);
            if (typeof result !== 'undefined') {
                if (result.then) {
                    beforePromise = result;
                }
                else if (result.subscribe) {
                    beforePromise = result.toPromise();
                }
                else {
                    beforePromise = Promise.resolve(result);
                }
            }
        }
        beforePromise.then((canEnd) => {
            if (canEnd) {
                this.editing = false;
                this.currentEditing = false;
                this.editingChange.emit(false);
                this.editStatusEvent.emit(false);
                this.removeEditClickEvent();
            }
        });
    }
    toggleChildTable(rowItem) {
        rowItem.$isChildTableOpen = !rowItem.$isChildTableOpen;
        this.toggleChildTableEvent.emit(rowItem.$isChildTableOpen);
    }
    ngOnDestroy() {
        if (this.documentClickSubscription) {
            this.documentClickSubscription.unsubscribe();
            this.documentClickSubscription = null;
        }
        if (this.tdClickSubscription) {
            this.tdClickSubscription.unsubscribe();
            this.tdClickSubscription = null;
        }
        if (this.tdMousedownSubscription) {
            this.tdMousedownSubscription.unsubscribe();
            this.tdMousedownSubscription = null;
        }
        if (this.tdMouseupSubscription) {
            this.tdMouseupSubscription.unsubscribe();
            this.tdMouseupSubscription = null;
        }
    }
}
TableTdComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: TableTdComponent, deps: [{ token: i0.ElementRef }, { token: i1.TableTdService }], target: i0.ɵɵFactoryTarget.Component });
TableTdComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.3", type: TableTdComponent, selector: "[dTableCell]", inputs: { editable: "editable", editableTip: "editableTip", nestedColumn: "nestedColumn", nestedLayer: "nestedLayer", field: "field", rowItem: "rowItem", fixedLeft: "fixedLeft", fixedRight: "fixedRight", iconFoldTable: "iconFoldTable", iconUnFoldTable: "iconUnFoldTable", nestedColumnIndent: "nestedColumnIndent", beforeEditStart: "beforeEditStart", beforeEditEnd: "beforeEditEnd", editing: "editing" }, outputs: { toggleChildTableEvent: "toggleChildTableEvent", editStatusEvent: "editStatusEvent", editingChange: "editingChange" }, host: { properties: { "class.devui-sticky-left-cell": "this.stickyLeftClass", "class.devui-sticky-right-cell": "this.stickyRightClass", "style.left": "this.stickyLeftStyle", "style.right": "this.stickyRightStyle", "class.editable-cell": "this.isEditable" } }, usesOnChanges: true, ngImport: i0, template: "<ng-container *ngIf=\"editable && !editing\">\n  <div *ngIf=\"editableTip === 'btn'\" class=\"cell-container\">\n    <div class=\"cell-container-inner not-break modify-holder\">\n      <ng-template\n        [ngTemplateOutlet]=\"nestedTmp\"\n        [ngTemplateOutletContext]=\"{ nestedColumn: nestedColumn, rowItem: rowItem, nestedLayer: nestedLayer }\"\n      ></ng-template>\n      <ng-container *ngTemplateOutlet=\"content\"></ng-container>\n      <span class=\"cell-modify\" (click)=\"startEditing($event)\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" width=\"16px\" height=\"16px\" version=\"1.1\">\n          <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"none\" stroke-width=\"1\">\n            <path\n              d=\"M 9.48528 3.41421 L 10.8995 2 L 13.7279 4.82843 L 12.3137 6.24264 L 9.48528 3.41421 Z M 5.24264 13.3137 L 2.41421 13.3137 L 2.41421 10.4853 L 8.77817 4.12132 L 11.6066 6.94975 L 5.24264 13.3137 Z\"\n            />\n          </g>\n        </svg>\n      </span>\n    </div>\n  </div>\n\n  <div *ngIf=\"editableTip !== 'btn'\" class=\"cell-editable not-break\" (click)=\"startEditing($event)\">\n    <ng-template\n      [ngTemplateOutlet]=\"nestedTmp\"\n      [ngTemplateOutletContext]=\"{ nestedColumn: nestedColumn, rowItem: rowItem, nestedLayer: nestedLayer }\"\n    ></ng-template>\n    <ng-container *ngTemplateOutlet=\"content\"></ng-container>\n  </div>\n</ng-container>\n\n<ng-container *ngIf=\"!editable || editing\">\n  <ng-template\n    [ngTemplateOutlet]=\"nestedTmp\"\n    [ngTemplateOutletContext]=\"{ nestedColumn: nestedColumn, rowItem: rowItem, nestedLayer: nestedLayer }\"\n  ></ng-template>\n  <ng-container *ngTemplateOutlet=\"content\"></ng-container>\n</ng-container>\n\n<ng-template #content><ng-content></ng-content></ng-template>\n\n<ng-template #nestedTmp let-nestedColumn=\"nestedColumn\" let-rowItem=\"rowItem\" let-nestedLayer=\"nestedLayer\">\n  <ng-container *ngIf=\"nestedColumn\">\n    <span *ngIf=\"nestedLayer > 0\" class=\"cell-placeholder\" [ngStyle]=\"{ width: nestedLayer * nestedColumnIndent + 'px' }\"></span>\n    <span [style.visibility]=\"rowItem.children ? 'visible' : 'hidden'\" class=\"childtable-toggler\" (click)=\"toggleChildTable(rowItem)\">\n      <ng-container *ngIf=\"rowItem['$isChildTableOpen']\">\n        <svg\n          *ngIf=\"!iconFoldTable\"\n          width=\"16px\"\n          height=\"16px\"\n          viewBox=\"0 0 16 16\"\n          version=\"1.1\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n          xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          class=\"svg-icon svg-icon-close\"\n        >\n          <g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n            <rect x=\"0.5\" y=\"0.5\" width=\"15\" height=\"15\" rx=\"2\"></rect>\n            <rect x=\"4\" y=\"7\" width=\"8\" height=\"2\"></rect>\n          </g>\n        </svg>\n        <span *ngIf=\"iconFoldTable\" [innerHTML]=\"iconFoldTable | safe: 'html'\"></span>\n      </ng-container>\n      <ng-container *ngIf=\"!rowItem['$isChildTableOpen']\">\n        <svg\n          *ngIf=\"!iconUnFoldTable\"\n          width=\"16px\"\n          height=\"16px\"\n          viewBox=\"0 0 16 16\"\n          version=\"1.1\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n          xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          class=\"svg-icon svg-icon-open-folder\"\n        >\n          <g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n            <rect x=\"0.5\" y=\"0.5\" width=\"15\" height=\"15\" rx=\"2\"></rect>\n            <path\n              d=\"M8.75,4 L8.75,7.25 L12,7.25 L12,8.75 L8.749,8.75 L8.75,12 L7.25,12 L7.249,8.75 L4,8.75 L4,7.25 L7.25,7.25 L7.25,4 L8.75,4 Z\"\n            ></path>\n          </g>\n        </svg>\n        <span *ngIf=\"iconUnFoldTable\" [innerHTML]=\"iconUnFoldTable | safe: 'html'\"></span>\n      </ng-container>\n    </span>\n  </ng-container>\n</ng-template>\n", styles: ["svg.svg-icon-arrow>g>polygon{fill:#71757f;fill:var(--devui-icon-text, #71757f)}:host ::ng-deep d-button button.d-btn.d-btn-icon{padding:0!important}:host.editable-cell{position:relative}:host.editable-cell:hover:after{content:\"\";display:block;width:calc(100% - 32px);position:absolute;height:calc(100% - 14px);border:1px solid #d7d8da;border:1px solid var(--devui-line, #d7d8da);left:12px;top:8px;border-radius:2px;border-radius:var(--devui-border-radius, 2px);pointer-events:none}.cell-modify{position:absolute;right:0;cursor:pointer}.cell-modify>svg{vertical-align:middle}.cell-modify:hover>svg>g>g{fill:#71757f;fill:var(--devui-icon-text, #71757f)}.cell-container{position:relative;height:24px}.cell-container-inner{position:absolute;max-width:100%;width:100%;min-height:24px}.cell-container-inner.modify-holder{padding-right:20px}.cell-container-inner.modify-holder .cell-modify{display:none;cursor:pointer;position:absolute;right:0}.cell-container-inner.modify-holder .cell-modify>svg{vertical-align:middle}.cell-container-inner.modify-holder .cell-modify>svg>g{fill:#71757f;fill:var(--devui-icon-text, #71757f)}.cell-container-inner.modify-holder .cell-modify:hover>svg>g{fill:#252b3a;fill:var(--devui-icon-fill-active-hover, #252b3a)}.cell-container-inner.modify-holder:hover .cell-modify{display:inline}.not-break{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;word-spacing:normal;word-wrap:normal}.cell-editable{cursor:pointer;margin-left:-5px;padding-left:5px}.cell-editable:hover{background:#f2f2f3;background:var(--devui-list-item-hover-bg, #f2f2f3)}.cell-placeholder{display:inline-block;height:16px}\n"], directives: [{ type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i2.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }, { type: i2.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }], pipes: { "safe": i3.SafePipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: TableTdComponent, decorators: [{
            type: Component,
            args: [{ selector: '[dTableCell]', template: "<ng-container *ngIf=\"editable && !editing\">\n  <div *ngIf=\"editableTip === 'btn'\" class=\"cell-container\">\n    <div class=\"cell-container-inner not-break modify-holder\">\n      <ng-template\n        [ngTemplateOutlet]=\"nestedTmp\"\n        [ngTemplateOutletContext]=\"{ nestedColumn: nestedColumn, rowItem: rowItem, nestedLayer: nestedLayer }\"\n      ></ng-template>\n      <ng-container *ngTemplateOutlet=\"content\"></ng-container>\n      <span class=\"cell-modify\" (click)=\"startEditing($event)\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" width=\"16px\" height=\"16px\" version=\"1.1\">\n          <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"none\" stroke-width=\"1\">\n            <path\n              d=\"M 9.48528 3.41421 L 10.8995 2 L 13.7279 4.82843 L 12.3137 6.24264 L 9.48528 3.41421 Z M 5.24264 13.3137 L 2.41421 13.3137 L 2.41421 10.4853 L 8.77817 4.12132 L 11.6066 6.94975 L 5.24264 13.3137 Z\"\n            />\n          </g>\n        </svg>\n      </span>\n    </div>\n  </div>\n\n  <div *ngIf=\"editableTip !== 'btn'\" class=\"cell-editable not-break\" (click)=\"startEditing($event)\">\n    <ng-template\n      [ngTemplateOutlet]=\"nestedTmp\"\n      [ngTemplateOutletContext]=\"{ nestedColumn: nestedColumn, rowItem: rowItem, nestedLayer: nestedLayer }\"\n    ></ng-template>\n    <ng-container *ngTemplateOutlet=\"content\"></ng-container>\n  </div>\n</ng-container>\n\n<ng-container *ngIf=\"!editable || editing\">\n  <ng-template\n    [ngTemplateOutlet]=\"nestedTmp\"\n    [ngTemplateOutletContext]=\"{ nestedColumn: nestedColumn, rowItem: rowItem, nestedLayer: nestedLayer }\"\n  ></ng-template>\n  <ng-container *ngTemplateOutlet=\"content\"></ng-container>\n</ng-container>\n\n<ng-template #content><ng-content></ng-content></ng-template>\n\n<ng-template #nestedTmp let-nestedColumn=\"nestedColumn\" let-rowItem=\"rowItem\" let-nestedLayer=\"nestedLayer\">\n  <ng-container *ngIf=\"nestedColumn\">\n    <span *ngIf=\"nestedLayer > 0\" class=\"cell-placeholder\" [ngStyle]=\"{ width: nestedLayer * nestedColumnIndent + 'px' }\"></span>\n    <span [style.visibility]=\"rowItem.children ? 'visible' : 'hidden'\" class=\"childtable-toggler\" (click)=\"toggleChildTable(rowItem)\">\n      <ng-container *ngIf=\"rowItem['$isChildTableOpen']\">\n        <svg\n          *ngIf=\"!iconFoldTable\"\n          width=\"16px\"\n          height=\"16px\"\n          viewBox=\"0 0 16 16\"\n          version=\"1.1\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n          xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          class=\"svg-icon svg-icon-close\"\n        >\n          <g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n            <rect x=\"0.5\" y=\"0.5\" width=\"15\" height=\"15\" rx=\"2\"></rect>\n            <rect x=\"4\" y=\"7\" width=\"8\" height=\"2\"></rect>\n          </g>\n        </svg>\n        <span *ngIf=\"iconFoldTable\" [innerHTML]=\"iconFoldTable | safe: 'html'\"></span>\n      </ng-container>\n      <ng-container *ngIf=\"!rowItem['$isChildTableOpen']\">\n        <svg\n          *ngIf=\"!iconUnFoldTable\"\n          width=\"16px\"\n          height=\"16px\"\n          viewBox=\"0 0 16 16\"\n          version=\"1.1\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n          xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          class=\"svg-icon svg-icon-open-folder\"\n        >\n          <g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n            <rect x=\"0.5\" y=\"0.5\" width=\"15\" height=\"15\" rx=\"2\"></rect>\n            <path\n              d=\"M8.75,4 L8.75,7.25 L12,7.25 L12,8.75 L8.749,8.75 L8.75,12 L7.25,12 L7.249,8.75 L4,8.75 L4,7.25 L7.25,7.25 L7.25,4 L8.75,4 Z\"\n            ></path>\n          </g>\n        </svg>\n        <span *ngIf=\"iconUnFoldTable\" [innerHTML]=\"iconUnFoldTable | safe: 'html'\"></span>\n      </ng-container>\n    </span>\n  </ng-container>\n</ng-template>\n", styles: ["svg.svg-icon-arrow>g>polygon{fill:#71757f;fill:var(--devui-icon-text, #71757f)}:host ::ng-deep d-button button.d-btn.d-btn-icon{padding:0!important}:host.editable-cell{position:relative}:host.editable-cell:hover:after{content:\"\";display:block;width:calc(100% - 32px);position:absolute;height:calc(100% - 14px);border:1px solid #d7d8da;border:1px solid var(--devui-line, #d7d8da);left:12px;top:8px;border-radius:2px;border-radius:var(--devui-border-radius, 2px);pointer-events:none}.cell-modify{position:absolute;right:0;cursor:pointer}.cell-modify>svg{vertical-align:middle}.cell-modify:hover>svg>g>g{fill:#71757f;fill:var(--devui-icon-text, #71757f)}.cell-container{position:relative;height:24px}.cell-container-inner{position:absolute;max-width:100%;width:100%;min-height:24px}.cell-container-inner.modify-holder{padding-right:20px}.cell-container-inner.modify-holder .cell-modify{display:none;cursor:pointer;position:absolute;right:0}.cell-container-inner.modify-holder .cell-modify>svg{vertical-align:middle}.cell-container-inner.modify-holder .cell-modify>svg>g{fill:#71757f;fill:var(--devui-icon-text, #71757f)}.cell-container-inner.modify-holder .cell-modify:hover>svg>g{fill:#252b3a;fill:var(--devui-icon-fill-active-hover, #252b3a)}.cell-container-inner.modify-holder:hover .cell-modify{display:inline}.not-break{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;word-spacing:normal;word-wrap:normal}.cell-editable{cursor:pointer;margin-left:-5px;padding-left:5px}.cell-editable:hover{background:#f2f2f3;background:var(--devui-list-item-hover-bg, #f2f2f3)}.cell-placeholder{display:inline-block;height:16px}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i1.TableTdService }]; }, propDecorators: { stickyLeftClass: [{
                type: HostBinding,
                args: ['class.devui-sticky-left-cell']
            }], stickyRightClass: [{
                type: HostBinding,
                args: ['class.devui-sticky-right-cell']
            }], stickyLeftStyle: [{
                type: HostBinding,
                args: ['style.left']
            }], stickyRightStyle: [{
                type: HostBinding,
                args: ['style.right']
            }], editable: [{
                type: Input
            }], editableTip: [{
                type: Input
            }], nestedColumn: [{
                type: Input
            }], nestedLayer: [{
                type: Input
            }], field: [{
                type: Input
            }], rowItem: [{
                type: Input
            }], fixedLeft: [{
                type: Input
            }], fixedRight: [{
                type: Input
            }], iconFoldTable: [{
                type: Input
            }], iconUnFoldTable: [{
                type: Input
            }], nestedColumnIndent: [{
                type: Input
            }], beforeEditStart: [{
                type: Input
            }], beforeEditEnd: [{
                type: Input
            }], toggleChildTableEvent: [{
                type: Output
            }], editing: [{
                type: Input
            }], editStatusEvent: [{
                type: Output
            }], editingChange: [{
                type: Output
            }], isEditable: [{
                type: HostBinding,
                args: ['class.editable-cell']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vZGV2dWkvZGF0YS10YWJsZS90YWJsZS9ib2R5L3RkL3RkLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL2RldnVpL2RhdGEtdGFibGUvdGFibGUvYm9keS90ZC90ZC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQ25DLFdBQVcsRUFBRSxLQUFLLEVBQ2xCLE1BQU0sRUFDUCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsU0FBUyxFQUE0QixNQUFNLE1BQU0sQ0FBQztBQUMzRCxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDckMsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxjQUFjLENBQUM7Ozs7O0FBUTlDLE1BQU0sT0FBTyxnQkFBZ0I7SUFvQzNCLFlBQW9CLFVBQXNCLEVBQVUsU0FBeUI7UUFBekQsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUFVLGNBQVMsR0FBVCxTQUFTLENBQWdCO1FBOUJwRSxnQkFBVyxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUM7UUFDaEMsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFRckIsdUJBQWtCLEdBQUcsRUFBRSxDQUFDO1FBR3ZCLDBCQUFxQixHQUFHLElBQUksWUFBWSxFQUFXLENBQUM7UUFFcEQsb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBVyxDQUFDO1FBQ3hEOztXQUVHO1FBQ08sa0JBQWEsR0FBRyxJQUFJLFlBQVksRUFBVyxDQUFDO1FBVzlDLG1CQUFjLEdBQUcsS0FBSyxDQUFDO0lBQ2tELENBQUM7SUFWbEYsSUFBd0MsVUFBVTtRQUNoRCxPQUFPLElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxXQUFXLEtBQUssS0FBSyxDQUFDO0lBQ3RFLENBQUM7SUFVRCxRQUFRLEtBQUksQ0FBQztJQUViLFdBQVcsQ0FBQyxPQUFzQjtRQUNoQyxJQUFJLE9BQU8sQ0FBQyxXQUFXLENBQUMsRUFBRTtZQUN4QixJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7Z0JBQ2xCLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO2dCQUM1QixJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7YUFDdkM7aUJBQU07Z0JBQ0wsSUFBSSxDQUFDLGVBQWUsR0FBRyxLQUFLLENBQUM7Z0JBQzdCLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO2FBQzdCO1NBQ0Y7UUFFRCxJQUFJLE9BQU8sQ0FBQyxZQUFZLENBQUMsRUFBRTtZQUN6QixJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7Z0JBQ25CLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUM7Z0JBQzdCLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO2FBQ3pDO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxLQUFLLENBQUM7Z0JBQzlCLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUM7YUFDOUI7U0FDRjtRQUVELElBQUksT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxZQUFZLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFO1lBQ2pGLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1NBQzNCO0lBQ0gsQ0FBQztJQUVELFlBQVksQ0FBQyxLQUFLO1FBQ2hCLEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUN4QixLQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdkIsSUFBSSxhQUFhLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMxQyxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDeEIsTUFBTSxNQUFNLEdBQVEsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNuRSxJQUFJLE9BQU8sTUFBTSxLQUFLLFdBQVcsRUFBRTtnQkFDakMsSUFBSSxNQUFNLENBQUMsSUFBSSxFQUFFO29CQUNmLGFBQWEsR0FBRyxNQUFNLENBQUM7aUJBQ3hCO3FCQUFNLElBQUksTUFBTSxDQUFDLFNBQVMsRUFBRTtvQkFDM0IsYUFBYSxHQUFJLE1BQThCLENBQUMsU0FBUyxFQUFFLENBQUM7aUJBQzdEO3FCQUFNO29CQUNMLGFBQWEsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2lCQUN6QzthQUNGO1NBQ0Y7UUFFRCxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUU7WUFDOUIsSUFBSSxRQUFRLEVBQUU7Z0JBQ1osSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7Z0JBQ3BCLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO2dCQUMzQixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDOUIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ2hDLElBQUksQ0FBQyxTQUFTLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUMvQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQzthQUMzQjtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELGtCQUFrQjtRQUNoQixJQUFJLENBQUMseUJBQXlCLEdBQUcsU0FBUyxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQ2hFLEdBQUcsQ0FBQyxDQUFDLENBQVEsRUFBRSxFQUFFO1lBQ2YsQ0FBQyxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQ3RCLENBQUMsQ0FBQyxDQUNILENBQUMsU0FBUyxDQUFDLENBQUMsVUFBVSxFQUFFLEVBQUU7WUFDekIsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFO2dCQUNqRixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7YUFDdkI7WUFDRCxJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyx1QkFBdUIsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ3JHLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBQ3hCLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLHFCQUFxQixHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxTQUFTLENBQUMsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDakcsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7UUFDekIsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxTQUFTLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRTtZQUNyRixJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsRUFBRTtnQkFDOUQsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO2FBQ3ZCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsb0JBQW9CO1FBQ2xCLElBQUksSUFBSSxDQUFDLHlCQUF5QixFQUFFO1lBQ2xDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUM3QyxJQUFJLENBQUMseUJBQXlCLEdBQUcsSUFBSSxDQUFDO1NBQ3ZDO1FBQ0QsSUFBSSxJQUFJLENBQUMsbUJBQW1CLEVBQUU7WUFDNUIsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3ZDLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUM7U0FDakM7SUFDSCxDQUFDO0lBRUQsY0FBYztRQUNaLElBQUksYUFBYSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUMsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ3RCLE1BQU0sTUFBTSxHQUFRLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDakUsSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXLEVBQUU7Z0JBQ2pDLElBQUksTUFBTSxDQUFDLElBQUksRUFBRTtvQkFDZixhQUFhLEdBQUcsTUFBTSxDQUFDO2lCQUN4QjtxQkFBTSxJQUFJLE1BQU0sQ0FBQyxTQUFTLEVBQUU7b0JBQzNCLGFBQWEsR0FBSSxNQUE4QixDQUFDLFNBQVMsRUFBRSxDQUFDO2lCQUM3RDtxQkFBTTtvQkFDTCxhQUFhLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztpQkFDekM7YUFDRjtTQUNGO1FBQ0QsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFO1lBQzVCLElBQUksTUFBTSxFQUFFO2dCQUNWLElBQUksQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDO2dCQUNyQixJQUFJLENBQUMsY0FBYyxHQUFHLEtBQUssQ0FBQztnQkFDNUIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQy9CLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNqQyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQzthQUM3QjtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELGdCQUFnQixDQUFDLE9BQU87UUFDdEIsT0FBTyxDQUFDLGlCQUFpQixHQUFHLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDO1FBQ3ZELElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFDN0QsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLElBQUksQ0FBQyx5QkFBeUIsRUFBRTtZQUNsQyxJQUFJLENBQUMseUJBQXlCLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDN0MsSUFBSSxDQUFDLHlCQUF5QixHQUFHLElBQUksQ0FBQztTQUN2QztRQUNELElBQUksSUFBSSxDQUFDLG1CQUFtQixFQUFFO1lBQzVCLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUN2QyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDO1NBQ2pDO1FBRUQsSUFBSSxJQUFJLENBQUMsdUJBQXVCLEVBQUU7WUFDaEMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzNDLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxJQUFJLENBQUM7U0FDckM7UUFFRCxJQUFJLElBQUksQ0FBQyxxQkFBcUIsRUFBRTtZQUM5QixJQUFJLENBQUMscUJBQXFCLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDekMsSUFBSSxDQUFDLHFCQUFxQixHQUFHLElBQUksQ0FBQztTQUNuQztJQUNILENBQUM7OzZHQXJMVSxnQkFBZ0I7aUdBQWhCLGdCQUFnQixrMkJDaEI3QiwrM0hBb0ZBOzJGRHBFYSxnQkFBZ0I7a0JBTjVCLFNBQVM7K0JBRUUsY0FBYzs4SEFLcUIsZUFBZTtzQkFBM0QsV0FBVzt1QkFBQyw4QkFBOEI7Z0JBQ0csZ0JBQWdCO3NCQUE3RCxXQUFXO3VCQUFDLCtCQUErQjtnQkFDakIsZUFBZTtzQkFBekMsV0FBVzt1QkFBQyxZQUFZO2dCQUNHLGdCQUFnQjtzQkFBM0MsV0FBVzt1QkFBQyxhQUFhO2dCQUNqQixRQUFRO3NCQUFoQixLQUFLO2dCQUNHLFdBQVc7c0JBQW5CLEtBQUs7Z0JBQ0csWUFBWTtzQkFBcEIsS0FBSztnQkFDRyxXQUFXO3NCQUFuQixLQUFLO2dCQUNHLEtBQUs7c0JBQWIsS0FBSztnQkFDRyxPQUFPO3NCQUFmLEtBQUs7Z0JBQ0csU0FBUztzQkFBakIsS0FBSztnQkFDRyxVQUFVO3NCQUFsQixLQUFLO2dCQUNHLGFBQWE7c0JBQXJCLEtBQUs7Z0JBQ0csZUFBZTtzQkFBdkIsS0FBSztnQkFDRyxrQkFBa0I7c0JBQTFCLEtBQUs7Z0JBQ0csZUFBZTtzQkFBdkIsS0FBSztnQkFDRyxhQUFhO3NCQUFyQixLQUFLO2dCQUNJLHFCQUFxQjtzQkFBOUIsTUFBTTtnQkFDRSxPQUFPO3NCQUFmLEtBQUs7Z0JBQ0ksZUFBZTtzQkFBeEIsTUFBTTtnQkFJRyxhQUFhO3NCQUF0QixNQUFNO2dCQUVpQyxVQUFVO3NCQUFqRCxXQUFXO3VCQUFDLHFCQUFxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLFxuICBIb3N0QmluZGluZywgSW5wdXQsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBPbkluaXQsXG4gIE91dHB1dCwgU2ltcGxlQ2hhbmdlc1xufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGZyb21FdmVudCwgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBFZGl0YWJsZVRpcCB9IGZyb20gJy4uLy4uLy4uL2RhdGEtdGFibGUubW9kZWwnO1xuaW1wb3J0IHsgVGFibGVUZFNlcnZpY2UgfSBmcm9tICcuL3RkLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9jb21wb25lbnQtc2VsZWN0b3IqL1xuICBzZWxlY3RvcjogJ1tkVGFibGVDZWxsXScsXG4gIHRlbXBsYXRlVXJsOiAnLi90ZC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3RkLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgVGFibGVUZENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xuICBASG9zdEJpbmRpbmcoJ2NsYXNzLmRldnVpLXN0aWNreS1sZWZ0LWNlbGwnKSBzdGlja3lMZWZ0Q2xhc3M6IGJvb2xlYW47XG4gIEBIb3N0QmluZGluZygnY2xhc3MuZGV2dWktc3RpY2t5LXJpZ2h0LWNlbGwnKSBzdGlja3lSaWdodENsYXNzOiBib29sZWFuO1xuICBASG9zdEJpbmRpbmcoJ3N0eWxlLmxlZnQnKSBzdGlja3lMZWZ0U3R5bGU6IHN0cmluZztcbiAgQEhvc3RCaW5kaW5nKCdzdHlsZS5yaWdodCcpIHN0aWNreVJpZ2h0U3R5bGU6IHN0cmluZztcbiAgQElucHV0KCkgZWRpdGFibGU6IGJvb2xlYW47XG4gIEBJbnB1dCgpIGVkaXRhYmxlVGlwID0gRWRpdGFibGVUaXAuaG92ZXI7XG4gIEBJbnB1dCgpIG5lc3RlZENvbHVtbiA9IGZhbHNlO1xuICBASW5wdXQoKSBuZXN0ZWRMYXllcjogbnVtYmVyO1xuICBASW5wdXQoKSBmaWVsZDogc3RyaW5nO1xuICBASW5wdXQoKSByb3dJdGVtOiBhbnk7XG4gIEBJbnB1dCgpIGZpeGVkTGVmdDogc3RyaW5nO1xuICBASW5wdXQoKSBmaXhlZFJpZ2h0OiBzdHJpbmc7XG4gIEBJbnB1dCgpIGljb25Gb2xkVGFibGU6IHN0cmluZztcbiAgQElucHV0KCkgaWNvblVuRm9sZFRhYmxlOiBzdHJpbmc7XG4gIEBJbnB1dCgpIG5lc3RlZENvbHVtbkluZGVudCA9IDE2O1xuICBASW5wdXQoKSBiZWZvcmVFZGl0U3RhcnQ6IChyb3dJdGVtLCBmaWVsZCkgPT4gYm9vbGVhbiB8IFByb21pc2U8Ym9vbGVhbj4gfCBPYnNlcnZhYmxlPGJvb2xlYW4+O1xuICBASW5wdXQoKSBiZWZvcmVFZGl0RW5kOiAocm93SXRlbSwgZmllbGQpID0+IGJvb2xlYW4gfCBQcm9taXNlPGJvb2xlYW4+IHwgT2JzZXJ2YWJsZTxib29sZWFuPjtcbiAgQE91dHB1dCgpIHRvZ2dsZUNoaWxkVGFibGVFdmVudCA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcbiAgQElucHV0KCkgZWRpdGluZzogYm9vbGVhbjtcbiAgQE91dHB1dCgpIGVkaXRTdGF0dXNFdmVudCA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcbiAgLyoqXG4gICAqIOe8lui+keeKtuaAgeiwg+aVtCBAZGVwcmVjYXRlZFxuICAgKi9cbiAgQE91dHB1dCgpIGVkaXRpbmdDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5lZGl0YWJsZS1jZWxsJykgZ2V0IGlzRWRpdGFibGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuZWRpdGFibGUgJiYgIXRoaXMuZWRpdGluZyAmJiB0aGlzLmVkaXRhYmxlVGlwICE9PSAnYnRuJztcbiAgfVxuXG4gIHByaXZhdGUgZG9jdW1lbnRDbGlja1N1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICBwcml2YXRlIHRkTW91c2Vkb3duU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gIHByaXZhdGUgdGRNb3VzZXVwU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gIHByaXZhdGUgY2xpY2tJblRkOiBib29sZWFuO1xuICBwcml2YXRlIHRkQ2xpY2tTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgcHJpdmF0ZSBjdXJyZW50RWRpdGluZyA9IGZhbHNlO1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsIHByaXZhdGUgdGRTZXJ2aWNlOiBUYWJsZVRkU2VydmljZSkgeyB9XG5cbiAgbmdPbkluaXQoKSB7fVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBpZiAoY2hhbmdlc1snZml4ZWRMZWZ0J10pIHtcbiAgICAgIGlmICh0aGlzLmZpeGVkTGVmdCkge1xuICAgICAgICB0aGlzLnN0aWNreUxlZnRDbGFzcyA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RpY2t5TGVmdFN0eWxlID0gdGhpcy5maXhlZExlZnQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnN0aWNreUxlZnRDbGFzcyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnN0aWNreUxlZnRTdHlsZSA9IG51bGw7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGNoYW5nZXNbJ2ZpeGVkUmlnaHQnXSkge1xuICAgICAgaWYgKHRoaXMuZml4ZWRSaWdodCkge1xuICAgICAgICB0aGlzLnN0aWNreVJpZ2h0Q2xhc3MgPSB0cnVlO1xuICAgICAgICB0aGlzLnN0aWNreVJpZ2h0U3R5bGUgPSB0aGlzLmZpeGVkUmlnaHQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnN0aWNreVJpZ2h0Q2xhc3MgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdGlja3lSaWdodFN0eWxlID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoY2hhbmdlc1snZWRpdGluZyddICYmIGNoYW5nZXNbJ2VkaXRpbmcnXS5jdXJyZW50VmFsdWUgJiYgIXRoaXMuY3VycmVudEVkaXRpbmcpIHtcbiAgICAgIHRoaXMuYmluZEVkaXRDbGlja0V2ZW50KCk7XG4gICAgfVxuICB9XG5cbiAgc3RhcnRFZGl0aW5nKGV2ZW50KSB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBsZXQgYmVmb3JlUHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSh0cnVlKTtcbiAgICBpZiAodGhpcy5iZWZvcmVFZGl0U3RhcnQpIHtcbiAgICAgIGNvbnN0IHJlc3VsdDogYW55ID0gdGhpcy5iZWZvcmVFZGl0U3RhcnQodGhpcy5yb3dJdGVtLCB0aGlzLmZpZWxkKTtcbiAgICAgIGlmICh0eXBlb2YgcmVzdWx0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBpZiAocmVzdWx0LnRoZW4pIHtcbiAgICAgICAgICBiZWZvcmVQcm9taXNlID0gcmVzdWx0O1xuICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdC5zdWJzY3JpYmUpIHtcbiAgICAgICAgICBiZWZvcmVQcm9taXNlID0gKHJlc3VsdCBhcyBPYnNlcnZhYmxlPGJvb2xlYW4+KS50b1Byb21pc2UoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBiZWZvcmVQcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBiZWZvcmVQcm9taXNlLnRoZW4oKGNhblN0YXJ0KSA9PiB7XG4gICAgICBpZiAoY2FuU3RhcnQpIHtcbiAgICAgICAgdGhpcy5lZGl0aW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5jdXJyZW50RWRpdGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuZWRpdGluZ0NoYW5nZS5lbWl0KHRydWUpO1xuICAgICAgICB0aGlzLmVkaXRTdGF0dXNFdmVudC5lbWl0KHRydWUpO1xuICAgICAgICB0aGlzLnRkU2VydmljZS50YWJsZUNlbGxDbGlja0V2ZW50LmVtaXQoZXZlbnQpO1xuICAgICAgICB0aGlzLmJpbmRFZGl0Q2xpY2tFdmVudCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgYmluZEVkaXRDbGlja0V2ZW50KCkge1xuICAgIHRoaXMuZG9jdW1lbnRDbGlja1N1YnNjcmlwdGlvbiA9IGZyb21FdmVudChkb2N1bWVudCwgJ2NsaWNrJykucGlwZShcbiAgICAgIHRhcCgoZTogRXZlbnQpID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIH0pXG4gICAgKS5zdWJzY3JpYmUoKGNsaWNrRXZlbnQpID0+IHtcbiAgICAgIGlmICghdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoY2xpY2tFdmVudC50YXJnZXQpICYmICF0aGlzLmNsaWNrSW5UZCkge1xuICAgICAgICB0aGlzLmZpbmlzaENlbGxFZGl0KCk7XG4gICAgICB9XG4gICAgICB0aGlzLmNsaWNrSW5UZCA9IGZhbHNlO1xuICAgIH0pO1xuICAgIHRoaXMudGRNb3VzZWRvd25TdWJzY3JpcHRpb24gPSBmcm9tRXZlbnQodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWRvd24nKS5zdWJzY3JpYmUoZXZlbnQgPT4ge1xuICAgICAgdGhpcy5jbGlja0luVGQgPSB0cnVlO1xuICAgIH0pO1xuXG4gICAgdGhpcy50ZE1vdXNldXBTdWJzY3JpcHRpb24gPSBmcm9tRXZlbnQodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdtb3VzZXVwJykuc3Vic2NyaWJlKGV2ZW50ID0+IHtcbiAgICAgIHRoaXMuY2xpY2tJblRkID0gZmFsc2U7XG4gICAgfSk7XG5cbiAgICB0aGlzLnRkQ2xpY2tTdWJzY3JpcHRpb24gPSB0aGlzLnRkU2VydmljZS50YWJsZUNlbGxDbGlja0V2ZW50LnN1YnNjcmliZSgoY2xpY2tFdmVudCkgPT4ge1xuICAgICAgaWYgKCF0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jb250YWlucyhjbGlja0V2ZW50LnRhcmdldCkpIHtcbiAgICAgICAgdGhpcy5maW5pc2hDZWxsRWRpdCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcmVtb3ZlRWRpdENsaWNrRXZlbnQoKSB7XG4gICAgaWYgKHRoaXMuZG9jdW1lbnRDbGlja1N1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy5kb2N1bWVudENsaWNrU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICB0aGlzLmRvY3VtZW50Q2xpY2tTdWJzY3JpcHRpb24gPSBudWxsO1xuICAgIH1cbiAgICBpZiAodGhpcy50ZENsaWNrU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLnRkQ2xpY2tTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgIHRoaXMudGRDbGlja1N1YnNjcmlwdGlvbiA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgZmluaXNoQ2VsbEVkaXQoKSB7XG4gICAgbGV0IGJlZm9yZVByb21pc2UgPSBQcm9taXNlLnJlc29sdmUodHJ1ZSk7XG4gICAgaWYgKHRoaXMuYmVmb3JlRWRpdEVuZCkge1xuICAgICAgY29uc3QgcmVzdWx0OiBhbnkgPSB0aGlzLmJlZm9yZUVkaXRFbmQodGhpcy5yb3dJdGVtLCB0aGlzLmZpZWxkKTtcbiAgICAgIGlmICh0eXBlb2YgcmVzdWx0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBpZiAocmVzdWx0LnRoZW4pIHtcbiAgICAgICAgICBiZWZvcmVQcm9taXNlID0gcmVzdWx0O1xuICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdC5zdWJzY3JpYmUpIHtcbiAgICAgICAgICBiZWZvcmVQcm9taXNlID0gKHJlc3VsdCBhcyBPYnNlcnZhYmxlPGJvb2xlYW4+KS50b1Byb21pc2UoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBiZWZvcmVQcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgYmVmb3JlUHJvbWlzZS50aGVuKChjYW5FbmQpID0+IHtcbiAgICAgIGlmIChjYW5FbmQpIHtcbiAgICAgICAgdGhpcy5lZGl0aW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY3VycmVudEVkaXRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5lZGl0aW5nQ2hhbmdlLmVtaXQoZmFsc2UpO1xuICAgICAgICB0aGlzLmVkaXRTdGF0dXNFdmVudC5lbWl0KGZhbHNlKTtcbiAgICAgICAgdGhpcy5yZW1vdmVFZGl0Q2xpY2tFdmVudCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgdG9nZ2xlQ2hpbGRUYWJsZShyb3dJdGVtKSB7XG4gICAgcm93SXRlbS4kaXNDaGlsZFRhYmxlT3BlbiA9ICFyb3dJdGVtLiRpc0NoaWxkVGFibGVPcGVuO1xuICAgIHRoaXMudG9nZ2xlQ2hpbGRUYWJsZUV2ZW50LmVtaXQocm93SXRlbS4kaXNDaGlsZFRhYmxlT3Blbik7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5kb2N1bWVudENsaWNrU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLmRvY3VtZW50Q2xpY2tTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgIHRoaXMuZG9jdW1lbnRDbGlja1N1YnNjcmlwdGlvbiA9IG51bGw7XG4gICAgfVxuICAgIGlmICh0aGlzLnRkQ2xpY2tTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMudGRDbGlja1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy50ZENsaWNrU3Vic2NyaXB0aW9uID0gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy50ZE1vdXNlZG93blN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy50ZE1vdXNlZG93blN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy50ZE1vdXNlZG93blN1YnNjcmlwdGlvbiA9IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMudGRNb3VzZXVwU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLnRkTW91c2V1cFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy50ZE1vdXNldXBTdWJzY3JpcHRpb24gPSBudWxsO1xuICAgIH1cbiAgfVxufVxuIiwiPG5nLWNvbnRhaW5lciAqbmdJZj1cImVkaXRhYmxlICYmICFlZGl0aW5nXCI+XG4gIDxkaXYgKm5nSWY9XCJlZGl0YWJsZVRpcCA9PT0gJ2J0bidcIiBjbGFzcz1cImNlbGwtY29udGFpbmVyXCI+XG4gICAgPGRpdiBjbGFzcz1cImNlbGwtY29udGFpbmVyLWlubmVyIG5vdC1icmVhayBtb2RpZnktaG9sZGVyXCI+XG4gICAgICA8bmctdGVtcGxhdGVcbiAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwibmVzdGVkVG1wXCJcbiAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRDb250ZXh0XT1cInsgbmVzdGVkQ29sdW1uOiBuZXN0ZWRDb2x1bW4sIHJvd0l0ZW06IHJvd0l0ZW0sIG5lc3RlZExheWVyOiBuZXN0ZWRMYXllciB9XCJcbiAgICAgID48L25nLXRlbXBsYXRlPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cImNvbnRlbnRcIj48L25nLWNvbnRhaW5lcj5cbiAgICAgIDxzcGFuIGNsYXNzPVwiY2VsbC1tb2RpZnlcIiAoY2xpY2spPVwic3RhcnRFZGl0aW5nKCRldmVudClcIj5cbiAgICAgICAgPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgdmlld0JveD1cIjAgMCAxNiAxNlwiIHdpZHRoPVwiMTZweFwiIGhlaWdodD1cIjE2cHhcIiB2ZXJzaW9uPVwiMS4xXCI+XG4gICAgICAgICAgPGcgZmlsbD1cIm5vbmVcIiBmaWxsLXJ1bGU9XCJldmVub2RkXCIgc3Ryb2tlPVwibm9uZVwiIHN0cm9rZS13aWR0aD1cIjFcIj5cbiAgICAgICAgICAgIDxwYXRoXG4gICAgICAgICAgICAgIGQ9XCJNIDkuNDg1MjggMy40MTQyMSBMIDEwLjg5OTUgMiBMIDEzLjcyNzkgNC44Mjg0MyBMIDEyLjMxMzcgNi4yNDI2NCBMIDkuNDg1MjggMy40MTQyMSBaIE0gNS4yNDI2NCAxMy4zMTM3IEwgMi40MTQyMSAxMy4zMTM3IEwgMi40MTQyMSAxMC40ODUzIEwgOC43NzgxNyA0LjEyMTMyIEwgMTEuNjA2NiA2Ljk0OTc1IEwgNS4yNDI2NCAxMy4zMTM3IFpcIlxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L2c+XG4gICAgICAgIDwvc3ZnPlxuICAgICAgPC9zcGFuPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cblxuICA8ZGl2ICpuZ0lmPVwiZWRpdGFibGVUaXAgIT09ICdidG4nXCIgY2xhc3M9XCJjZWxsLWVkaXRhYmxlIG5vdC1icmVha1wiIChjbGljayk9XCJzdGFydEVkaXRpbmcoJGV2ZW50KVwiPlxuICAgIDxuZy10ZW1wbGF0ZVxuICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwibmVzdGVkVG1wXCJcbiAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0Q29udGV4dF09XCJ7IG5lc3RlZENvbHVtbjogbmVzdGVkQ29sdW1uLCByb3dJdGVtOiByb3dJdGVtLCBuZXN0ZWRMYXllcjogbmVzdGVkTGF5ZXIgfVwiXG4gICAgPjwvbmctdGVtcGxhdGU+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cImNvbnRlbnRcIj48L25nLWNvbnRhaW5lcj5cbiAgPC9kaXY+XG48L25nLWNvbnRhaW5lcj5cblxuPG5nLWNvbnRhaW5lciAqbmdJZj1cIiFlZGl0YWJsZSB8fCBlZGl0aW5nXCI+XG4gIDxuZy10ZW1wbGF0ZVxuICAgIFtuZ1RlbXBsYXRlT3V0bGV0XT1cIm5lc3RlZFRtcFwiXG4gICAgW25nVGVtcGxhdGVPdXRsZXRDb250ZXh0XT1cInsgbmVzdGVkQ29sdW1uOiBuZXN0ZWRDb2x1bW4sIHJvd0l0ZW06IHJvd0l0ZW0sIG5lc3RlZExheWVyOiBuZXN0ZWRMYXllciB9XCJcbiAgPjwvbmctdGVtcGxhdGU+XG4gIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJjb250ZW50XCI+PC9uZy1jb250YWluZXI+XG48L25nLWNvbnRhaW5lcj5cblxuPG5nLXRlbXBsYXRlICNjb250ZW50PjxuZy1jb250ZW50PjwvbmctY29udGVudD48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgI25lc3RlZFRtcCBsZXQtbmVzdGVkQ29sdW1uPVwibmVzdGVkQ29sdW1uXCIgbGV0LXJvd0l0ZW09XCJyb3dJdGVtXCIgbGV0LW5lc3RlZExheWVyPVwibmVzdGVkTGF5ZXJcIj5cbiAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIm5lc3RlZENvbHVtblwiPlxuICAgIDxzcGFuICpuZ0lmPVwibmVzdGVkTGF5ZXIgPiAwXCIgY2xhc3M9XCJjZWxsLXBsYWNlaG9sZGVyXCIgW25nU3R5bGVdPVwieyB3aWR0aDogbmVzdGVkTGF5ZXIgKiBuZXN0ZWRDb2x1bW5JbmRlbnQgKyAncHgnIH1cIj48L3NwYW4+XG4gICAgPHNwYW4gW3N0eWxlLnZpc2liaWxpdHldPVwicm93SXRlbS5jaGlsZHJlbiA/ICd2aXNpYmxlJyA6ICdoaWRkZW4nXCIgY2xhc3M9XCJjaGlsZHRhYmxlLXRvZ2dsZXJcIiAoY2xpY2spPVwidG9nZ2xlQ2hpbGRUYWJsZShyb3dJdGVtKVwiPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInJvd0l0ZW1bJyRpc0NoaWxkVGFibGVPcGVuJ11cIj5cbiAgICAgICAgPHN2Z1xuICAgICAgICAgICpuZ0lmPVwiIWljb25Gb2xkVGFibGVcIlxuICAgICAgICAgIHdpZHRoPVwiMTZweFwiXG4gICAgICAgICAgaGVpZ2h0PVwiMTZweFwiXG4gICAgICAgICAgdmlld0JveD1cIjAgMCAxNiAxNlwiXG4gICAgICAgICAgdmVyc2lvbj1cIjEuMVwiXG4gICAgICAgICAgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiXG4gICAgICAgICAgeG1sbnM6eGxpbms9XCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rXCJcbiAgICAgICAgICBjbGFzcz1cInN2Zy1pY29uIHN2Zy1pY29uLWNsb3NlXCJcbiAgICAgICAgPlxuICAgICAgICAgIDxnIHN0cm9rZT1cIm5vbmVcIiBzdHJva2Utd2lkdGg9XCIxXCIgZmlsbD1cIm5vbmVcIiBmaWxsLXJ1bGU9XCJldmVub2RkXCI+XG4gICAgICAgICAgICA8cmVjdCB4PVwiMC41XCIgeT1cIjAuNVwiIHdpZHRoPVwiMTVcIiBoZWlnaHQ9XCIxNVwiIHJ4PVwiMlwiPjwvcmVjdD5cbiAgICAgICAgICAgIDxyZWN0IHg9XCI0XCIgeT1cIjdcIiB3aWR0aD1cIjhcIiBoZWlnaHQ9XCIyXCI+PC9yZWN0PlxuICAgICAgICAgIDwvZz5cbiAgICAgICAgPC9zdmc+XG4gICAgICAgIDxzcGFuICpuZ0lmPVwiaWNvbkZvbGRUYWJsZVwiIFtpbm5lckhUTUxdPVwiaWNvbkZvbGRUYWJsZSB8IHNhZmU6ICdodG1sJ1wiPjwvc3Bhbj5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIiFyb3dJdGVtWyckaXNDaGlsZFRhYmxlT3BlbiddXCI+XG4gICAgICAgIDxzdmdcbiAgICAgICAgICAqbmdJZj1cIiFpY29uVW5Gb2xkVGFibGVcIlxuICAgICAgICAgIHdpZHRoPVwiMTZweFwiXG4gICAgICAgICAgaGVpZ2h0PVwiMTZweFwiXG4gICAgICAgICAgdmlld0JveD1cIjAgMCAxNiAxNlwiXG4gICAgICAgICAgdmVyc2lvbj1cIjEuMVwiXG4gICAgICAgICAgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiXG4gICAgICAgICAgeG1sbnM6eGxpbms9XCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rXCJcbiAgICAgICAgICBjbGFzcz1cInN2Zy1pY29uIHN2Zy1pY29uLW9wZW4tZm9sZGVyXCJcbiAgICAgICAgPlxuICAgICAgICAgIDxnIHN0cm9rZT1cIm5vbmVcIiBzdHJva2Utd2lkdGg9XCIxXCIgZmlsbD1cIm5vbmVcIiBmaWxsLXJ1bGU9XCJldmVub2RkXCI+XG4gICAgICAgICAgICA8cmVjdCB4PVwiMC41XCIgeT1cIjAuNVwiIHdpZHRoPVwiMTVcIiBoZWlnaHQ9XCIxNVwiIHJ4PVwiMlwiPjwvcmVjdD5cbiAgICAgICAgICAgIDxwYXRoXG4gICAgICAgICAgICAgIGQ9XCJNOC43NSw0IEw4Ljc1LDcuMjUgTDEyLDcuMjUgTDEyLDguNzUgTDguNzQ5LDguNzUgTDguNzUsMTIgTDcuMjUsMTIgTDcuMjQ5LDguNzUgTDQsOC43NSBMNCw3LjI1IEw3LjI1LDcuMjUgTDcuMjUsNCBMOC43NSw0IFpcIlxuICAgICAgICAgICAgPjwvcGF0aD5cbiAgICAgICAgICA8L2c+XG4gICAgICAgIDwvc3ZnPlxuICAgICAgICA8c3BhbiAqbmdJZj1cImljb25VbkZvbGRUYWJsZVwiIFtpbm5lckhUTUxdPVwiaWNvblVuRm9sZFRhYmxlIHwgc2FmZTogJ2h0bWwnXCI+PC9zcGFuPlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgPC9zcGFuPlxuICA8L25nLWNvbnRhaW5lcj5cbjwvbmctdGVtcGxhdGU+XG4iXX0=