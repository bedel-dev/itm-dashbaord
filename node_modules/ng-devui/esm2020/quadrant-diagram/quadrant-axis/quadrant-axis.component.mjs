import { ChangeDetectionStrategy, Component, ElementRef, Input } from '@angular/core';
import { AXIS_TITLE_SPACE } from '../quadrant.config';
import * as i0 from "@angular/core";
export class QuadrantDiagramAxisComponent {
    constructor(elementRef) {
        this.elementRef = elementRef;
        this.refreshColor = () => {
            if (this.themeService) {
                this.AXIS_COLOR = this.themeService.currentTheme.data['devui-dividing-line'];
                this.AXIS_LABEL_COLOR = this.themeService.currentTheme.data['devui-aide-text'];
            }
            this.resetAxis();
        };
    }
    ngOnChanges(changes) {
        if (changes && (changes['axisConfigs'] || changes['view'])) {
            this.resetAxis();
        }
    }
    ngOnInit() {
        if (typeof window !== 'undefined') {
            this.themeService = window['devuiThemeService'];
            if (this.themeService && this.themeService.eventBus) {
                this.themeService.eventBus.add('themeChanged', this.refreshColor);
            }
            this.refreshColor();
        }
    }
    resetAxis() {
        this.initAxisData();
        this.setAxisData();
        this.drawAxis();
        this.drawAxisLabels();
    }
    initAxisData() {
        this.quadrantAxis = this.elementRef.nativeElement.querySelector('d-quadrant-diagram#' + this.diagramId + ' canvas');
        this.quadrantAxis.width = this.view.width;
        this.quadrantAxis.height = this.view.height;
    }
    setAxisData() {
        this.context = this.quadrantAxis.getContext('2d');
        this.axisOrigin = this.axisConfigs.axisOrigin;
        this.axisTop = this.axisConfigs.axisTop;
        this.axisRight = this.axisConfigs.axisRight;
        this.axisWidth = this.axisConfigs.axisWidth;
        this.axisHeight = this.axisConfigs.axisHeight;
        this.yAxisTicksNum = this.axisConfigs.yAxisTicksNum;
        this.xAxisTicksNum = this.axisConfigs.xAxisTicksNum;
        this.xTickSpacing = this.axisConfigs.xTickSpacing;
        this.yTickSpacing = this.axisConfigs.yTickSpacing;
    }
    drawAxis() {
        this.context.save();
        this.context.fillStyle = this.AXIS_COLOR;
        this.context.strokeStyle = this.AXIS_COLOR;
        this.drawXAxis();
        this.drawYAxis();
        this.context.lineWidth = 0.5;
        this.drawYAxisTicks();
        this.drawXAxisTicks();
        this.context.restore();
    }
    drawXAxisTicks() {
        let deltaY;
        for (let i = 1; i < this.xAxisTicksNum; i++) {
            this.context.beginPath();
            // 判断显示长刻度还是短刻度
            if (i % this.axisConfigs.xAxisRange.step === 0) {
                deltaY = this.axisConfigs.tickWidth;
            }
            else {
                deltaY = this.axisConfigs.tickWidth / 2;
            }
            this.context.moveTo(this.axisOrigin.x + i * this.xTickSpacing, this.axisOrigin.y - deltaY);
            this.context.lineTo(this.axisOrigin.x + i * this.xTickSpacing, this.axisOrigin.y + deltaY);
            this.context.stroke();
        }
    }
    drawYAxisTicks() {
        let deltaX;
        for (let i = 1; i < this.yAxisTicksNum; i++) {
            this.context.beginPath();
            if (i % this.axisConfigs.yAxisRange.step === 0) {
                deltaX = this.axisConfigs.tickWidth;
            }
            else {
                deltaX = this.axisConfigs.tickWidth / 2;
            }
            this.context.moveTo(this.axisOrigin.x - deltaX, this.axisOrigin.y - i * this.yTickSpacing);
            this.context.lineTo(this.axisOrigin.x + deltaX, this.axisOrigin.y - i * this.yTickSpacing);
            this.context.stroke();
        }
    }
    drawYAxis() {
        this.context.beginPath();
        this.context.moveTo(this.axisOrigin.x, this.axisOrigin.y);
        this.context.lineTo(this.axisOrigin.x, this.axisTop - this.axisConfigs.axisMargin);
        this.context.stroke();
        this.context.moveTo(this.axisOrigin.x, this.axisTop - this.axisConfigs.axisMargin);
        this.context.lineTo(this.axisOrigin.x + 5, this.axisTop - this.axisConfigs.axisMargin + 10);
        this.context.lineTo(this.axisOrigin.x - 5, this.axisTop - this.axisConfigs.axisMargin + 10);
        this.context.fill();
    }
    drawXAxis() {
        this.context.beginPath();
        this.context.moveTo(this.axisOrigin.x, this.axisOrigin.y);
        this.context.lineTo(this.axisRight + this.axisConfigs.axisMargin - 10, this.axisOrigin.y);
        this.context.stroke();
        // 绘制坐标轴三角形
        this.context.moveTo(this.axisRight + this.axisConfigs.axisMargin, this.axisOrigin.y);
        this.context.lineTo(this.axisRight + this.axisConfigs.axisMargin - 10, this.axisOrigin.y + 5);
        this.context.lineTo(this.axisRight + this.axisConfigs.axisMargin - 10, this.axisOrigin.y - 5);
        this.context.fill();
    }
    drawAxisLabels() {
        this.context.save();
        this.context.fillStyle = this.AXIS_LABEL_COLOR;
        this.drawXTicksLabels();
        this.drawYTicksLabels();
        this.context.restore();
        this.drawAxisTitle();
    }
    drawAxisTitle() {
        this.context.font = '12px Microsoft YaHei';
        this.context.textAlign = 'left';
        this.context.fillStyle = this.AXIS_LABEL_COLOR;
        const xLabelWidth = this.context.measureText(this.axisConfigs.xAxisLabel).width;
        this.rotateLabel(this.axisConfigs.xAxisLabel, this.axisRight + this.axisConfigs.axisMargin / 2, this.axisOrigin.y - xLabelWidth - AXIS_TITLE_SPACE);
        this.context.fillText(this.axisConfigs.yAxisLabel, this.axisOrigin.x + AXIS_TITLE_SPACE, this.axisTop - this.axisConfigs.axisMargin / 2);
    }
    drawXTicksLabels() {
        this.context.textAlign = 'center';
        this.context.textBaseline = 'top';
        for (let i = 0; i <= this.xAxisTicksNum; i++) {
            if (i % this.axisConfigs.xAxisRange.step === 0) {
                this.context.fillText(i, this.axisOrigin.x + i * this.xTickSpacing, this.axisOrigin.y + this.axisConfigs.spaceBetweenLabelsAxis);
            }
        }
    }
    drawYTicksLabels() {
        this.context.textAlign = 'center';
        this.context.textBaseline = 'middle';
        for (let i = 0; i <= this.yAxisTicksNum; i++) {
            if (i % this.axisConfigs.yAxisRange.step === 0) {
                this.context.fillText(i, this.axisOrigin.x - this.axisConfigs.spaceBetweenLabelsAxis, this.axisOrigin.y - i * this.yTickSpacing);
            }
        }
    }
    rotateLabel(name, x, y) {
        for (let i = 0; i < name.length; i++) {
            const str = name.slice(i, i + 1).toString();
            if (str.match(/[A-Za-z0-9]/)) {
                this.context.save();
                this.context.translate(x, y);
                this.context.rotate(Math.PI / 180 * 90);
                this.context.textBaseline = 'bottom';
                this.context.fillText(str, 0, 0);
                this.context.restore();
                y += this.context.measureText(str).width;
            }
            else if (str.match(/[\u4E00-\u9FA5]/)) {
                this.context.save();
                this.context.textBaseline = 'top';
                this.context.fillText(str, x, y);
                this.context.restore();
                y += this.context.measureText(str).width;
            }
        }
    }
}
QuadrantDiagramAxisComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: QuadrantDiagramAxisComponent, deps: [{ token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component });
QuadrantDiagramAxisComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.3", type: QuadrantDiagramAxisComponent, selector: "d-quadrant-axis", inputs: { axisConfigs: "axisConfigs", view: "view", diagramId: "diagramId" }, usesOnChanges: true, ngImport: i0, template: "<canvas id=\"devui-quadrant-axis\"></canvas>\n", styles: ["canvas{position:absolute;z-index:1}\n"], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: QuadrantDiagramAxisComponent, decorators: [{
            type: Component,
            args: [{ selector: 'd-quadrant-axis', changeDetection: ChangeDetectionStrategy.OnPush, template: "<canvas id=\"devui-quadrant-axis\"></canvas>\n", styles: ["canvas{position:absolute;z-index:1}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }]; }, propDecorators: { axisConfigs: [{
                type: Input
            }], view: [{
                type: Input
            }], diagramId: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVhZHJhbnQtYXhpcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9kZXZ1aS9xdWFkcmFudC1kaWFncmFtL3F1YWRyYW50LWF4aXMvcXVhZHJhbnQtYXhpcy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9kZXZ1aS9xdWFkcmFudC1kaWFncmFtL3F1YWRyYW50LWF4aXMvcXVhZHJhbnQtYXhpcy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQW9DLE1BQU0sZUFBZSxDQUFDO0FBR3hILE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLG9CQUFvQixDQUFDOztBQVF0RCxNQUFNLE9BQU8sNEJBQTRCO0lBa0J2QyxZQUFvQixVQUFzQjtRQUF0QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBZ0IxQyxpQkFBWSxHQUFHLEdBQUcsRUFBRTtZQUNsQixJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7Z0JBQ3JCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUM7Z0JBQzdFLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQzthQUNoRjtZQUNELElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNuQixDQUFDLENBQUM7SUF0QjRDLENBQUM7SUFDL0MsV0FBVyxDQUFDLE9BQXNCO1FBQ2hDLElBQUksT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFO1lBQzFELElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztTQUNsQjtJQUNILENBQUM7SUFDRCxRQUFRO1FB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QUNsQyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUNqQyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO2dCQUN2QixDQUFDLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDO2FBQzFDO1NBQ0Y7SUFDSCxDQUFDOzt5SEFqTVUsNEJBQTRCOzZHQUE1Qiw0QkFBNEIsMEpDWHpDLGdEQUNBOzJGRFVhLDRCQUE0QjtrQkFOeEMsU0FBUzsrQkFDRSxpQkFBaUIsbUJBQ1YsdUJBQXVCLENBQUMsTUFBTTtpR0FLdEMsV0FBVztzQkFBbkIsS0FBSztnQkFDRyxJQUFJO3NCQUFaLEtBQUs7Z0JBQ0csU0FBUztzQkFBakIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIElucHV0LCBPbkNoYW5nZXMsIE9uSW5pdCwgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVGhlbWVTZXJ2aWNlIH0gZnJvbSAnbmctZGV2dWkvdGhlbWUnO1xuaW1wb3J0IHsgSUF4aXNDb25maWdzLCBJVmlld0NvbmZpZ3MgfSBmcm9tICcuLi9xdWFkcmFudC1kaWFncmFtLnR5cGUnO1xuaW1wb3J0IHsgQVhJU19USVRMRV9TUEFDRSB9IGZyb20gJy4uL3F1YWRyYW50LmNvbmZpZyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2QtcXVhZHJhbnQtYXhpcycsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICB0ZW1wbGF0ZVVybDogJy4vcXVhZHJhbnQtYXhpcy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3F1YWRyYW50LWF4aXMuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBRdWFkcmFudERpYWdyYW1BeGlzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuICBASW5wdXQoKSBheGlzQ29uZmlnczogSUF4aXNDb25maWdzO1xuICBASW5wdXQoKSB2aWV3OiBJVmlld0NvbmZpZ3M7XG4gIEBJbnB1dCgpIGRpYWdyYW1JZDtcbiAgcXVhZHJhbnRBeGlzOiBhbnk7XG4gIGNvbnRleHQ6IGFueTtcbiAgYXhpc09yaWdpbjogYW55O1xuICBheGlzVG9wOiBudW1iZXI7XG4gIGF4aXNSaWdodDogbnVtYmVyO1xuICBheGlzV2lkdGg6IG51bWJlcjtcbiAgYXhpc0hlaWdodDogbnVtYmVyO1xuICB5QXhpc1RpY2tzTnVtOiBudW1iZXI7XG4gIHhBeGlzVGlja3NOdW06IG51bWJlcjtcbiAgeFRpY2tTcGFjaW5nOiBudW1iZXI7XG4gIHlUaWNrU3BhY2luZzogbnVtYmVyO1xuICBwcml2YXRlIEFYSVNfQ09MT1I7XG4gIHByaXZhdGUgQVhJU19MQUJFTF9DT0xPUjtcbiAgdGhlbWVTZXJ2aWNlOiBUaGVtZVNlcnZpY2U7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZikgeyB9XG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBpZiAoY2hhbmdlcyAmJiAoY2hhbmdlc1snYXhpc0NvbmZpZ3MnXSB8fCBjaGFuZ2VzWyd2aWV3J10pKSB7XG4gICAgICB0aGlzLnJlc2V0QXhpcygpO1xuICAgIH1cbiAgfVxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRoaXMudGhlbWVTZXJ2aWNlID0gd2luZG93WydkZXZ1aVRoZW1lU2VydmljZSddO1xuICAgICAgaWYgKHRoaXMudGhlbWVTZXJ2aWNlICYmIHRoaXMudGhlbWVTZXJ2aWNlLmV2ZW50QnVzKSB7XG4gICAgICAgIHRoaXMudGhlbWVTZXJ2aWNlLmV2ZW50QnVzLmFkZCgndGhlbWVDaGFuZ2VkJywgdGhpcy5yZWZyZXNoQ29sb3IpO1xuICAgICAgfVxuICAgICAgdGhpcy5yZWZyZXNoQ29sb3IoKTtcbiAgICB9XG4gIH1cblxuICByZWZyZXNoQ29sb3IgPSAoKSA9PiB7XG4gICAgaWYgKHRoaXMudGhlbWVTZXJ2aWNlKSB7XG4gICAgICB0aGlzLkFYSVNfQ09MT1IgPSB0aGlzLnRoZW1lU2VydmljZS5jdXJyZW50VGhlbWUuZGF0YVsnZGV2dWktZGl2aWRpbmctbGluZSddO1xuICAgICAgdGhpcy5BWElTX0xBQkVMX0NPTE9SID0gdGhpcy50aGVtZVNlcnZpY2UuY3VycmVudFRoZW1lLmRhdGFbJ2RldnVpLWFpZGUtdGV4dCddO1xuICAgIH1cbiAgICB0aGlzLnJlc2V0QXhpcygpO1xuICB9O1xuXG4gIHJlc2V0QXhpcygpIHtcbiAgICB0aGlzLmluaXRBeGlzRGF0YSgpO1xuICAgIHRoaXMuc2V0QXhpc0RhdGEoKTtcbiAgICB0aGlzLmRyYXdBeGlzKCk7XG4gICAgdGhpcy5kcmF3QXhpc0xhYmVscygpO1xuICB9XG5cbiAgaW5pdEF4aXNEYXRhKCkge1xuICAgIHRoaXMucXVhZHJhbnRBeGlzID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignZC1xdWFkcmFudC1kaWFncmFtIycgKyB0aGlzLmRpYWdyYW1JZCArICcgY2FudmFzJyk7XG4gICAgdGhpcy5xdWFkcmFudEF4aXMud2lkdGggPSB0aGlzLnZpZXcud2lkdGg7XG4gICAgdGhpcy5xdWFkcmFudEF4aXMuaGVpZ2h0ID0gdGhpcy52aWV3LmhlaWdodDtcblxuICB9XG4gIHNldEF4aXNEYXRhKCkge1xuICAgIHRoaXMuY29udGV4dCA9IHRoaXMucXVhZHJhbnRBeGlzLmdldENvbnRleHQoJzJkJyk7XG4gICAgdGhpcy5heGlzT3JpZ2luID0gdGhpcy5heGlzQ29uZmlncy5heGlzT3JpZ2luO1xuICAgIHRoaXMuYXhpc1RvcCA9IHRoaXMuYXhpc0NvbmZpZ3MuYXhpc1RvcDtcbiAgICB0aGlzLmF4aXNSaWdodCA9IHRoaXMuYXhpc0NvbmZpZ3MuYXhpc1JpZ2h0O1xuICAgIHRoaXMuYXhpc1dpZHRoID0gdGhpcy5heGlzQ29uZmlncy5heGlzV2lkdGg7XG4gICAgdGhpcy5heGlzSGVpZ2h0ID0gdGhpcy5heGlzQ29uZmlncy5heGlzSGVpZ2h0O1xuICAgIHRoaXMueUF4aXNUaWNrc051bSA9IHRoaXMuYXhpc0NvbmZpZ3MueUF4aXNUaWNrc051bTtcbiAgICB0aGlzLnhBeGlzVGlja3NOdW0gPSB0aGlzLmF4aXNDb25maWdzLnhBeGlzVGlja3NOdW07XG4gICAgdGhpcy54VGlja1NwYWNpbmcgPSB0aGlzLmF4aXNDb25maWdzLnhUaWNrU3BhY2luZztcbiAgICB0aGlzLnlUaWNrU3BhY2luZyA9IHRoaXMuYXhpc0NvbmZpZ3MueVRpY2tTcGFjaW5nO1xuICB9XG4gIGRyYXdBeGlzKCkge1xuICAgIHRoaXMuY29udGV4dC5zYXZlKCk7XG4gICAgdGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9IHRoaXMuQVhJU19DT0xPUjtcbiAgICB0aGlzLmNvbnRleHQuc3Ryb2tlU3R5bGUgPSB0aGlzLkFYSVNfQ09MT1I7XG4gICAgdGhpcy5kcmF3WEF4aXMoKTtcbiAgICB0aGlzLmRyYXdZQXhpcygpO1xuICAgIHRoaXMuY29udGV4dC5saW5lV2lkdGggPSAwLjU7XG4gICAgdGhpcy5kcmF3WUF4aXNUaWNrcygpO1xuICAgIHRoaXMuZHJhd1hBeGlzVGlja3MoKTtcbiAgICB0aGlzLmNvbnRleHQucmVzdG9yZSgpO1xuICB9XG4gIGRyYXdYQXhpc1RpY2tzKCkge1xuICAgIGxldCBkZWx0YVk7XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0aGlzLnhBeGlzVGlja3NOdW07IGkrKykge1xuICAgICAgdGhpcy5jb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgICAgLy8g5Yik5pat5pi+56S66ZW/5Yi75bqm6L+Y5piv55+t5Yi75bqmXG4gICAgICBpZiAoaSAlIHRoaXMuYXhpc0NvbmZpZ3MueEF4aXNSYW5nZS5zdGVwID09PSAwKSB7XG4gICAgICAgIGRlbHRhWSA9IHRoaXMuYXhpc0NvbmZpZ3MudGlja1dpZHRoO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGVsdGFZID0gdGhpcy5heGlzQ29uZmlncy50aWNrV2lkdGggLyAyO1xuICAgICAgfVxuICAgICAgdGhpcy5jb250ZXh0Lm1vdmVUbyh0aGlzLmF4aXNPcmlnaW4ueCArIGkgKiB0aGlzLnhUaWNrU3BhY2luZyxcbiAgICAgICAgdGhpcy5heGlzT3JpZ2luLnkgLSBkZWx0YVkpO1xuICAgICAgdGhpcy5jb250ZXh0LmxpbmVUbyh0aGlzLmF4aXNPcmlnaW4ueCArIGkgKiB0aGlzLnhUaWNrU3BhY2luZyxcbiAgICAgICAgdGhpcy5heGlzT3JpZ2luLnkgKyBkZWx0YVkpO1xuICAgICAgdGhpcy5jb250ZXh0LnN0cm9rZSgpO1xuICAgIH1cblxuICB9XG4gIGRyYXdZQXhpc1RpY2tzKCkge1xuICAgIGxldCBkZWx0YVg7XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0aGlzLnlBeGlzVGlja3NOdW07IGkrKykge1xuICAgICAgdGhpcy5jb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgICAgaWYgKGkgJSB0aGlzLmF4aXNDb25maWdzLnlBeGlzUmFuZ2Uuc3RlcCA9PT0gMCkge1xuICAgICAgICBkZWx0YVggPSB0aGlzLmF4aXNDb25maWdzLnRpY2tXaWR0aDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRlbHRhWCA9IHRoaXMuYXhpc0NvbmZpZ3MudGlja1dpZHRoIC8gMjtcbiAgICAgIH1cbiAgICAgIHRoaXMuY29udGV4dC5tb3ZlVG8odGhpcy5heGlzT3JpZ2luLnggLSBkZWx0YVgsXG4gICAgICAgIHRoaXMuYXhpc09yaWdpbi55IC0gaSAqIHRoaXMueVRpY2tTcGFjaW5nKTtcbiAgICAgIHRoaXMuY29udGV4dC5saW5lVG8odGhpcy5heGlzT3JpZ2luLnggKyBkZWx0YVgsXG4gICAgICAgIHRoaXMuYXhpc09yaWdpbi55IC0gaSAqIHRoaXMueVRpY2tTcGFjaW5nKTtcbiAgICAgIHRoaXMuY29udGV4dC5zdHJva2UoKTtcbiAgICB9XG4gIH1cbiAgZHJhd1lBeGlzKCkge1xuICAgIHRoaXMuY29udGV4dC5iZWdpblBhdGgoKTtcbiAgICB0aGlzLmNvbnRleHQubW92ZVRvKHRoaXMuYXhpc09yaWdpbi54LCB0aGlzLmF4aXNPcmlnaW4ueSk7XG4gICAgdGhpcy5jb250ZXh0LmxpbmVUbyh0aGlzLmF4aXNPcmlnaW4ueCwgdGhpcy5heGlzVG9wIC0gdGhpcy5heGlzQ29uZmlncy5heGlzTWFyZ2luKTtcbiAgICB0aGlzLmNvbnRleHQuc3Ryb2tlKCk7XG4gICAgdGhpcy5jb250ZXh0Lm1vdmVUbyh0aGlzLmF4aXNPcmlnaW4ueCwgdGhpcy5heGlzVG9wIC0gdGhpcy5heGlzQ29uZmlncy5heGlzTWFyZ2luKTtcbiAgICB0aGlzLmNvbnRleHQubGluZVRvKHRoaXMuYXhpc09yaWdpbi54ICsgNSwgdGhpcy5heGlzVG9wIC0gdGhpcy5heGlzQ29uZmlncy5heGlzTWFyZ2luICsgMTApO1xuICAgIHRoaXMuY29udGV4dC5saW5lVG8odGhpcy5heGlzT3JpZ2luLnggLSA1LCB0aGlzLmF4aXNUb3AgLSB0aGlzLmF4aXNDb25maWdzLmF4aXNNYXJnaW4gKyAxMCk7XG4gICAgdGhpcy5jb250ZXh0LmZpbGwoKTtcblxuICB9XG4gIGRyYXdYQXhpcygpIHtcbiAgICB0aGlzLmNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgdGhpcy5jb250ZXh0Lm1vdmVUbyh0aGlzLmF4aXNPcmlnaW4ueCwgdGhpcy5heGlzT3JpZ2luLnkpO1xuICAgIHRoaXMuY29udGV4dC5saW5lVG8odGhpcy5heGlzUmlnaHQgKyB0aGlzLmF4aXNDb25maWdzLmF4aXNNYXJnaW4gLSAxMCwgdGhpcy5heGlzT3JpZ2luLnkpO1xuICAgIHRoaXMuY29udGV4dC5zdHJva2UoKTtcbiAgICAvLyDnu5jliLblnZDmoIfovbTkuInop5LlvaJcbiAgICB0aGlzLmNvbnRleHQubW92ZVRvKHRoaXMuYXhpc1JpZ2h0ICsgdGhpcy5heGlzQ29uZmlncy5heGlzTWFyZ2luLCB0aGlzLmF4aXNPcmlnaW4ueSk7XG4gICAgdGhpcy5jb250ZXh0LmxpbmVUbyh0aGlzLmF4aXNSaWdodCArIHRoaXMuYXhpc0NvbmZpZ3MuYXhpc01hcmdpbiAtIDEwLCB0aGlzLmF4aXNPcmlnaW4ueSArIDUpO1xuICAgIHRoaXMuY29udGV4dC5saW5lVG8odGhpcy5heGlzUmlnaHQgKyB0aGlzLmF4aXNDb25maWdzLmF4aXNNYXJnaW4gLSAxMCwgdGhpcy5heGlzT3JpZ2luLnkgLSA1KTtcbiAgICB0aGlzLmNvbnRleHQuZmlsbCgpO1xuICB9XG4gIGRyYXdBeGlzTGFiZWxzKCkge1xuICAgIHRoaXMuY29udGV4dC5zYXZlKCk7XG4gICAgdGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9IHRoaXMuQVhJU19MQUJFTF9DT0xPUjtcbiAgICB0aGlzLmRyYXdYVGlja3NMYWJlbHMoKTtcbiAgICB0aGlzLmRyYXdZVGlja3NMYWJlbHMoKTtcbiAgICB0aGlzLmNvbnRleHQucmVzdG9yZSgpO1xuICAgIHRoaXMuZHJhd0F4aXNUaXRsZSgpO1xuICB9XG4gIGRyYXdBeGlzVGl0bGUoKSB7XG4gICAgdGhpcy5jb250ZXh0LmZvbnQgPSAnMTJweCBNaWNyb3NvZnQgWWFIZWknO1xuICAgIHRoaXMuY29udGV4dC50ZXh0QWxpZ24gPSAnbGVmdCc7XG4gICAgdGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9IHRoaXMuQVhJU19MQUJFTF9DT0xPUjtcbiAgICBjb25zdCB4TGFiZWxXaWR0aCA9IHRoaXMuY29udGV4dC5tZWFzdXJlVGV4dCh0aGlzLmF4aXNDb25maWdzLnhBeGlzTGFiZWwpLndpZHRoO1xuICAgIHRoaXMucm90YXRlTGFiZWwodGhpcy5heGlzQ29uZmlncy54QXhpc0xhYmVsLCB0aGlzLmF4aXNSaWdodCArIHRoaXMuYXhpc0NvbmZpZ3MuYXhpc01hcmdpbiAvIDIsXG4gICAgICB0aGlzLmF4aXNPcmlnaW4ueSAtIHhMYWJlbFdpZHRoIC0gQVhJU19USVRMRV9TUEFDRSk7XG4gICAgdGhpcy5jb250ZXh0LmZpbGxUZXh0KHRoaXMuYXhpc0NvbmZpZ3MueUF4aXNMYWJlbCxcbiAgICAgIHRoaXMuYXhpc09yaWdpbi54ICsgQVhJU19USVRMRV9TUEFDRSwgdGhpcy5heGlzVG9wIC0gdGhpcy5heGlzQ29uZmlncy5heGlzTWFyZ2luIC8gMik7XG4gIH1cbiAgZHJhd1hUaWNrc0xhYmVscygpIHtcbiAgICB0aGlzLmNvbnRleHQudGV4dEFsaWduID0gJ2NlbnRlcic7XG4gICAgdGhpcy5jb250ZXh0LnRleHRCYXNlbGluZSA9ICd0b3AnO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IHRoaXMueEF4aXNUaWNrc051bTsgaSsrKSB7XG4gICAgICBpZiAoaSAlIHRoaXMuYXhpc0NvbmZpZ3MueEF4aXNSYW5nZS5zdGVwID09PSAwKSB7XG4gICAgICAgIHRoaXMuY29udGV4dC5maWxsVGV4dChpLFxuICAgICAgICAgIHRoaXMuYXhpc09yaWdpbi54ICsgaSAqIHRoaXMueFRpY2tTcGFjaW5nLFxuICAgICAgICAgIHRoaXMuYXhpc09yaWdpbi55ICsgdGhpcy5heGlzQ29uZmlncy5zcGFjZUJldHdlZW5MYWJlbHNBeGlzKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgZHJhd1lUaWNrc0xhYmVscygpIHtcbiAgICB0aGlzLmNvbnRleHQudGV4dEFsaWduID0gJ2NlbnRlcic7XG4gICAgdGhpcy5jb250ZXh0LnRleHRCYXNlbGluZSA9ICdtaWRkbGUnO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IHRoaXMueUF4aXNUaWNrc051bTsgaSsrKSB7XG4gICAgICBpZiAoaSAlIHRoaXMuYXhpc0NvbmZpZ3MueUF4aXNSYW5nZS5zdGVwID09PSAwKSB7XG4gICAgICAgIHRoaXMuY29udGV4dC5maWxsVGV4dChpLFxuICAgICAgICAgIHRoaXMuYXhpc09yaWdpbi54IC0gdGhpcy5heGlzQ29uZmlncy5zcGFjZUJldHdlZW5MYWJlbHNBeGlzLFxuICAgICAgICAgIHRoaXMuYXhpc09yaWdpbi55IC0gaSAqIHRoaXMueVRpY2tTcGFjaW5nKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcm90YXRlTGFiZWwobmFtZSwgeCwgeSkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmFtZS5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qgc3RyID0gbmFtZS5zbGljZShpLCBpICsgMSkudG9TdHJpbmcoKTtcbiAgICAgIGlmIChzdHIubWF0Y2goL1tBLVphLXowLTldLykpIHtcbiAgICAgICAgdGhpcy5jb250ZXh0LnNhdmUoKTtcbiAgICAgICAgdGhpcy5jb250ZXh0LnRyYW5zbGF0ZSh4LCB5KTtcbiAgICAgICAgdGhpcy5jb250ZXh0LnJvdGF0ZShNYXRoLlBJIC8gMTgwICogOTApO1xuICAgICAgICB0aGlzLmNvbnRleHQudGV4dEJhc2VsaW5lID0gJ2JvdHRvbSc7XG4gICAgICAgIHRoaXMuY29udGV4dC5maWxsVGV4dChzdHIsIDAsIDApO1xuICAgICAgICB0aGlzLmNvbnRleHQucmVzdG9yZSgpO1xuICAgICAgICB5ICs9IHRoaXMuY29udGV4dC5tZWFzdXJlVGV4dChzdHIpLndpZHRoO1xuICAgICAgfSBlbHNlIGlmIChzdHIubWF0Y2goL1tcXHU0RTAwLVxcdTlGQTVdLykpIHtcbiAgICAgICAgdGhpcy5jb250ZXh0LnNhdmUoKTtcbiAgICAgICAgdGhpcy5jb250ZXh0LnRleHRCYXNlbGluZSA9ICd0b3AnO1xuICAgICAgICB0aGlzLmNvbnRleHQuZmlsbFRleHQoc3RyLCB4LCB5KTtcbiAgICAgICAgdGhpcy5jb250ZXh0LnJlc3RvcmUoKTtcbiAgICAgICAgeSArPSB0aGlzLmNvbnRleHQubWVhc3VyZVRleHQoc3RyKS53aWR0aDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiIsIjxjYW52YXMgaWQ9XCJkZXZ1aS1xdWFkcmFudC1heGlzXCI+PC9jYW52YXM+XG4iXX0=