import { DOCUMENT } from '@angular/common';
import { Directive, ElementRef, EventEmitter, HostListener, Inject, Input, NgZone, Output, Renderer2 } from '@angular/core';
import { fromEvent, Subject, Subscription } from 'rxjs';
import { distinctUntilChanged, filter } from 'rxjs/operators';
import { DragDropService } from '../services/drag-drop.service';
import { DropEvent } from '../shared/drop-event.model';
import { Utils } from '../shared/utils';
import * as i0 from "@angular/core";
import * as i1 from "../services/drag-drop.service";
export class DroppableDirective {
    constructor(el, renderer, dragDropService, ngZone, doc) {
        this.el = el;
        this.renderer = renderer;
        this.dragDropService = dragDropService;
        this.ngZone = ngZone;
        this.doc = doc;
        /**
           *  Event fired when Drag dragged element enters a valid drop target.
           */
        this.dragEnterEvent = new EventEmitter();
        /**
           * Event fired when an element is being dragged over a valid drop target
           */
        this.dragOverEvent = new EventEmitter();
        /**
           * Event fired when a dragged element leaves a valid drop target.
           */
        this.dragLeaveEvent = new EventEmitter();
        /**
           * Event fired when an element is dropped on a valid drop target.
           */
        this.dropEvent = new EventEmitter(); // 注意使用了虚拟滚动后，DropEvent中的dragFromIndex无效
        /**
           * Defines compatible drag drop pairs. Values must match both in draggable and droppable.dropScope.
           */
        this.dropScope = 'default';
        this.placeholderTag = 'div';
        this.placeholderStyle = { backgroundColor: ['#859bff', `var(--devui-brand-foil, #859bff)`], opacity: '.4' };
        /**
           * 设置placeholder的提示性文字，仅支持文本（安全起见）
           */
        this.placeholderText = '';
        /**
           * 用于允许拖动到元素上，方便树形结构的拖动可以成为元素的子节点
           */
        this.allowDropOnItem = false;
        /**
          *  是否启用越过立即交换位置的算法, 不能与allowDropOnItem一起用，allowDropOnItem为true时，此规则无效
          * */
        this.switchWhileCrossEdge = false;
        /**
          *  sortable的情况下，拖动到可以drop但不在sortContainer里的时候默认drop的位置
          * */
        this.defaultDropPosition = 'closest';
        // 用于修复dragleave多次触发
        this.dragCount = 0;
        this.dropIndex = undefined;
        /* 协同拖拽需要 */
        this.placeholderInsertionEvent = new Subject();
        this.placeholderRenderEvent = new Subject();
        this.dropSortCountSelectorFilterFn = (value) => {
            return Utils.matches(value, this.dropSortCountSelector)
                || value.contains(this.placeholder)
                || value === this.dragDropService.dragOriginPlaceholder;
        };
        this.setPlaceholder = () => {
            this.ngZone.runOutsideAngular(() => {
                this.placeholder.style.width = this.dragDropService.dragOffset.width + 'px';
                this.placeholder.style.height = this.dragDropService.dragOffset.height + 'px'; // ie下clientHeight为0
                Utils.addElStyles(this.placeholder, this.placeholderStyle);
                this.placeholderRenderEvent.next({ width: this.dragDropService.dragOffset.width, height: this.dragDropService.dragOffset.height });
            });
        };
        this.document = this.doc;
    }
    ngOnInit() {
        this.placeholder = this.document.createElement(this.placeholderTag);
        this.placeholder.className = 'drag-placeholder';
        this.placeholder.innerText = this.placeholderText;
        this.dragStartSubscription = this.dragDropService.dragStartEvent.subscribe(() => this.setPlaceholder());
        if (this.dragDropService.draggedEl) {
            this.setPlaceholder(); // 虚拟滚动生成元素过程中
        }
        this.dropEndSubscription = this.dragDropService.dropEvent.subscribe(() => {
            if (this.dragDropService.draggedEl) {
                if (!this.dragDropService.dragFollow) {
                    this.renderer.setStyle(this.dragDropService.draggedEl, 'display', '');
                    this.dragDropService.dragElShowHideEvent.next(true);
                }
            }
            this.removePlaceholder();
            this.overElement = undefined;
            this.allowDropCache = undefined;
            this.dragElIndex = undefined;
            this.dropIndex = undefined;
        });
        this.dragEndSubscription = this.dragDropService.dragEndEvent.subscribe(() => {
            if (this.dragDropService.draggedEl) {
                if (!this.dragDropService.dragFollow) {
                    this.renderer.setStyle(this.dragDropService.draggedEl, 'display', '');
                    this.dragDropService.dragElShowHideEvent.next(true);
                }
            }
            this.removePlaceholder();
            this.dragCount = 0;
            this.overElement = undefined;
            this.allowDropCache = undefined;
            this.dragElIndex = undefined;
            this.dropIndex = undefined;
        });
        this.ngZone.runOutsideAngular(() => {
            this.dragPartEventSub = new Subscription();
            this.dragPartEventSub.add(fromEvent(this.el.nativeElement, 'dragover')
                .pipe(filter(event => this.allowDrop(event)), distinctUntilChanged((prev, current) => {
                const bool = (prev.clientX === current.clientX && prev.clientY === current.clientY && prev.target === current.target);
                if (bool) {
                    current.preventDefault();
                    current.stopPropagation();
                }
                return bool;
            }))
                .subscribe((event) => this.dragOver(event)));
            this.dragPartEventSub.add(fromEvent(this.el.nativeElement, 'dragenter').subscribe((event) => this.dragEnter(event)));
            this.dragPartEventSub.add(fromEvent(this.el.nativeElement, 'dragleave').subscribe((event) => this.dragLeave(event)));
        });
    }
    ngAfterViewInit() {
        if (this.el.nativeElement.hasAttribute('d-sortable')) {
            this.sortContainer = this.el.nativeElement;
        }
        else {
            this.sortContainer = this.el.nativeElement.querySelector('[d-sortable]');
        }
        this.sortDirection = this.sortContainer ? this.sortContainer.getAttribute('dsortable') || 'v' : 'v';
        this.sortDirectionZMode = this.sortContainer ? (this.sortContainer.getAttribute('d-sortable-zmode') === 'true' || false) : false;
    }
    ngOnDestroy() {
        this.dragStartSubscription.unsubscribe();
        this.dragEndSubscription.unsubscribe();
        this.dropEndSubscription.unsubscribe();
        if (this.dragPartEventSub) {
            this.dragPartEventSub.unsubscribe();
        }
    }
    dragEnter(e) {
        this.dragCount++;
        e.preventDefault(); // ie11 dragenter需要preventDefault否则dragover无效
        this.dragEnterEvent.emit(e);
    }
    dragOver(e) {
        if (this.allowDrop(e)) {
            if (this.dragDropService.dropTargets.indexOf(this.el) === -1) {
                this.dragDropService.dropTargets.forEach(el => {
                    const placeHolderEl = el.nativeElement.querySelector('.drag-placeholder');
                    if (placeHolderEl) {
                        placeHolderEl.parentElement.removeChild(placeHolderEl);
                    }
                    Utils.removeClass(el, this.dragOverClass);
                    this.removeDragoverItemClass(el.nativeElement);
                });
                this.dragDropService.dropTargets = [this.el];
                this.overElement = undefined; // 否则会遇到上一次position= 这一次的然后不刷新和插入。
            }
            Utils.addClass(this.el, this.dragOverClass);
            const hitPlaceholder = this.dragDropService.dragOriginPlaceholder && this.dragDropService.dragOriginPlaceholder.contains(e.target);
            if (this.sortContainer && ((hitPlaceholder && this.overElement === undefined)
                || !(e.target.contains(this.placeholder) || hitPlaceholder)
                || (this.switchWhileCrossEdge && !this.placeholder.contains(e.target) && !hitPlaceholder) // 越边交换回折的情况需要重新计算
                || (!this.sortContainer.contains(e.target) && this.defaultDropPosition === 'closest') // 就近模式需要重新计算
            )) {
                const overElement = this.findSortableEl(e);
                if (!(this.overElement && overElement) || this.overElement.index !== overElement.index
                    || (this.allowDropOnItem && this.overElement.position !== overElement.position
                        && (this.overElement.position === 'inside' || overElement.position === 'inside'))) {
                    // overElement的参数有刷新的时候才进行插入等操作
                    this.overElement = overElement;
                    this.insertPlaceholder(overElement);
                    this.removeDragoverItemClass(this.sortContainer, overElement);
                    if (overElement.position === 'inside' && this.dragOverItemClass) {
                        Utils.addClass(overElement.el, this.dragOverItemClass);
                    }
                }
                else {
                    this.overElement = overElement;
                }
            }
            else {
                if (this.sortContainer && this.overElement && this.overElement.el) {
                    if (!this.overElement.el.contains(e.target)) {
                        this.overElement.realEl = e.target;
                    }
                    else {
                        this.overElement.realEl = undefined;
                    }
                }
            }
            if (this.dragDropService.draggedEl) {
                if (!this.dragDropService.dragFollow) {
                    this.renderer.setStyle(this.dragDropService.draggedEl, 'display', 'none');
                    this.dragDropService.dragElShowHideEvent.next(false);
                    if (this.dragDropService.dragOriginPlaceholder) {
                        this.renderer.setStyle(this.dragDropService.dragOriginPlaceholder, 'display', 'block');
                    }
                }
            }
            e.preventDefault();
            e.stopPropagation();
            this.dragOverEvent.emit(e);
        }
    }
    dragLeave(e) {
        // 用于修复包含子元素时，多次触发dragleave
        this.dragCount--;
        if (this.dragCount === 0) {
            if (this.dragDropService.dropTargets.indexOf(this.el) !== -1) {
                this.dragDropService.dropTargets = [];
            }
            Utils.removeClass(this.el, this.dragOverClass);
            this.removePlaceholder();
            this.removeDragoverItemClass(this.el.nativeElement);
            this.overElement = undefined;
            this.dragElIndex = undefined;
            this.dropIndex = undefined;
        }
        e.preventDefault();
        this.dragLeaveEvent.emit(e);
    }
    drop(e) {
        if (!this.allowDrop(e)) {
            return;
        }
        this.dragCount = 0;
        Utils.removeClass(this.el, this.dragOverClass);
        this.removeDragoverItemClass(this.sortContainer);
        this.removePlaceholder();
        e.preventDefault();
        e.stopPropagation();
        this.dragDropService.dropOnOrigin = this.isDragPlaceholderPosition(this.dropIndex);
        const draggedElIdentity = this.dragDropService.draggedElIdentity;
        this.dragDropService.draggedElIdentity = undefined; // 需要提前清除，避免新生成的节点复用了id 刷新了dragOriginPlaceholder
        let batchDraggble = [];
        if (this.dragDropService.batchDragData && this.dragDropService.batchDragData.length > 1) {
            batchDraggble = this.dragDropService.batchDragData.map(dragData => dragData.draggable)
                .filter(draggable => draggable && draggable.el.nativeElement !== this.dragDropService.draggedEl);
        }
        this.dropEvent.emit(new DropEvent(e, this.dragDropService.dragData, this.dragDropService.dropEvent, this.dropSortVirtualScrollOption ? this.getRealIndex(this.dropIndex, this.dropFlag) : this.dropIndex, this.sortContainer ? this.checkSelfFromIndex(this.dragDropService.draggedEl) : -1, this.dragDropService.dropOnItem, this.dragDropService.dropOnOrigin, (this.dragDropService.batchDragging)
            ? this.dragDropService.getBatchDragData(draggedElIdentity)
            : undefined));
        // 如果drop之后drag元素被删除，则不会发生dragend事件，需要代替dragend清理
        if (this.dragDropService.dragFollow) {
            this.dragDropService.disableDraggedCloneNodeFollowMouse();
        }
        else {
            this.renderer.setStyle(this.dragDropService.draggedEl, 'display', '');
            this.dragDropService.dragElShowHideEvent.next(false);
        }
        if (batchDraggble.length > 0 && this.dragDropService.batchDragging) {
            batchDraggble.forEach((draggable) => {
                if (!draggable.originPlaceholder || draggable.originPlaceholder.show === false) {
                    draggable.el.nativeElement.style.display = '';
                }
                else if (draggable.originPlaceholder.removeDelay > 0 && !this.dragDropService.dropOnOrigin) {
                    draggable.delayRemoveOriginPlaceholder(false);
                }
                else {
                    draggable.el.nativeElement.style.display = '';
                    draggable.removeOriginPlaceholder(false);
                }
            });
        }
        this.dragDropService.dropEvent.next(e);
        this.dragDropService.dragData = undefined;
        this.dragDropService.scope = undefined;
        this.dragDropService.draggedEl = undefined;
        this.dragDropService.dragFollow = undefined;
        this.dragDropService.dragFollowOptions = undefined;
        this.dragDropService.dragOffset = undefined;
        this.dragDropService.dropOnOrigin = undefined;
        this.dragDropService.batchDragging = false;
        this.dragDropService.batchDragStyle = undefined;
        this.dragDropService.dragPreviewDirective = undefined;
    }
    allowDrop(e) {
        if (!e) {
            return false;
        }
        if (this.allowDropCache !== undefined) {
            return this.allowDropCache;
        }
        let allowed = false;
        if (typeof this.dropScope === 'string') {
            if (typeof this.dragDropService.scope === 'string') {
                allowed = this.dragDropService.scope === this.dropScope;
            }
            if (this.dragDropService.scope instanceof Array) {
                allowed = this.dragDropService.scope.indexOf(this.dropScope) > -1;
            }
        }
        if (this.dropScope instanceof Array) {
            if (typeof this.dragDropService.scope === 'string') {
                allowed = this.dropScope.indexOf(this.dragDropService.scope) > -1;
            }
            if (this.dragDropService.scope instanceof Array) {
                allowed = this.dropScope.filter((item) => {
                    return this.dragDropService.scope.indexOf(item) !== -1;
                }).length > 0;
            }
        }
        this.allowDropCache = allowed;
        return allowed;
    }
    // 查询需要插入placeholder的位置
    /* eslint-disable-next-line complexity*/
    findSortableEl(event) {
        const moveElement = event.target;
        let overElement = null;
        if (!this.sortContainer) {
            return overElement;
        }
        overElement = { index: 0, el: null, position: 'before' };
        this.dropIndex = 0;
        this.dropFlag = undefined;
        let childEls = Utils.slice(this.sortContainer.children);
        // 删除虚拟滚动等的额外元素不需要计算的元素
        if (this.dropSortCountSelector) {
            childEls = childEls.filter(this.dropSortCountSelectorFilterFn);
        }
        // 如果没有主动删除则删除多余的originplaceholder
        if (childEls.some(el => el !== this.dragDropService.dragOriginPlaceholder
            && el.classList.contains('drag-origin-placeholder'))) {
            childEls = childEls.filter(el => !(el.classList.contains('drag-origin-placeholder')
                && el !== this.dragDropService.dragOriginPlaceholder));
        }
        // 要先删除clonenode否则placeholderindex是错的
        if (this.dragDropService.dragFollow && this.dragDropService.dragCloneNode) {
            const cloneNodeIndex = childEls.findIndex(value => value === this.dragDropService.dragCloneNode);
            if (-1 !== cloneNodeIndex) {
                childEls.splice(cloneNodeIndex, 1);
            }
        }
        // 计算index数组需要删除源占位符
        if (this.dragDropService.dragOriginPlaceholder) {
            const dragOriginPlaceholderIndex = childEls.findIndex(value => value === this.dragDropService.dragOriginPlaceholder);
            if (-1 !== dragOriginPlaceholderIndex) {
                this.dragElIndex = dragOriginPlaceholderIndex - 1;
                childEls.splice(dragOriginPlaceholderIndex, 1);
            }
            else {
                this.dragElIndex = -1;
            }
        }
        else {
            this.dragElIndex = -1;
        }
        // 查询是否已经插入了placeholder
        const placeholderIndex = childEls.findIndex(value => value.contains(this.placeholder));
        // 删除placeholder
        if (-1 !== placeholderIndex) {
            childEls.splice(placeholderIndex, 1);
        }
        // 如果还有placeholder在前面 dragElIndex得再减一
        if (-1 !== placeholderIndex && -1 !== this.dragElIndex && placeholderIndex < this.dragElIndex) {
            this.dragElIndex--;
        }
        const positionIndex = -1 !== placeholderIndex ? placeholderIndex : this.dragElIndex;
        const currentIndex = childEls.findIndex(value => (value.contains(moveElement)
            || value.nextElementSibling === moveElement
                && value.nextElementSibling.classList.contains('drag-origin-placeholder')));
        if (this.switchWhileCrossEdge && !this.allowDropOnItem && childEls.length
            && -1 !== positionIndex
            && currentIndex > -1) { // 越过元素边界立即交换位置算法
            const lastIndex = positionIndex;
            // 解决抖动
            const realEl = this.overElement && (this.overElement.realEl || this.overElement.el);
            if (-1 !== currentIndex && realEl === childEls[currentIndex]) {
                this.dropIndex = this.overElement.index;
                return this.overElement;
            }
            overElement = {
                index: lastIndex > currentIndex ? currentIndex : (currentIndex + 1),
                el: childEls[currentIndex],
                position: lastIndex > currentIndex ? 'before' : 'after'
            };
            this.dragDropService.dropOnItem = false;
            this.dropIndex = overElement.index;
            return overElement;
        }
        if (moveElement === this.sortContainer
            || moveElement.classList.contains('drag-origin-placeholder')
            || moveElement === (this.dragDropService && this.dragDropService.dragOriginPlaceholder)
            || (!this.sortContainer.contains(moveElement) && this.defaultDropPosition === 'closest')) {
            if (!childEls.length) {
                this.dropIndex = 0;
                this.dragDropService.dropOnItem = false;
                return overElement;
            }
            // 落入A元素和B元素的间隙里
            let findInGap = false;
            for (let i = 0; i < childEls.length; i++) {
                const targetElement = childEls[i];
                // 处理非越边的落到side-origin-placeholder
                if (childEls[i].nextSibling === moveElement
                    && moveElement.classList.contains('drag-origin-placeholder')) {
                    const position = this.calcPosition(event, moveElement);
                    this.dragDropService.dropOnItem = position === 'inside';
                    overElement = { index: position === 'after' ? (i + 1) : i, el: childEls[i], position: position };
                    this.dropIndex = overElement.index;
                    return overElement;
                }
                const positionOutside = this.calcPositionOutside(event, targetElement);
                if (positionOutside === 'before') {
                    this.dragDropService.dropOnItem = false;
                    overElement = { index: i, el: childEls[i], position: positionOutside, realEl: moveElement };
                    this.dropIndex = overElement.index;
                    findInGap = true;
                    break;
                }
                else {
                    // for 'notsure'
                }
            }
            if (!findInGap) {
                this.dragDropService.dropOnItem = false;
                overElement = { index: childEls.length, el: childEls[childEls.length - 1], position: 'after', realEl: moveElement };
                this.dropIndex = childEls.length;
            }
            return overElement;
        }
        if (!this.sortContainer.contains(moveElement)) {
            if (this.defaultDropPosition === 'before') {
                overElement = { index: 0, el: childEls.length ? childEls[0] : null, position: 'before', realEl: moveElement };
                this.dropFlag = 'beforeAll';
            }
            else {
                overElement = {
                    index: childEls.length,
                    el: childEls.length ? childEls[childEls.length - 1] : null,
                    position: 'after',
                    realEl: moveElement
                };
                this.dropFlag = 'afterAll';
            }
            this.dropIndex = overElement.index;
            return overElement;
        }
        let find = false;
        for (let i = 0; i < childEls.length; i++) {
            if (childEls[i].contains(moveElement)) {
                const targetElement = childEls[i];
                const position = this.calcPosition(event, targetElement);
                this.dragDropService.dropOnItem = position === 'inside';
                overElement = { index: position === 'after' ? (i + 1) : i, el: childEls[i], position: position };
                this.dropIndex = overElement.index;
                find = true;
                break;
            }
        }
        if (!find) {
            if (childEls.length) {
                overElement = { index: childEls.length, el: childEls[childEls.length - 1], position: 'after' };
            }
            this.dropIndex = childEls.length;
            this.dragDropService.dropOnItem = false;
        }
        return overElement;
    }
    calcPosition(event, targetElement) {
        const rect = targetElement.getBoundingClientRect();
        const relY = event.clientY - (rect.y || rect.top);
        const relX = event.clientX - (rect.x || rect.left);
        // 处理允许drop到元素自己
        if (this.allowDropOnItem) {
            const dropOnItemEdge = {
                height: (this.nestingTargetRect && this.nestingTargetRect.height || rect.height),
                width: (this.nestingTargetRect && this.nestingTargetRect.width || rect.width)
            };
            const threeQuartersOfHeight = dropOnItemEdge.height * 3 / 4;
            const threeQuartersOfWidth = dropOnItemEdge.width * 3 / 4;
            const AQuarterOfHeight = Number(dropOnItemEdge.height) / 4;
            const AQuarterOfWidth = Number(dropOnItemEdge.width) / 4;
            if (this.sortDirectionZMode) {
                const slashPosition = (relY / dropOnItemEdge.height + relX / dropOnItemEdge.width);
                if (slashPosition > 0.3 && slashPosition <= 0.7) {
                    return 'inside';
                }
                else if (slashPosition > 0.7) {
                    const slashPositionNesting = ((relY - rect.height + dropOnItemEdge.height) / dropOnItemEdge.height
                        + (relX - rect.width + dropOnItemEdge.width) / dropOnItemEdge.width);
                    if (slashPositionNesting <= 0.7) {
                        return 'inside';
                    }
                }
            }
            if ((this.sortDirection === 'v' && relY > AQuarterOfHeight && relY <= threeQuartersOfHeight) ||
                (this.sortDirection !== 'v' && relX > AQuarterOfWidth && relX <= threeQuartersOfWidth)) {
                //  高度的中间1/4 - 3/4 属于drop到元素自己
                return 'inside';
            }
            else if ((this.sortDirection === 'v' && relY > threeQuartersOfHeight
                && relY <= (rect.height - AQuarterOfHeight)) ||
                (this.sortDirection !== 'v' && relX > threeQuartersOfWidth
                    && relX <= (rect.width - AQuarterOfWidth))) {
                // 内嵌列表后中间区域都属于inside
                return 'inside';
            }
        }
        if (this.sortDirectionZMode) {
            if ((relY / rect.height + relX / rect.width) < 1) {
                return 'before';
            }
            return 'after';
        }
        // 其他情况保持原来的属于上半部分或者下半部分
        if ((this.sortDirection === 'v' && relY > (rect.height / 2)) ||
            (this.sortDirection !== 'v' && relX > (rect.width / 2))) {
            return 'after';
        }
        return 'before';
    }
    calcPositionOutside(event, targetElement) {
        const rect = this.getBoundingRectAndRealPosition(targetElement); // targetElement.getBoundingClientRect();
        const relY = event.clientY - (rect.y || rect.top);
        const relX = event.clientX - (rect.x || rect.left);
        if (this.sortDirectionZMode) {
            if ((this.sortDirection === 'v' && (relY < 0 || (relY < rect.height && relX < 0)))
                || (this.sortDirection !== 'v' && (relX < 0 || (relX < rect.width && relY < 0)))) {
                return 'before';
            }
            return 'notsure';
        }
        if ((this.sortDirection === 'v' && relY < (rect.height / 2)) ||
            (this.sortDirection !== 'v' && relX < (rect.width / 2))) {
            return 'before';
        }
        return 'notsure';
    }
    // 插入placeholder
    insertPlaceholder(overElement) {
        const tempScrollTop = this.sortContainer.scrollTop;
        const tempScrollLeft = this.sortContainer.scrollLeft;
        let hitPlaceholder = false;
        let cmd;
        const getIndex = (arr, el, defaultValue) => {
            const index = arr.indexOf(el);
            return index > -1 ? index : defaultValue;
        };
        if (null !== overElement) {
            const sortContainerChildren = Utils.slice(this.sortContainer.children).filter(el => el !== this.dragDropService.dragCloneNode);
            if (overElement.el === null) {
                cmd = {
                    command: 'append'
                };
                this.sortContainer.appendChild(this.placeholder);
            }
            else {
                if (overElement.position === 'inside') {
                    cmd = {
                        command: 'remove'
                    };
                    this.removePlaceholder();
                }
                else if (this.dragDropService.dragOriginPlaceholder && this.isDragPlaceholderPosition(overElement.index)) {
                    cmd = {
                        command: 'remove'
                    };
                    this.removePlaceholder();
                    hitPlaceholder = true;
                }
                else if (overElement.position === 'after') {
                    if (overElement.el.nextSibling && overElement.el.nextSibling.classList
                        && overElement.el.nextSibling.classList.contains('drag-origin-placeholder')) {
                        // 针对多源占位符场景
                        cmd = {
                            command: 'insertBefore',
                            index: getIndex(sortContainerChildren, overElement.el.nextSibling, sortContainerChildren.length) + 1
                        };
                        this.sortContainer.insertBefore(this.placeholder, overElement.el.nextSibling.nextSibling);
                    }
                    else {
                        cmd = {
                            command: 'insertBefore',
                            index: getIndex(sortContainerChildren, overElement.el, sortContainerChildren.length) + 1
                        };
                        this.sortContainer.insertBefore(this.placeholder, overElement.el.nextSibling);
                    }
                }
                else {
                    cmd = {
                        command: 'insertBefore',
                        index: getIndex(sortContainerChildren, overElement.el, sortContainerChildren.length)
                    };
                    this.sortContainer.insertBefore(this.placeholder, overElement.el);
                }
            }
        }
        this.placeholderInsertionEvent.next(cmd);
        this.sortContainer.scrollTop = tempScrollTop;
        this.sortContainer.scrollLeft = tempScrollLeft;
        if (this.dragDropService.dragOriginPlaceholder) {
            if (hitPlaceholder) {
                this.hitDragOriginPlaceholder();
            }
            else {
                this.hitDragOriginPlaceholder(false);
            }
        }
    }
    isDragPlaceholderPosition(index) {
        if (this.dragElIndex > -1 && (index === this.dragElIndex || index === this.dragElIndex + 1)) {
            return true;
        }
        else {
            return false;
        }
    }
    hitDragOriginPlaceholder(bool = true) {
        const placeholder = this.dragDropService.dragOriginPlaceholder;
        if (bool) {
            placeholder.classList.add('hit-origin-placeholder');
        }
        else {
            placeholder.classList.remove('hit-origin-placeholder');
        }
    }
    removePlaceholder() {
        if (this.sortContainer && this.sortContainer.contains(this.placeholder)) {
            this.sortContainer.removeChild(this.placeholder);
            this.placeholderInsertionEvent.next({
                command: 'remove'
            });
        }
    }
    removeDragoverItemClass(container, overElement) {
        if (this.dragOverItemClass) {
            const dragOverItemClassGroup = container.querySelectorAll('.' + this.dragOverItemClass);
            if (dragOverItemClassGroup && dragOverItemClassGroup.length > 0) {
                for (const element of dragOverItemClassGroup) {
                    if (overElement) {
                        if (element !== overElement.el || overElement.position !== 'inside') {
                            Utils.removeClass(element, this.dragOverItemClass);
                        }
                    }
                    else {
                        Utils.removeClass(element, this.dragOverItemClass);
                    }
                }
            }
        }
    }
    checkSelfFromIndex(el) {
        let fromIndex = -1;
        if (!this.sortContainer.contains(el)) {
            return fromIndex;
        }
        let childs = Utils.slice(this.sortContainer.children);
        if (this.dropSortCountSelector) {
            childs = childs.filter(this.dropSortCountSelectorFilterFn);
        }
        for (let i = 0; i < childs.length; i++) {
            if (childs[i].contains(this.dragDropService.draggedEl)) {
                fromIndex = i;
                break;
            }
        }
        return this.getRealIndex(fromIndex);
    }
    getRealIndex(index, flag) {
        let realIndex;
        const startIndex = this.dropSortVirtualScrollOption && this.dropSortVirtualScrollOption.startIndex || 0;
        const totalLength = this.dropSortVirtualScrollOption && this.dropSortVirtualScrollOption.totalLength;
        if (flag === 'beforeAll') {
            realIndex = 0;
        }
        else if (flag === 'afterAll') {
            realIndex = totalLength || index;
        }
        else {
            realIndex = startIndex + index;
        }
        return realIndex;
    }
    getBoundingRectAndRealPosition(targetElement) {
        // 用于修复部分display none的元素获取到的top和left是0， 取它下一个元素的左上角为坐标
        let rect = targetElement.getBoundingClientRect();
        const { bottom, right, width, height } = rect;
        if (rect.width === 0 && rect.height === 0 &&
            (targetElement.style.display === 'none' || getComputedStyle(targetElement).display === 'none')) {
            if (targetElement.nextElementSibling) {
                const { top: realTop, left: realLeft } = targetElement.nextElementSibling.getBoundingClientRect();
                rect = { x: realLeft, y: realTop, top: realTop, left: realLeft, bottom, right, width, height };
            }
        }
        return rect;
    }
    getSortContainer() {
        return this.sortContainer;
    }
}
DroppableDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DroppableDirective, deps: [{ token: i0.ElementRef }, { token: i0.Renderer2 }, { token: i1.DragDropService }, { token: i0.NgZone }, { token: DOCUMENT }], target: i0.ɵɵFactoryTarget.Directive });
DroppableDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.1.3", type: DroppableDirective, selector: "[dDroppable]", inputs: { dragOverClass: "dragOverClass", dropScope: "dropScope", placeholderTag: "placeholderTag", placeholderStyle: "placeholderStyle", placeholderText: "placeholderText", allowDropOnItem: "allowDropOnItem", dragOverItemClass: "dragOverItemClass", nestingTargetRect: "nestingTargetRect", switchWhileCrossEdge: "switchWhileCrossEdge", defaultDropPosition: "defaultDropPosition", dropSortCountSelector: "dropSortCountSelector", dropSortVirtualScrollOption: "dropSortVirtualScrollOption" }, outputs: { dragEnterEvent: "dragEnterEvent", dragOverEvent: "dragOverEvent", dragLeaveEvent: "dragLeaveEvent", dropEvent: "dropEvent" }, host: { listeners: { "drop": "drop($event)" } }, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DroppableDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[dDroppable]'
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.Renderer2 }, { type: i1.DragDropService }, { type: i0.NgZone }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }]; }, propDecorators: { dragEnterEvent: [{
                type: Output
            }], dragOverEvent: [{
                type: Output
            }], dragLeaveEvent: [{
                type: Output
            }], dropEvent: [{
                type: Output
            }], dragOverClass: [{
                type: Input
            }], dropScope: [{
                type: Input
            }], placeholderTag: [{
                type: Input
            }], placeholderStyle: [{
                type: Input
            }], placeholderText: [{
                type: Input
            }], allowDropOnItem: [{
                type: Input
            }], dragOverItemClass: [{
                type: Input
            }], nestingTargetRect: [{
                type: Input
            }], switchWhileCrossEdge: [{
                type: Input
            }], defaultDropPosition: [{
                type: Input
            }], dropSortCountSelector: [{
                type: Input
            }], dropSortVirtualScrollOption: [{
                type: Input
            }], drop: [{
                type: HostListener,
                args: ['drop', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcHBhYmxlLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2RldnVpL2RyYWdkcm9wL2RpcmVjdGl2ZXMvZHJvcHBhYmxlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUVMLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLFlBQVksRUFDWixNQUFNLEVBQ04sS0FBSyxFQUNMLE1BQU0sRUFHTixNQUFNLEVBQ04sU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN4RCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0saUJBQWlCLENBQUM7OztBQVF4QyxNQUFNLE9BQU8sa0JBQWtCO0lBc0c3QixZQUFzQixFQUFjLEVBQVUsUUFBbUIsRUFBVSxlQUFnQyxFQUFVLE1BQWMsRUFDN0YsR0FBUTtRQUR4QixPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUFVLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDN0YsUUFBRyxHQUFILEdBQUcsQ0FBSztRQXJHOUM7O2FBRUs7UUFDSyxtQkFBYyxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBRXRFOzthQUVLO1FBQ0ssa0JBQWEsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUVyRTs7YUFFSztRQUNLLG1C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LE1BQU07Z0JBS0csY0FBYztzQkFBdkIsTUFBTTtnQkFLRyxTQUFTO3NCQUFsQixNQUFNO2dCQUtFLGFBQWE7c0JBQXJCLEtBQUs7Z0JBS0csU0FBUztzQkFBakIsS0FBSztnQkFFRyxjQUFjO3NCQUF0QixLQUFLO2dCQUVHLGdCQUFnQjtzQkFBeEIsS0FBSztnQkFLRyxlQUFlO3NCQUF2QixLQUFLO2dCQUtHLGVBQWU7c0JBQXZCLEtBQUs7Z0JBS0csaUJBQWlCO3NCQUF6QixLQUFLO2dCQUtHLGlCQUFpQjtzQkFBekIsS0FBSztnQkFLRyxvQkFBb0I7c0JBQTVCLEtBQUs7Z0JBS0csbUJBQW1CO3NCQUEzQixLQUFLO2dCQUtHLHFCQUFxQjtzQkFBN0IsS0FBSztnQkFDRywyQkFBMkI7c0JBQW5DLEtBQUs7Z0JBeU1OLElBQUk7c0JBREgsWUFBWTt1QkFBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBET0NVTUVOVCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBEaXJlY3RpdmUsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdExpc3RlbmVyLFxuICBJbmplY3QsXG4gIElucHV0LFxuICBOZ1pvbmUsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFJlbmRlcmVyMlxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGZyb21FdmVudCwgU3ViamVjdCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgZmlsdGVyIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgRHJhZ0Ryb3BTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvZHJhZy1kcm9wLnNlcnZpY2UnO1xuaW1wb3J0IHsgRHJvcEV2ZW50IH0gZnJvbSAnLi4vc2hhcmVkL2Ryb3AtZXZlbnQubW9kZWwnO1xuaW1wb3J0IHsgVXRpbHMgfSBmcm9tICcuLi9zaGFyZWQvdXRpbHMnO1xuaW1wb3J0IHsgRHJhZ2dhYmxlRGlyZWN0aXZlIH0gZnJvbSAnLi9kcmFnZ2FibGUuZGlyZWN0aXZlJztcbmltcG9ydCB7IERyYWdQbGFjZWhvbGRlckluc2VydGlvbkV2ZW50LCBEcmFnUGxhY2Vob2xkZXJJbnNlcnRpb25JbmRleEV2ZW50IH0gZnJvbSAnLi9wbGFjZWhvbGRlci1pbnNlcnRpb24tZXZlbnQudHlwZSc7XG5cbmV4cG9ydCB0eXBlIERyb3BJbmRleEZsYWcgPSAnYmVmb3JlQWxsJyB8ICdhZnRlckFsbCc7XG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbZERyb3BwYWJsZV0nXG59KVxuZXhwb3J0IGNsYXNzIERyb3BwYWJsZURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcblxuICAvKipcbiAgICAgKiAgRXZlbnQgZmlyZWQgd2hlbiBEcmFnIGRyYWdnZWQgZWxlbWVudCBlbnRlcnMgYSB2YWxpZCBkcm9wIHRhcmdldC5cbiAgICAgKi9cbiAgQE91dHB1dCgpIGRyYWdFbnRlckV2ZW50OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIC8qKlxuICAgICAqIEV2ZW50IGZpcmVkIHdoZW4gYW4gZWxlbWVudCBpcyBiZWluZyBkcmFnZ2VkIG92ZXIgYSB2YWxpZCBkcm9wIHRhcmdldFxuICAgICAqL1xuICBAT3V0cHV0KCkgZHJhZ092ZXJFdmVudDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAvKipcbiAgICAgKiBFdmVudCBmaXJlZCB3aGVuIGEgZHJhZ2dlZCBlbGVtZW50IGxlYXZlcyBhIHZhbGlkIGRyb3AgdGFyZ2V0LlxuICAgICAqL1xuICBAT3V0cHV0KCkgZHJhZ0xlYXZlRXZlbnQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgLyoqXG4gICAgICogRXZlbnQgZmlyZWQgd2hlbiBhbiBlbGVtZW50IGlzIGRyb3BwZWQgb24gYSB2YWxpZCBkcm9wIHRhcmdldC5cbiAgICAgKi9cbiAgQE91dHB1dCgpIGRyb3BFdmVudDogRXZlbnRFbWl0dGVyPERyb3BFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPERyb3BFdmVudD4oKTsgLy8g5rOo5oSP5L2/55So5LqG6Jma5ouf5rua5Yqo5ZCO77yMRHJvcEV2ZW505Lit55qEZHJhZ0Zyb21JbmRleOaXoOaViFxuXG4gIC8qKlxuICAgICAqIENTUyBjbGFzcyBhcHBsaWVkIG9uIHRoZSBkcmFnZ2FibGUgdGhhdCBpcyBhcHBsaWVkIHdoZW4gdGhlIGl0ZW0gaXMgYmVpbmcgZHJhZ2dlZC5cbiAgICAgKi9cbiAgQElucHV0KCkgZHJhZ092ZXJDbGFzczogc3RyaW5nO1xuXG4gIC8qKlxuICAgICAqIERlZmluZXMgY29tcGF0aWJsZSBkcmFnIGRyb3AgcGFpcnMuIFZhbHVlcyBtdXN0IG1hdGNoIGJvdGggaW4gZHJhZ2dhYmxlIGFuZCBkcm9wcGFibGUuZHJvcFNjb3BlLlxuICAgICAqL1xuICBASW5wdXQoKSBkcm9wU2NvcGU6IHN0cmluZyB8IEFycmF5PHN0cmluZz4gPSAnZGVmYXVsdCc7XG5cbiAgQElucHV0KCkgcGxhY2Vob2xkZXJUYWcgPSAnZGl2JztcblxuICBASW5wdXQoKSBwbGFjZWhvbGRlclN0eWxlOiBhbnkgPSB7YmFja2dyb3VuZENvbG9yOiBbJyM4NTliZmYnLCBgdmFyKC0tZGV2dWktYnJhbmQtZm9pbCwgIzg1OWJmZilgXSwgb3BhY2l0eTogJy40J307XG5cbiAgLyoqXG4gICAgICog6K6+572ucGxhY2Vob2xkZXLnmoTmj5DnpLrmgKfmloflrZfvvIzku4XmlK/mjIHmlofmnKzvvIjlronlhajotbfop4HvvIlcbiAgICAgKi9cbiAgQElucHV0KCkgcGxhY2Vob2xkZXJUZXh0ID0gJyc7XG5cbiAgLyoqXG4gICAgICog55So5LqO5YWB6K645ouW5Yqo5Yiw5YWD57Sg5LiK77yM5pa55L6/5qCR5b2i57uT5p6E55qE5ouW5Yqo5Y+v5Lul5oiQ5Li65YWD57Sg55qE5a2Q6IqC54K5XG4gICAgICovXG4gIEBJbnB1dCgpIGFsbG93RHJvcE9uSXRlbSA9IGZhbHNlO1xuXG4gIC8qKlxuICAgICAqIGFsbG93RHJvcE9uSXRlbeS4unRydWXml7bvvIzmiY3mnInmlYjvvIznlKjkuo7lhYHorrjmi5bliqjliLDlhYPntKDkuIrlkI7vvIzooqvlkb3kuK3nmoTlhYPntKDlop7liqDmoLflvI9cbiAgICAgKi9cbiAgQElucHV0KCkgZHJhZ092ZXJJdGVtQ2xhc3M6IHN0cmluZztcblxuICAvKipcbiAgICAgKiAg55So5LqO5L+u5q2j5pyJ5YaF5bWM5YiX6KGo5ZCO77yM54i26aG56auY5bqm6KKr5pKR5aSn77yM5q2k5aSEaGVpZ2h077yMd2lkdGjkuLrniLbpobnoh6rlt7HnmoTpq5jluqbvvIjnlKjkuo7nurXlkJHmi5bliqjvvInvvIzlrr3luqbvvIjnlKjkuo7mqKrlkJHmi5bliqjvvIlcbiAgICAgKiAqL1xuICBASW5wdXQoKSBuZXN0aW5nVGFyZ2V0UmVjdDoge2hlaWdodD86IG51bWJlcjsgd2lkdGg/OiBudW1iZXJ9O1xuXG4gIC8qKlxuICAgICogIOaYr+WQpuWQr+eUqOi2iui/h+eri+WNs+S6pOaNouS9jee9rueahOeul+azlSwg5LiN6IO95LiOYWxsb3dEcm9wT25JdGVt5LiA6LW355So77yMYWxsb3dEcm9wT25JdGVt5Li6dHJ1ZeaXtu+8jOatpOinhOWImeaXoOaViFxuICAgICogKi9cbiAgQElucHV0KCkgc3dpdGNoV2hpbGVDcm9zc0VkZ2UgPSBmYWxzZTtcblxuICAvKipcbiAgICAqICBzb3J0YWJsZeeahOaDheWGteS4i++8jOaLluWKqOWIsOWPr+S7pWRyb3DkvYbkuI3lnKhzb3J0Q29udGFpbmVy6YeM55qE5pe25YCZ6buY6K6kZHJvcOeahOS9jee9rlxuICAgICogKi9cbiAgQElucHV0KCkgZGVmYXVsdERyb3BQb3NpdGlvbjogJ2Nsb3Nlc3QnIHwgJ2JlZm9yZScgfCAnYWZ0ZXInID0gJ2Nsb3Nlc3QnO1xuXG4gIC8qKlxuICAgICogIHNvcnRhYmxl55qE5oOF5Ya15LiL77yM5YiX6KGo5aaC5p6c5L2/55So5LqGdmlydHVhbCBzY3JvbGznrYnpg6jliIbliqDovb3mioDmnK/ml7blgJnov5Tlm57mraPnoa7nmoRkcm9wSW5kZXhcbiAgICAqICovXG4gIEBJbnB1dCgpIGRyb3BTb3J0Q291bnRTZWxlY3Rvcjogc3RyaW5nO1xuICBASW5wdXQoKSBkcm9wU29ydFZpcnR1YWxTY3JvbGxPcHRpb246IHtcbiAgICB0b3RhbExlbmd0aD86IG51bWJlcjtcbiAgICBzdGFydEluZGV4PzogbnVtYmVyO1xuICAgIC8vIGlubmVyU29ydENvbnRhaW5lcj86IEhUTUxFbGVtZW50IHwgc3RyaW5nOyAvLyDnlKjkuo7omZrmi5/mu5rliqjliJfooajnu5PmnoTlj5HnlJ/lhoXltYxcbiAgfTtcbiAgcHJpdmF0ZSBkcm9wRmxhZzogRHJvcEluZGV4RmxhZztcblxuICBwcml2YXRlIHNvcnRDb250YWluZXI6IGFueTtcbiAgcHJpdmF0ZSBzb3J0RGlyZWN0aW9uOiAndicgfCAnaCc7XG4gIHByaXZhdGUgc29ydERpcmVjdGlvblpNb2RlOiBib29sZWFuO1xuICBwcml2YXRlIHBsYWNlaG9sZGVyOiBhbnk7XG5cbiAgLy8g55So5LqO5L+u5aSNZHJhZ2xlYXZl5aSa5qyh6Kem5Y+RXG4gIHByaXZhdGUgZHJhZ0NvdW50ID0gMDtcblxuICBwcml2YXRlIGRyb3BJbmRleCA9IHVuZGVmaW5lZDtcblxuICBwcml2YXRlIGRyYWdTdGFydFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICBwcml2YXRlIGRyYWdFbmRTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgcHJpdmF0ZSBkcm9wRW5kU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG5cbiAgLy8g6K6w5b2V5LiK5LiA5qyh5oKs5YGc55qE5YWD57Sg77yM55So5LqO5a+55q+U5oKs5YGc55qE5YWD57Sg562J5piv5ZCm5Y+R55Sf5Y+Y5YyWXG4gIHByaXZhdGUgb3ZlckVsZW1lbnQ7XG5cbiAgcHJpdmF0ZSBkcmFnUGFydEV2ZW50U3ViOiBTdWJzY3JpcHRpb247XG4gIHByaXZhdGUgYWxsb3dEcm9wQ2FjaGU6IGJvb2xlYW47XG4gIHByaXZhdGUgZHJhZ0VsSW5kZXg7XG4gIC8qIOWNj+WQjOaLluaLvemcgOimgSAqL1xuICBwbGFjZWhvbGRlckluc2VydGlvbkV2ZW50ID0gbmV3IFN1YmplY3Q8RHJhZ1BsYWNlaG9sZGVySW5zZXJ0aW9uRXZlbnQ+KCk7XG4gIHBsYWNlaG9sZGVyUmVuZGVyRXZlbnQgPSBuZXcgU3ViamVjdDxhbnk+KCk7XG4gIGRvY3VtZW50OiBEb2N1bWVudDtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBkcmFnRHJvcFNlcnZpY2U6IERyYWdEcm9wU2VydmljZSwgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSxcbiAgICAgICAgICAgICAgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2M6IGFueSkge1xuICAgIHRoaXMuZG9jdW1lbnQgPSB0aGlzLmRvYztcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMucGxhY2Vob2xkZXIgPSB0aGlzLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGhpcy5wbGFjZWhvbGRlclRhZyk7XG4gICAgdGhpcy5wbGFjZWhvbGRlci5jbGFzc05hbWUgPSAnZHJhZy1wbGFjZWhvbGRlcic7XG4gICAgdGhpcy5wbGFjZWhvbGRlci5pbm5lclRleHQgPSB0aGlzLnBsYWNlaG9sZGVyVGV4dDtcbiAgICB0aGlzLmRyYWdTdGFydFN1YnNjcmlwdGlvbiA9IHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdTdGFydEV2ZW50LnN1YnNjcmliZSgoKSA9PiB0aGlzLnNldFBsYWNlaG9sZGVyKCkpO1xuICAgIGlmICh0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnZ2VkRWwpIHtcbiAgICAgIHRoaXMuc2V0UGxhY2Vob2xkZXIoKTsgLy8g6Jma5ouf5rua5Yqo55Sf5oiQ5YWD57Sg6L+H56iL5LitXG4gICAgfVxuICAgIHRoaXMuZHJvcEVuZFN1YnNjcmlwdGlvbiA9IHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyb3BFdmVudC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdnZWRFbCkge1xuICAgICAgICBpZiAoIXRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdGb2xsb3cpIHtcbiAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdnZWRFbCwgJ2Rpc3BsYXknLCAnJyk7XG4gICAgICAgICAgdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJhZ0VsU2hvd0hpZGVFdmVudC5uZXh0KHRydWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLnJlbW92ZVBsYWNlaG9sZGVyKCk7XG4gICAgICB0aGlzLm92ZXJFbGVtZW50ID0gdW5kZWZpbmVkO1xuICAgICAgdGhpcy5hbGxvd0Ryb3BDYWNoZSA9IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMuZHJhZ0VsSW5kZXggPSB1bmRlZmluZWQ7XG4gICAgICB0aGlzLmRyb3BJbmRleCA9IHVuZGVmaW5lZDtcbiAgICB9KTtcbiAgICB0aGlzLmRyYWdFbmRTdWJzY3JpcHRpb24gPSB0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnRW5kRXZlbnQuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIGlmICh0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnZ2VkRWwpIHtcbiAgICAgICAgaWYgKCF0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnRm9sbG93KSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnZ2VkRWwsICdkaXNwbGF5JywgJycpO1xuICAgICAgICAgIHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdFbFNob3dIaWRlRXZlbnQubmV4dCh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5yZW1vdmVQbGFjZWhvbGRlcigpO1xuICAgICAgdGhpcy5kcmFnQ291bnQgPSAwO1xuICAgICAgdGhpcy5vdmVyRWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMuYWxsb3dEcm9wQ2FjaGUgPSB1bmRlZmluZWQ7XG4gICAgICB0aGlzLmRyYWdFbEluZGV4ID0gdW5kZWZpbmVkO1xuICAgICAgdGhpcy5kcm9wSW5kZXggPSB1bmRlZmluZWQ7XG4gICAgfSk7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIgKCgpID0+IHtcbiAgICAgIHRoaXMuZHJhZ1BhcnRFdmVudFN1YiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcbiAgICAgIHRoaXMuZHJhZ1BhcnRFdmVudFN1Yi5hZGQoZnJvbUV2ZW50PERyYWdFdmVudD4odGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnZHJhZ292ZXInKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBmaWx0ZXIoZXZlbnQgPT4gdGhpcy5hbGxvd0Ryb3AoZXZlbnQpKSxcbiAgICAgICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgocHJldiAsIGN1cnJlbnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGJvb2wgPSAocHJldi5jbGllbnRYID09PSBjdXJyZW50LmNsaWVudFggJiYgcHJldi5jbGllbnRZID09PSBjdXJyZW50LmNsaWVudFkgJiYgcHJldi50YXJnZXQgPT09IGN1cnJlbnQudGFyZ2V0KTtcbiAgICAgICAgICAgIGlmIChib29sKSB7IGN1cnJlbnQucHJldmVudERlZmF1bHQoKTsgY3VycmVudC5zdG9wUHJvcGFnYXRpb24oKTsgfVxuICAgICAgICAgICAgcmV0dXJuIGJvb2w7XG4gICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKChldmVudCkgPT4gdGhpcy5kcmFnT3ZlcihldmVudCkpXG4gICAgICApO1xuICAgICAgdGhpcy5kcmFnUGFydEV2ZW50U3ViLmFkZChcbiAgICAgICAgZnJvbUV2ZW50KHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2RyYWdlbnRlcicpLnN1YnNjcmliZSgoZXZlbnQpID0+IHRoaXMuZHJhZ0VudGVyKGV2ZW50KSlcbiAgICAgICk7XG4gICAgICB0aGlzLmRyYWdQYXJ0RXZlbnRTdWIuYWRkKFxuICAgICAgICBmcm9tRXZlbnQodGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnZHJhZ2xlYXZlJykuc3Vic2NyaWJlKChldmVudCkgPT4gdGhpcy5kcmFnTGVhdmUoZXZlbnQpKVxuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICBpZiAodGhpcy5lbC5uYXRpdmVFbGVtZW50Lmhhc0F0dHJpYnV0ZSgnZC1zb3J0YWJsZScpKSB7XG4gICAgICB0aGlzLnNvcnRDb250YWluZXIgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc29ydENvbnRhaW5lciA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdbZC1zb3J0YWJsZV0nKTtcbiAgICB9XG4gICAgdGhpcy5zb3J0RGlyZWN0aW9uID0gdGhpcy5zb3J0Q29udGFpbmVyID8gdGhpcy5zb3J0Q29udGFpbmVyLmdldEF0dHJpYnV0ZSgnZHNvcnRhYmxlJykgfHwgJ3YnIDogJ3YnO1xuICAgIHRoaXMuc29ydERpcmVjdGlvblpNb2RlID0gdGhpcy5zb3J0Q29udGFpbmVyID8gKHRoaXMuc29ydENvbnRhaW5lci5nZXRBdHRyaWJ1dGUoJ2Qtc29ydGFibGUtem1vZGUnKSA9PT0gJ3RydWUnIHx8IGZhbHNlKSA6IGZhbHNlO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5kcmFnU3RhcnRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLmRyYWdFbmRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLmRyb3BFbmRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICBpZiAodGhpcy5kcmFnUGFydEV2ZW50U3ViKSB7dGhpcy5kcmFnUGFydEV2ZW50U3ViLnVuc3Vic2NyaWJlKCk7IH1cbiAgfVxuXG4gIGRyYWdFbnRlcihlKSB7XG4gICAgdGhpcy5kcmFnQ291bnQrKztcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7IC8vIGllMTEgZHJhZ2VudGVy6ZyA6KaBcHJldmVudERlZmF1bHTlkKbliJlkcmFnb3ZlcuaXoOaViFxuICAgIHRoaXMuZHJhZ0VudGVyRXZlbnQuZW1pdChlKTtcbiAgfVxuXG4gIGRyYWdPdmVyKGUpIHtcbiAgICBpZiAodGhpcy5hbGxvd0Ryb3AoZSkpIHtcbiAgICAgIGlmICh0aGlzLmRyYWdEcm9wU2VydmljZS5kcm9wVGFyZ2V0cy5pbmRleE9mKHRoaXMuZWwpID09PSAtMSkge1xuICAgICAgICB0aGlzLmRyYWdEcm9wU2VydmljZS5kcm9wVGFyZ2V0cy5mb3JFYWNoKGVsID0+IHtcbiAgICAgICAgICBjb25zdCBwbGFjZUhvbGRlckVsID0gZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZHJhZy1wbGFjZWhvbGRlcicpO1xuICAgICAgICAgIGlmIChwbGFjZUhvbGRlckVsKSB7XG4gICAgICAgICAgICBwbGFjZUhvbGRlckVsLnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQocGxhY2VIb2xkZXJFbCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIFV0aWxzLnJlbW92ZUNsYXNzKGVsLCB0aGlzLmRyYWdPdmVyQ2xhc3MpO1xuICAgICAgICAgIHRoaXMucmVtb3ZlRHJhZ292ZXJJdGVtQ2xhc3MoZWwubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmRyYWdEcm9wU2VydmljZS5kcm9wVGFyZ2V0cyA9IFt0aGlzLmVsXTtcbiAgICAgICAgdGhpcy5vdmVyRWxlbWVudCA9IHVuZGVmaW5lZDsgLy8g5ZCm5YiZ5Lya6YGH5Yiw5LiK5LiA5qyhcG9zaXRpb249IOi/meS4gOasoeeahOeEtuWQjuS4jeWIt+aWsOWSjOaPkuWFpeOAglxuICAgICAgfVxuICAgICAgVXRpbHMuYWRkQ2xhc3ModGhpcy5lbCwgdGhpcy5kcmFnT3ZlckNsYXNzKTtcbiAgICAgIGNvbnN0IGhpdFBsYWNlaG9sZGVyXG4gICAgICAgICAgPSB0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnT3JpZ2luUGxhY2Vob2xkZXIgJiYgdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJhZ09yaWdpblBsYWNlaG9sZGVyLmNvbnRhaW5zKGUudGFyZ2V0KTtcbiAgICAgIGlmICh0aGlzLnNvcnRDb250YWluZXIgJiYgKFxuICAgICAgICAoaGl0UGxhY2Vob2xkZXIgJiYgdGhpcy5vdmVyRWxlbWVudCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgIHx8ICEoZS50YXJnZXQuY29udGFpbnModGhpcy5wbGFjZWhvbGRlcikgfHwgaGl0UGxhY2Vob2xkZXIpXG4gICAgICAgICAgfHwgKHRoaXMuc3dpdGNoV2hpbGVDcm9zc0VkZ2UgJiYgIXRoaXMucGxhY2Vob2xkZXIuY29udGFpbnMoZS50YXJnZXQpICYmICFoaXRQbGFjZWhvbGRlcikgLy8g6LaK6L655Lqk5o2i5Zue5oqY55qE5oOF5Ya16ZyA6KaB6YeN5paw6K6h566XXG4gICAgICAgICAgfHwgKCF0aGlzLnNvcnRDb250YWluZXIuY29udGFpbnMoZS50YXJnZXQpICYmIHRoaXMuZGVmYXVsdERyb3BQb3NpdGlvbiA9PT0gJ2Nsb3Nlc3QnKSAvLyDlsLHov5HmqKHlvI/pnIDopoHph43mlrDorqHnrpdcbiAgICAgICkpIHtcbiAgICAgICAgY29uc3Qgb3ZlckVsZW1lbnQgPSB0aGlzLmZpbmRTb3J0YWJsZUVsKGUpO1xuICAgICAgICBpZiAoISh0aGlzLm92ZXJFbGVtZW50ICYmIG92ZXJFbGVtZW50KSB8fCB0aGlzLm92ZXJFbGVtZW50LmluZGV4ICE9PSBvdmVyRWxlbWVudC5pbmRleFxuICAgICAgICAgICAgfHwgKHRoaXMuYWxsb3dEcm9wT25JdGVtICYmIHRoaXMub3ZlckVsZW1lbnQucG9zaXRpb24gIT09IG92ZXJFbGVtZW50LnBvc2l0aW9uXG4gICAgICAgICAgICAgICYmICh0aGlzLm92ZXJFbGVtZW50LnBvc2l0aW9uID09PSAnaW5zaWRlJyB8fCBvdmVyRWxlbWVudC5wb3NpdGlvbiA9PT0gJ2luc2lkZScpKVxuICAgICAgICApIHtcbiAgICAgICAgICAvLyBvdmVyRWxlbWVudOeahOWPguaVsOacieWIt+aWsOeahOaXtuWAmeaJjei/m+ihjOaPkuWFpeetieaTjeS9nFxuICAgICAgICAgIHRoaXMub3ZlckVsZW1lbnQgPSBvdmVyRWxlbWVudDtcblxuICAgICAgICAgIHRoaXMuaW5zZXJ0UGxhY2Vob2xkZXIob3ZlckVsZW1lbnQpO1xuXG4gICAgICAgICAgdGhpcy5yZW1vdmVEcmFnb3Zlckl0ZW1DbGFzcyh0aGlzLnNvcnRDb250YWluZXIsIG92ZXJFbGVtZW50KTtcbiAgICAgICAgICBpZiAob3ZlckVsZW1lbnQucG9zaXRpb24gPT09ICdpbnNpZGUnICYmIHRoaXMuZHJhZ092ZXJJdGVtQ2xhc3MpIHtcbiAgICAgICAgICAgIFV0aWxzLmFkZENsYXNzKG92ZXJFbGVtZW50LmVsLCB0aGlzLmRyYWdPdmVySXRlbUNsYXNzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5vdmVyRWxlbWVudCA9IG92ZXJFbGVtZW50O1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5zb3J0Q29udGFpbmVyICYmIHRoaXMub3ZlckVsZW1lbnQgJiYgdGhpcy5vdmVyRWxlbWVudC5lbCkge1xuICAgICAgICAgIGlmICghdGhpcy5vdmVyRWxlbWVudC5lbC5jb250YWlucyhlLnRhcmdldCkpIHtcbiAgICAgICAgICAgIHRoaXMub3ZlckVsZW1lbnQucmVhbEVsID0gZS50YXJnZXQ7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMub3ZlckVsZW1lbnQucmVhbEVsID0gdW5kZWZpbmVkO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdnZWRFbCkge1xuICAgICAgICBpZiAoIXRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdGb2xsb3cpIHtcbiAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdnZWRFbCwgJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICAgIHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdFbFNob3dIaWRlRXZlbnQubmV4dChmYWxzZSk7XG4gICAgICAgICAgaWYgKHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdPcmlnaW5QbGFjZWhvbGRlcikge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnT3JpZ2luUGxhY2Vob2xkZXIsICdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgdGhpcy5kcmFnT3ZlckV2ZW50LmVtaXQoZSk7XG4gICAgfVxuICB9XG5cbiAgZHJhZ0xlYXZlKGUpIHtcbiAgICAvLyDnlKjkuo7kv67lpI3ljIXlkKvlrZDlhYPntKDml7bvvIzlpJrmrKHop6blj5FkcmFnbGVhdmVcbiAgICB0aGlzLmRyYWdDb3VudC0tO1xuXG4gICAgaWYgKHRoaXMuZHJhZ0NvdW50ID09PSAwKSB7XG4gICAgICBpZiAodGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJvcFRhcmdldHMuaW5kZXhPZih0aGlzLmVsKSAhPT0gLTEpIHtcbiAgICAgICAgdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJvcFRhcmdldHMgPSBbXTtcbiAgICAgIH1cbiAgICAgIFV0aWxzLnJlbW92ZUNsYXNzKHRoaXMuZWwsIHRoaXMuZHJhZ092ZXJDbGFzcyk7XG4gICAgICB0aGlzLnJlbW92ZVBsYWNlaG9sZGVyKCk7XG4gICAgICB0aGlzLnJlbW92ZURyYWdvdmVySXRlbUNsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XG4gICAgICB0aGlzLm92ZXJFbGVtZW50ID0gdW5kZWZpbmVkO1xuICAgICAgdGhpcy5kcmFnRWxJbmRleCA9IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMuZHJvcEluZGV4ID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgdGhpcy5kcmFnTGVhdmVFdmVudC5lbWl0KGUpO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignZHJvcCcsIFsnJGV2ZW50J10pXG4gIGRyb3AoZSkge1xuICAgIGlmICghdGhpcy5hbGxvd0Ryb3AoZSkpIHsgcmV0dXJuOyB9XG4gICAgdGhpcy5kcmFnQ291bnQgPSAwO1xuICAgIFV0aWxzLnJlbW92ZUNsYXNzKHRoaXMuZWwsIHRoaXMuZHJhZ092ZXJDbGFzcyk7XG4gICAgdGhpcy5yZW1vdmVEcmFnb3Zlckl0ZW1DbGFzcyh0aGlzLnNvcnRDb250YWluZXIpO1xuICAgIHRoaXMucmVtb3ZlUGxhY2Vob2xkZXIoKTtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLmRyYWdEcm9wU2VydmljZS5kcm9wT25PcmlnaW4gPSB0aGlzLmlzRHJhZ1BsYWNlaG9sZGVyUG9zaXRpb24odGhpcy5kcm9wSW5kZXgpO1xuICAgIGNvbnN0IGRyYWdnZWRFbElkZW50aXR5ID0gdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJhZ2dlZEVsSWRlbnRpdHk7XG4gICAgdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJhZ2dlZEVsSWRlbnRpdHkgPSB1bmRlZmluZWQ7IC8vIOmcgOimgeaPkOWJjea4hemZpO+8jOmBv+WFjeaWsOeUn+aIkOeahOiKgueCueWkjeeUqOS6hmlkIOWIt+aWsOS6hmRyYWdPcmlnaW5QbGFjZWhvbGRlclxuICAgIGxldCBiYXRjaERyYWdnYmxlOiBBcnJheTxEcmFnZ2FibGVEaXJlY3RpdmU+ID0gW107XG4gICAgaWYgKHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmJhdGNoRHJhZ0RhdGEgJiYgdGhpcy5kcmFnRHJvcFNlcnZpY2UuYmF0Y2hEcmFnRGF0YS5sZW5ndGggPiAxKSB7XG4gICAgICBiYXRjaERyYWdnYmxlID0gdGhpcy5kcmFnRHJvcFNlcnZpY2UuYmF0Y2hEcmFnRGF0YS5tYXAoZHJhZ0RhdGEgPT4gZHJhZ0RhdGEuZHJhZ2dhYmxlKVxuICAgICAgICAuZmlsdGVyKGRyYWdnYWJsZSA9PiBkcmFnZ2FibGUgJiYgZHJhZ2dhYmxlLmVsLm5hdGl2ZUVsZW1lbnQgIT09IHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdnZWRFbCk7XG4gICAgfVxuICAgIHRoaXMuZHJvcEV2ZW50LmVtaXQoXG4gICAgICBuZXcgRHJvcEV2ZW50KFxuICAgICAgICBlLFxuICAgICAgICB0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnRGF0YSxcbiAgICAgICAgdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJvcEV2ZW50LFxuICAgICAgICB0aGlzLmRyb3BTb3J0VmlydHVhbFNjcm9sbE9wdGlvbiA/IHRoaXMuZ2V0UmVhbEluZGV4KHRoaXMuZHJvcEluZGV4LCB0aGlzLmRyb3BGbGFnKSA6IHRoaXMuZHJvcEluZGV4LFxuICAgICAgICB0aGlzLnNvcnRDb250YWluZXIgPyB0aGlzLmNoZWNrU2VsZkZyb21JbmRleCh0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnZ2VkRWwpIDogLTEsXG4gICAgICAgIHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyb3BPbkl0ZW0sXG4gICAgICAgIHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyb3BPbk9yaWdpbixcbiAgICAgICAgKHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmJhdGNoRHJhZ2dpbmcpXG4gICAgICAgICAgPyB0aGlzLmRyYWdEcm9wU2VydmljZS5nZXRCYXRjaERyYWdEYXRhKGRyYWdnZWRFbElkZW50aXR5KVxuICAgICAgICAgIDogdW5kZWZpbmVkXG4gICAgICApXG4gICAgKTtcbiAgICAvLyDlpoLmnpxkcm9w5LmL5ZCOZHJhZ+WFg+e0oOiiq+WIoOmZpO+8jOWImeS4jeS8muWPkeeUn2RyYWdlbmTkuovku7bvvIzpnIDopoHku6Pmm79kcmFnZW5k5riF55CGXG4gICAgaWYgKHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdGb2xsb3cpIHtcbiAgICAgIHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRpc2FibGVEcmFnZ2VkQ2xvbmVOb2RlRm9sbG93TW91c2UoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnZ2VkRWwsICdkaXNwbGF5JywgJycpO1xuICAgICAgdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJhZ0VsU2hvd0hpZGVFdmVudC5uZXh0KGZhbHNlKTtcbiAgICB9XG4gICAgaWYgKGJhdGNoRHJhZ2dibGUubGVuZ3RoID4gMCAmJiB0aGlzLmRyYWdEcm9wU2VydmljZS5iYXRjaERyYWdnaW5nKSB7XG4gICAgICBiYXRjaERyYWdnYmxlLmZvckVhY2goKGRyYWdnYWJsZSkgPT4ge1xuICAgICAgICBpZiAoIWRyYWdnYWJsZS5vcmlnaW5QbGFjZWhvbGRlciB8fCBkcmFnZ2FibGUub3JpZ2luUGxhY2Vob2xkZXIuc2hvdyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICBkcmFnZ2FibGUuZWwubmF0aXZlRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJyc7XG4gICAgICAgIH0gZWxzZSBpZiAoZHJhZ2dhYmxlLm9yaWdpblBsYWNlaG9sZGVyLnJlbW92ZURlbGF5ID4gMCAmJiAhdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJvcE9uT3JpZ2luKSB7XG4gICAgICAgICAgZHJhZ2dhYmxlLmRlbGF5UmVtb3ZlT3JpZ2luUGxhY2Vob2xkZXIoZmFsc2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRyYWdnYWJsZS5lbC5uYXRpdmVFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnJztcbiAgICAgICAgICBkcmFnZ2FibGUucmVtb3ZlT3JpZ2luUGxhY2Vob2xkZXIoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJvcEV2ZW50Lm5leHQoZSk7XG4gICAgdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJhZ0RhdGEgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5kcmFnRHJvcFNlcnZpY2Uuc2NvcGUgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJhZ2dlZEVsID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdGb2xsb3cgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJhZ0ZvbGxvd09wdGlvbnMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJhZ09mZnNldCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmRyYWdEcm9wU2VydmljZS5kcm9wT25PcmlnaW4gPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5kcmFnRHJvcFNlcnZpY2UuYmF0Y2hEcmFnZ2luZyA9IGZhbHNlO1xuICAgIHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmJhdGNoRHJhZ1N0eWxlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdQcmV2aWV3RGlyZWN0aXZlID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgYWxsb3dEcm9wKGUpOiBib29sZWFuIHtcbiAgICBpZiAoIWUpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgaWYgKHRoaXMuYWxsb3dEcm9wQ2FjaGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIHRoaXMuYWxsb3dEcm9wQ2FjaGU7XG4gICAgfVxuICAgIGxldCBhbGxvd2VkID0gZmFsc2U7XG4gICAgaWYgKHR5cGVvZiB0aGlzLmRyb3BTY29wZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5kcmFnRHJvcFNlcnZpY2Uuc2NvcGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGFsbG93ZWQgPSB0aGlzLmRyYWdEcm9wU2VydmljZS5zY29wZSA9PT0gdGhpcy5kcm9wU2NvcGU7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5kcmFnRHJvcFNlcnZpY2Uuc2NvcGUgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICBhbGxvd2VkID0gdGhpcy5kcmFnRHJvcFNlcnZpY2Uuc2NvcGUuaW5kZXhPZih0aGlzLmRyb3BTY29wZSkgPiAtMTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMuZHJvcFNjb3BlIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5kcmFnRHJvcFNlcnZpY2Uuc2NvcGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGFsbG93ZWQgPSB0aGlzLmRyb3BTY29wZS5pbmRleE9mKHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLnNjb3BlKSA+IC0xO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLnNjb3BlIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgYWxsb3dlZCA9IHRoaXMuZHJvcFNjb3BlLmZpbHRlcigoaXRlbSkgPT4ge1xuICAgICAgICAgIHJldHVybiB0aGlzLmRyYWdEcm9wU2VydmljZS5zY29wZS5pbmRleE9mKGl0ZW0pICE9PSAtMTtcbiAgICAgICAgfSkubGVuZ3RoID4gMDtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5hbGxvd0Ryb3BDYWNoZSA9IGFsbG93ZWQ7XG4gICAgcmV0dXJuIGFsbG93ZWQ7XG4gIH1cblxuICBwcml2YXRlIGRyb3BTb3J0Q291bnRTZWxlY3RvckZpbHRlckZuID0gKHZhbHVlKSA9PiB7XG4gICAgcmV0dXJuIFV0aWxzLm1hdGNoZXModmFsdWUsIHRoaXMuZHJvcFNvcnRDb3VudFNlbGVjdG9yKVxuICAgICAgfHwgdmFsdWUuY29udGFpbnModGhpcy5wbGFjZWhvbGRlcilcbiAgICAgIHx8IHZhbHVlID09PSB0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnT3JpZ2luUGxhY2Vob2xkZXI7XG4gIH07XG5cbiAgLy8g5p+l6K+i6ZyA6KaB5o+S5YWlcGxhY2Vob2xkZXLnmoTkvY3nva5cbiAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbXBsZXhpdHkqL1xuICBwcml2YXRlIGZpbmRTb3J0YWJsZUVsKGV2ZW50KSB7XG4gICAgY29uc3QgbW92ZUVsZW1lbnQgPSBldmVudC50YXJnZXQ7XG4gICAgbGV0IG92ZXJFbGVtZW50ID0gbnVsbDtcbiAgICBpZiAoIXRoaXMuc29ydENvbnRhaW5lcikge1xuICAgICAgcmV0dXJuIG92ZXJFbGVtZW50O1xuICAgIH1cbiAgICBvdmVyRWxlbWVudCA9IHtpbmRleDogMCwgZWw6IG51bGwsIHBvc2l0aW9uOiAnYmVmb3JlJ307XG4gICAgdGhpcy5kcm9wSW5kZXggPSAwO1xuICAgIHRoaXMuZHJvcEZsYWcgPSB1bmRlZmluZWQ7XG4gICAgbGV0IGNoaWxkRWxzID0gVXRpbHMuc2xpY2UodGhpcy5zb3J0Q29udGFpbmVyLmNoaWxkcmVuKTtcbiAgICAvLyDliKDpmaTomZrmi5/mu5rliqjnrYnnmoTpop3lpJblhYPntKDkuI3pnIDopoHorqHnrpfnmoTlhYPntKBcbiAgICBpZiAodGhpcy5kcm9wU29ydENvdW50U2VsZWN0b3IpIHtcbiAgICAgIGNoaWxkRWxzID0gY2hpbGRFbHMuZmlsdGVyKHRoaXMuZHJvcFNvcnRDb3VudFNlbGVjdG9yRmlsdGVyRm4pO1xuICAgIH1cbiAgICAvLyDlpoLmnpzmsqHmnInkuLvliqjliKDpmaTliJnliKDpmaTlpJrkvZnnmoRvcmlnaW5wbGFjZWhvbGRlclxuICAgIGlmIChjaGlsZEVscy5zb21lKGVsID0+XG4gICAgICBlbCAhPT0gdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJhZ09yaWdpblBsYWNlaG9sZGVyXG4gICAgICAmJiBlbC5jbGFzc0xpc3QuY29udGFpbnMoJ2RyYWctb3JpZ2luLXBsYWNlaG9sZGVyJylcbiAgICApKSB7XG4gICAgICBjaGlsZEVscyA9IGNoaWxkRWxzLmZpbHRlcihlbCA9PlxuICAgICAgICAhKGVsLmNsYXNzTGlzdC5jb250YWlucygnZHJhZy1vcmlnaW4tcGxhY2Vob2xkZXInKVxuICAgICAgICAmJiBlbCAhPT0gdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJhZ09yaWdpblBsYWNlaG9sZGVyKVxuICAgICAgKTtcbiAgICB9XG4gICAgLy8g6KaB5YWI5Yig6ZmkY2xvbmVub2Rl5ZCm5YiZcGxhY2Vob2xkZXJpbmRleOaYr+mUmeeahFxuICAgIGlmICh0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnRm9sbG93ICYmIHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdDbG9uZU5vZGUpIHtcbiAgICAgIGNvbnN0IGNsb25lTm9kZUluZGV4ID0gY2hpbGRFbHMuZmluZEluZGV4KHZhbHVlID0+IHZhbHVlID09PSB0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnQ2xvbmVOb2RlKTtcbiAgICAgIGlmICgtMSAhPT0gY2xvbmVOb2RlSW5kZXgpIHtcbiAgICAgICAgY2hpbGRFbHMuc3BsaWNlKGNsb25lTm9kZUluZGV4LCAxKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8g6K6h566XaW5kZXjmlbDnu4TpnIDopoHliKDpmaTmupDljaDkvY3nrKZcbiAgICBpZiAodGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJhZ09yaWdpblBsYWNlaG9sZGVyKSB7XG4gICAgICBjb25zdCBkcmFnT3JpZ2luUGxhY2Vob2xkZXJJbmRleCA9IGNoaWxkRWxzLmZpbmRJbmRleCh2YWx1ZSA9PiB2YWx1ZSA9PT0gdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJhZ09yaWdpblBsYWNlaG9sZGVyKTtcbiAgICAgIGlmICgtMSAhPT0gZHJhZ09yaWdpblBsYWNlaG9sZGVySW5kZXgpIHtcbiAgICAgICAgdGhpcy5kcmFnRWxJbmRleCA9IGRyYWdPcmlnaW5QbGFjZWhvbGRlckluZGV4IC0gMTtcbiAgICAgICAgY2hpbGRFbHMuc3BsaWNlKGRyYWdPcmlnaW5QbGFjZWhvbGRlckluZGV4LCAxKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZHJhZ0VsSW5kZXggPSAtMTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kcmFnRWxJbmRleCA9IC0xO1xuICAgIH1cbiAgICAvLyDmn6Xor6LmmK/lkKblt7Lnu4/mj5LlhaXkuoZwbGFjZWhvbGRlclxuICAgIGNvbnN0IHBsYWNlaG9sZGVySW5kZXggPSBjaGlsZEVscy5maW5kSW5kZXgodmFsdWUgPT4gdmFsdWUuY29udGFpbnModGhpcy5wbGFjZWhvbGRlcikpO1xuICAgIC8vIOWIoOmZpHBsYWNlaG9sZGVyXG4gICAgaWYgKC0xICE9PSBwbGFjZWhvbGRlckluZGV4KSB7XG4gICAgICBjaGlsZEVscy5zcGxpY2UocGxhY2Vob2xkZXJJbmRleCwgMSk7XG4gICAgfVxuICAgIC8vIOWmguaenOi/mOaciXBsYWNlaG9sZGVy5Zyo5YmN6Z2iIGRyYWdFbEluZGV45b6X5YaN5YeP5LiAXG4gICAgaWYgKC0xICE9PSBwbGFjZWhvbGRlckluZGV4ICYmIC0xICE9PSAgdGhpcy5kcmFnRWxJbmRleCAmJiBwbGFjZWhvbGRlckluZGV4IDwgdGhpcy5kcmFnRWxJbmRleCkge1xuICAgICAgdGhpcy5kcmFnRWxJbmRleC0tO1xuICAgIH1cbiAgICBjb25zdCBwb3NpdGlvbkluZGV4ID0gLTEgIT09IHBsYWNlaG9sZGVySW5kZXggPyBwbGFjZWhvbGRlckluZGV4IDogdGhpcy5kcmFnRWxJbmRleDtcbiAgICBjb25zdCBjdXJyZW50SW5kZXggPSBjaGlsZEVscy5maW5kSW5kZXgodmFsdWUgPT4gKFxuICAgICAgdmFsdWUuY29udGFpbnMobW92ZUVsZW1lbnQpXG4gICAgICAgIHx8IHZhbHVlLm5leHRFbGVtZW50U2libGluZyA9PT0gbW92ZUVsZW1lbnRcbiAgICAgICAgJiYgdmFsdWUubmV4dEVsZW1lbnRTaWJsaW5nLmNsYXNzTGlzdC5jb250YWlucygnZHJhZy1vcmlnaW4tcGxhY2Vob2xkZXInKSlcbiAgICApO1xuICAgIGlmICh0aGlzLnN3aXRjaFdoaWxlQ3Jvc3NFZGdlICYmICF0aGlzLmFsbG93RHJvcE9uSXRlbSAmJiBjaGlsZEVscy5sZW5ndGhcbiAgICAgICYmIC0xICE9PSBwb3NpdGlvbkluZGV4XG4gICAgICAmJiBjdXJyZW50SW5kZXggPiAtMVxuICAgICkgeyAvLyDotorov4flhYPntKDovrnnlYznq4vljbPkuqTmjaLkvY3nva7nrpfms5VcbiAgICAgIGNvbnN0IGxhc3RJbmRleCA9IHBvc2l0aW9uSW5kZXg7XG4gICAgICAvLyDop6PlhrPmipbliqhcbiAgICAgIGNvbnN0IHJlYWxFbCA9IHRoaXMub3ZlckVsZW1lbnQgJiYgKHRoaXMub3ZlckVsZW1lbnQucmVhbEVsIHx8IHRoaXMub3ZlckVsZW1lbnQuZWwpO1xuICAgICAgaWYgKC0xICE9PSBjdXJyZW50SW5kZXggJiYgcmVhbEVsID09PSBjaGlsZEVsc1tjdXJyZW50SW5kZXhdKSB7XG4gICAgICAgIHRoaXMuZHJvcEluZGV4ID0gdGhpcy5vdmVyRWxlbWVudC5pbmRleDtcbiAgICAgICAgcmV0dXJuIHRoaXMub3ZlckVsZW1lbnQ7XG4gICAgICB9XG5cbiAgICAgIG92ZXJFbGVtZW50ID0ge1xuICAgICAgICBpbmRleDogbGFzdEluZGV4ID4gY3VycmVudEluZGV4ID8gIGN1cnJlbnRJbmRleCA6IChjdXJyZW50SW5kZXggKyAxKSxcbiAgICAgICAgZWw6ICBjaGlsZEVsc1tjdXJyZW50SW5kZXhdLFxuICAgICAgICBwb3NpdGlvbjogbGFzdEluZGV4ID4gY3VycmVudEluZGV4ID8gJ2JlZm9yZScgOiAnYWZ0ZXInXG4gICAgICB9O1xuXG4gICAgICB0aGlzLmRyYWdEcm9wU2VydmljZS5kcm9wT25JdGVtID0gZmFsc2U7XG4gICAgICB0aGlzLmRyb3BJbmRleCA9IG92ZXJFbGVtZW50LmluZGV4O1xuICAgICAgcmV0dXJuIG92ZXJFbGVtZW50O1xuICAgIH1cblxuICAgIGlmIChtb3ZlRWxlbWVudCA9PT0gdGhpcy5zb3J0Q29udGFpbmVyXG4gICAgICB8fCBtb3ZlRWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2RyYWctb3JpZ2luLXBsYWNlaG9sZGVyJylcbiAgICAgIHx8IG1vdmVFbGVtZW50ID09PSAodGhpcy5kcmFnRHJvcFNlcnZpY2UgJiYgdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJhZ09yaWdpblBsYWNlaG9sZGVyKVxuICAgICAgfHwgKCF0aGlzLnNvcnRDb250YWluZXIuY29udGFpbnMobW92ZUVsZW1lbnQpICYmIHRoaXMuZGVmYXVsdERyb3BQb3NpdGlvbiA9PT0gJ2Nsb3Nlc3QnKVxuICAgICkge1xuICAgICAgaWYgKCFjaGlsZEVscy5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy5kcm9wSW5kZXggPSAwO1xuICAgICAgICB0aGlzLmRyYWdEcm9wU2VydmljZS5kcm9wT25JdGVtID0gZmFsc2U7XG4gICAgICAgIHJldHVybiBvdmVyRWxlbWVudDtcbiAgICAgIH1cbiAgICAgIC8vIOiQveWFpUHlhYPntKDlkoxC5YWD57Sg55qE6Ze06ZqZ6YeMXG4gICAgICBsZXQgZmluZEluR2FwID0gZmFsc2U7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNoaWxkRWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHRhcmdldEVsZW1lbnQgPSBjaGlsZEVsc1tpXTtcbiAgICAgICAgLy8g5aSE55CG6Z2e6LaK6L6555qE6JC95Yiwc2lkZS1vcmlnaW4tcGxhY2Vob2xkZXJcbiAgICAgICAgaWYgKGNoaWxkRWxzW2ldLm5leHRTaWJsaW5nID09PSBtb3ZlRWxlbWVudFxuICAgICAgICAgICYmIG1vdmVFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnZHJhZy1vcmlnaW4tcGxhY2Vob2xkZXInKSkge1xuICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5jYWxjUG9zaXRpb24oZXZlbnQsIG1vdmVFbGVtZW50KTtcbiAgICAgICAgICB0aGlzLmRyYWdEcm9wU2VydmljZS5kcm9wT25JdGVtID0gcG9zaXRpb24gPT09ICdpbnNpZGUnO1xuICAgICAgICAgIG92ZXJFbGVtZW50ID0ge2luZGV4OiBwb3NpdGlvbiA9PT0gJ2FmdGVyJyA/IChpICsgMSkgOiBpLCBlbDogY2hpbGRFbHNbaV0sIHBvc2l0aW9uOiBwb3NpdGlvbn07XG4gICAgICAgICAgdGhpcy5kcm9wSW5kZXggPSBvdmVyRWxlbWVudC5pbmRleDtcbiAgICAgICAgICByZXR1cm4gb3ZlckVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcG9zaXRpb25PdXRzaWRlID0gdGhpcy5jYWxjUG9zaXRpb25PdXRzaWRlKGV2ZW50LCB0YXJnZXRFbGVtZW50KTtcbiAgICAgICAgaWYgKHBvc2l0aW9uT3V0c2lkZSA9PT0gJ2JlZm9yZScpIHtcbiAgICAgICAgICB0aGlzLmRyYWdEcm9wU2VydmljZS5kcm9wT25JdGVtID0gZmFsc2U7XG4gICAgICAgICAgb3ZlckVsZW1lbnQgPSB7aW5kZXg6IGksIGVsOiBjaGlsZEVsc1tpXSwgcG9zaXRpb246IHBvc2l0aW9uT3V0c2lkZSwgcmVhbEVsOiBtb3ZlRWxlbWVudH07XG4gICAgICAgICAgdGhpcy5kcm9wSW5kZXggPSBvdmVyRWxlbWVudC5pbmRleDtcbiAgICAgICAgICBmaW5kSW5HYXAgPSB0cnVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGZvciAnbm90c3VyZSdcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCFmaW5kSW5HYXApIHtcbiAgICAgICAgdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJvcE9uSXRlbSA9IGZhbHNlO1xuICAgICAgICBvdmVyRWxlbWVudCA9IHtpbmRleDogY2hpbGRFbHMubGVuZ3RoICwgZWw6ICBjaGlsZEVsc1tjaGlsZEVscy5sZW5ndGggLSAxXSwgcG9zaXRpb246ICdhZnRlcicsIHJlYWxFbDogbW92ZUVsZW1lbnR9O1xuICAgICAgICB0aGlzLmRyb3BJbmRleCA9IGNoaWxkRWxzLmxlbmd0aDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvdmVyRWxlbWVudDtcbiAgICB9XG4gICAgaWYgKCF0aGlzLnNvcnRDb250YWluZXIuY29udGFpbnMobW92ZUVsZW1lbnQpKSB7XG4gICAgICBpZiAodGhpcy5kZWZhdWx0RHJvcFBvc2l0aW9uID09PSAnYmVmb3JlJykge1xuICAgICAgICBvdmVyRWxlbWVudCA9IHtpbmRleDogMCwgZWw6IGNoaWxkRWxzLmxlbmd0aCA/IGNoaWxkRWxzWzBdIDogbnVsbCwgcG9zaXRpb246ICdiZWZvcmUnLCByZWFsRWw6IG1vdmVFbGVtZW50fTtcbiAgICAgICAgdGhpcy5kcm9wRmxhZyA9ICdiZWZvcmVBbGwnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3ZlckVsZW1lbnQgPSB7XG4gICAgICAgICAgaW5kZXg6IGNoaWxkRWxzLmxlbmd0aCxcbiAgICAgICAgICBlbDogY2hpbGRFbHMubGVuZ3RoID8gY2hpbGRFbHNbY2hpbGRFbHMubGVuZ3RoIC0gMV0gOiBudWxsLFxuICAgICAgICAgIHBvc2l0aW9uOiAnYWZ0ZXInLFxuICAgICAgICAgIHJlYWxFbDogbW92ZUVsZW1lbnRcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5kcm9wRmxhZyA9ICdhZnRlckFsbCc7XG4gICAgICB9XG4gICAgICB0aGlzLmRyb3BJbmRleCA9IG92ZXJFbGVtZW50LmluZGV4O1xuICAgICAgcmV0dXJuIG92ZXJFbGVtZW50O1xuICAgIH1cbiAgICBsZXQgZmluZCA9IGZhbHNlO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hpbGRFbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChjaGlsZEVsc1tpXS5jb250YWlucyhtb3ZlRWxlbWVudCkpIHtcbiAgICAgICAgY29uc3QgdGFyZ2V0RWxlbWVudCA9IGNoaWxkRWxzW2ldO1xuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IHRoaXMuY2FsY1Bvc2l0aW9uKGV2ZW50LCB0YXJnZXRFbGVtZW50KTtcbiAgICAgICAgdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJvcE9uSXRlbSA9IHBvc2l0aW9uID09PSAnaW5zaWRlJztcbiAgICAgICAgb3ZlckVsZW1lbnQgPSB7aW5kZXg6IHBvc2l0aW9uID09PSAnYWZ0ZXInID8gKGkgKyAxKSA6IGksIGVsOiBjaGlsZEVsc1tpXSwgcG9zaXRpb246IHBvc2l0aW9ufTtcbiAgICAgICAgdGhpcy5kcm9wSW5kZXggPSBvdmVyRWxlbWVudC5pbmRleDtcbiAgICAgICAgZmluZCA9IHRydWU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWZpbmQpIHtcbiAgICAgIGlmIChjaGlsZEVscy5sZW5ndGgpIHtcbiAgICAgICAgb3ZlckVsZW1lbnQgPSB7aW5kZXg6IGNoaWxkRWxzLmxlbmd0aCwgZWw6IGNoaWxkRWxzW2NoaWxkRWxzLmxlbmd0aCAtIDEgXSwgcG9zaXRpb246ICdhZnRlcid9O1xuICAgICAgfVxuICAgICAgdGhpcy5kcm9wSW5kZXggPSBjaGlsZEVscy5sZW5ndGg7XG4gICAgICB0aGlzLmRyYWdEcm9wU2VydmljZS5kcm9wT25JdGVtID0gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBvdmVyRWxlbWVudDtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY1Bvc2l0aW9uKGV2ZW50OiBhbnksIHRhcmdldEVsZW1lbnQ6IGFueSkge1xuICAgIGNvbnN0IHJlY3QgPSB0YXJnZXRFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNvbnN0IHJlbFkgPSBldmVudC5jbGllbnRZIC0gKHJlY3QueSB8fCByZWN0LnRvcCk7XG4gICAgY29uc3QgcmVsWCA9IGV2ZW50LmNsaWVudFggLSAocmVjdC54IHx8IHJlY3QubGVmdCk7XG5cbiAgICAvLyDlpITnkIblhYHorrhkcm9w5Yiw5YWD57Sg6Ieq5bexXG4gICAgaWYgKHRoaXMuYWxsb3dEcm9wT25JdGVtKSB7XG4gICAgICBjb25zdCBkcm9wT25JdGVtRWRnZSA9IHsgLy8g5pyJ5YaF5bWM5YiX6KGo55qE5pe25YCZ6ZyA6KaB5L+u5q2j5YWD57Sg55qE6auY5bqm5rS75a695bqmXG4gICAgICAgIGhlaWdodDogKHRoaXMubmVzdGluZ1RhcmdldFJlY3QgJiYgdGhpcy5uZXN0aW5nVGFyZ2V0UmVjdC5oZWlnaHQgfHwgcmVjdC5oZWlnaHQpLFxuICAgICAgICB3aWR0aDogKHRoaXMubmVzdGluZ1RhcmdldFJlY3QgJiYgdGhpcy5uZXN0aW5nVGFyZ2V0UmVjdC53aWR0aCB8fCByZWN0LndpZHRoKVxuICAgICAgfTtcbiAgICAgIGNvbnN0IHRocmVlUXVhcnRlcnNPZkhlaWdodCA9IGRyb3BPbkl0ZW1FZGdlLmhlaWdodCAqIDMgLyA0O1xuICAgICAgY29uc3QgdGhyZWVRdWFydGVyc09mV2lkdGggPSBkcm9wT25JdGVtRWRnZS53aWR0aCAqIDMgLyA0O1xuICAgICAgY29uc3QgQVF1YXJ0ZXJPZkhlaWdodCA9IE51bWJlcihkcm9wT25JdGVtRWRnZS5oZWlnaHQpIC8gNDtcbiAgICAgIGNvbnN0IEFRdWFydGVyT2ZXaWR0aCA9IE51bWJlcihkcm9wT25JdGVtRWRnZS53aWR0aCkgLyA0O1xuXG4gICAgICBpZiAodGhpcy5zb3J0RGlyZWN0aW9uWk1vZGUpIHtcbiAgICAgICAgY29uc3Qgc2xhc2hQb3NpdGlvbiA9IChyZWxZIC8gZHJvcE9uSXRlbUVkZ2UuaGVpZ2h0ICsgcmVsWCAvIGRyb3BPbkl0ZW1FZGdlLndpZHRoKTtcbiAgICAgICAgaWYgKHNsYXNoUG9zaXRpb24gPiAwLjMgJiYgIHNsYXNoUG9zaXRpb24gPD0gMC43KSB7XG4gICAgICAgICAgcmV0dXJuICdpbnNpZGUnO1xuICAgICAgICB9IGVsc2UgaWYgKHNsYXNoUG9zaXRpb24gPiAwLjcpIHtcbiAgICAgICAgICBjb25zdCBzbGFzaFBvc2l0aW9uTmVzdGluZyA9IChcbiAgICAgICAgICAgIChyZWxZIC0gcmVjdC5oZWlnaHQgKyBkcm9wT25JdGVtRWRnZS5oZWlnaHQpIC8gZHJvcE9uSXRlbUVkZ2UuaGVpZ2h0XG4gICAgICAgICAgICArIChyZWxYIC0gcmVjdC53aWR0aCArICBkcm9wT25JdGVtRWRnZS53aWR0aCkgLyBkcm9wT25JdGVtRWRnZS53aWR0aFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKHNsYXNoUG9zaXRpb25OZXN0aW5nIDw9IDAuNykge1xuICAgICAgICAgICAgcmV0dXJuICdpbnNpZGUnO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCh0aGlzLnNvcnREaXJlY3Rpb24gPT09ICd2JyAmJiByZWxZID4gQVF1YXJ0ZXJPZkhlaWdodCAmJiByZWxZIDw9IHRocmVlUXVhcnRlcnNPZkhlaWdodCkgfHxcbiAgICAgICAgKHRoaXMuc29ydERpcmVjdGlvbiAhPT0gJ3YnICYmIHJlbFggPiBBUXVhcnRlck9mV2lkdGggJiYgcmVsWCA8PSB0aHJlZVF1YXJ0ZXJzT2ZXaWR0aCkpIHtcbiAgICAgICAgLy8gIOmrmOW6pueahOS4remXtDEvNCAtIDMvNCDlsZ7kuo5kcm9w5Yiw5YWD57Sg6Ieq5bexXG4gICAgICAgIHJldHVybiAnaW5zaWRlJztcbiAgICAgIH0gZWxzZSBpZiAoKHRoaXMuc29ydERpcmVjdGlvbiA9PT0gJ3YnICYmIHJlbFkgPiB0aHJlZVF1YXJ0ZXJzT2ZIZWlnaHRcbiAgICAgICAgICAmJiByZWxZIDw9IChyZWN0LmhlaWdodCAtIEFRdWFydGVyT2ZIZWlnaHQpKSB8fFxuICAgICAgICAgICh0aGlzLnNvcnREaXJlY3Rpb24gIT09ICd2JyAmJiByZWxYID4gdGhyZWVRdWFydGVyc09mV2lkdGhcbiAgICAgICAgICAmJiAgcmVsWCA8PSAocmVjdC53aWR0aCAtIEFRdWFydGVyT2ZXaWR0aCkpKSAge1xuICAgICAgICAvLyDlhoXltYzliJfooajlkI7kuK3pl7TljLrln5/pg73lsZ7kuo5pbnNpZGVcbiAgICAgICAgcmV0dXJuICdpbnNpZGUnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLnNvcnREaXJlY3Rpb25aTW9kZSkge1xuICAgICAgaWYgKChyZWxZIC8gcmVjdC5oZWlnaHQgKyByZWxYIC8gcmVjdC53aWR0aCkgPCAxKSB7XG4gICAgICAgIHJldHVybiAnYmVmb3JlJztcbiAgICAgIH1cbiAgICAgIHJldHVybiAnYWZ0ZXInO1xuICAgIH1cbiAgICAvLyDlhbbku5bmg4XlhrXkv53mjIHljp/mnaXnmoTlsZ7kuo7kuIrljYrpg6jliIbmiJbogIXkuIvljYrpg6jliIZcbiAgICBpZiAoKHRoaXMuc29ydERpcmVjdGlvbiA9PT0gJ3YnICYmIHJlbFkgPiAocmVjdC5oZWlnaHQgLyAyKSkgfHxcbiAgICAgICh0aGlzLnNvcnREaXJlY3Rpb24gIT09ICd2JyAmJiByZWxYID4gKHJlY3Qud2lkdGggLyAyKSkpICB7XG4gICAgICByZXR1cm4gJ2FmdGVyJztcbiAgICB9XG4gICAgcmV0dXJuICdiZWZvcmUnO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjUG9zaXRpb25PdXRzaWRlKGV2ZW50OiBhbnksIHRhcmdldEVsZW1lbnQ6IGFueSkge1xuICAgIGNvbnN0IHJlY3QgPSB0aGlzLmdldEJvdW5kaW5nUmVjdEFuZFJlYWxQb3NpdGlvbih0YXJnZXRFbGVtZW50KTsgLy8gdGFyZ2V0RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCByZWxZID0gZXZlbnQuY2xpZW50WSAtIChyZWN0LnkgfHwgcmVjdC50b3ApO1xuICAgIGNvbnN0IHJlbFggPSBldmVudC5jbGllbnRYIC0gKHJlY3QueCB8fCByZWN0LmxlZnQpO1xuXG4gICAgaWYgKHRoaXMuc29ydERpcmVjdGlvblpNb2RlKSB7XG4gICAgICBpZiAoKHRoaXMuc29ydERpcmVjdGlvbiA9PT0gJ3YnICYmIChyZWxZIDwgMCB8fCAocmVsWSA8IHJlY3QuaGVpZ2h0ICYmIHJlbFggPCAwKSkpXG4gICAgICAgIHx8ICh0aGlzLnNvcnREaXJlY3Rpb24gIT09ICd2JyAmJiAocmVsWCA8IDAgfHwgKHJlbFggPCByZWN0LndpZHRoICYmIHJlbFkgPCAwKSkpXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuICdiZWZvcmUnO1xuICAgICAgfVxuICAgICAgcmV0dXJuICdub3RzdXJlJztcbiAgICB9XG5cbiAgICBpZiAoKHRoaXMuc29ydERpcmVjdGlvbiA9PT0gJ3YnICYmIHJlbFkgPCAocmVjdC5oZWlnaHQgLyAyKSkgfHxcbiAgICAgICh0aGlzLnNvcnREaXJlY3Rpb24gIT09ICd2JyAmJiByZWxYIDwgKHJlY3Qud2lkdGggLyAyKSkpICB7XG4gICAgICByZXR1cm4gJ2JlZm9yZSc7XG4gICAgfVxuICAgIHJldHVybiAnbm90c3VyZSc7XG4gIH1cbiAgc2V0UGxhY2Vob2xkZXIgPSAoKSA9PiB7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgdGhpcy5wbGFjZWhvbGRlci5zdHlsZS53aWR0aCA9IHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdPZmZzZXQud2lkdGggKyAncHgnO1xuICAgICAgdGhpcy5wbGFjZWhvbGRlci5zdHlsZS5oZWlnaHQgPSB0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnT2Zmc2V0LmhlaWdodCArICdweCc7IC8vIGll5LiLY2xpZW50SGVpZ2h05Li6MFxuICAgICAgVXRpbHMuYWRkRWxTdHlsZXModGhpcy5wbGFjZWhvbGRlciwgdGhpcy5wbGFjZWhvbGRlclN0eWxlKTtcbiAgICAgIHRoaXMucGxhY2Vob2xkZXJSZW5kZXJFdmVudC5uZXh0KHt3aWR0aDogdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJhZ09mZnNldC53aWR0aCwgaGVpZ2h0OiB0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnT2Zmc2V0LmhlaWdodH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIC8vIOaPkuWFpXBsYWNlaG9sZGVyXG4gIHByaXZhdGUgaW5zZXJ0UGxhY2Vob2xkZXIob3ZlckVsZW1lbnQpIHtcbiAgICBjb25zdCB0ZW1wU2Nyb2xsVG9wID0gdGhpcy5zb3J0Q29udGFpbmVyLnNjcm9sbFRvcDtcbiAgICBjb25zdCB0ZW1wU2Nyb2xsTGVmdCA9IHRoaXMuc29ydENvbnRhaW5lci5zY3JvbGxMZWZ0O1xuICAgIGxldCBoaXRQbGFjZWhvbGRlciA9IGZhbHNlO1xuICAgIGxldCBjbWQ6IERyYWdQbGFjZWhvbGRlckluc2VydGlvbkluZGV4RXZlbnQ7XG4gICAgY29uc3QgZ2V0SW5kZXggPSAoYXJyLCBlbCwgZGVmYXVsdFZhbHVlKSA9PiB7XG4gICAgICBjb25zdCBpbmRleCA9IGFyci5pbmRleE9mKGVsKTtcbiAgICAgIHJldHVybiBpbmRleCA+IC0xID8gaW5kZXggOiBkZWZhdWx0VmFsdWU7XG4gICAgfTtcbiAgICBpZiAobnVsbCAhPT0gb3ZlckVsZW1lbnQpIHtcbiAgICAgIGNvbnN0IHNvcnRDb250YWluZXJDaGlsZHJlbiA9IFV0aWxzLnNsaWNlKHRoaXMuc29ydENvbnRhaW5lci5jaGlsZHJlbikuZmlsdGVyKFxuICAgICAgICBlbCA9PiBlbCAhPT0gdGhpcy5kcmFnRHJvcFNlcnZpY2UuZHJhZ0Nsb25lTm9kZVxuICAgICAgKTtcblxuICAgICAgaWYgKG92ZXJFbGVtZW50LmVsID09PSBudWxsKSB7XG4gICAgICAgIGNtZCA9IHtcbiAgICAgICAgICBjb21tYW5kOiAnYXBwZW5kJ1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNvcnRDb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5wbGFjZWhvbGRlcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAob3ZlckVsZW1lbnQucG9zaXRpb24gPT09ICdpbnNpZGUnKSB7XG4gICAgICAgICAgY21kID0ge1xuICAgICAgICAgICAgY29tbWFuZDogJ3JlbW92ZSdcbiAgICAgICAgICB9O1xuICAgICAgICAgIHRoaXMucmVtb3ZlUGxhY2Vob2xkZXIoKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnT3JpZ2luUGxhY2Vob2xkZXIgJiYgdGhpcy5pc0RyYWdQbGFjZWhvbGRlclBvc2l0aW9uKG92ZXJFbGVtZW50LmluZGV4KSkge1xuICAgICAgICAgIGNtZCA9IHtcbiAgICAgICAgICAgIGNvbW1hbmQ6ICdyZW1vdmUnXG4gICAgICAgICAgfTtcbiAgICAgICAgICB0aGlzLnJlbW92ZVBsYWNlaG9sZGVyKCk7XG4gICAgICAgICAgaGl0UGxhY2Vob2xkZXIgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKG92ZXJFbGVtZW50LnBvc2l0aW9uID09PSAnYWZ0ZXInKSB7XG4gICAgICAgICAgaWYgKG92ZXJFbGVtZW50LmVsLm5leHRTaWJsaW5nICYmIG92ZXJFbGVtZW50LmVsLm5leHRTaWJsaW5nLmNsYXNzTGlzdFxuICAgICAgICAgICAgJiYgb3ZlckVsZW1lbnQuZWwubmV4dFNpYmxpbmcuY2xhc3NMaXN0LmNvbnRhaW5zKCdkcmFnLW9yaWdpbi1wbGFjZWhvbGRlcicpKSB7XG4gICAgICAgICAgICAvLyDpkojlr7nlpJrmupDljaDkvY3nrKblnLrmma9cbiAgICAgICAgICAgIGNtZCA9IHtcbiAgICAgICAgICAgICAgY29tbWFuZDogJ2luc2VydEJlZm9yZScsXG4gICAgICAgICAgICAgIGluZGV4OiBnZXRJbmRleChzb3J0Q29udGFpbmVyQ2hpbGRyZW4sIG92ZXJFbGVtZW50LmVsLm5leHRTaWJsaW5nLCBzb3J0Q29udGFpbmVyQ2hpbGRyZW4ubGVuZ3RoKSArIDFcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLnNvcnRDb250YWluZXIuaW5zZXJ0QmVmb3JlKHRoaXMucGxhY2Vob2xkZXIsIG92ZXJFbGVtZW50LmVsLm5leHRTaWJsaW5nLm5leHRTaWJsaW5nKTtcblxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjbWQgPSB7XG4gICAgICAgICAgICAgIGNvbW1hbmQ6ICdpbnNlcnRCZWZvcmUnLFxuICAgICAgICAgICAgICBpbmRleDogZ2V0SW5kZXgoc29ydENvbnRhaW5lckNoaWxkcmVuLCBvdmVyRWxlbWVudC5lbCwgc29ydENvbnRhaW5lckNoaWxkcmVuLmxlbmd0aCkgKyAxXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5zb3J0Q29udGFpbmVyLmluc2VydEJlZm9yZSh0aGlzLnBsYWNlaG9sZGVyLCBvdmVyRWxlbWVudC5lbC5uZXh0U2libGluZyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNtZCA9IHtcbiAgICAgICAgICAgIGNvbW1hbmQ6ICdpbnNlcnRCZWZvcmUnLFxuICAgICAgICAgICAgaW5kZXg6IGdldEluZGV4KHNvcnRDb250YWluZXJDaGlsZHJlbiwgb3ZlckVsZW1lbnQuZWwsIHNvcnRDb250YWluZXJDaGlsZHJlbi5sZW5ndGgpXG4gICAgICAgICAgfTtcbiAgICAgICAgICB0aGlzLnNvcnRDb250YWluZXIuaW5zZXJ0QmVmb3JlKHRoaXMucGxhY2Vob2xkZXIsIG92ZXJFbGVtZW50LmVsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnBsYWNlaG9sZGVySW5zZXJ0aW9uRXZlbnQubmV4dChjbWQpO1xuICAgIHRoaXMuc29ydENvbnRhaW5lci5zY3JvbGxUb3AgPSB0ZW1wU2Nyb2xsVG9wO1xuICAgIHRoaXMuc29ydENvbnRhaW5lci5zY3JvbGxMZWZ0ID0gdGVtcFNjcm9sbExlZnQ7XG4gICAgaWYgKHRoaXMuZHJhZ0Ryb3BTZXJ2aWNlLmRyYWdPcmlnaW5QbGFjZWhvbGRlcikge1xuICAgICAgaWYgKGhpdFBsYWNlaG9sZGVyKSB7XG4gICAgICAgIHRoaXMuaGl0RHJhZ09yaWdpblBsYWNlaG9sZGVyKCk7XG4gICAgICB9IGVsc2UgIHtcbiAgICAgICAgdGhpcy5oaXREcmFnT3JpZ2luUGxhY2Vob2xkZXIoZmFsc2UpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaXNEcmFnUGxhY2Vob2xkZXJQb3NpdGlvbihpbmRleCkge1xuICAgIGlmICh0aGlzLmRyYWdFbEluZGV4ID4gLTEgJiYgKGluZGV4ID09PSB0aGlzLmRyYWdFbEluZGV4IHx8IGluZGV4ID09PSB0aGlzLmRyYWdFbEluZGV4ICsgMSkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHByaXZhdGUgaGl0RHJhZ09yaWdpblBsYWNlaG9sZGVyKGJvb2wgPSB0cnVlKSB7XG4gICAgY29uc3QgcGxhY2Vob2xkZXIgPSB0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnT3JpZ2luUGxhY2Vob2xkZXI7XG4gICAgaWYgKGJvb2wpIHtcbiAgICAgIHBsYWNlaG9sZGVyLmNsYXNzTGlzdC5hZGQoJ2hpdC1vcmlnaW4tcGxhY2Vob2xkZXInKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcGxhY2Vob2xkZXIuY2xhc3NMaXN0LnJlbW92ZSgnaGl0LW9yaWdpbi1wbGFjZWhvbGRlcicpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlUGxhY2Vob2xkZXIoKSB7XG4gICAgaWYgKHRoaXMuc29ydENvbnRhaW5lciAmJiB0aGlzLnNvcnRDb250YWluZXIuY29udGFpbnModGhpcy5wbGFjZWhvbGRlcikpIHtcbiAgICAgIHRoaXMuc29ydENvbnRhaW5lci5yZW1vdmVDaGlsZCh0aGlzLnBsYWNlaG9sZGVyKTtcbiAgICAgIHRoaXMucGxhY2Vob2xkZXJJbnNlcnRpb25FdmVudC5uZXh0KHtcbiAgICAgICAgY29tbWFuZDogJ3JlbW92ZSdcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlRHJhZ292ZXJJdGVtQ2xhc3MoY29udGFpbmVyLCBvdmVyRWxlbWVudD8pIHtcbiAgICBpZiAodGhpcy5kcmFnT3Zlckl0ZW1DbGFzcykge1xuICAgICAgY29uc3QgZHJhZ092ZXJJdGVtQ2xhc3NHcm91cCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIHRoaXMuZHJhZ092ZXJJdGVtQ2xhc3MpO1xuICAgICAgaWYgKGRyYWdPdmVySXRlbUNsYXNzR3JvdXAgJiYgZHJhZ092ZXJJdGVtQ2xhc3NHcm91cC5sZW5ndGggPiAwKSB7XG4gICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBkcmFnT3Zlckl0ZW1DbGFzc0dyb3VwKSB7XG4gICAgICAgICAgaWYgKG92ZXJFbGVtZW50KSB7XG4gICAgICAgICAgICBpZiAoZWxlbWVudCAhPT0gb3ZlckVsZW1lbnQuZWwgfHwgb3ZlckVsZW1lbnQucG9zaXRpb24gIT09ICdpbnNpZGUnKSB7XG4gICAgICAgICAgICAgIFV0aWxzLnJlbW92ZUNsYXNzKGVsZW1lbnQsIHRoaXMuZHJhZ092ZXJJdGVtQ2xhc3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBVdGlscy5yZW1vdmVDbGFzcyhlbGVtZW50LCB0aGlzLmRyYWdPdmVySXRlbUNsYXNzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNoZWNrU2VsZkZyb21JbmRleChlbDogYW55KSB7XG4gICAgbGV0IGZyb21JbmRleCA9IC0xO1xuICAgIGlmICghdGhpcy5zb3J0Q29udGFpbmVyLmNvbnRhaW5zKGVsKSkge1xuICAgICAgcmV0dXJuIGZyb21JbmRleDtcbiAgICB9XG4gICAgbGV0IGNoaWxkcyA9IFV0aWxzLnNsaWNlKHRoaXMuc29ydENvbnRhaW5lci5jaGlsZHJlbik7XG4gICAgaWYgKHRoaXMuZHJvcFNvcnRDb3VudFNlbGVjdG9yKSB7XG4gICAgICBjaGlsZHMgPSBjaGlsZHMuZmlsdGVyKHRoaXMuZHJvcFNvcnRDb3VudFNlbGVjdG9yRmlsdGVyRm4pO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNoaWxkcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGNoaWxkc1tpXS5jb250YWlucyh0aGlzLmRyYWdEcm9wU2VydmljZS5kcmFnZ2VkRWwpKSB7XG4gICAgICAgIGZyb21JbmRleCA9IGk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcy5nZXRSZWFsSW5kZXgoZnJvbUluZGV4KTtcbiAgfVxuICBwcml2YXRlIGdldFJlYWxJbmRleChpbmRleCwgZmxhZz86IERyb3BJbmRleEZsYWcpOiBudW1iZXIge1xuICAgIGxldCByZWFsSW5kZXg7XG4gICAgY29uc3Qgc3RhcnRJbmRleCA9IHRoaXMuZHJvcFNvcnRWaXJ0dWFsU2Nyb2xsT3B0aW9uICYmIHRoaXMuZHJvcFNvcnRWaXJ0dWFsU2Nyb2xsT3B0aW9uLnN0YXJ0SW5kZXggfHwgMDtcbiAgICBjb25zdCB0b3RhbExlbmd0aCA9IHRoaXMuZHJvcFNvcnRWaXJ0dWFsU2Nyb2xsT3B0aW9uICYmIHRoaXMuZHJvcFNvcnRWaXJ0dWFsU2Nyb2xsT3B0aW9uLnRvdGFsTGVuZ3RoO1xuICAgIGlmIChmbGFnID09PSAnYmVmb3JlQWxsJykge1xuICAgICAgcmVhbEluZGV4ID0gMDtcbiAgICB9IGVsc2UgaWYgKGZsYWcgPT09ICdhZnRlckFsbCcpIHtcbiAgICAgIHJlYWxJbmRleCA9IHRvdGFsTGVuZ3RoIHx8IGluZGV4O1xuICAgIH0gZWxzZSB7XG4gICAgICByZWFsSW5kZXggPSBzdGFydEluZGV4ICsgaW5kZXg7XG4gICAgfVxuICAgIHJldHVybiByZWFsSW5kZXg7XG4gIH1cblxuICBnZXRCb3VuZGluZ1JlY3RBbmRSZWFsUG9zaXRpb24odGFyZ2V0RWxlbWVudCkge1xuICAgIC8vIOeUqOS6juS/ruWkjemDqOWIhmRpc3BsYXkgbm9uZeeahOWFg+e0oOiOt+WPluWIsOeahHRvcOWSjGxlZnTmmK8w77yMIOWPluWug+S4i+S4gOS4quWFg+e0oOeahOW3puS4iuinkuS4uuWdkOagh1xuICAgIGxldCByZWN0ID0gdGFyZ2V0RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCB7Ym90dG9tLCByaWdodCwgd2lkdGgsIGhlaWdodH0gPSByZWN0O1xuICAgIGlmIChyZWN0LndpZHRoID09PSAwICYmIHJlY3QuaGVpZ2h0ID09PSAwICYmXG4gICAgICAodGFyZ2V0RWxlbWVudC5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScgfHwgZ2V0Q29tcHV0ZWRTdHlsZSh0YXJnZXRFbGVtZW50KS5kaXNwbGF5ID09PSAnbm9uZScpKSB7XG4gICAgICBpZiAodGFyZ2V0RWxlbWVudC5uZXh0RWxlbWVudFNpYmxpbmcpIHtcbiAgICAgICAgY29uc3Qge3RvcDogcmVhbFRvcCwgbGVmdDogcmVhbExlZnR9ID0gIHRhcmdldEVsZW1lbnQubmV4dEVsZW1lbnRTaWJsaW5nLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICByZWN0ID0ge3g6IHJlYWxMZWZ0LCB5OiByZWFsVG9wLCB0b3A6IHJlYWxUb3AsIGxlZnQ6IHJlYWxMZWZ0LCBib3R0b20sIHJpZ2h0LCB3aWR0aCwgaGVpZ2h0fTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlY3Q7XG4gIH1cbiAgZ2V0U29ydENvbnRhaW5lcigpIHtcbiAgICByZXR1cm4gdGhpcy5zb3J0Q29udGFpbmVyO1xuICB9XG59XG4iXX0=