/**
 * 2020.03.23-Modified from https://github.com/Bernardo-Castilho/dragdroptouch, license: MIT，reason:Converting .js file to .ts file
 */
export class DragDropTouch {
    constructor() {
        this.lastClick = 0;
        // ** event handlers
        this.touchstart = (e) => {
            if (this.shouldHandle(e)) {
                // raise double-click and prevent zooming
                if (Date.now() - this.lastClick < DragDropTouch.DBLCLICK) {
                    if (this.dispatchEvent(e, 'dblclick', e.target)) {
                        e.preventDefault();
                        this.reset();
                        return;
                    }
                }
                // clear all variables
                this.reset();
                // get nearest draggable element
                const src = this.closestDraggable(e.target);
                if (src) {
                    this.dragSource = src;
                    this.ptDown = this.getPoint(e);
                    this.lastTouch = e;
                    if (DragDropTouch.IS_PRESS_HOLD_MODE) {
                        this.pressHoldInterval = setTimeout(() => {
                            this.bindTouchmoveTouchend(e);
                            this.isDragEnabled = true;
                            this.touchmove(e);
                        }, DragDropTouch.PRESS_HOLD_AWAIT);
                    }
                    else {
                        e.preventDefault();
                        this.bindTouchmoveTouchend(e);
                    }
                }
            }
        };
        this.touchmoveOnDocument = (e) => {
            if (this.shouldCancelPressHoldMove(e)) {
                this.reset();
                return;
            }
        };
        this.touchmove = (e) => {
            if (this.shouldCancelPressHoldMove(e)) {
                this.reset();
                return;
            }
            if (this.shouldHandleMove(e) || this.shouldHandlePressHoldMove(e)) {
                const target = this.getTarget(e);
                // start dragging
                if (this.dragSource && !this.img && this.shouldStartDragging(e)) {
                    this.dispatchEvent(e, 'dragstart', this.dragSource);
                    this.createImage(e);
                }
                // continue dragging
                if (this.img) {
                    this.clearDragoverInterval();
                    this.lastTouch = e;
                    e.preventDefault(); // prevent scrolling
                    if (target !== this.lastTarget) {
                        // according to drag drop implementation of the browser, dragenterB is supposed to fired before dragleaveA
                        this.dispatchEvent(e, 'dragenter', target);
                        this.dispatchEvent(this.lastTouch, 'dragleave', this.lastTarget);
                        this.lastTarget = target;
                    }
                    this.moveImage(e);
                    this.isDropZone = this.dispatchEvent(e, 'dragover', target);
                    // should continue dispatch dragover event when touch position stay still
                    this.setDragoverInterval(e);
                }
            }
        };
        this.touchendOnDocument = (e) => {
            if (this.shouldHandle(e)) {
                if (!this.img) {
                    this.dragSource = null;
                    this.lastClick = Date.now();
                }
                // finish dragging
                this.destroyImage();
                if (this.dragSource) {
                    this.reset();
                }
            }
        };
        this.touchend = (e) => {
            if (this.shouldHandle(e)) {
                // user clicked the element but didn't drag, so clear the source and simulate a click
                if (!this.img) {
                    this.dragSource = null;
                    // browser will dispatch click event after trigger touchend, since touchstart didn't preventDefault
                    this.lastClick = Date.now();
                }
                // finish dragging
                this.destroyImage();
                if (this.dragSource) {
                    if (e.type.indexOf('cancel') < 0 && this.isDropZone) {
                        this.dispatchEvent(this.lastTouch, 'drop', this.lastTarget);
                    }
                    this.dispatchEvent(this.lastTouch, 'dragend', this.dragSource);
                    this.reset();
                }
            }
        };
        // enforce singleton pattern
        if (DragDropTouch.instance) {
            throw new Error('DragDropTouch instance already created.');
        }
        // detect passive event support
        // https://github.com/Modernizr/Modernizr/issues/1894
        let supportsPassive = false;
        if (typeof document !== 'undefined') {
            document.addEventListener('test', () => { }, {
                get passive() {
                    supportsPassive = true;
                    return true;
                }
            });
            // listen to touch events
            if (DragDropTouch.isTouchDevice()) {
                // 能响应触摸事件
                const d = document;
                const ts = this.touchstart;
                const tmod = this.touchmoveOnDocument;
                const teod = this.touchendOnDocument;
                const opt = supportsPassive ? { passive: false, capture: false } : false;
                const optPassive = supportsPassive ? { passive: true } : false;
                d.addEventListener('touchstart', ts, opt);
                d.addEventListener('touchmove', tmod, optPassive);
                d.addEventListener('touchend', teod);
                d.addEventListener('touchcancel', teod);
                this.touchmoveListener = this.touchmove;
                this.touchendListener = this.touchend;
                this.listenerOpt = opt;
            }
        }
    }
    /**
     * Gets a reference to the @see:DragDropTouch singleton.
     */
    static getInstance() {
        if (!DragDropTouch.instance) {
            DragDropTouch.instance = new DragDropTouch();
        }
        return DragDropTouch.instance;
    }
    static isTouchDevice() {
        if (typeof window === 'undefined' || typeof document === 'undefined') {
            return false;
        }
        const d = document;
        const w = window;
        let bool;
        if ('ontouchstart' in d // normal mobile device
            || 'ontouchstart' in w
            || navigator.maxTouchPoints > 0
            || navigator['msMaxTouchPoints'] > 0
            || window['DocumentTouch'] && document instanceof window['DocumentTouch']) {
            bool = true;
        }
        else {
            const fakeBody = document.createElement('fakebody');
            fakeBody.innerHTML += `
      <style>
        @media (touch-enabled),(-webkit-touch-enabled),(-moz-touch-enabled),(-o-touch-enabled){
          #touch_test {
            top: 42px;
            position: absolute;
          }
        }
      </style>`;
            document.documentElement.appendChild(fakeBody);
            const touchTestNode = document.createElement('div');
            touchTestNode.id = 'touch_test';
            fakeBody.appendChild(touchTestNode);
            bool = touchTestNode.offsetTop === 42;
            fakeBody.parentElement.removeChild(fakeBody);
        }
        return bool;
    }
    // ** event listener binding
    bindTouchmoveTouchend(e) {
        this.touchTarget = e.target;
        e.target.addEventListener('touchmove', this.touchmoveListener, this.listenerOpt);
        e.target.addEventListener('touchend', this.touchendListener);
        e.target.addEventListener('touchcancel', this.touchendListener);
    }
    removeTouchmoveTouchend() {
        if (this.touchTarget) {
            this.touchTarget.removeEventListener('touchmove', this.touchmoveListener);
            this.touchTarget.removeEventListener('touchend', this.touchendListener);
            this.touchTarget.removeEventListener('touchcancel', this.touchendListener);
            this.touchTarget = undefined;
        }
    }
    // ** utilities
    // ignore events that have been handled or that involve more than one touch
    shouldHandle(e) {
        return e &&
            !e.defaultPrevented &&
            e.touches && e.touches.length < 2;
    }
    // use regular condition outside of press & hold mode
    shouldHandleMove(e) {
        return !DragDropTouch.IS_PRESS_HOLD_MODE && this.shouldHandle(e);
    }
    // allow to handle moves that involve many touches for press & hold
    shouldHandlePressHoldMove(e) {
        return DragDropTouch.IS_PRESS_HOLD_MODE &&
            this.isDragEnabled && e && e.touches && e.touches.length;
    }
    // reset data if user drags without pressing & holding
    shouldCancelPressHoldMove(e) {
        return DragDropTouch.IS_PRESS_HOLD_MODE && !this.isDragEnabled &&
            this.getDelta(e) > DragDropTouch.PRESS_HOLD_MARGIN;
    }
    // start dragging when mouseover element matches drag handler selector and specified delta is detected
    shouldStartDragging(e) {
        const dragHandleSelector = this.getDragHandle();
        // start dragging when mouseover element matches drag handler selector
        if (dragHandleSelector && !this.matchSelector(e.target, dragHandleSelector)) {
            return false;
        }
        // start dragging when specified delta is detected
        const delta = this.getDelta(e);
        return delta > DragDropTouch.THRESHOLD ||
            (DragDropTouch.IS_PRESS_HOLD_MODE && delta >= DragDropTouch.PRESS_HOLD_THRESHOLD);
    }
    // find drag handler selector for dragstart only with partial element
    getDragHandle() {
        if (this.dragSource) {
            return this.dragSource.getAttribute(DragDropTouch.DRAG_HANDLE_ATTR) || '';
        }
        return '';
    }
    // test if element matches selector
    matchSelector(element, selector) {
        if (selector) {
            const proto = Element.prototype;
            const func = proto['matches'] ||
                proto['matchesSelector'] ||
                proto['mozMatchesSelector'] ||
                proto['msMatchesSelector'] ||
                proto['oMatchesSelector'] ||
                proto['webkitMatchesSelector'] ||
                function (s) {
                    const matches = (this.document || this.ownerDocument).querySelectorAll(s);
                    let i = matches.length;
                    while (--i >= 0 && matches.item(i) !== this) {
                        // do nothing
                    }
                    return i > -1;
                };
            return func.call(element, selector);
        }
        return true;
    }
    // clear all members
    reset() {
        this.removeTouchmoveTouchend();
        this.destroyImage();
        this.dragSource = null;
        this.lastTouch = null;
        this.lastTarget = null;
        this.ptDown = null;
        this.isDragEnabled = false;
        this.isDropZone = false;
        this.dataTransfer = new DragDropTouch.DataTransfer();
        clearInterval(this.pressHoldInterval);
        this.clearDragoverInterval();
    }
    // get point for a touch event
    getPoint(e, page) {
        if (e && e.touches) {
            e = e.touches[0];
        }
        return { x: page ? e.pageX : e.clientX, y: page ? e.pageY : e.clientY };
    }
    // get distance between the current touch event and the first one
    getDelta(e) {
        if (DragDropTouch.IS_PRESS_HOLD_MODE && !this.ptDown) {
            return 0;
        }
        const p = this.getPoint(e);
        return Math.abs(p.x - this.ptDown.x) + Math.abs(p.y - this.ptDown.y);
    }
    // get the element at a given touch event
    getTarget(e) {
        const pt = this.getPoint(e);
        let el = document.elementFromPoint(pt.x, pt.y);
        while (el && getComputedStyle(el).pointerEvents === 'none') {
            el = el.parentElement;
        }
        return el;
    }
    // create drag image from source element
    createImage(e) {
        // just in case...
        if (this.img) {
            this.destroyImage();
        }
        // create drag image from custom element or drag source
        const src = this.imgCustom || this.dragSource;
        this.img = src.cloneNode(true);
        this.copyStyle(src, this.img);
        this.img.style.top = this.img.style.left = '-9999px';
        // if creating from drag source, apply offset and opacity
        if (!this.imgCustom) {
            const rc = src.getBoundingClientRect();
            const pt = this.getPoint(e);
            this.imgOffset = { x: pt.x - rc.left, y: pt.y - rc.top };
            this.img.style.opacity = DragDropTouch.OPACITY.toString();
        }
        // add image to document
        this.moveImage(e);
        document.body.appendChild(this.img);
    }
    // dispose of drag image element
    destroyImage() {
        if (this.img && this.img.parentElement) {
            this.img.parentElement.removeChild(this.img);
        }
        this.img = null;
        this.imgCustom = null;
    }
    // move the drag image element
    moveImage(e) {
        requestAnimationFrame(() => {
            if (this.img) {
                const pt = this.getPoint(e, true);
                const s = this.img.style;
                s.position = 'absolute';
                s.pointerEvents = 'none';
                s.zIndex = '999999';
                s.left = Math.round(pt.x - this.imgOffset.x) + 'px';
                s.top = Math.round(pt.y - this.imgOffset.y) + 'px';
            }
        });
    }
    // copy properties from an object to another
    copyProps(dst, src, props) {
        for (let i = 0; i < props.length; i++) {
            const p = props[i];
            dst[p] = src[p];
        }
    }
    // copy styles/attributes from drag source to drag image element
    copyStyle(src, dst) {
        // remove potentially troublesome attributes
        DragDropTouch.rmvAttrs.forEach(function (att) {
            dst.removeAttribute(att);
        });
        // copy canvas content
        if (src instanceof HTMLCanvasElement) {
            const canSrc = src;
            const canDst = dst;
            canDst.width = canSrc.width;
            canDst.height = canSrc.height;
            canDst.getContext('2d').drawImage(canSrc, 0, 0);
        }
        // copy canvas content for nested canvas element
        const srcCanvases = src.querySelectorAll('canvas');
        if (srcCanvases.length > 0) {
            const dstCanvases = dst.querySelectorAll('canvas');
            for (let i = 0; i < dstCanvases.length; i++) {
                const cSrc = srcCanvases[i];
                const cDst = dstCanvases[i];
                cDst.getContext('2d').drawImage(cSrc, 0, 0);
            }
        }
        // copy style (without transitions)
        const cs = getComputedStyle(src);
        for (let i = 0; i < cs.length; i++) {
            const key = cs[i];
            if (key.indexOf('transition') < 0) {
                dst.style[key] = cs[key];
            }
        }
        dst.style.pointerEvents = 'none';
        // and repeat for all children
        for (let i = 0; i < src.children.length; i++) {
            this.copyStyle(src.children[i], dst.children[i]);
        }
    }
    // synthesize and dispatch an event
    // returns true if the event has been handled (e.preventDefault == true)
    dispatchEvent(e, type, target) {
        if (e && target) {
            const evt = document.createEvent('Event');
            const t = e.touches ? e.touches[0] : e;
            evt.initEvent(type, true, true);
            const obj = {
                button: 0,
                which: 0,
                buttons: 1,
                dataTransfer: this.dataTransfer
            };
            this.copyProps(evt, e, DragDropTouch.kbdProps);
            this.copyProps(evt, t, DragDropTouch.ptProps);
            this.copyProps(evt, { fromTouch: true }, ['fromTouch']); // mark as from touch event
            this.copyProps(evt, obj, Object.keys(obj));
            target.dispatchEvent(evt);
            return evt.defaultPrevented;
        }
        return false;
    }
    // gets an element's closest draggable ancestor
    closestDraggable(e) {
        for (; e; e = e.parentElement) {
            if (e.hasAttribute('draggable') && e.draggable) {
                return e;
            }
        }
        return null;
    }
    // repeat dispatch dragover event when touch point stay still
    setDragoverInterval(e) {
        this.dragoverTimer = setInterval(() => {
            const target = this.getTarget(e);
            if (target !== this.lastTarget) {
                this.dispatchEvent(e, 'dragenter', target);
                this.dispatchEvent(e, 'dragleave', this.lastTarget);
                this.lastTarget = target;
            }
            this.isDropZone = this.dispatchEvent(e, 'dragover', target);
        }, DragDropTouch.DRAG_OVER_TIME);
    }
    clearDragoverInterval() {
        if (this.dragoverTimer) {
            clearInterval(this.dragoverTimer);
            this.dragoverTimer = undefined;
        }
    }
}
DragDropTouch.THRESHOLD = 5; // pixels to move before drag starts
DragDropTouch.OPACITY = 0.5; // drag image opacity
DragDropTouch.DBLCLICK = 500; // max ms between clicks in a double click
DragDropTouch.DRAG_OVER_TIME = 300; // interval ms when drag over
DragDropTouch.CTX_MENU = 900; // ms to hold before raising 'contextmenu' event
DragDropTouch.IS_PRESS_HOLD_MODE = true; // decides of press & hold mode presence
DragDropTouch.PRESS_HOLD_AWAIT = 400; // ms to wait before press & hold is detected
DragDropTouch.PRESS_HOLD_MARGIN = 25; // pixels that finger might shiver while pressing
DragDropTouch.PRESS_HOLD_THRESHOLD = 0; // pixels to move before drag starts
DragDropTouch.DRAG_HANDLE_ATTR = 'data-drag-handle-selector';
DragDropTouch.rmvAttrs = 'id,class,style,draggable'.split(',');
DragDropTouch.kbdProps = 'altKey,ctrlKey,metaKey,shiftKey'.split(',');
DragDropTouch.ptProps = 'pageX,pageY,clientX,clientY,screenX,screenY'.split(',');
DragDropTouch.instance = null;
/* eslint-disable-next-line @typescript-eslint/no-namespace */
(function (DragDropTouch) {
    /**
       * Object used to hold the data that is being dragged during drag and drop operations.
       *
       * It may hold one or more data items of different types. For more information about
       * drag and drop operations and data transfer objects, see
       * <a href="https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer">HTML Drag and Drop API</a>.
       *
       * This object is created automatically by the @see:DragDropTouch singleton and is
       * accessible through the @see:dataTransfer property of all drag events.
       */
    class DataTransfer {
        constructor() {
            this._dropEffect = 'move';
            this._effectAllowed = 'all';
            this._data = {};
        }
        get dropEffect() {
            return this._dropEffect;
        }
        set dropEffect(value) {
            this._dropEffect = value;
        }
        get effectAllowed() {
            return this._effectAllowed;
        }
        set effectAllowed(value) {
            this._effectAllowed = value;
        }
        get types() {
            return Object.keys(this._data);
        }
        /**
           * Removes the data associated with a given type.
           *
           * The type argument is optional. If the type is empty or not specified, the data
           * associated with all types is removed. If data for the specified type does not exist,
           * or the data transfer contains no data, this method will have no effect.
           *
           * @param type Type of data to remove.
           */
        clearData(type) {
            if (type !== null) {
                delete this._data[type];
            }
            else {
                this._data = null;
            }
        }
        /**
         * Retrieves the data for a given type, or an empty string if data for that type does
         * not exist or the data transfer contains no data.
         *
         * @param type Type of data to retrieve.
         */
        getData(type) {
            return this._data[type] || '';
        }
        /**
         * Set the data for a given type.
         *
         * For a list of recommended drag types, please see
         * https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Recommended_Drag_Types.
         *
         * @param type Type of data to add.
         * @param value Data to add.
         */
        setData(type, value) {
            this._data[type] = value;
        }
        /**
         * Set the image to be used for dragging if a custom one is desired.
         *
         * @param img An image element to use as the drag feedback image.
         * @param offsetX The horizontal offset within the image.
         * @param offsetY The vertical offset within the image.
         */
        setDragImage(img, offsetX, offsetY) {
            const ddt = DragDropTouch.getInstance();
            ddt.imgCustom = img;
            ddt.imgOffset = { x: offsetX, y: offsetY };
        }
    }
    DragDropTouch.DataTransfer = DataTransfer;
})(DragDropTouch || (DragDropTouch = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhZ2Ryb3AtdG91Y2guanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9kZXZ1aS9kcmFnZHJvcC90b3VjaC1zdXBwb3J0L2RyYWdkcm9wLXRvdWNoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztHQUVHO0FBQ0gsTUFBTSxPQUFPLGFBQWE7SUF3Q3hCO1FBdEJBLGNBQVMsR0FBRyxDQUFDLENBQUM7UUFpSGQsb0JBQW9CO1FBQ3BCLGVBQVUsR0FBRyxDQUFDLENBQWEsRUFBRSxFQUFFO1lBQzdCLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDeEIseUNBQXlDO2dCQUN6QyxJQUFJLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsU0FBUyxHQUFHLGFBQWEsQ0FBQyxRQUFRLEVBQUU7b0JBQ3hELElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRTt3QkFDL0MsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFDO3dCQUNuQixJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7d0JBQ2IsT0FBTztxQkFDUjtpQkFDRjtnQkFDRCxzQkFBc0I7Z0JBQ3RCLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDYixnQ0FBZ0M7Z0JBQ2hDLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQzVDLElBQUksR0FBRyxFQUFFO29CQUNQLElBQUksQ0FBQyxVQUFVLEdBQUcsR0FBRyxDQUFDO29CQUN0QixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQy9CLElBQUksQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDO29CQUNuQixJQUFJLGFBQWEsQ0FBQyxrQkFBa0IsRUFBRTt3QkFDcEMsSUFBSSxDQUFD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QUFJLENBQUMsR0FBRyxLQUFLLENBQUM7UUFDM0IsQ0FBQztRQUNEOzs7Ozs7V0FNRztRQUNILFlBQVksQ0FBRSxHQUFHLEVBQUUsT0FBTyxFQUFFLE9BQU87WUFDakMsTUFBTSxHQUFHLEdBQUcsYUFBYSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3hDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDO1lBQ3BCLEdBQUcsQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQztRQUM3QyxDQUFDO0tBQ0Y7SUExRlksMEJBQVksZUEwRnhCLENBQUE7QUFFSCxDQUFDLEVBdkdnQixhQUFhLEtBQWIsYUFBYSxRQXVHN0IiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIDIwMjAuMDMuMjMtTW9kaWZpZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vQmVybmFyZG8tQ2FzdGlsaG8vZHJhZ2Ryb3B0b3VjaCwgbGljZW5zZTogTUlU77yMcmVhc29uOkNvbnZlcnRpbmcgLmpzIGZpbGUgdG8gLnRzIGZpbGVcbiAqL1xuZXhwb3J0IGNsYXNzIERyYWdEcm9wVG91Y2gge1xuICBzdGF0aWMgcmVhZG9ubHkgVEhSRVNIT0xEID0gNTsgLy8gcGl4ZWxzIHRvIG1vdmUgYmVmb3JlIGRyYWcgc3RhcnRzXG4gIHN0YXRpYyByZWFkb25seSBPUEFDSVRZID0gMC41OyAvLyBkcmFnIGltYWdlIG9wYWNpdHlcbiAgc3RhdGljIHJlYWRvbmx5IERCTENMSUNLID0gNTAwOyAvLyBtYXggbXMgYmV0d2VlbiBjbGlja3MgaW4gYSBkb3VibGUgY2xpY2tcbiAgc3RhdGljIHJlYWRvbmx5IERSQUdfT1ZFUl9USU1FID0gMzAwOyAvLyBpbnRlcnZhbCBtcyB3aGVuIGRyYWcgb3ZlclxuICBzdGF0aWMgcmVhZG9ubHkgQ1RYX01FTlUgPSA5MDA7IC8vIG1zIHRvIGhvbGQgYmVmb3JlIHJhaXNpbmcgJ2NvbnRleHRtZW51JyBldmVudFxuICBzdGF0aWMgcmVhZG9ubHkgSVNfUFJFU1NfSE9MRF9NT0RFID0gdHJ1ZTsgLy8gZGVjaWRlcyBvZiBwcmVzcyAmIGhvbGQgbW9kZSBwcmVzZW5jZVxuICBzdGF0aWMgcmVhZG9ubHkgUFJFU1NfSE9MRF9BV0FJVCA9IDQwMDsgLy8gbXMgdG8gd2FpdCBiZWZvcmUgcHJlc3MgJiBob2xkIGlzIGRldGVjdGVkXG4gIHN0YXRpYyByZWFkb25seSBQUkVTU19IT0xEX01BUkdJTiA9IDI1OyAvLyBwaXhlbHMgdGhhdCBmaW5nZXIgbWlnaHQgc2hpdmVyIHdoaWxlIHByZXNzaW5nXG4gIHN0YXRpYyByZWFkb25seSBQUkVTU19IT0xEX1RIUkVTSE9MRCA9IDA7IC8vIHBpeGVscyB0byBtb3ZlIGJlZm9yZSBkcmFnIHN0YXJ0c1xuICBzdGF0aWMgcmVhZG9ubHkgRFJBR19IQU5ETEVfQVRUUiA9ICdkYXRhLWRyYWctaGFuZGxlLXNlbGVjdG9yJztcblxuICBzdGF0aWMgcmVhZG9ubHkgcm12QXR0cnMgPSAnaWQsY2xhc3Msc3R5bGUsZHJhZ2dhYmxlJy5zcGxpdCgnLCcpO1xuICBzdGF0aWMgcmVhZG9ubHkga2JkUHJvcHMgPSAnYWx0S2V5LGN0cmxLZXksbWV0YUtleSxzaGlmdEtleScuc3BsaXQoJywnKTtcbiAgc3RhdGljIHJlYWRvbmx5IHB0UHJvcHMgPSAncGFnZVgscGFnZVksY2xpZW50WCxjbGllbnRZLHNjcmVlblgsc2NyZWVuWScuc3BsaXQoJywnKTtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IERyYWdEcm9wVG91Y2ggPSBudWxsO1xuXG4gIGRhdGFUcmFuc2ZlcjogRGF0YVRyYW5zZmVyO1xuICBsYXN0Q2xpY2sgPSAwO1xuICBsYXN0VG91Y2g6IFRvdWNoRXZlbnQ7XG4gIC8vIHRvdWNoZWQgZWxlbWVudFxuICBsYXN0VGFyZ2V0OiBIVE1MRWxlbWVudDtcbiAgLy8gdG91Y2hlZCBkcmFnZ2JsZSBlbGVtZW50XG4gIGRyYWdTb3VyY2U6IEhUTUxFbGVtZW50O1xuICBwdERvd246IHt4OiBudW1iZXI7IHk6IG51bWJlcn07XG4gIGlzRHJhZ0VuYWJsZWQ6IGJvb2xlYW47XG4gIGlzRHJvcFpvbmU6IGJvb2xlYW47XG4gIHByZXNzSG9sZEludGVydmFsO1xuICBpbWc7XG4gIGltZ0N1c3RvbTtcbiAgaW1nT2Zmc2V0O1xuICAvLyBmb3IgY29udGludWFsIGRyYWcgb3ZlciBldmVudCBldmVuIHRvdWNoIHBvaW50IHN0b3AgYXQgYSBjZXJ0YWluIHBvaW50IGZvciBhIHdoaWxlLlxuICBkcmFnb3ZlclRpbWVyO1xuICAvLyBmb3IgYmluZCB0b3VjaCBtb3ZlIGFuZCB0b3VjaCBlbmQgZXZlbnQgdG8gdG91Y2ggdGFyZ2V0IGluY2FzZSB2aXJ0dWFsIHNjcm9sbCBjYXVzZVxuICAvLyBkb2N1bWVudCBubyBsb25nZXIgZ2V0IGNhcHR1cmUvIGJ1YmJsZSBvZiB0b3VjaG1vdmUgZXZlbnQgZnJvbSBkb20gcmVtb3ZlZCBmcm9tIGRvY3VtZW50IHRyZWVcbiAgdG91Y2hUYXJnZXQ6IEV2ZW50VGFyZ2V0O1xuICB0b3VjaG1vdmVMaXN0ZW5lcjogRXZlbnRMaXN0ZW5lcjtcbiAgdG91Y2hlbmRMaXN0ZW5lcjogRXZlbnRMaXN0ZW5lcjtcbiAgbGlzdGVuZXJPcHQ6IGJvb2xlYW4gfCBFdmVudExpc3RlbmVyT3B0aW9ucztcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvLyBlbmZvcmNlIHNpbmdsZXRvbiBwYXR0ZXJuXG4gICAgaWYgKERyYWdEcm9wVG91Y2guaW5zdGFuY2UpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRHJhZ0Ryb3BUb3VjaCBpbnN0YW5jZSBhbHJlYWR5IGNyZWF0ZWQuJyk7XG4gICAgfVxuICAgIC8vIGRldGVjdCBwYXNzaXZlIGV2ZW50IHN1cHBvcnRcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vTW9kZXJuaXpyL01vZGVybml6ci9pc3N1ZXMvMTg5NFxuICAgIGxldCBzdXBwb3J0c1Bhc3NpdmUgPSBmYWxzZTtcbiAgICBpZiAodHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndGVzdCcsICgpID0+IHt9LCB7XG4gICAgICAgIGdldCBwYXNzaXZlKCkge1xuICAgICAgICAgIHN1cHBvcnRzUGFzc2l2ZSA9IHRydWU7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgLy8gbGlzdGVuIHRvIHRvdWNoIGV2ZW50c1xuICAgICAgaWYgKERyYWdEcm9wVG91Y2guaXNUb3VjaERldmljZSgpKSB7XG4gICAgICAgIC8vIOiDveWTjeW6lOinpuaRuOS6i+S7tlxuICAgICAgICBjb25zdCBkID0gZG9jdW1lbnQ7XG4gICAgICAgIGNvbnN0IHRzID0gdGhpcy50b3VjaHN0YXJ0O1xuICAgICAgICBjb25zdCB0bW9kID0gdGhpcy50b3VjaG1vdmVPbkRvY3VtZW50O1xuICAgICAgICBjb25zdCB0ZW9kID0gdGhpcy50b3VjaGVuZE9uRG9jdW1lbnQ7XG4gICAgICAgIGNvbnN0IG9wdCA9IHN1cHBvcnRzUGFzc2l2ZSA/IHsgcGFzc2l2ZTogZmFsc2UsIGNhcHR1cmU6IGZhbHNlIH0gOiBmYWxzZTtcbiAgICAgICAgY29uc3Qgb3B0UGFzc2l2ZSA9IHN1cHBvcnRzUGFzc2l2ZSA/IHtwYXNzaXZlOiB0cnVlfSA6IGZhbHNlO1xuICAgICAgICBkLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCB0cywgb3B0KTtcbiAgICAgICAgZC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0bW9kLCBvcHRQYXNzaXZlKTtcbiAgICAgICAgZC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRlb2QpO1xuICAgICAgICBkLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoY2FuY2VsJywgdGVvZCk7XG4gICAgICAgIHRoaXMudG91Y2htb3ZlTGlzdGVuZXIgPSB0aGlzLnRvdWNobW92ZTtcbiAgICAgICAgdGhpcy50b3VjaGVuZExpc3RlbmVyID0gdGhpcy50b3VjaGVuZDtcbiAgICAgICAgdGhpcy5saXN0ZW5lck9wdCA9IG9wdDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIEdldHMgYSByZWZlcmVuY2UgdG8gdGhlIEBzZWU6RHJhZ0Ryb3BUb3VjaCBzaW5nbGV0b24uXG4gICAqL1xuICBzdGF0aWMgZ2V0SW5zdGFuY2UoKSB7XG4gICAgaWYgKCFEcmFnRHJvcFRvdWNoLmluc3RhbmNlKSB7XG4gICAgICBEcmFnRHJvcFRvdWNoLmluc3RhbmNlID0gbmV3IERyYWdEcm9wVG91Y2goKTtcbiAgICB9XG4gICAgcmV0dXJuIERyYWdEcm9wVG91Y2guaW5zdGFuY2U7XG4gIH1cbiAgc3RhdGljIGlzVG91Y2hEZXZpY2UoKSB7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgZDogRG9jdW1lbnQgPSBkb2N1bWVudDtcbiAgICBjb25zdCB3OiBXaW5kb3cgPSB3aW5kb3c7XG4gICAgbGV0IGJvb2w7XG4gICAgaWYgKCdvbnRvdWNoc3RhcnQnIGluIGQgIC8vIG5vcm1hbCBtb2JpbGUgZGV2aWNlXG4gICAgICB8fCAnb250b3VjaHN0YXJ0JyBpbiB3XG4gICAgICB8fCBuYXZpZ2F0b3IubWF4VG91Y2hQb2ludHMgPiAwXG4gICAgICB8fCBuYXZpZ2F0b3JbJ21zTWF4VG91Y2hQb2ludHMnXSA+IDBcbiAgICAgIHx8IHdpbmRvd1snRG9jdW1lbnRUb3VjaCddICYmIGRvY3VtZW50IGluc3RhbmNlb2Ygd2luZG93WydEb2N1bWVudFRvdWNoJ10pIHtcbiAgICAgIGJvb2wgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBmYWtlQm9keSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zha2Vib2R5Jyk7XG4gICAgICBmYWtlQm9keS5pbm5lckhUTUwgKz0gYFxuICAgICAgPHN0eWxlPlxuICAgICAgICBAbWVkaWEgKHRvdWNoLWVuYWJsZWQpLCgtd2Via2l0LXRvdWNoLWVuYWJsZWQpLCgtbW96LXRvdWNoLWVuYWJsZWQpLCgtby10b3VjaC1lbmFibGVkKXtcbiAgICAgICAgICAjdG91Y2hfdGVzdCB7XG4gICAgICAgICAgICB0b3A6IDQycHg7XG4gICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICA8L3N0eWxlPmA7XG4gICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoZmFrZUJvZHkpO1xuICAgICAgY29uc3QgdG91Y2hUZXN0Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgdG91Y2hUZXN0Tm9kZS5pZCA9ICd0b3VjaF90ZXN0JztcbiAgICAgIGZha2VCb2R5LmFwcGVuZENoaWxkKHRvdWNoVGVzdE5vZGUpO1xuICAgICAgYm9vbCA9IHRvdWNoVGVzdE5vZGUub2Zmc2V0VG9wID09PSA0MjtcbiAgICAgIGZha2VCb2R5LnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQoZmFrZUJvZHkpO1xuICAgIH1cbiAgICByZXR1cm4gYm9vbDtcbiAgfVxuICAvLyAqKiBldmVudCBsaXN0ZW5lciBiaW5kaW5nXG4gIGJpbmRUb3VjaG1vdmVUb3VjaGVuZCAoZTogVG91Y2hFdmVudCkge1xuICAgIHRoaXMudG91Y2hUYXJnZXQgPSBlLnRhcmdldDtcbiAgICBlLnRhcmdldC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLnRvdWNobW92ZUxpc3RlbmVyLCB0aGlzLmxpc3RlbmVyT3B0KTtcbiAgICBlLnRhcmdldC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRoaXMudG91Y2hlbmRMaXN0ZW5lcik7XG4gICAgZS50YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hjYW5jZWwnLCB0aGlzLnRvdWNoZW5kTGlzdGVuZXIpO1xuICB9XG4gIHJlbW92ZVRvdWNobW92ZVRvdWNoZW5kICgpIHtcbiAgICBpZiAodGhpcy50b3VjaFRhcmdldCkge1xuICAgICAgdGhpcy50b3VjaFRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLnRvdWNobW92ZUxpc3RlbmVyKTtcbiAgICAgIHRoaXMudG91Y2hUYXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLnRvdWNoZW5kTGlzdGVuZXIpO1xuICAgICAgdGhpcy50b3VjaFRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGNhbmNlbCcsIHRoaXMudG91Y2hlbmRMaXN0ZW5lcik7XG4gICAgICB0aGlzLnRvdWNoVGFyZ2V0ID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuICAvLyAqKiBldmVudCBoYW5kbGVyc1xuICB0b3VjaHN0YXJ0ID0gKGU6IFRvdWNoRXZlbnQpID0+IHtcbiAgICBpZiAodGhpcy5zaG91bGRIYW5kbGUoZSkpIHtcbiAgICAgIC8vIHJhaXNlIGRvdWJsZS1jbGljayBhbmQgcHJldmVudCB6b29taW5nXG4gICAgICBpZiAoRGF0ZS5ub3coKSAtIHRoaXMubGFzdENsaWNrIDwgRHJhZ0Ryb3BUb3VjaC5EQkxDTElDSykge1xuICAgICAgICBpZiAodGhpcy5kaXNwYXRjaEV2ZW50KGUsICdkYmxjbGljaycsIGUudGFyZ2V0KSkge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBjbGVhciBhbGwgdmFyaWFibGVzXG4gICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAvLyBnZXQgbmVhcmVzdCBkcmFnZ2FibGUgZWxlbWVudFxuICAgICAgY29uc3Qgc3JjID0gdGhpcy5jbG9zZXN0RHJhZ2dhYmxlKGUudGFyZ2V0KTtcbiAgICAgIGlmIChzcmMpIHtcbiAgICAgICAgdGhpcy5kcmFnU291cmNlID0gc3JjO1xuICAgICAgICB0aGlzLnB0RG93biA9IHRoaXMuZ2V0UG9pbnQoZSk7XG4gICAgICAgIHRoaXMubGFzdFRvdWNoID0gZTtcbiAgICAgICAgaWYgKERyYWdEcm9wVG91Y2guSVNfUFJFU1NfSE9MRF9NT0RFKSB7XG4gICAgICAgICAgdGhpcy5wcmVzc0hvbGRJbnRlcnZhbCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5iaW5kVG91Y2htb3ZlVG91Y2hlbmQoZSk7XG4gICAgICAgICAgICB0aGlzLmlzRHJhZ0VuYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy50b3VjaG1vdmUoZSk7XG4gICAgICAgICAgfSwgRHJhZ0Ryb3BUb3VjaC5QUkVTU19IT0xEX0FXQUlUKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgdGhpcy5iaW5kVG91Y2htb3ZlVG91Y2hlbmQoZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHRvdWNobW92ZU9uRG9jdW1lbnQgPSAoZSkgPT4ge1xuICAgIGlmICh0aGlzLnNob3VsZENhbmNlbFByZXNzSG9sZE1vdmUoZSkpIHtcbiAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH07XG4gIHRvdWNobW92ZSA9IChlOiBUb3VjaEV2ZW50KSA9PiB7XG4gICAgaWYgKHRoaXMuc2hvdWxkQ2FuY2VsUHJlc3NIb2xkTW92ZShlKSkge1xuICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy5zaG91bGRIYW5kbGVNb3ZlKGUpIHx8IHRoaXMuc2hvdWxkSGFuZGxlUHJlc3NIb2xkTW92ZShlKSkge1xuICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoZSk7XG4gICAgICAvLyBzdGFydCBkcmFnZ2luZ1xuICAgICAgaWYgKHRoaXMuZHJhZ1NvdXJjZSAmJiAhdGhpcy5pbWcgJiYgdGhpcy5zaG91bGRTdGFydERyYWdnaW5nKGUpKSB7XG4gICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlLCAnZHJhZ3N0YXJ0JywgdGhpcy5kcmFnU291cmNlKTtcbiAgICAgICAgdGhpcy5jcmVhdGVJbWFnZShlKTtcbiAgICAgIH1cbiAgICAgIC8vIGNvbnRpbnVlIGRyYWdnaW5nXG4gICAgICBpZiAodGhpcy5pbWcpIHtcbiAgICAgICAgdGhpcy5jbGVhckRyYWdvdmVySW50ZXJ2YWwoKTtcbiAgICAgICAgdGhpcy5sYXN0VG91Y2ggPSBlO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7IC8vIHByZXZlbnQgc2Nyb2xsaW5nXG4gICAgICAgIGlmICh0YXJnZXQgIT09IHRoaXMubGFzdFRhcmdldCkge1xuICAgICAgICAgIC8vIGFjY29yZGluZyB0byBkcmFnIGRyb3AgaW1wbGVtZW50YXRpb24gb2YgdGhlIGJyb3dzZXIsIGRyYWdlbnRlckIgaXMgc3VwcG9zZWQgdG8gZmlyZWQgYmVmb3JlIGRyYWdsZWF2ZUFcbiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZSwgJ2RyYWdlbnRlcicsIHRhcmdldCk7XG4gICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMubGFzdFRvdWNoLCAnZHJhZ2xlYXZlJywgdGhpcy5sYXN0VGFyZ2V0KTtcbiAgICAgICAgICB0aGlzLmxhc3RUYXJnZXQgPSB0YXJnZXQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tb3ZlSW1hZ2UoZSk7XG4gICAgICAgIHRoaXMuaXNEcm9wWm9uZSA9IHRoaXMuZGlzcGF0Y2hFdmVudChlLCAnZHJhZ292ZXInLCB0YXJnZXQpO1xuICAgICAgICAvLyBzaG91bGQgY29udGludWUgZGlzcGF0Y2ggZHJhZ292ZXIgZXZlbnQgd2hlbiB0b3VjaCBwb3NpdGlvbiBzdGF5IHN0aWxsXG4gICAgICAgIHRoaXMuc2V0RHJhZ292ZXJJbnRlcnZhbChlKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHRvdWNoZW5kT25Eb2N1bWVudCA9IChlKSA9PiB7XG4gICAgaWYgKHRoaXMuc2hvdWxkSGFuZGxlKGUpKSB7XG4gICAgICBpZiAoIXRoaXMuaW1nKSB7XG4gICAgICAgIHRoaXMuZHJhZ1NvdXJjZSA9IG51bGw7XG4gICAgICAgIHRoaXMubGFzdENsaWNrID0gRGF0ZS5ub3coKTtcbiAgICAgIH1cbiAgICAgIC8vIGZpbmlzaCBkcmFnZ2luZ1xuICAgICAgdGhpcy5kZXN0cm95SW1hZ2UoKTtcbiAgICAgIGlmICh0aGlzLmRyYWdTb3VyY2UpIHtcbiAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgdG91Y2hlbmQgPSAoZSkgPT4ge1xuICAgIGlmICh0aGlzLnNob3VsZEhhbmRsZShlKSkge1xuICAgICAgLy8gdXNlciBjbGlja2VkIHRoZSBlbGVtZW50IGJ1dCBkaWRuJ3QgZHJhZywgc28gY2xlYXIgdGhlIHNvdXJjZSBhbmQgc2ltdWxhdGUgYSBjbGlja1xuICAgICAgaWYgKCF0aGlzLmltZykge1xuICAgICAgICB0aGlzLmRyYWdTb3VyY2UgPSBudWxsO1xuICAgICAgICAvLyBicm93c2VyIHdpbGwgZGlzcGF0Y2ggY2xpY2sgZXZlbnQgYWZ0ZXIgdHJpZ2dlciB0b3VjaGVuZCwgc2luY2UgdG91Y2hzdGFydCBkaWRuJ3QgcHJldmVudERlZmF1bHRcbiAgICAgICAgdGhpcy5sYXN0Q2xpY2sgPSBEYXRlLm5vdygpO1xuICAgICAgfVxuICAgICAgLy8gZmluaXNoIGRyYWdnaW5nXG4gICAgICB0aGlzLmRlc3Ryb3lJbWFnZSgpO1xuICAgICAgaWYgKHRoaXMuZHJhZ1NvdXJjZSkge1xuICAgICAgICBpZiAoZS50eXBlLmluZGV4T2YoJ2NhbmNlbCcpIDwgMCAmJiB0aGlzLmlzRHJvcFpvbmUpIHtcbiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5sYXN0VG91Y2gsICdkcm9wJywgdGhpcy5sYXN0VGFyZ2V0KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5sYXN0VG91Y2gsICdkcmFnZW5kJywgdGhpcy5kcmFnU291cmNlKTtcbiAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgLy8gKiogdXRpbGl0aWVzXG4gIC8vIGlnbm9yZSBldmVudHMgdGhhdCBoYXZlIGJlZW4gaGFuZGxlZCBvciB0aGF0IGludm9sdmUgbW9yZSB0aGFuIG9uZSB0b3VjaFxuICBzaG91bGRIYW5kbGUoZSkge1xuICAgIHJldHVybiBlICYmXG4gICAgIWUuZGVmYXVsdFByZXZlbnRlZCAmJlxuICAgIGUudG91Y2hlcyAmJiBlLnRvdWNoZXMubGVuZ3RoIDwgMjtcbiAgfVxuICAvLyB1c2UgcmVndWxhciBjb25kaXRpb24gb3V0c2lkZSBvZiBwcmVzcyAmIGhvbGQgbW9kZVxuICBzaG91bGRIYW5kbGVNb3ZlKGUpIHtcbiAgICByZXR1cm4gIURyYWdEcm9wVG91Y2guSVNfUFJFU1NfSE9MRF9NT0RFICYmIHRoaXMuc2hvdWxkSGFuZGxlKGUpO1xuICB9XG4gIC8vIGFsbG93IHRvIGhhbmRsZSBtb3ZlcyB0aGF0IGludm9sdmUgbWFueSB0b3VjaGVzIGZvciBwcmVzcyAmIGhvbGRcbiAgc2hvdWxkSGFuZGxlUHJlc3NIb2xkTW92ZShlKSB7XG4gICAgcmV0dXJuIERyYWdEcm9wVG91Y2guSVNfUFJFU1NfSE9MRF9NT0RFICYmXG4gICAgICB0aGlzLmlzRHJhZ0VuYWJsZWQgJiYgZSAmJiBlLnRvdWNoZXMgJiYgZS50b3VjaGVzLmxlbmd0aDtcbiAgfVxuICAvLyByZXNldCBkYXRhIGlmIHVzZXIgZHJhZ3Mgd2l0aG91dCBwcmVzc2luZyAmIGhvbGRpbmdcbiAgc2hvdWxkQ2FuY2VsUHJlc3NIb2xkTW92ZShlKSB7XG4gICAgcmV0dXJuIERyYWdEcm9wVG91Y2guSVNfUFJFU1NfSE9MRF9NT0RFICYmICF0aGlzLmlzRHJhZ0VuYWJsZWQgJiZcbiAgICAgIHRoaXMuZ2V0RGVsdGEoZSkgPiBEcmFnRHJvcFRvdWNoLlBSRVNTX0hPTERfTUFSR0lOO1xuICB9XG4gIC8vIHN0YXJ0IGRyYWdnaW5nIHdoZW4gbW91c2VvdmVyIGVsZW1lbnQgbWF0Y2hlcyBkcmFnIGhhbmRsZXIgc2VsZWN0b3IgYW5kIHNwZWNpZmllZCBkZWx0YSBpcyBkZXRlY3RlZFxuICBzaG91bGRTdGFydERyYWdnaW5nKGUpIHtcbiAgICBjb25zdCBkcmFnSGFuZGxlU2VsZWN0b3IgPSB0aGlzLmdldERyYWdIYW5kbGUoKTtcbiAgICAvLyBzdGFydCBkcmFnZ2luZyB3aGVuIG1vdXNlb3ZlciBlbGVtZW50IG1hdGNoZXMgZHJhZyBoYW5kbGVyIHNlbGVjdG9yXG4gICAgaWYgKGRyYWdIYW5kbGVTZWxlY3RvciAmJiAhdGhpcy5tYXRjaFNlbGVjdG9yKGUudGFyZ2V0LCBkcmFnSGFuZGxlU2VsZWN0b3IpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8vIHN0YXJ0IGRyYWdnaW5nIHdoZW4gc3BlY2lmaWVkIGRlbHRhIGlzIGRldGVjdGVkXG4gICAgY29uc3QgZGVsdGEgPSB0aGlzLmdldERlbHRhKGUpO1xuICAgIHJldHVybiBkZWx0YSA+IERyYWdEcm9wVG91Y2guVEhSRVNIT0xEIHx8XG4gICAgICAgIChEcmFnRHJvcFRvdWNoLklTX1BSRVNTX0hPTERfTU9ERSAmJiBkZWx0YSA+PSBEcmFnRHJvcFRvdWNoLlBSRVNTX0hPTERfVEhSRVNIT0xEKTtcbiAgfVxuICAvLyBmaW5kIGRyYWcgaGFuZGxlciBzZWxlY3RvciBmb3IgZHJhZ3N0YXJ0IG9ubHkgd2l0aCBwYXJ0aWFsIGVsZW1lbnRcbiAgZ2V0RHJhZ0hhbmRsZSgpIHtcbiAgICBpZiAodGhpcy5kcmFnU291cmNlKSB7XG4gICAgICByZXR1cm4gdGhpcy5kcmFnU291cmNlLmdldEF0dHJpYnV0ZShEcmFnRHJvcFRvdWNoLkRSQUdfSEFORExFX0FUVFIpIHx8ICcnO1xuICAgIH1cbiAgICByZXR1cm4gJyc7XG4gIH1cbiAgLy8gdGVzdCBpZiBlbGVtZW50IG1hdGNoZXMgc2VsZWN0b3JcbiAgbWF0Y2hTZWxlY3RvcihlbGVtZW50LCBzZWxlY3Rvcikge1xuICAgIGlmIChzZWxlY3Rvcikge1xuICAgICAgY29uc3QgcHJvdG8gPSBFbGVtZW50LnByb3RvdHlwZTtcbiAgICAgIGNvbnN0IGZ1bmMgPVxuICAgICAgICAgIHByb3RvWydtYXRjaGVzJ10gfHxcbiAgICAgICAgICBwcm90b1snbWF0Y2hlc1NlbGVjdG9yJ10gfHxcbiAgICAgICAgICBwcm90b1snbW96TWF0Y2hlc1NlbGVjdG9yJ10gfHxcbiAgICAgICAgICBwcm90b1snbXNNYXRjaGVzU2VsZWN0b3InXSB8fFxuICAgICAgICAgIHByb3RvWydvTWF0Y2hlc1NlbGVjdG9yJ10gfHxcbiAgICAgICAgICBwcm90b1snd2Via2l0TWF0Y2hlc1NlbGVjdG9yJ10gfHxcbiAgICAgICAgICBmdW5jdGlvbiAocykge1xuICAgICAgICAgICAgY29uc3QgbWF0Y2hlcyA9ICh0aGlzLmRvY3VtZW50IHx8IHRoaXMub3duZXJEb2N1bWVudCkucXVlcnlTZWxlY3RvckFsbChzKTtcbiAgICAgICAgICAgIGxldCBpID0gbWF0Y2hlcy5sZW5ndGg7XG4gICAgICAgICAgICB3aGlsZSAoLS1pID49IDAgJiYgbWF0Y2hlcy5pdGVtKGkpICE9PSB0aGlzKSB7XG4gICAgICAgICAgICAgIC8vIGRvIG5vdGhpbmdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBpID4gLTE7XG4gICAgICAgICAgfTtcbiAgICAgIHJldHVybiBmdW5jLmNhbGwoZWxlbWVudCwgc2VsZWN0b3IpO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICAvLyBjbGVhciBhbGwgbWVtYmVyc1xuICByZXNldCgpIHtcbiAgICB0aGlzLnJlbW92ZVRvdWNobW92ZVRvdWNoZW5kKCk7XG4gICAgdGhpcy5kZXN0cm95SW1hZ2UoKTtcbiAgICB0aGlzLmRyYWdTb3VyY2UgPSBudWxsO1xuICAgIHRoaXMubGFzdFRvdWNoID0gbnVsbDtcbiAgICB0aGlzLmxhc3RUYXJnZXQgPSBudWxsO1xuICAgIHRoaXMucHREb3duID0gbnVsbDtcbiAgICB0aGlzLmlzRHJhZ0VuYWJsZWQgPSBmYWxzZTtcbiAgICB0aGlzLmlzRHJvcFpvbmUgPSBmYWxzZTtcbiAgICB0aGlzLmRhdGFUcmFuc2ZlciA9IG5ldyBEcmFnRHJvcFRvdWNoLkRhdGFUcmFuc2ZlcigpO1xuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5wcmVzc0hvbGRJbnRlcnZhbCk7XG4gICAgdGhpcy5jbGVhckRyYWdvdmVySW50ZXJ2YWwoKTtcbiAgfVxuICAvLyBnZXQgcG9pbnQgZm9yIGEgdG91Y2ggZXZlbnRcbiAgZ2V0UG9pbnQoZSwgcGFnZT8pIHtcbiAgICBpZiAoZSAmJiBlLnRvdWNoZXMpIHtcbiAgICAgIGUgPSBlLnRvdWNoZXNbMF07XG4gICAgfVxuICAgIHJldHVybiB7IHg6IHBhZ2UgPyBlLnBhZ2VYIDogZS5jbGllbnRYLCB5OiBwYWdlID8gZS5wYWdlWSA6IGUuY2xpZW50WSB9O1xuICB9XG4gIC8vIGdldCBkaXN0YW5jZSBiZXR3ZWVuIHRoZSBjdXJyZW50IHRvdWNoIGV2ZW50IGFuZCB0aGUgZmlyc3Qgb25lXG4gIGdldERlbHRhKGUpIHtcbiAgICBpZiAoRHJhZ0Ryb3BUb3VjaC5JU19QUkVTU19IT0xEX01PREUgJiYgIXRoaXMucHREb3duKSB7IHJldHVybiAwOyB9XG4gICAgY29uc3QgcCA9IHRoaXMuZ2V0UG9pbnQoZSk7XG4gICAgcmV0dXJuIE1hdGguYWJzKHAueCAtIHRoaXMucHREb3duLngpICsgTWF0aC5hYnMocC55IC0gdGhpcy5wdERvd24ueSk7XG4gIH1cbiAgLy8gZ2V0IHRoZSBlbGVtZW50IGF0IGEgZ2l2ZW4gdG91Y2ggZXZlbnRcbiAgZ2V0VGFyZ2V0KGU6IFRvdWNoRXZlbnQpIHtcbiAgICBjb25zdCBwdCA9IHRoaXMuZ2V0UG9pbnQoZSk7XG4gICAgbGV0IGVsID0gZG9jdW1lbnQuZWxlbWVudEZyb21Qb2ludChwdC54LCBwdC55KTtcbiAgICB3aGlsZSAoZWwgJiYgZ2V0Q29tcHV0ZWRTdHlsZShlbCkucG9pbnRlckV2ZW50cyA9PT0gJ25vbmUnKSB7XG4gICAgICBlbCA9IGVsLnBhcmVudEVsZW1lbnQ7XG4gICAgfVxuICAgIHJldHVybiA8SFRNTEVsZW1lbnQ+ZWw7XG4gIH1cbiAgLy8gY3JlYXRlIGRyYWcgaW1hZ2UgZnJvbSBzb3VyY2UgZWxlbWVudFxuICBjcmVhdGVJbWFnZShlKSB7XG4gICAgLy8ganVzdCBpbiBjYXNlLi4uXG4gICAgaWYgKHRoaXMuaW1nKSB7XG4gICAgICB0aGlzLmRlc3Ryb3lJbWFnZSgpO1xuICAgIH1cbiAgICAvLyBjcmVhdGUgZHJhZyBpbWFnZSBmcm9tIGN1c3RvbSBlbGVtZW50IG9yIGRyYWcgc291cmNlXG4gICAgY29uc3Qgc3JjID0gdGhpcy5pbWdDdXN0b20gfHwgdGhpcy5kcmFnU291cmNlO1xuICAgIHRoaXMuaW1nID0gc3JjLmNsb25lTm9kZSh0cnVlKTtcbiAgICB0aGlzLmNvcHlTdHlsZShzcmMsIHRoaXMuaW1nKTtcbiAgICB0aGlzLmltZy5zdHlsZS50b3AgPSB0aGlzLmltZy5zdHlsZS5sZWZ0ID0gJy05OTk5cHgnO1xuICAgIC8vIGlmIGNyZWF0aW5nIGZyb20gZHJhZyBzb3VyY2UsIGFwcGx5IG9mZnNldCBhbmQgb3BhY2l0eVxuICAgIGlmICghdGhpcy5pbWdDdXN0b20pIHtcbiAgICAgIGNvbnN0IHJjID0gc3JjLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3QgcHQgPSB0aGlzLmdldFBvaW50KGUpO1xuICAgICAgdGhpcy5pbWdPZmZzZXQgPSB7IHg6IHB0LnggLSByYy5sZWZ0LCB5OiBwdC55IC0gcmMudG9wIH07XG4gICAgICB0aGlzLmltZy5zdHlsZS5vcGFjaXR5ID0gRHJhZ0Ryb3BUb3VjaC5PUEFDSVRZLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIC8vIGFkZCBpbWFnZSB0byBkb2N1bWVudFxuICAgIHRoaXMubW92ZUltYWdlKGUpO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5pbWcpO1xuICB9XG4gIC8vIGRpc3Bvc2Ugb2YgZHJhZyBpbWFnZSBlbGVtZW50XG4gIGRlc3Ryb3lJbWFnZSgpIHtcbiAgICBpZiAodGhpcy5pbWcgJiYgdGhpcy5pbWcucGFyZW50RWxlbWVudCkge1xuICAgICAgdGhpcy5pbWcucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLmltZyk7XG4gICAgfVxuICAgIHRoaXMuaW1nID0gbnVsbDtcbiAgICB0aGlzLmltZ0N1c3RvbSA9IG51bGw7XG4gIH1cbiAgLy8gbW92ZSB0aGUgZHJhZyBpbWFnZSBlbGVtZW50XG4gIG1vdmVJbWFnZShlKSB7XG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgIGlmICh0aGlzLmltZykge1xuICAgICAgICBjb25zdCBwdCA9IHRoaXMuZ2V0UG9pbnQoZSwgdHJ1ZSk7XG4gICAgICAgIGNvbnN0IHMgPSB0aGlzLmltZy5zdHlsZTtcbiAgICAgICAgcy5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XG4gICAgICAgIHMucG9pbnRlckV2ZW50cyA9ICdub25lJztcbiAgICAgICAgcy56SW5kZXggPSAnOTk5OTk5JztcbiAgICAgICAgcy5sZWZ0ID0gTWF0aC5yb3VuZChwdC54IC0gdGhpcy5pbWdPZmZzZXQueCkgKyAncHgnO1xuICAgICAgICBzLnRvcCA9IE1hdGgucm91bmQocHQueSAtIHRoaXMuaW1nT2Zmc2V0LnkpICsgJ3B4JztcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICAvLyBjb3B5IHByb3BlcnRpZXMgZnJvbSBhbiBvYmplY3QgdG8gYW5vdGhlclxuICBjb3B5UHJvcHMgKGRzdCwgc3JjLCBwcm9wcykge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHAgPSBwcm9wc1tpXTtcbiAgICAgIGRzdFtwXSA9IHNyY1twXTtcbiAgICB9XG4gIH1cbiAgLy8gY29weSBzdHlsZXMvYXR0cmlidXRlcyBmcm9tIGRyYWcgc291cmNlIHRvIGRyYWcgaW1hZ2UgZWxlbWVudFxuICBjb3B5U3R5bGUoc3JjLCBkc3QpIHtcbiAgICAvLyByZW1vdmUgcG90ZW50aWFsbHkgdHJvdWJsZXNvbWUgYXR0cmlidXRlc1xuICAgIERyYWdEcm9wVG91Y2gucm12QXR0cnMuZm9yRWFjaChmdW5jdGlvbiAoYXR0KSB7XG4gICAgICBkc3QucmVtb3ZlQXR0cmlidXRlKGF0dCk7XG4gICAgfSk7XG4gICAgLy8gY29weSBjYW52YXMgY29udGVudFxuICAgIGlmIChzcmMgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCkge1xuICAgICAgY29uc3QgY2FuU3JjID0gc3JjO1xuICAgICAgY29uc3QgY2FuRHN0ID0gZHN0O1xuICAgICAgY2FuRHN0LndpZHRoID0gY2FuU3JjLndpZHRoO1xuICAgICAgY2FuRHN0LmhlaWdodCA9IGNhblNyYy5oZWlnaHQ7XG4gICAgICBjYW5Ec3QuZ2V0Q29udGV4dCgnMmQnKS5kcmF3SW1hZ2UoY2FuU3JjLCAwLCAwKTtcbiAgICB9XG4gICAgLy8gY29weSBjYW52YXMgY29udGVudCBmb3IgbmVzdGVkIGNhbnZhcyBlbGVtZW50XG4gICAgY29uc3Qgc3JjQ2FudmFzZXMgPSBzcmMucXVlcnlTZWxlY3RvckFsbCgnY2FudmFzJyk7XG4gICAgaWYgKHNyY0NhbnZhc2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGRzdENhbnZhc2VzID0gZHN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ2NhbnZhcycpO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkc3RDYW52YXNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBjU3JjID0gc3JjQ2FudmFzZXNbaV07XG4gICAgICAgIGNvbnN0IGNEc3QgPSBkc3RDYW52YXNlc1tpXTtcbiAgICAgICAgY0RzdC5nZXRDb250ZXh0KCcyZCcpLmRyYXdJbWFnZShjU3JjLCAwLCAwKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gY29weSBzdHlsZSAod2l0aG91dCB0cmFuc2l0aW9ucylcbiAgICBjb25zdCBjcyA9IGdldENvbXB1dGVkU3R5bGUoc3JjKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBrZXkgPSBjc1tpXTtcbiAgICAgIGlmIChrZXkuaW5kZXhPZigndHJhbnNpdGlvbicpIDwgMCkge1xuICAgICAgICBkc3Quc3R5bGVba2V5XSA9IGNzW2tleV07XG4gICAgICB9XG4gICAgfVxuICAgIGRzdC5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ25vbmUnO1xuICAgIC8vIGFuZCByZXBlYXQgZm9yIGFsbCBjaGlsZHJlblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3JjLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLmNvcHlTdHlsZShzcmMuY2hpbGRyZW5baV0sIGRzdC5jaGlsZHJlbltpXSk7XG4gICAgfVxuICB9XG4gIC8vIHN5bnRoZXNpemUgYW5kIGRpc3BhdGNoIGFuIGV2ZW50XG4gIC8vIHJldHVybnMgdHJ1ZSBpZiB0aGUgZXZlbnQgaGFzIGJlZW4gaGFuZGxlZCAoZS5wcmV2ZW50RGVmYXVsdCA9PSB0cnVlKVxuICBkaXNwYXRjaEV2ZW50KGUsIHR5cGUsIHRhcmdldCkge1xuICAgIGlmIChlICYmIHRhcmdldCkge1xuICAgICAgY29uc3QgZXZ0ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0V2ZW50Jyk7XG4gICAgICBjb25zdCB0ID0gZS50b3VjaGVzID8gZS50b3VjaGVzWzBdIDogZTtcbiAgICAgIGV2dC5pbml0RXZlbnQodHlwZSwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICBjb25zdCBvYmogPSB7XG4gICAgICAgIGJ1dHRvbjogMCxcbiAgICAgICAgd2hpY2g6IDAsXG4gICAgICAgIGJ1dHRvbnM6IDEsXG4gICAgICAgIGRhdGFUcmFuc2ZlcjogdGhpcy5kYXRhVHJhbnNmZXJcbiAgICAgIH07XG4gICAgICB0aGlzLmNvcHlQcm9wcyhldnQsIGUsIERyYWdEcm9wVG91Y2gua2JkUHJvcHMpO1xuICAgICAgdGhpcy5jb3B5UHJvcHMoZXZ0LCB0LCBEcmFnRHJvcFRvdWNoLnB0UHJvcHMpO1xuICAgICAgdGhpcy5jb3B5UHJvcHMoZXZ0LCB7ZnJvbVRvdWNoOiB0cnVlfSwgWydmcm9tVG91Y2gnXSk7IC8vIG1hcmsgYXMgZnJvbSB0b3VjaCBldmVudFxuICAgICAgdGhpcy5jb3B5UHJvcHMoZXZ0LCBvYmosIE9iamVjdC5rZXlzKG9iaikpO1xuXG4gICAgICB0YXJnZXQuZGlzcGF0Y2hFdmVudChldnQpO1xuICAgICAgcmV0dXJuIGV2dC5kZWZhdWx0UHJldmVudGVkO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgLy8gZ2V0cyBhbiBlbGVtZW50J3MgY2xvc2VzdCBkcmFnZ2FibGUgYW5jZXN0b3JcbiAgY2xvc2VzdERyYWdnYWJsZShlKSB7XG4gICAgZm9yICg7IGU7IGUgPSBlLnBhcmVudEVsZW1lbnQpIHtcbiAgICAgIGlmIChlLmhhc0F0dHJpYnV0ZSgnZHJhZ2dhYmxlJykgJiYgZS5kcmFnZ2FibGUpIHtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG4gIC8vIHJlcGVhdCBkaXNwYXRjaCBkcmFnb3ZlciBldmVudCB3aGVuIHRvdWNoIHBvaW50IHN0YXkgc3RpbGxcbiAgc2V0RHJhZ292ZXJJbnRlcnZhbChlKSB7XG4gICAgdGhpcy5kcmFnb3ZlclRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoZSk7XG4gICAgICBpZiAodGFyZ2V0ICE9PSB0aGlzLmxhc3RUYXJnZXQpIHtcbiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGUsICdkcmFnZW50ZXInLCB0YXJnZXQpO1xuICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZSwgJ2RyYWdsZWF2ZScsIHRoaXMubGFzdFRhcmdldCk7XG4gICAgICAgIHRoaXMubGFzdFRhcmdldCA9IHRhcmdldDtcbiAgICAgIH1cbiAgICAgIHRoaXMuaXNEcm9wWm9uZSA9IHRoaXMuZGlzcGF0Y2hFdmVudChlLCAnZHJhZ292ZXInLCB0YXJnZXQpO1xuICAgIH0sIERyYWdEcm9wVG91Y2guRFJBR19PVkVSX1RJTUUpO1xuICB9XG4gIGNsZWFyRHJhZ292ZXJJbnRlcnZhbCgpIHtcbiAgICBpZiAodGhpcy5kcmFnb3ZlclRpbWVyKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMuZHJhZ292ZXJUaW1lcik7XG4gICAgICB0aGlzLmRyYWdvdmVyVGltZXIgPSB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG5cbn1cbi8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbmFtZXNwYWNlICovXG5leHBvcnQgbmFtZXNwYWNlIERyYWdEcm9wVG91Y2gge1xuICAvKipcbiAgICAgKiBPYmplY3QgdXNlZCB0byBob2xkIHRoZSBkYXRhIHRoYXQgaXMgYmVpbmcgZHJhZ2dlZCBkdXJpbmcgZHJhZyBhbmQgZHJvcCBvcGVyYXRpb25zLlxuICAgICAqXG4gICAgICogSXQgbWF5IGhvbGQgb25lIG9yIG1vcmUgZGF0YSBpdGVtcyBvZiBkaWZmZXJlbnQgdHlwZXMuIEZvciBtb3JlIGluZm9ybWF0aW9uIGFib3V0XG4gICAgICogZHJhZyBhbmQgZHJvcCBvcGVyYXRpb25zIGFuZCBkYXRhIHRyYW5zZmVyIG9iamVjdHMsIHNlZVxuICAgICAqIDxhIGhyZWY9XCJodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRGF0YVRyYW5zZmVyXCI+SFRNTCBEcmFnIGFuZCBEcm9wIEFQSTwvYT4uXG4gICAgICpcbiAgICAgKiBUaGlzIG9iamVjdCBpcyBjcmVhdGVkIGF1dG9tYXRpY2FsbHkgYnkgdGhlIEBzZWU6RHJhZ0Ryb3BUb3VjaCBzaW5nbGV0b24gYW5kIGlzXG4gICAgICogYWNjZXNzaWJsZSB0aHJvdWdoIHRoZSBAc2VlOmRhdGFUcmFuc2ZlciBwcm9wZXJ0eSBvZiBhbGwgZHJhZyBldmVudHMuXG4gICAgICovXG4gIGV4cG9ydCBjbGFzcyBEYXRhVHJhbnNmZXIgaW1wbGVtZW50cyBEYXRhVHJhbnNmZXIge1xuICAgIGZpbGVzO1xuICAgIGl0ZW1zO1xuICAgIHByaXZhdGUgX2RhdGE7XG4gICAgLyoqXG4gICAgICogR2V0cyBvciBzZXRzIHRoZSB0eXBlIG9mIGRyYWctYW5kLWRyb3Agb3BlcmF0aW9uIGN1cnJlbnRseSBzZWxlY3RlZC5cbiAgICAgKiBUaGUgdmFsdWUgbXVzdCBiZSAnbm9uZScsICAnY29weScsICAnbGluaycsIG9yICdtb3ZlJy5cbiAgICAgKi9cbiAgICBwcml2YXRlIF9kcm9wRWZmZWN0O1xuICAgIGdldCBkcm9wRWZmZWN0KCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2Ryb3BFZmZlY3Q7XG4gICAgfVxuICAgIHNldCBkcm9wRWZmZWN0KHZhbHVlKSB7XG4gICAgICB0aGlzLl9kcm9wRWZmZWN0ID0gdmFsdWU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldHMgb3Igc2V0cyB0aGUgdHlwZXMgb2Ygb3BlcmF0aW9ucyB0aGF0IGFyZSBwb3NzaWJsZS5cbiAgICAgKiBNdXN0IGJlIG9uZSBvZiAnbm9uZScsICdjb3B5JywgJ2NvcHlMaW5rJywgJ2NvcHlNb3ZlJywgJ2xpbmsnLFxuICAgICAqICdsaW5rTW92ZScsICdtb3ZlJywgJ2FsbCcgb3IgJ3VuaW5pdGlhbGl6ZWQnLlxuICAgICAqL1xuICAgIHByaXZhdGUgX2VmZmVjdEFsbG93ZWQ7XG4gICAgZ2V0IGVmZmVjdEFsbG93ZWQoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZWZmZWN0QWxsb3dlZDtcbiAgICB9XG4gICAgc2V0IGVmZmVjdEFsbG93ZWQodmFsdWUpIHtcbiAgICAgIHRoaXMuX2VmZmVjdEFsbG93ZWQgPSB2YWx1ZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0cyBhbiBhcnJheSBvZiBzdHJpbmdzIGdpdmluZyB0aGUgZm9ybWF0cyB0aGF0IHdlcmUgc2V0IGluIHRoZSBAc2VlOmRyYWdzdGFydCBldmVudC5cbiAgICAgKi9cbiAgICBwcml2YXRlIF90eXBlcztcbiAgICBnZXQgdHlwZXMoKSB7XG4gICAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy5fZGF0YSk7XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IgKCkge1xuICAgICAgdGhpcy5fZHJvcEVmZmVjdCA9ICdtb3ZlJztcbiAgICAgIHRoaXMuX2VmZmVjdEFsbG93ZWQgPSAnYWxsJztcbiAgICAgIHRoaXMuX2RhdGEgPSB7fTtcbiAgICB9XG4gICAgLyoqXG4gICAgICAgKiBSZW1vdmVzIHRoZSBkYXRhIGFzc29jaWF0ZWQgd2l0aCBhIGdpdmVuIHR5cGUuXG4gICAgICAgKlxuICAgICAgICogVGhlIHR5cGUgYXJndW1lbnQgaXMgb3B0aW9uYWwuIElmIHRoZSB0eXBlIGlzIGVtcHR5IG9yIG5vdCBzcGVjaWZpZWQsIHRoZSBkYXRhXG4gICAgICAgKiBhc3NvY2lhdGVkIHdpdGggYWxsIHR5cGVzIGlzIHJlbW92ZWQuIElmIGRhdGEgZm9yIHRoZSBzcGVjaWZpZWQgdHlwZSBkb2VzIG5vdCBleGlzdCxcbiAgICAgICAqIG9yIHRoZSBkYXRhIHRyYW5zZmVyIGNvbnRhaW5zIG5vIGRhdGEsIHRoaXMgbWV0aG9kIHdpbGwgaGF2ZSBubyBlZmZlY3QuXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHR5cGUgVHlwZSBvZiBkYXRhIHRvIHJlbW92ZS5cbiAgICAgICAqL1xuICAgIGNsZWFyRGF0YSAodHlwZSkge1xuICAgICAgaWYgKHR5cGUgIT09IG51bGwpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMuX2RhdGFbdHlwZV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9kYXRhID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIHRoZSBkYXRhIGZvciBhIGdpdmVuIHR5cGUsIG9yIGFuIGVtcHR5IHN0cmluZyBpZiBkYXRhIGZvciB0aGF0IHR5cGUgZG9lc1xuICAgICAqIG5vdCBleGlzdCBvciB0aGUgZGF0YSB0cmFuc2ZlciBjb250YWlucyBubyBkYXRhLlxuICAgICAqXG4gICAgICogQHBhcmFtIHR5cGUgVHlwZSBvZiBkYXRhIHRvIHJldHJpZXZlLlxuICAgICAqL1xuICAgIGdldERhdGEgKHR5cGUpIHtcbiAgICAgIHJldHVybiB0aGlzLl9kYXRhW3R5cGVdIHx8ICcnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgZGF0YSBmb3IgYSBnaXZlbiB0eXBlLlxuICAgICAqXG4gICAgICogRm9yIGEgbGlzdCBvZiByZWNvbW1lbmRlZCBkcmFnIHR5cGVzLCBwbGVhc2Ugc2VlXG4gICAgICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvR3VpZGUvSFRNTC9SZWNvbW1lbmRlZF9EcmFnX1R5cGVzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHR5cGUgVHlwZSBvZiBkYXRhIHRvIGFkZC5cbiAgICAgKiBAcGFyYW0gdmFsdWUgRGF0YSB0byBhZGQuXG4gICAgICovXG4gICAgc2V0RGF0YSAodHlwZSwgdmFsdWUpIHtcbiAgICAgIHRoaXMuX2RhdGFbdHlwZV0gPSB2YWx1ZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0IHRoZSBpbWFnZSB0byBiZSB1c2VkIGZvciBkcmFnZ2luZyBpZiBhIGN1c3RvbSBvbmUgaXMgZGVzaXJlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbWcgQW4gaW1hZ2UgZWxlbWVudCB0byB1c2UgYXMgdGhlIGRyYWcgZmVlZGJhY2sgaW1hZ2UuXG4gICAgICogQHBhcmFtIG9mZnNldFggVGhlIGhvcml6b250YWwgb2Zmc2V0IHdpdGhpbiB0aGUgaW1hZ2UuXG4gICAgICogQHBhcmFtIG9mZnNldFkgVGhlIHZlcnRpY2FsIG9mZnNldCB3aXRoaW4gdGhlIGltYWdlLlxuICAgICAqL1xuICAgIHNldERyYWdJbWFnZSAoaW1nLCBvZmZzZXRYLCBvZmZzZXRZKSB7XG4gICAgICBjb25zdCBkZHQgPSBEcmFnRHJvcFRvdWNoLmdldEluc3RhbmNlKCk7XG4gICAgICBkZHQuaW1nQ3VzdG9tID0gaW1nO1xuICAgICAgZGR0LmltZ09mZnNldCA9IHsgeDogb2Zmc2V0WCwgeTogb2Zmc2V0WSB9O1xuICAgIH1cbiAgfVxuXG59XG4iXX0=