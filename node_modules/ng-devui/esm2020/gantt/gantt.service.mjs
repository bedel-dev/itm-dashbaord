import { Injectable } from '@angular/core';
import { fromEvent, merge, Observable, ReplaySubject, Subject } from 'rxjs';
import { pluck } from 'rxjs/operators';
import { GanttScaleUnit } from './gantt.model';
import * as i0 from "@angular/core";
export class GanttService {
    constructor() {
        this.scaleUnit = GanttScaleUnit.day;
        this.ganttBarStatusChange = new Subject();
        this.ganttScaleConfigChange = new ReplaySubject(1);
        this.mouseMoveListener = new Observable();
        this.mouseEndListener = new Observable();
    }
    changeGanttBarStatus(status) {
        this.ganttBarStatusChange.next(status);
    }
    registContainerEvents(scrollContainer) {
        // 背景拖拽
        this.mouseDownListener = fromEvent(scrollContainer, 'mousedown').pipe(pluck('pageX'));
        this.mouseMoveListener = fromEvent(scrollContainer, 'mousemove').pipe(pluck('pageX'));
        this.mouseEndListener = merge(fromEvent(scrollContainer, 'mouseup'), fromEvent(scrollContainer, 'mouseout')).pipe(pluck('pageX'));
    }
    changeGanttScaleConfig(status) {
        this.ganttScaleConfigChange.next(status);
    }
    setScaleConfig(config) {
        if (config.startDate) {
            this.scaleStartDate = config.startDate;
        }
        if (config.endDate) {
            this.scaleEndDate = config.endDate;
        }
        if (config.unit) {
            this.scaleUnit = config.unit;
        }
        this.changeGanttScaleConfig(config);
    }
    getScaleUnitPixel() {
        switch (this.scaleUnit) {
            case GanttScaleUnit.day:
                return 40;
                break;
            case GanttScaleUnit.week:
                return 30;
                break;
            case GanttScaleUnit.month:
                return 20;
                break;
            default:
                break;
        }
    }
    getDatePostionOffset(date) {
        if (date && this.scaleStartDate) {
            const timeOffset = date.getTime() - this.scaleStartDate.getTime();
            const units = timeOffset / GanttService.DAY_DURATION;
            return units * this.getScaleUnitPixel();
        }
    }
    getDuration(startDate, endDate) {
        if (startDate && endDate) {
            const timeOffset = endDate.getTime() - startDate.getTime();
            const duration = timeOffset / GanttService.DAY_DURATION + 1;
            return Math.round(duration);
        }
    }
    getDurationWidth(startDate, endDate) {
        if (startDate && endDate) {
            const duration = this.getDuration(startDate, endDate);
            return duration * this.getScaleUnitPixel();
        }
    }
    isSomeDate(date, compareDate) {
        if (date.getFullYear() !== compareDate.getFullYear()) {
            return false;
        }
        if (date.getMonth() !== compareDate.getMonth()) {
            return false;
        }
        if (date.getDate() !== compareDate.getDate()) {
            return false;
        }
        return true;
    }
    roundDate(date) {
        if (date.getHours() >= 12) {
            date.setDate(date.getDate() + 1);
            date.setHours(0, 0, 0);
        }
        else if (date.getHours() < 12) {
            date.setHours(0, 0, 0);
        }
    }
    unRegistContainerEvents() { }
}
GanttService.DAY_DURATION = 24 * 60 * 60 * 1000;
GanttService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: GanttService, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
GanttService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: GanttService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: GanttService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return []; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FudHQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2RldnVpL2dhbnR0L2dhbnR0LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsYUFBYSxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1RSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkMsT0FBTyxFQUFvQyxjQUFjLEVBQUUsTUFBTSxlQUFlLENBQUM7O0FBR2pGLE1BQU0sT0FBTyxZQUFZO0lBWXZCO1FBVkEsY0FBUyxHQUFHLGNBQWMsQ0FBQyxHQUFHLENBQUM7UUFHL0IseUJBQW9CLEdBQUcsSUFBSSxPQUFPLEVBQWtCLENBQUM7UUFDckQsMkJBQXNCLEdBQUcsSUFBSSxhQUFhLENBQW1CLENBQUMsQ0FBQyxDQUFDO1FBR2hFLHNCQUFpQixHQUFHLElBQUksVUFBVSxFQUFFLENBQUM7UUFDckMscUJBQWdCLEdBQUcsSUFBSSxVQUFVLEVBQUUsQ0FBQztJQUVyQixDQUFDO0lBQ2hCLG9CQUFvQixDQUFDLE1BQXNCO1FBQ3pDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUVELHFCQUFxQixDQUFDLGVBQTRCO1FBQ2hELE9BQU87UUFDUCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsU0FBUyxDQUFDLGVBQWUsRUFBRSxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFnQixPQUFPLENBQUMsQ0FBQyxDQUFDO1FBRXJHLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxTQUFTLENBQUMsZUFBZSxFQUFFLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQWdCLE9BQU8sQ0FBQyxDQUFDLENB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LE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxTQUFTLENBQUMsSUFBVTtRQUNsQixJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxFQUFFLEVBQUU7WUFDekIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDakMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ3hCO2FBQU0sSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxFQUFFO1lBQy9CLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztTQUN4QjtJQUNILENBQUM7SUFFRCx1QkFBdUIsS0FBSSxDQUFDOztBQTNHckIseUJBQVksR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUM7eUdBRC9CLFlBQVk7NkdBQVosWUFBWTsyRkFBWixZQUFZO2tCQUR4QixVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgZnJvbUV2ZW50LCBtZXJnZSwgT2JzZXJ2YWJsZSwgUmVwbGF5U3ViamVjdCwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgcGx1Y2sgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBHYW50dEJhclN0YXR1cywgR2FudHRTY2FsZUNvbmZpZywgR2FudHRTY2FsZVVuaXQgfSBmcm9tICcuL2dhbnR0Lm1vZGVsJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEdhbnR0U2VydmljZSB7XG4gIHN0YXRpYyBEQVlfRFVSQVRJT04gPSAyNCAqIDYwICogNjAgKiAxMDAwO1xuICBzY2FsZVVuaXQgPSBHYW50dFNjYWxlVW5pdC5kYXk7XG4gIHNjYWxlU3RhcnREYXRlOiBEYXRlO1xuICBzY2FsZUVuZERhdGU6IERhdGU7XG4gIGdhbnR0QmFyU3RhdHVzQ2hhbmdlID0gbmV3IFN1YmplY3Q8R2FudHRCYXJTdGF0dXM+KCk7XG4gIGdhbnR0U2NhbGVDb25maWdDaGFuZ2UgPSBuZXcgUmVwbGF5U3ViamVjdDxHYW50dFNjYWxlQ29uZmlnPigxKTtcblxuICBtb3VzZURvd25MaXN0ZW5lcjogT2JzZXJ2YWJsZTxudW1iZXI+O1xuICBtb3VzZU1vdmVMaXN0ZW5lciA9IG5ldyBPYnNlcnZhYmxlKCk7XG4gIG1vdXNlRW5kTGlzdGVuZXIgPSBuZXcgT2JzZXJ2YWJsZSgpO1xuXG4gIGNvbnN0cnVjdG9yKCkge31cbiAgY2hhbmdlR2FudHRCYXJTdGF0dXMoc3RhdHVzOiBHYW50dEJhclN0YXR1cykge1xuICAgIHRoaXMuZ2FudHRCYXJTdGF0dXNDaGFuZ2UubmV4dChzdGF0dXMpO1xuICB9XG5cbiAgcmVnaXN0Q29udGFpbmVyRXZlbnRzKHNjcm9sbENvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICAvLyDog4zmma/mi5bmi71cbiAgICB0aGlzLm1vdXNlRG93bkxpc3RlbmVyID0gZnJvbUV2ZW50KHNjcm9sbENvbnRhaW5lciwgJ21vdXNlZG93bicpLnBpcGUocGx1Y2s8RXZlbnQsIG51bWJlcj4oJ3BhZ2VYJykpO1xuXG4gICAgdGhpcy5tb3VzZU1vdmVMaXN0ZW5lciA9IGZyb21FdmVudChzY3JvbGxDb250YWluZXIsICdtb3VzZW1vdmUnKS5waXBlKHBsdWNrPEV2ZW50LCBudW1iZXI+KCdwYWdlWCcpKTtcblxuICAgIHRoaXMubW91c2VFbmRMaXN0ZW5lciA9IG1lcmdlKGZyb21FdmVudChzY3JvbGxDb250YWluZXIsICdtb3VzZXVwJyksIGZyb21FdmVudChzY3JvbGxDb250YWluZXIsICdtb3VzZW91dCcpKS5waXBlKFxuICAgICAgcGx1Y2s8RXZlbnQsIG51bWJlcj4oJ3BhZ2VYJylcbiAgICApO1xuICB9XG5cbiAgY2hhbmdlR2FudHRTY2FsZUNvbmZpZyhzdGF0dXM6IEdhbnR0U2NhbGVDb25maWcpIHtcbiAgICB0aGlzLmdhbnR0U2NhbGVDb25maWdDaGFuZ2UubmV4dChzdGF0dXMpO1xuICB9XG5cbiAgc2V0U2NhbGVDb25maWcoY29uZmlnOiBHYW50dFNjYWxlQ29uZmlnKSB7XG4gICAgaWYgKGNvbmZpZy5zdGFydERhdGUpIHtcbiAgICAgIHRoaXMuc2NhbGVTdGFydERhdGUgPSBjb25maWcuc3RhcnREYXRlO1xuICAgIH1cbiAgICBpZiAoY29uZmlnLmVuZERhdGUpIHtcbiAgICAgIHRoaXMuc2NhbGVFbmREYXRlID0gY29uZmlnLmVuZERhdGU7XG4gICAgfVxuICAgIGlmIChjb25maWcudW5pdCkge1xuICAgICAgdGhpcy5zY2FsZVVuaXQgPSBjb25maWcudW5pdDtcbiAgICB9XG4gICAgdGhpcy5jaGFuZ2VHYW50dFNjYWxlQ29uZmlnKGNvbmZpZyk7XG4gIH1cblxuICBnZXRTY2FsZVVuaXRQaXhlbCgpIHtcbiAgICBzd2l0Y2ggKHRoaXMuc2NhbGVVbml0KSB7XG4gICAgY2FzZSBHYW50dFNjYWxlVW5pdC5kYXk6XG4gICAgICByZXR1cm4gNDA7XG4gICAgICBicmVhaztcbiAgICBjYXNlIEdhbnR0U2NhbGVVbml0LndlZWs6XG4gICAgICByZXR1cm4gMzA7XG4gICAgICBicmVhaztcbiAgICBjYXNlIEdhbnR0U2NhbGVVbml0Lm1vbnRoOlxuICAgICAgcmV0dXJuIDIwO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIGdldERhdGVQb3N0aW9uT2Zmc2V0KGRhdGU6IERhdGUpOiBudW1iZXIge1xuICAgIGlmIChkYXRlICYmIHRoaXMuc2NhbGVTdGFydERhdGUpIHtcbiAgICAgIGNvbnN0IHRpbWVPZmZzZXQgPSBkYXRlLmdldFRpbWUoKSAtIHRoaXMuc2NhbGVTdGFydERhdGUuZ2V0VGltZSgpO1xuICAgICAgY29uc3QgdW5pdHMgPSB0aW1lT2Zmc2V0IC8gR2FudHRTZXJ2aWNlLkRBWV9EVVJBVElPTjtcbiAgICAgIHJldHVybiB1bml0cyAqIHRoaXMuZ2V0U2NhbGVVbml0UGl4ZWwoKTtcbiAgICB9XG4gIH1cblxuICBnZXREdXJhdGlvbihzdGFydERhdGU6IERhdGUsIGVuZERhdGU6IERhdGUpOiBudW1iZXIge1xuICAgIGlmIChzdGFydERhdGUgJiYgZW5kRGF0ZSkge1xuICAgICAgY29uc3QgdGltZU9mZnNldCA9IGVuZERhdGUuZ2V0VGltZSgpIC0gc3RhcnREYXRlLmdldFRpbWUoKTtcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gdGltZU9mZnNldCAvIEdhbnR0U2VydmljZS5EQVlfRFVSQVRJT04gKyAxO1xuICAgICAgcmV0dXJuIE1hdGgucm91bmQoZHVyYXRpb24pO1xuICAgIH1cbiAgfVxuXG4gIGdldER1cmF0aW9uV2lkdGgoc3RhcnREYXRlOiBEYXRlLCBlbmREYXRlOiBEYXRlKTogbnVtYmVyIHtcbiAgICBpZiAoc3RhcnREYXRlICYmIGVuZERhdGUpIHtcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gdGhpcy5nZXREdXJhdGlvbihzdGFydERhdGUsIGVuZERhdGUpO1xuICAgICAgcmV0dXJuIGR1cmF0aW9uICogdGhpcy5nZXRTY2FsZVVuaXRQaXhlbCgpO1xuICAgIH1cbiAgfVxuXG4gIGlzU29tZURhdGUoZGF0ZTogRGF0ZSwgY29tcGFyZURhdGU6IERhdGUpIHtcbiAgICBpZiAoZGF0ZS5nZXRGdWxsWWVhcigpICE9PSBjb21wYXJlRGF0ZS5nZXRGdWxsWWVhcigpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKGRhdGUuZ2V0TW9udGgoKSAhPT0gY29tcGFyZURhdGUuZ2V0TW9udGgoKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmIChkYXRlLmdldERhdGUoKSAhPT0gY29tcGFyZURhdGUuZ2V0RGF0ZSgpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcm91bmREYXRlKGRhdGU6IERhdGUpIHtcbiAgICBpZiAoZGF0ZS5nZXRIb3VycygpID49IDEyKSB7XG4gICAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyAxKTtcbiAgICAgIGRhdGUuc2V0SG91cnMoMCwgMCwgMCk7XG4gICAgfSBlbHNlIGlmIChkYXRlLmdldEhvdXJzKCkgPCAxMikge1xuICAgICAgZGF0ZS5zZXRIb3VycygwLCAwLCAwKTtcbiAgICB9XG4gIH1cblxuICB1blJlZ2lzdENvbnRhaW5lckV2ZW50cygpIHt9XG59XG4iXX0=