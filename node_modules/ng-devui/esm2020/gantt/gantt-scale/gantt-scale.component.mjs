import { Component, EventEmitter, Input, Output } from '@angular/core';
import { I18nService } from 'ng-devui/i18n';
import { fromEvent } from 'rxjs';
import { GanttScaleUnit } from '../gantt.model';
import { GanttService } from '../gantt.service';
import * as i0 from "@angular/core";
import * as i1 from "../gantt.service";
import * as i2 from "ng-devui/i18n";
import * as i3 from "@angular/common";
import * as i4 from "../gantt-marker.directive";
export class GanttScaleComponent {
    constructor(ganttService, i18n) {
        this.ganttService = ganttService;
        this.i18n = i18n;
        this.viewScaleRange = [0, 0];
        this.viewSCaleData = [];
        this.SCALE_START_LABLE_OFFSET = 7;
        this.scaleWidth = {
            day: 40,
            week: 30,
            month: 20,
        };
        this.unit = GanttScaleUnit.day;
        this.addMilestoneEvent = new EventEmitter();
    }
    ngOnInit() {
        this.i18nText = this.i18n.getI18nText().gantt;
        this.i18nCommonText = this.i18n.getI18nText().common;
        this.i18nLocale = this.i18n.getI18nText().locale;
        this.i18nSubscription = this.i18n.langChange().subscribe((data) => {
            this.i18nText = data.gantt;
            this.i18nCommonText = data.common;
            this.i18nLocale = data.locale;
        });
        this.ganttBarStatusHandler = this.ganttService.ganttBarStatusChange.subscribe((status) => {
            this.ganttBarStatusChange(status);
        });
        this.ganttSacleConfigHandler = this.ganttService.ganttScaleConfigChange.subscribe((config) => {
            if (config.startDate) {
                this.startDate = config.startDate;
            }
            if (config.endDate) {
                this.endDate = config.endDate;
            }
            if (config.startDate || config.endDate) {
                this.scaleData = this.generateScaleData(this.startDate, this.endDate);
                this.getViewScaleData();
            }
            if (config.unit) {
                this.unit = config.unit;
                this.getViewScaleData();
            }
            if (config.viewChange) {
                this.getViewScaleData();
            }
        });
    }
    ngOnChanges(changes) {
        if (Object.prototype.hasOwnProperty.call(changes, 'scrollElement')) {
            this.registerScrollEvent();
        }
    }
    registerScrollEvent() {
        if (!this.scrollHandler && this.scrollElement) {
            this.scrollHandler = fromEvent(this.scrollElement, 'scroll').subscribe(e => {
                this.getViewScaleData();
            });
        }
    }
    getViewScaleData() {
        if (this.scrollElement) {
            const containerWidth = this.scrollElement.clientWidth;
            const scrollLeft = this.scrollElement.scrollLeft;
            const start = Math.floor(scrollLeft / this.scaleWidth[this.unit]);
            const offset = Math.ceil(containerWidth / this.scaleWidth[this.unit]);
            this.viewScaleRange = [start - 2, start + offset + 2];
            this.viewSCaleData = this.scaleData.filter((i) => {
                return i.index >= this.viewScaleRange[0] && i.index <= this.viewScaleRange[1];
            });
        }
    }
    generateScaleData(startDate, endDate) {
        if (startDate && endDate) {
            const scaleData = [];
            let handleDate = startDate;
            let index = 0;
            while (!this.ganttService.isSomeDate(handleDate, endDate)) {
                const dateInfo = this.generateDateInfo(handleDate, index);
                scaleData.push(dateInfo);
                handleDate = this.getNextDay(new Date(handleDate));
                index++;
            }
            return scaleData;
        }
    }
    getNextDay(date) {
        const nextDayDate = date.setDate(date.getDate() + 1);
        return new Date(nextDayDate);
    }
    generateDateInfo(date, index) {
        const dateInfo = {
            dayOfMonthLabel: '',
            dayOfWeekLabel: '',
            monthLabel: '',
            yearLabel: '',
            date: date,
            monthStart: false,
            weekend: false,
            today: false,
            milestone: '',
            highlightStart: false,
            scaleStartVisable: true,
            index
        };
        const dayOfMonth = date.getDate();
        dateInfo.dayOfMonthLabel = String(dayOfMonth);
        if (dayOfMonth === 1) {
            dateInfo.monthStart = true;
        }
        const dayOfWeek = date.getDay();
        dateInfo.dayOfWeekLabel = String(dayOfWeek);
        if (dayOfWeek === 6) {
            dateInfo.weekend = true;
        }
        const month = date.getMonth() + 1;
        dateInfo.monthLabel = String(month);
        const year = date.getFullYear();
        dateInfo.yearLabel = String(year);
        if (this.ganttService.isSomeDate(date, new Date())) {
            dateInfo.today = true;
        }
        if (new Date(year, month - 1, dayOfMonth + this.SCALE_START_LABLE_OFFSET).getMonth() > month - 1) {
            dateInfo.scaleStartVisable = false;
        }
        if (this.milestoneList) {
            this.milestoneList.forEach((milestone) => {
                if (milestone.date) {
                    if (this.ganttService.isSomeDate(milestone.date, dateInfo.date)) {
                        dateInfo.milestone = milestone.lable;
                    }
                }
            });
        }
        return dateInfo;
    }
    trackByFn(index, item) {
        return index;
    }
    ganttBarStatusChange(status) {
        this.highlight = status.focused;
        if (this.highlight) {
            this.scaleData.forEach((dateInfo, index) => {
                if (dateInfo.date >= status.startDate && dateInfo.date <= status.endDate) {
                    dateInfo.highlight = true;
                }
                else {
                    dateInfo.highlight = false;
                }
                dateInfo.highlightStart = false;
            });
            const highlightBarStartIndex = this.scaleData.findIndex((data) => {
                return data.highlight;
            });
            if (highlightBarStartIndex > -1) {
                this.scaleData[highlightBarStartIndex].highlightStart = true;
            }
            const highlightData = this.scaleData.filter((data) => {
                return data.highlight;
            });
            if (highlightData.length === 0) {
                return;
            }
            if (highlightData.length === 1) {
                const startData = highlightData[0];
                this.highlightStartText =
                    this.prefixZero(parseInt(startData.monthLabel, 10)) + '-' + this.prefixZero(parseInt(startData.dayOfMonthLabel, 10));
                const highlightWidth = this.ganttService.getScaleUnitPixel();
                if (highlightWidth < 40) {
                    this.highlightMinWidth = 40;
                }
                else {
                    this.highlightMinWidth = highlightWidth;
                }
            }
            else {
                const startData = highlightData[0];
                const endData = highlightData[highlightData.length - 1];
                this.highlightStartText =
                    this.prefixZero(parseInt(startData.monthLabel, 10)) + '-' + this.prefixZero(parseInt(startData.dayOfMonthLabel, 10));
                this.highlightEndText =
                    this.prefixZero(parseInt(endData.monthLabel, 10)) + '-' + this.prefixZero(parseInt(endData.dayOfMonthLabel, 10));
                const highlightWidth = highlightData.length * this.ganttService.getScaleUnitPixel();
                if (highlightWidth < 80) {
                    this.highlightMinWidth = 80;
                }
                else {
                    this.highlightMinWidth = highlightWidth;
                }
            }
        }
    }
    prefixZero(num) {
        return (Array(2).join('0') + num).slice(-2);
    }
    addMilestone(info) {
        this.addMilestoneEvent.emit(info);
    }
    ngOnDestroy() {
        if (this.ganttBarStatusHandler) {
            this.ganttBarStatusHandler.unsubscribe();
            this.ganttBarStatusHandler = null;
        }
        if (this.ganttSacleConfigHandler) {
            this.ganttSacleConfigHandler.unsubscribe();
            this.ganttSacleConfigHandler = null;
        }
        if (this.scrollHandler) {
            this.scrollHandler.unsubscribe();
        }
    }
}
GanttScaleComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: GanttScaleComponent, deps: [{ token: i1.GanttService }, { token: i2.I18nService }], target: i0.ɵɵFactoryTarget.Component });
GanttScaleComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.3", type: GanttScaleComponent, selector: "d-gantt-scale", inputs: { unit: "unit", height: "height", startDate: "startDate", endDate: "endDate", ganttBarContainerElement: "ganttBarContainerElement", ganttScaleContainerOffsetLeft: "ganttScaleContainerOffsetLeft", milestoneList: "milestoneList", scrollElement: "scrollElement" }, outputs: { addMilestoneEvent: "addMilestoneEvent" }, usesOnChanges: true, ngImport: i0, template: "<div\n  class=\"devui-gantt-scale {{ unit }}\"\n  *ngFor=\"let data of viewSCaleData; trackBy: trackByFn; let first = first; let last = last\"\n  [ngClass]=\"{ today: data.today, milestone: data.milestone }\"\n  [style.left]=\"scaleWidth[unit] * data.index + 'px'\"\n  [style.width]=\"scaleWidth[unit] + 'px'\"\n  dGanttMarker\n  [monthMark]=\"data.monthStart\"\n  [weekend]=\"data.weekend\"\n  [milestone]=\"data.milestone\"\n  [today]=\"data.today\"\n  [date]=\"data.date\"\n  [unit]=\"unit\"\n  [last]=\"last\"\n  [ganttScaleContainerOffsetLeft]=\"ganttScaleContainerOffsetLeft\"\n  [ganttBarContainerElement]=\"ganttBarContainerElement\"\n>\n  <div class=\"devui-scale-start\" [ngClass]=\"{ milestone: data.milestone }\">\n    <ng-container *ngIf=\"data.milestone && unit === 'day'\">\n      {{ data.milestone }}\n    </ng-container>\n    <ng-container *ngIf=\"!data.milestone || unit !== 'day'\">\n      {{\n        data.scaleStartVisable && (first || data.monthStart)\n          ? unit === 'month'\n            ? i18nText?.yearDisplay(data.yearLabel)\n            : i18nText?.yearAndMonthDisplay(data.yearLabel, data.monthLabel)\n          : ''\n      }}\n    </ng-container>\n  </div>\n  <div class=\"devui-scale-unit\">\n    <div *ngIf=\"highlight && data.highlightStart\" class=\"scale-highlight\" [style.minWidth]=\"highlightMinWidth + 'px'\">\n      <div style=\"float: left\">{{ highlightStartText }}</div>\n      <div style=\"float: right\">{{ highlightEndText }}</div>\n      <div style=\"clear: both\"></div>\n    </div>\n    <ng-container *ngIf=\"!highlight || !data.highlight\">\n      <div *ngIf=\"unit === 'day'\" class=\"border-left\" [ngClass]=\"{ today: data.today }\">\n        {{ data.today ? i18nText?.today : data.dayOfMonthLabel }}\n      </div>\n      <div *ngIf=\"unit === 'week'\" [ngClass]=\"{ 'border-left': first || data.weekend }\">\n        {{ first || data.weekend ? data.dayOfMonthLabel : '' }}\n      </div>\n      <div *ngIf=\"unit === 'month'\" [ngClass]=\"{ 'border-left': first || data.monthStart }\">\n        {{ first || data.monthStart ? i18nText?.monthDisplay(data.monthLabel) : '' }}\n      </div>\n    </ng-container>\n  </div>\n  <div class=\"milestone-new {{ unit }}\" [title]=\"i18nText?.milestone\" (click)=\"addMilestone(data)\">\n    <div class=\"icon-add\"></div>\n  </div>\n</div>\n", styles: [".devui-font-size-base{font-size:12px;font-size:var(--devui-font-size, 12px)}.devui-font-base{font-size:12px;font-size:var(--devui-font-size, 12px);font-weight:400;line-height:1.5}.devui-font-size-modal-title{font-size:18px;font-size:var(--devui-font-size-modal-title, 18px)}.devui-font-modal-title{font-size:18px;font-size:var(--devui-font-size-modal-title, 18px);font-weight:700;line-height:1.5}.devui-font-size-page-title{font-size:16px;font-size:var(--devui-font-size-page-title, 16px)}.devui-font-page-title{font-size:16px;font-size:var(--devui-font-size-page-title, 16px);font-weight:700;line-height:1.5}.devui-font-size-secondary-title{font-size:14px;font-size:var(--devui-font-size-card-title, 14px)}.devui-font-secondary-title{font-size:14px;font-size:var(--devui-font-size-card-title, 14px);font-weight:700;line-height:1.5}:host{display:block;height:36px;line-height:18px}.devui-gantt-scale{display:inline-block;color:#babbc0;color:var(--devui-placeholder, #babbc0);text-align:center;position:absolute;height:36px;font-weight:400}.devui-gantt-scale.day:not(.milestone):hover .devui-scale-start{display:none}.devui-gantt-scale.day.milestone{background-image:linear-gradient(180deg,rgba(254,204,85,0) 0%,rgba(62,204,166,.1) 100%)}.devui-gantt-scale .devui-scale-start{width:100%;height:18px;position:absolute;left:1px;white-space:nowrap}.devui-gantt-scale .devui-scale-start.milestone{color:#50d4ab;color:var(--devui-success, #50d4ab)}.devui-gantt-scale .devui-scale-unit{height:18px;position:absolute;top:18px;width:100%}.devui-gantt-scale .devui-scale-unit .border-left{height:18px;border-left:1px solid #f2f5fc;border-left:1px solid var(--devui-list-item-selected-bg, #f2f5fc)}.devui-gantt-scale .devui-scale-unit .scale-highlight{position:absolute;height:18px;border-radius:2px;border-radius:var(--devui-border-radius, 2px);background-color:#5e7ce0;background-color:var(--devui-brand, #5e7ce0);padding:0 4px}.devui-gantt-scale .devui-scale-unit .scale-highlight div{color:#fff;color:var(--devui-base-bg, #ffffff);font-size:12px;font-size:var(--devui-font-size, 12px);font-weight:400}.devui-gantt-scale .devui-scale-unit .today{background:rgba(255,121,14,.2);border-radius:2px;border-radius:var(--devui-border-radius, 2px);height:16px}.devui-gantt-scale .milestone-new{display:none;position:absolute;width:18px;height:18px;margin-left:16px;border:1px solid #f2f5fc;border:1px solid var(--devui-list-item-selected-bg, #f2f5fc);cursor:pointer}.devui-gantt-scale .milestone-new div{line-height:16px}.devui-gantt-scale:not(.milestone):hover .milestone-new.day{display:block}.devui-mark-line{position:absolute;top:0;bottom:0;width:2px;z-index:1;background:#d7d8da;background:var(--devui-line, #d7d8da);opacity:.5}.devui-mark-line.today{opacity:.2;background:#ff790e}.devui-mark-line.today.day{margin-left:24px}.devui-mark-line.today.week{margin-left:9px}.devui-mark-line.today.month{margin-left:4px}.devui-mark-line.milestone{opacity:.2;background:#50d4ab;background:var(--devui-success, #50d4ab)}.devui-mark-line.milestone.day{margin-left:24px}.devui-mark-line.milestone.week{margin-left:9px}.devui-mark-line.milestone.month{margin-left:4px}.devui-mark-stripe{position:absolute;top:0;bottom:0;z-index:1;background:linear-gradient(45deg,rgba(202,207,216,.2) 0,rgba(202,207,216,.2) 10%,transparent 10%,transparent 50%,rgba(202,207,216,.2) 50%,rgba(202,207,216,.2) 60%,transparent 60%,transparent);background-size:6px 6px}.devui-mark-stripe.day{width:100px}.devui-mark-stripe.week{width:40px}.devui-mark-stripe.month{width:20px}\n"], directives: [{ type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i4.GanttMarkerDirective, selector: "[dGanttMarker]", inputs: ["ganttBarContainerElement", "ganttScaleContainerOffsetLeft", "monthMark", "weekend", "today", "milestone", "unit", "date", "last"] }, { type: i3.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: GanttScaleComponent, decorators: [{
            type: Component,
            args: [{ selector: 'd-gantt-scale', template: "<div\n  class=\"devui-gantt-scale {{ unit }}\"\n  *ngFor=\"let data of viewSCaleData; trackBy: trackByFn; let first = first; let last = last\"\n  [ngClass]=\"{ today: data.today, milestone: data.milestone }\"\n  [style.left]=\"scaleWidth[unit] * data.index + 'px'\"\n  [style.width]=\"scaleWidth[unit] + 'px'\"\n  dGanttMarker\n  [monthMark]=\"data.monthStart\"\n  [weekend]=\"data.weekend\"\n  [milestone]=\"data.milestone\"\n  [today]=\"data.today\"\n  [date]=\"data.date\"\n  [unit]=\"unit\"\n  [last]=\"last\"\n  [ganttScaleContainerOffsetLeft]=\"ganttScaleContainerOffsetLeft\"\n  [ganttBarContainerElement]=\"ganttBarContainerElement\"\n>\n  <div class=\"devui-scale-start\" [ngClass]=\"{ milestone: data.milestone }\">\n    <ng-container *ngIf=\"data.milestone && unit === 'day'\">\n      {{ data.milestone }}\n    </ng-container>\n    <ng-container *ngIf=\"!data.milestone || unit !== 'day'\">\n      {{\n        data.scaleStartVisable && (first || data.monthStart)\n          ? unit === 'month'\n            ? i18nText?.yearDisplay(data.yearLabel)\n            : i18nText?.yearAndMonthDisplay(data.yearLabel, data.monthLabel)\n          : ''\n      }}\n    </ng-container>\n  </div>\n  <div class=\"devui-scale-unit\">\n    <div *ngIf=\"highlight && data.highlightStart\" class=\"scale-highlight\" [style.minWidth]=\"highlightMinWidth + 'px'\">\n      <div style=\"float: left\">{{ highlightStartText }}</div>\n      <div style=\"float: right\">{{ highlightEndText }}</div>\n      <div style=\"clear: both\"></div>\n    </div>\n    <ng-container *ngIf=\"!highlight || !data.highlight\">\n      <div *ngIf=\"unit === 'day'\" class=\"border-left\" [ngClass]=\"{ today: data.today }\">\n        {{ data.today ? i18nText?.today : data.dayOfMonthLabel }}\n      </div>\n      <div *ngIf=\"unit === 'week'\" [ngClass]=\"{ 'border-left': first || data.weekend }\">\n        {{ first || data.weekend ? data.dayOfMonthLabel : '' }}\n      </div>\n      <div *ngIf=\"unit === 'month'\" [ngClass]=\"{ 'border-left': first || data.monthStart }\">\n        {{ first || data.monthStart ? i18nText?.monthDisplay(data.monthLabel) : '' }}\n      </div>\n    </ng-container>\n  </div>\n  <div class=\"milestone-new {{ unit }}\" [title]=\"i18nText?.milestone\" (click)=\"addMilestone(data)\">\n    <div class=\"icon-add\"></div>\n  </div>\n</div>\n", styles: [".devui-font-size-base{font-size:12px;font-size:var(--devui-font-size, 12px)}.devui-font-base{font-size:12px;font-size:var(--devui-font-size, 12px);font-weight:400;line-height:1.5}.devui-font-size-modal-title{font-size:18px;font-size:var(--devui-font-size-modal-title, 18px)}.devui-font-modal-title{font-size:18px;font-size:var(--devui-font-size-modal-title, 18px);font-weight:700;line-height:1.5}.devui-font-size-page-title{font-size:16px;font-size:var(--devui-font-size-page-title, 16px)}.devui-font-page-title{font-size:16px;font-size:var(--devui-font-size-page-title, 16px);font-weight:700;line-height:1.5}.devui-font-size-secondary-title{font-size:14px;font-size:var(--devui-font-size-card-title, 14px)}.devui-font-secondary-title{font-size:14px;font-size:var(--devui-font-size-card-title, 14px);font-weight:700;line-height:1.5}:host{display:block;height:36px;line-height:18px}.devui-gantt-scale{display:inline-block;color:#babbc0;color:var(--devui-placeholder, #babbc0);text-align:center;position:absolute;height:36px;font-weight:400}.devui-gantt-scale.day:not(.milestone):hover .devui-scale-start{display:none}.devui-gantt-scale.day.milestone{background-image:linear-gradient(180deg,rgba(254,204,85,0) 0%,rgba(62,204,166,.1) 100%)}.devui-gantt-scale .devui-scale-start{width:100%;height:18px;position:absolute;left:1px;white-space:nowrap}.devui-gantt-scale .devui-scale-start.milestone{color:#50d4ab;color:var(--devui-success, #50d4ab)}.devui-gantt-scale .devui-scale-unit{height:18px;position:absolute;top:18px;width:100%}.devui-gantt-scale .devui-scale-unit .border-left{height:18px;border-left:1px solid #f2f5fc;border-left:1px solid var(--devui-list-item-selected-bg, #f2f5fc)}.devui-gantt-scale .devui-scale-unit .scale-highlight{position:absolute;height:18px;border-radius:2px;border-radius:var(--devui-border-radius, 2px);background-color:#5e7ce0;background-color:var(--devui-brand, #5e7ce0);padding:0 4px}.devui-gantt-scale .devui-scale-unit .scale-highlight div{color:#fff;color:var(--devui-base-bg, #ffffff);font-size:12px;font-size:var(--devui-font-size, 12px);font-weight:400}.devui-gantt-scale .devui-scale-unit .today{background:rgba(255,121,14,.2);border-radius:2px;border-radius:var(--devui-border-radius, 2px);height:16px}.devui-gantt-scale .milestone-new{display:none;position:absolute;width:18px;height:18px;margin-left:16px;border:1px solid #f2f5fc;border:1px solid var(--devui-list-item-selected-bg, #f2f5fc);cursor:pointer}.devui-gantt-scale .milestone-new div{line-height:16px}.devui-gantt-scale:not(.milestone):hover .milestone-new.day{display:block}.devui-mark-line{position:absolute;top:0;bottom:0;width:2px;z-index:1;background:#d7d8da;background:var(--devui-line, #d7d8da);opacity:.5}.devui-mark-line.today{opacity:.2;background:#ff790e}.devui-mark-line.today.day{margin-left:24px}.devui-mark-line.today.week{margin-left:9px}.devui-mark-line.today.month{margin-left:4px}.devui-mark-line.milestone{opacity:.2;background:#50d4ab;background:var(--devui-success, #50d4ab)}.devui-mark-line.milestone.day{margin-left:24px}.devui-mark-line.milestone.week{margin-left:9px}.devui-mark-line.milestone.month{margin-left:4px}.devui-mark-stripe{position:absolute;top:0;bottom:0;z-index:1;background:linear-gradient(45deg,rgba(202,207,216,.2) 0,rgba(202,207,216,.2) 10%,transparent 10%,transparent 50%,rgba(202,207,216,.2) 50%,rgba(202,207,216,.2) 60%,transparent 60%,transparent);background-size:6px 6px}.devui-mark-stripe.day{width:100px}.devui-mark-stripe.week{width:40px}.devui-mark-stripe.month{width:20px}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.GanttService }, { type: i2.I18nService }]; }, propDecorators: { unit: [{
                type: Input
            }], height: [{
                type: Input
            }], startDate: [{
                type: Input
            }], endDate: [{
                type: Input
            }], ganttBarContainerElement: [{
                type: Input
            }], ganttScaleContainerOffsetLeft: [{
                type: Input
            }], milestoneList: [{
                type: Input
            }], scrollElement: [{
                type: Input
            }], addMilestoneEvent: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FudHQtc2NhbGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vZGV2dWkvZ2FudHQvZ2FudHQtc2NhbGUvZ2FudHQtc2NhbGUuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vZGV2dWkvZ2FudHQvZ2FudHQtc2NhbGUvZ2FudHQtc2NhbGUuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFBRSxZQUFZLEVBQ3ZCLEtBQUssRUFJTCxNQUFNLEVBRVAsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFpQixXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0QsT0FBTyxFQUFFLFNBQVMsRUFBZ0IsTUFBTSxNQUFNLENBQUM7QUFDL0MsT0FBTyxFQUFzRCxjQUFjLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNwRyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7Ozs7OztBQU1oRCxNQUFNLE9BQU8sbUJBQW1CO0lBa0M5QixZQUFvQixZQUEwQixFQUFVLElBQWlCO1FBQXJELGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBQVUsU0FBSSxHQUFKLElBQUksQ0FBYTtRQWhDekUsbUJBQWMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN4QixrQkFBYSxHQUF5QixFQUFFLENBQUM7UUFRekMsNkJBQXdCLEdBQUcsQ0FBQyxDQUFDO1FBRTdCLGVBQVUsR0FBRztZQUNYLEdBQUcsRUFBRSxFQUFFO1lBQ1AsSUFBSSxFQUFFLEVBQUU7WUFDUixLQUFLLEVBQUUsRUFBRTtTQUNWLENBQUM7UUFDTyxTQUFJLEdBQUcsY0FBYyxDQUFDLEdBQUcsQ0FBQztRQVF6QixzQkFBaUIsR0FBRyxJQUFJLFlBQVksRUFBc0IsQ0FBQztJQVFRLENBQUM7SUFFOUUsUUFBUTtRQUNOLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLElB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Q0csYUFBYTtzQkFBckIsS0FBSztnQkFDRyxhQUFhO3NCQUFyQixLQUFLO2dCQUNJLGlCQUFpQjtzQkFBMUIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgT25DaGFuZ2VzLFxuICBPbkRlc3Ryb3ksXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBTaW1wbGVDaGFuZ2VzXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSTE4bkludGVyZmFjZSwgSTE4blNlcnZpY2UgfSBmcm9tICduZy1kZXZ1aS9pMThuJztcbmltcG9ydCB7IGZyb21FdmVudCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBHYW50dEJhclN0YXR1cywgR2FudHRNaWxlc3RvbmUsIEdhbnR0U2NhbGVEYXRlSW5mbywgR2FudHRTY2FsZVVuaXQgfSBmcm9tICcuLi9nYW50dC5tb2RlbCc7XG5pbXBvcnQgeyBHYW50dFNlcnZpY2UgfSBmcm9tICcuLi9nYW50dC5zZXJ2aWNlJztcbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2QtZ2FudHQtc2NhbGUnLFxuICB0ZW1wbGF0ZVVybDogJy4vZ2FudHQtc2NhbGUuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9nYW50dC1zY2FsZS5jb21wb25lbnQuc2NzcyddLFxufSlcbmV4cG9ydCBjbGFzcyBHYW50dFNjYWxlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG4gIHNjYWxlRGF0YTogR2FudHRTY2FsZURhdGVJbmZvW107XG4gIHZpZXdTY2FsZVJhbmdlID0gWzAsIDBdO1xuICB2aWV3U0NhbGVEYXRhOiBHYW50dFNjYWxlRGF0ZUluZm9bXSA9IFtdO1xuICBnYW50dEJhclN0YXR1c0hhbmRsZXI6IFN1YnNjcmlwdGlvbjtcbiAgZ2FudHRTYWNsZUNvbmZpZ0hhbmRsZXI6IFN1YnNjcmlwdGlvbjtcbiAgaGlnaGxpZ2h0OiBib29sZWFuO1xuICBoaWdobGlnaHRTdGFydFRleHQ6IHN0cmluZztcbiAgaGlnaGxpZ2h0RW5kVGV4dDogc3RyaW5nO1xuICBoaWdobGlnaHRNaW5XaWR0aDogbnVtYmVyO1xuXG4gIFNDQUxFX1NUQVJUX0xBQkxFX09GRlNFVCA9IDc7XG5cbiAgc2NhbGVXaWR0aCA9IHtcbiAgICBkYXk6IDQwLFxuICAgIHdlZWs6IDMwLFxuICAgIG1vbnRoOiAyMCxcbiAgfTtcbiAgQElucHV0KCkgdW5pdCA9IEdhbnR0U2NhbGVVbml0LmRheTtcbiAgQElucHV0KCkgaGVpZ2h0OiBudW1iZXI7XG4gIEBJbnB1dCgpIHN0YXJ0RGF0ZTogRGF0ZTtcbiAgQElucHV0KCkgZW5kRGF0ZTogRGF0ZTtcbiAgQElucHV0KCkgZ2FudHRCYXJDb250YWluZXJFbGVtZW50OiBIVE1MRWxlbWVudDtcbiAgQElucHV0KCkgZ2FudHRTY2FsZUNvbnRhaW5lck9mZnNldExlZnQ6IG51bWJlcjtcbiAgQElucHV0KCkgbWlsZXN0b25lTGlzdDogR2FudHRNaWxlc3RvbmVbXTtcbiAgQElucHV0KCkgc2Nyb2xsRWxlbWVudDogSFRNTEVsZW1lbnQ7XG4gIEBPdXRwdXQoKSBhZGRNaWxlc3RvbmVFdmVudCA9IG5ldyBFdmVudEVtaXR0ZXI8R2FudHRTY2FsZURhdGVJbmZvPigpO1xuXG4gIHByaXZhdGUgc2Nyb2xsSGFuZGxlcjogU3Vic2NyaXB0aW9uO1xuXG4gIGkxOG5UZXh0OiBJMThuSW50ZXJmYWNlWydnYW50dCddO1xuICBpMThuTG9jYWxlOiBJMThuSW50ZXJmYWNlWydsb2NhbGUnXTtcbiAgaTE4bkNvbW1vblRleHQ6IEkxOG5JbnRlcmZhY2VbJ2NvbW1vbiddO1xuICBpMThuU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZ2FudHRTZXJ2aWNlOiBHYW50dFNlcnZpY2UsIHByaXZhdGUgaTE4bjogSTE4blNlcnZpY2UpIHsgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuaTE4blRleHQgPSB0aGlzLmkxOG4uZ2V0STE4blRleHQoKS5nYW50dDtcbiAgICB0aGlzLmkxOG5Db21tb25UZXh0ID0gdGhpcy5pMThuLmdldEkxOG5UZXh0KCkuY29tbW9uO1xuICAgIHRoaXMuaTE4bkxvY2FsZSA9IHRoaXMuaTE4bi5nZXRJMThuVGV4dCgpLmxvY2FsZTtcbiAgICB0aGlzLmkxOG5TdWJzY3JpcHRpb24gPSB0aGlzLmkxOG4ubGFuZ0NoYW5nZSgpLnN1YnNjcmliZSgoZGF0YSkgPT4ge1xuICAgICAgdGhpcy5pMThuVGV4dCA9IGRhdGEuZ2FudHQ7XG4gICAgICB0aGlzLmkxOG5Db21tb25UZXh0ID0gZGF0YS5jb21tb247XG4gICAgICB0aGlzLmkxOG5Mb2NhbGUgPSBkYXRhLmxvY2FsZTtcbiAgICB9KTtcbiAgICB0aGlzLmdhbnR0QmFyU3RhdHVzSGFuZGxlciA9IHRoaXMuZ2FudHRTZXJ2aWNlLmdhbnR0QmFyU3RhdHVzQ2hhbmdlLnN1YnNjcmliZSgoc3RhdHVzKSA9PiB7XG4gICAgICB0aGlzLmdhbnR0QmFyU3RhdHVzQ2hhbmdlKHN0YXR1cyk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmdhbnR0U2FjbGVDb25maWdIYW5kbGVyID0gdGhpcy5nYW50dFNlcnZpY2UuZ2FudHRTY2FsZUNvbmZpZ0NoYW5nZS5zdWJzY3JpYmUoKGNvbmZpZykgPT4ge1xuICAgICAgaWYgKGNvbmZpZy5zdGFydERhdGUpIHtcbiAgICAgICAgdGhpcy5zdGFydERhdGUgPSBjb25maWcuc3RhcnREYXRlO1xuICAgICAgfVxuICAgICAgaWYgKGNvbmZpZy5lbmREYXRlKSB7XG4gICAgICAgIHRoaXMuZW5kRGF0ZSA9IGNvbmZpZy5lbmREYXRlO1xuICAgICAgfVxuICAgICAgaWYgKGNvbmZpZy5zdGFydERhdGUgfHwgY29uZmlnLmVuZERhdGUpIHtcbiAgICAgICAgdGhpcy5zY2FsZURhdGEgPSB0aGlzLmdlbmVyYXRlU2NhbGVEYXRhKHRoaXMuc3RhcnREYXRlLCB0aGlzLmVuZERhdGUpO1xuICAgICAgICB0aGlzLmdldFZpZXdTY2FsZURhdGEoKTtcbiAgICAgIH1cbiAgICAgIGlmIChjb25maWcudW5pdCkge1xuICAgICAgICB0aGlzLnVuaXQgPSBjb25maWcudW5pdDtcbiAgICAgICAgdGhpcy5nZXRWaWV3U2NhbGVEYXRhKCk7XG4gICAgICB9XG4gICAgICBpZiAoY29uZmlnLnZpZXdDaGFuZ2Upe1xuICAgICAgICB0aGlzLmdldFZpZXdTY2FsZURhdGEoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGNoYW5nZXMsICdzY3JvbGxFbGVtZW50JykpIHtcbiAgICAgIHRoaXMucmVnaXN0ZXJTY3JvbGxFdmVudCgpO1xuICAgIH1cbiAgfVxuXG4gIHJlZ2lzdGVyU2Nyb2xsRXZlbnQgKCkge1xuICAgIGlmICghdGhpcy5zY3JvbGxIYW5kbGVyICYmIHRoaXMuc2Nyb2xsRWxlbWVudCkge1xuICAgICAgdGhpcy5zY3JvbGxIYW5kbGVyID0gZnJvbUV2ZW50KHRoaXMuc2Nyb2xsRWxlbWVudCwgJ3Njcm9sbCcpLnN1YnNjcmliZShlID0+IHtcbiAgICAgICAgdGhpcy5nZXRWaWV3U2NhbGVEYXRhKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBnZXRWaWV3U2NhbGVEYXRhKCkge1xuICAgIGlmICh0aGlzLnNjcm9sbEVsZW1lbnQpIHtcbiAgICAgIGNvbnN0IGNvbnRhaW5lcldpZHRoID0gdGhpcy5zY3JvbGxFbGVtZW50LmNsaWVudFdpZHRoO1xuICAgICAgY29uc3Qgc2Nyb2xsTGVmdCA9IHRoaXMuc2Nyb2xsRWxlbWVudC5zY3JvbGxMZWZ0O1xuICAgICAgY29uc3Qgc3RhcnQgPSBNYXRoLmZsb29yKHNjcm9sbExlZnQgLyB0aGlzLnNjYWxlV2lkdGhbdGhpcy51bml0XSk7XG4gICAgICBjb25zdCBvZmZzZXQgPSBNYXRoLmNlaWwoY29udGFpbmVyV2lkdGggLyB0aGlzLnNjYWxlV2lkdGhbdGhpcy51bml0XSk7XG4gICAgICB0aGlzLnZpZXdTY2FsZVJhbmdlID0gW3N0YXJ0IC0gMiwgc3RhcnQgKyBvZmZzZXQgKyAyXTtcbiAgICAgIHRoaXMudmlld1NDYWxlRGF0YSA9IHRoaXMuc2NhbGVEYXRhLmZpbHRlcigoaTogR2FudHRTY2FsZURhdGVJbmZvKSA9PiB7XG4gICAgICAgIHJldHVybiBpLmluZGV4ID49IHRoaXMudmlld1NjYWxlUmFuZ2VbMF0gJiYgaS5pbmRleCA8PSB0aGlzLnZpZXdTY2FsZVJhbmdlWzFdO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZVNjYWxlRGF0YShzdGFydERhdGU6IERhdGUsIGVuZERhdGU6IERhdGUpOiBHYW50dFNjYWxlRGF0ZUluZm9bXSB7XG4gICAgaWYgKHN0YXJ0RGF0ZSAmJiBlbmREYXRlKSB7XG4gICAgICBjb25zdCBzY2FsZURhdGEgPSBbXTtcbiAgICAgIGxldCBoYW5kbGVEYXRlID0gc3RhcnREYXRlO1xuICAgICAgbGV0IGluZGV4ID0gMDtcbiAgICAgIHdoaWxlICghdGhpcy5nYW50dFNlcnZpY2UuaXNTb21lRGF0ZShoYW5kbGVEYXRlLCBlbmREYXRlKSkge1xuICAgICAgICBjb25zdCBkYXRlSW5mbyA9IHRoaXMuZ2VuZXJhdGVEYXRlSW5mbyhoYW5kbGVEYXRlLCBpbmRleCk7XG4gICAgICAgIHNjYWxlRGF0YS5wdXNoKGRhdGVJbmZvKTtcbiAgICAgICAgaGFuZGxlRGF0ZSA9IHRoaXMuZ2V0TmV4dERheShuZXcgRGF0ZShoYW5kbGVEYXRlKSk7XG4gICAgICAgIGluZGV4Kys7XG4gICAgICB9XG4gICAgICByZXR1cm4gc2NhbGVEYXRhO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0TmV4dERheShkYXRlOiBEYXRlKSB7XG4gICAgY29uc3QgbmV4dERheURhdGUgPSBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyAxKTtcbiAgICByZXR1cm4gbmV3IERhdGUobmV4dERheURhdGUpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZURhdGVJbmZvKGRhdGU6IERhdGUsIGluZGV4KTogR2FudHRTY2FsZURhdGVJbmZvIHtcbiAgICBjb25zdCBkYXRlSW5mbzogR2FudHRTY2FsZURhdGVJbmZvID0ge1xuICAgICAgZGF5T2ZNb250aExhYmVsOiAnJyxcbiAgICAgIGRheU9mV2Vla0xhYmVsOiAnJyxcbiAgICAgIG1vbnRoTGFiZWw6ICcnLFxuICAgICAgeWVhckxhYmVsOiAnJyxcbiAgICAgIGRhdGU6IGRhdGUsXG4gICAgICBtb250aFN0YXJ0OiBmYWxzZSxcbiAgICAgIHdlZWtlbmQ6IGZhbHNlLFxuICAgICAgdG9kYXk6IGZhbHNlLFxuICAgICAgbWlsZXN0b25lOiAnJyxcbiAgICAgIGhpZ2hsaWdodFN0YXJ0OiBmYWxzZSxcbiAgICAgIHNjYWxlU3RhcnRWaXNhYmxlOiB0cnVlLFxuICAgICAgaW5kZXhcbiAgICB9O1xuXG4gICAgY29uc3QgZGF5T2ZNb250aCA9IGRhdGUuZ2V0RGF0ZSgpO1xuICAgIGRhdGVJbmZvLmRheU9mTW9udGhMYWJlbCA9IFN0cmluZyhkYXlPZk1vbnRoKTtcbiAgICBpZiAoZGF5T2ZNb250aCA9PT0gMSkge1xuICAgICAgZGF0ZUluZm8ubW9udGhTdGFydCA9IHRydWU7XG4gICAgfVxuXG4gICAgY29uc3QgZGF5T2ZXZWVrID0gZGF0ZS5nZXREYXkoKTtcbiAgICBkYXRlSW5mby5kYXlPZldlZWtMYWJlbCA9IFN0cmluZyhkYXlPZldlZWspO1xuICAgIGlmIChkYXlPZldlZWsgPT09IDYpIHtcbiAgICAgIGRhdGVJbmZvLndlZWtlbmQgPSB0cnVlO1xuICAgIH1cbiAgICBjb25zdCBtb250aCA9IGRhdGUuZ2V0TW9udGgoKSArIDE7XG4gICAgZGF0ZUluZm8ubW9udGhMYWJlbCA9IFN0cmluZyhtb250aCk7XG4gICAgY29uc3QgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICBkYXRlSW5mby55ZWFyTGFiZWwgPSBTdHJpbmcoeWVhcik7XG4gICAgaWYgKHRoaXMuZ2FudHRTZXJ2aWNlLmlzU29tZURhdGUoZGF0ZSwgbmV3IERhdGUoKSkpIHtcbiAgICAgIGRhdGVJbmZvLnRvZGF5ID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAobmV3IERhdGUoeWVhciwgbW9udGggLSAxLCBkYXlPZk1vbnRoICsgdGhpcy5TQ0FMRV9TVEFSVF9MQUJMRV9PRkZTRVQpLmdldE1vbnRoKCkgPiBtb250aCAtIDEpIHtcbiAgICAgIGRhdGVJbmZvLnNjYWxlU3RhcnRWaXNhYmxlID0gZmFsc2U7XG4gICAgfVxuICAgIGlmICh0aGlzLm1pbGVzdG9uZUxpc3QpIHtcbiAgICAgIHRoaXMubWlsZXN0b25lTGlzdC5mb3JFYWNoKChtaWxlc3RvbmUpID0+IHtcbiAgICAgICAgaWYgKG1pbGVzdG9uZS5kYXRlKSB7XG4gICAgICAgICAgaWYgKHRoaXMuZ2FudHRTZXJ2aWNlLmlzU29tZURhdGUobWlsZXN0b25lLmRhdGUsIGRhdGVJbmZvLmRhdGUpKSB7XG4gICAgICAgICAgICBkYXRlSW5mby5taWxlc3RvbmUgPSBtaWxlc3RvbmUubGFibGU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gZGF0ZUluZm87XG4gIH1cblxuICB0cmFja0J5Rm4oaW5kZXgsIGl0ZW0pIHtcbiAgICByZXR1cm4gaW5kZXg7XG4gIH1cblxuICBwcml2YXRlIGdhbnR0QmFyU3RhdHVzQ2hhbmdlKHN0YXR1czogR2FudHRCYXJTdGF0dXMpIHtcbiAgICB0aGlzLmhpZ2hsaWdodCA9IHN0YXR1cy5mb2N1c2VkO1xuICAgIGlmICh0aGlzLmhpZ2hsaWdodCkge1xuICAgICAgdGhpcy5zY2FsZURhdGEuZm9yRWFjaCgoZGF0ZUluZm8sIGluZGV4KSA9PiB7XG4gICAgICAgIGlmIChkYXRlSW5mby5kYXRlID49IHN0YXR1cy5zdGFydERhdGUgJiYgZGF0ZUluZm8uZGF0ZSA8PSBzdGF0dXMuZW5kRGF0ZSkge1xuICAgICAgICAgIGRhdGVJbmZvLmhpZ2hsaWdodCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGF0ZUluZm8uaGlnaGxpZ2h0ID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZGF0ZUluZm8uaGlnaGxpZ2h0U3RhcnQgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgICAgY29uc3QgaGlnaGxpZ2h0QmFyU3RhcnRJbmRleCA9ICB0aGlzLnNjYWxlRGF0YS5maW5kSW5kZXgoKGRhdGEpID0+IHtcbiAgICAgICAgcmV0dXJuIGRhdGEuaGlnaGxpZ2h0O1xuICAgICAgfSk7XG4gICAgICBpZiAoaGlnaGxpZ2h0QmFyU3RhcnRJbmRleCA+IC0xKSB7XG4gICAgICAgIHRoaXMuc2NhbGVEYXRhW2hpZ2hsaWdodEJhclN0YXJ0SW5kZXhdLmhpZ2hsaWdodFN0YXJ0ID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgaGlnaGxpZ2h0RGF0YSA9IHRoaXMuc2NhbGVEYXRhLmZpbHRlcigoZGF0YSkgPT4ge1xuICAgICAgICByZXR1cm4gZGF0YS5oaWdobGlnaHQ7XG4gICAgICB9KTtcblxuICAgICAgaWYgKGhpZ2hsaWdodERhdGEubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKGhpZ2hsaWdodERhdGEubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0RGF0YSA9IGhpZ2hsaWdodERhdGFbMF07XG4gICAgICAgIHRoaXMuaGlnaGxpZ2h0U3RhcnRUZXh0ID1cbiAgICAgICAgICB0aGlzLnByZWZpeFplcm8ocGFyc2VJbnQoc3RhcnREYXRhLm1vbnRoTGFiZWwsIDEwKSkgKyAnLScgKyB0aGlzLnByZWZpeFplcm8ocGFyc2VJbnQoc3RhcnREYXRhLmRheU9mTW9udGhMYWJlbCwgMTApKTtcbiAgICAgICAgY29uc3QgaGlnaGxpZ2h0V2lkdGggPSB0aGlzLmdhbnR0U2VydmljZS5nZXRTY2FsZVVuaXRQaXhlbCgpO1xuICAgICAgICBpZiAoaGlnaGxpZ2h0V2lkdGggPCA0MCkge1xuICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0TWluV2lkdGggPSA0MDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmhpZ2hsaWdodE1pbldpZHRoID0gaGlnaGxpZ2h0V2lkdGg7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0RGF0YSA9IGhpZ2hsaWdodERhdGFbMF07XG4gICAgICAgIGNvbnN0IGVuZERhdGEgPSBoaWdobGlnaHREYXRhW2hpZ2hsaWdodERhdGEubGVuZ3RoIC0gMV07XG4gICAgICAgIHRoaXMuaGlnaGxpZ2h0U3RhcnRUZXh0ID1cbiAgICAgICAgICB0aGlzLnByZWZpeFplcm8ocGFyc2VJbnQoc3RhcnREYXRhLm1vbnRoTGFiZWwsIDEwKSkgKyAnLScgKyB0aGlzLnByZWZpeFplcm8ocGFyc2VJbnQoc3RhcnREYXRhLmRheU9mTW9udGhMYWJlbCwgMTApKTtcbiAgICAgICAgdGhpcy5oaWdobGlnaHRFbmRUZXh0ID1cbiAgICAgICAgICB0aGlzLnByZWZpeFplcm8ocGFyc2VJbnQoZW5kRGF0YS5tb250aExhYmVsLCAxMCkpICsgJy0nICsgdGhpcy5wcmVmaXhaZXJvKHBhcnNlSW50KGVuZERhdGEuZGF5T2ZNb250aExhYmVsLCAxMCkpO1xuICAgICAgICBjb25zdCBoaWdobGlnaHRXaWR0aCA9IGhpZ2hsaWdodERhdGEubGVuZ3RoICogdGhpcy5nYW50dFNlcnZpY2UuZ2V0U2NhbGVVbml0UGl4ZWwoKTtcbiAgICAgICAgaWYgKGhpZ2hsaWdodFdpZHRoIDwgODApIHtcbiAgICAgICAgICB0aGlzLmhpZ2hsaWdodE1pbldpZHRoID0gODA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5oaWdobGlnaHRNaW5XaWR0aCA9IGhpZ2hsaWdodFdpZHRoO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJlZml4WmVybyhudW06IG51bWJlcikge1xuICAgIHJldHVybiAoQXJyYXkoMikuam9pbignMCcpICsgbnVtKS5zbGljZSgtMik7XG4gIH1cblxuICBhZGRNaWxlc3RvbmUoaW5mbzogR2FudHRTY2FsZURhdGVJbmZvKSB7XG4gICAgdGhpcy5hZGRNaWxlc3RvbmVFdmVudC5lbWl0KGluZm8pO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuZ2FudHRCYXJTdGF0dXNIYW5kbGVyKSB7XG4gICAgICB0aGlzLmdhbnR0QmFyU3RhdHVzSGFuZGxlci51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy5nYW50dEJhclN0YXR1c0hhbmRsZXIgPSBudWxsO1xuICAgIH1cbiAgICBpZiAodGhpcy5nYW50dFNhY2xlQ29uZmlnSGFuZGxlcikge1xuICAgICAgdGhpcy5nYW50dFNhY2xlQ29uZmlnSGFuZGxlci51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy5nYW50dFNhY2xlQ29uZmlnSGFuZGxlciA9IG51bGw7XG4gICAgfVxuICAgIGlmICh0aGlzLnNjcm9sbEhhbmRsZXIpIHtcbiAgICAgIHRoaXMuc2Nyb2xsSGFuZGxlci51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxufVxuIiwiPGRpdlxuICBjbGFzcz1cImRldnVpLWdhbnR0LXNjYWxlIHt7IHVuaXQgfX1cIlxuICAqbmdGb3I9XCJsZXQgZGF0YSBvZiB2aWV3U0NhbGVEYXRhOyB0cmFja0J5OiB0cmFja0J5Rm47IGxldCBmaXJzdCA9IGZpcnN0OyBsZXQgbGFzdCA9IGxhc3RcIlxuICBbbmdDbGFzc109XCJ7IHRvZGF5OiBkYXRhLnRvZGF5LCBtaWxlc3RvbmU6IGRhdGEubWlsZXN0b25lIH1cIlxuICBbc3R5bGUubGVmdF09XCJzY2FsZVdpZHRoW3VuaXRdICogZGF0YS5pbmRleCArICdweCdcIlxuICBbc3R5bGUud2lkdGhdPVwic2NhbGVXaWR0aFt1bml0XSArICdweCdcIlxuICBkR2FudHRNYXJrZXJcbiAgW21vbnRoTWFya109XCJkYXRhLm1vbnRoU3RhcnRcIlxuICBbd2Vla2VuZF09XCJkYXRhLndlZWtlbmRcIlxuICBbbWlsZXN0b25lXT1cImRhdGEubWlsZXN0b25lXCJcbiAgW3RvZGF5XT1cImRhdGEudG9kYXlcIlxuICBbZGF0ZV09XCJkYXRhLmRhdGVcIlxuICBbdW5pdF09XCJ1bml0XCJcbiAgW2xhc3RdPVwibGFzdFwiXG4gIFtnYW50dFNjYWxlQ29udGFpbmVyT2Zmc2V0TGVmdF09XCJnYW50dFNjYWxlQ29udGFpbmVyT2Zmc2V0TGVmdFwiXG4gIFtnYW50dEJhckNvbnRhaW5lckVsZW1lbnRdPVwiZ2FudHRCYXJDb250YWluZXJFbGVtZW50XCJcbj5cbiAgPGRpdiBjbGFzcz1cImRldnVpLXNjYWxlLXN0YXJ0XCIgW25nQ2xhc3NdPVwieyBtaWxlc3RvbmU6IGRhdGEubWlsZXN0b25lIH1cIj5cbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiZGF0YS5taWxlc3RvbmUgJiYgdW5pdCA9PT0gJ2RheSdcIj5cbiAgICAgIHt7IGRhdGEubWlsZXN0b25lIH19XG4gICAgPC9uZy1jb250YWluZXI+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIiFkYXRhLm1pbGVzdG9uZSB8fCB1bml0ICE9PSAnZGF5J1wiPlxuICAgICAge3tcbiAgICAgICAgZGF0YS5zY2FsZVN0YXJ0VmlzYWJsZSAmJiAoZmlyc3QgfHwgZGF0YS5tb250aFN0YXJ0KVxuICAgICAgICAgID8gdW5pdCA9PT0gJ21vbnRoJ1xuICAgICAgICAgICAgPyBpMThuVGV4dD8ueWVhckRpc3BsYXkoZGF0YS55ZWFyTGFiZWwpXG4gICAgICAgICAgICA6IGkxOG5UZXh0Py55ZWFyQW5kTW9udGhEaXNwbGF5KGRhdGEueWVhckxhYmVsLCBkYXRhLm1vbnRoTGFiZWwpXG4gICAgICAgICAgOiAnJ1xuICAgICAgfX1cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgPC9kaXY+XG4gIDxkaXYgY2xhc3M9XCJkZXZ1aS1zY2FsZS11bml0XCI+XG4gICAgPGRpdiAqbmdJZj1cImhpZ2hsaWdodCAmJiBkYXRhLmhpZ2hsaWdodFN0YXJ0XCIgY2xhc3M9XCJzY2FsZS1oaWdobGlnaHRcIiBbc3R5bGUubWluV2lkdGhdPVwiaGlnaGxpZ2h0TWluV2lkdGggKyAncHgnXCI+XG4gICAgICA8ZGl2IHN0eWxlPVwiZmxvYXQ6IGxlZnRcIj57eyBoaWdobGlnaHRTdGFydFRleHQgfX08L2Rpdj5cbiAgICAgIDxkaXYgc3R5bGU9XCJmbG9hdDogcmlnaHRcIj57eyBoaWdobGlnaHRFbmRUZXh0IH19PC9kaXY+XG4gICAgICA8ZGl2IHN0eWxlPVwiY2xlYXI6IGJvdGhcIj48L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiIWhpZ2hsaWdodCB8fCAhZGF0YS5oaWdobGlnaHRcIj5cbiAgICAgIDxkaXYgKm5nSWY9XCJ1bml0ID09PSAnZGF5J1wiIGNsYXNzPVwiYm9yZGVyLWxlZnRcIiBbbmdDbGFzc109XCJ7IHRvZGF5OiBkYXRhLnRvZGF5IH1cIj5cbiAgICAgICAge3sgZGF0YS50b2RheSA/IGkxOG5UZXh0Py50b2RheSA6IGRhdGEuZGF5T2ZNb250aExhYmVsIH19XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgKm5nSWY9XCJ1bml0ID09PSAnd2VlaydcIiBbbmdDbGFzc109XCJ7ICdib3JkZXItbGVmdCc6IGZpcnN0IHx8IGRhdGEud2Vla2VuZCB9XCI+XG4gICAgICAgIHt7IGZpcnN0IHx8IGRhdGEud2Vla2VuZCA/IGRhdGEuZGF5T2ZNb250aExhYmVsIDogJycgfX1cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiAqbmdJZj1cInVuaXQgPT09ICdtb250aCdcIiBbbmdDbGFzc109XCJ7ICdib3JkZXItbGVmdCc6IGZpcnN0IHx8IGRhdGEubW9udGhTdGFydCB9XCI+XG4gICAgICAgIHt7IGZpcnN0IHx8IGRhdGEubW9udGhTdGFydCA/IGkxOG5UZXh0Py5tb250aERpc3BsYXkoZGF0YS5tb250aExhYmVsKSA6ICcnIH19XG4gICAgICA8L2Rpdj5cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgPC9kaXY+XG4gIDxkaXYgY2xhc3M9XCJtaWxlc3RvbmUtbmV3IHt7IHVuaXQgfX1cIiBbdGl0bGVdPVwiaTE4blRleHQ/Lm1pbGVzdG9uZVwiIChjbGljayk9XCJhZGRNaWxlc3RvbmUoZGF0YSlcIj5cbiAgICA8ZGl2IGNsYXNzPVwiaWNvbi1hZGRcIj48L2Rpdj5cbiAgPC9kaXY+XG48L2Rpdj5cbiJdfQ==