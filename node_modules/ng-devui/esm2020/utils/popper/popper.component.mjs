import { DOCUMENT } from '@angular/common';
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, Inject, Input, NgZone, Output, Renderer2, ViewChild } from '@angular/core';
import { createPopper } from '@popperjs/core';
import { Subject } from 'rxjs';
import { AnimationCurves, AnimationDuration } from '../animations';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
export class PopperComponent {
    constructor(el, renderer, ngZone, changeDetectorRef, doc) {
        this.el = el;
        this.renderer = renderer;
        this.ngZone = ngZone;
        this.changeDetectorRef = changeDetectorRef;
        this.doc = doc;
        this.fluidPopper = true;
        this.poppoverAppendDirection = 'bottom';
        this.appendTo = 'body';
        this.showAnimation = true;
        this.popper = null;
        this._isOpen = false;
        this.directionAnimationTransformOrigin = {
            'top': '0 100%',
            'bottom': '0 0'
        };
        this.directionSubject = new Subject();
        this.openChange = new EventEmitter();
        this.onDocumentClick = ($event) => {
            if (!!this.appendTo && this.popperContainer.nativeElement !== $event.target &&
                !this.popperContainer.nativeElement.contains($event.target)) {
                this.open = false;
            }
            else if (!this.appendTo && this.open && !this.el.nativeElement.contains($event.target)) {
                this.open = false;
            }
        };
        this.blockEvent = ($event) => {
            $event.preventDefault();
            $event.stopPropagation();
        };
        this.applyTransitionStyle = (data) => {
            const optionsContainer = this.popperContainer.nativeElement;
            this.updateContainerTransitionDirection(data?.state?.modifiersData?.flip?._skip);
            if (this.animate) {
                // perspective(1px) solves pixel shift caused by webkit transform
                this.renderer.setStyle(optionsContainer, 'transform', optionsContainer.style.transform +
                    ` scale3d(1, 0.8, 1) perspective(1px) ${this.popperDirection === 'bottom' ? 'translateY(-4px)' : 'translateY(4px)'}`);
                // Set container init state to transparent as beginning of the transition.
                this.renderer.setStyle(optionsContainer, 'opacity', 0);
                PopperComponent.nextTick(() => {
                    this.setTransition('open');
                    const that = this;
                    const handler = function (e) {
                        // remove transition
                        that.setTransition();
                        e.currentTarget.removeEventListener(e.type, handler);
                    };
                    optionsContainer.addEventListener('transitionend', handler);
                    this.renderer.setStyle(optionsContainer, 'transform', optionsContainer.style.transform.replace('scale3d(1, 0.8, 1)', 'scale3d(1, 1, 1)'));
                    this.popperDirection === 'bottom' ?
                        this.renderer.setStyle(optionsContainer, 'transform', optionsContainer.style.transform.replace('translateY(-4px)', 'translateY(0)')) :
                        this.renderer.setStyle(optionsContainer, 'transform', optionsContainer.style.transform.replace('translateY(4px)', 'translateY(0)'));
                    this.renderer.setStyle(optionsContainer, 'opacity', 1);
                    this.animate = false;
                });
            }
            else {
                // handle popper re-rendering, incoming transform doesn't have scale info
                this.renderer.setStyle(optionsContainer, 'transform', optionsContainer.style.transform + (this.open ? ' scale3d(1, 1, 1)' : ' scale3d(1, 0.8, 1)') + ' perspective(1px)');
            }
        };
        this.document = this.doc;
    }
    get open() {
        return this._isOpen;
    }
    set open(value) {
        if (this._isOpen === value) {
            return;
        }
        this.animate = true;
        if (value) {
            this.show();
        }
        else {
            this.close();
        }
        this._isOpen = value;
        PopperComponent.nextTick(() => {
            this.openChange.emit(value);
            this.setBlurListener();
        });
    }
    static nextTick(fn) {
        // Force to run fn after current data changed.
        setTimeout(() => fn.bind(this)());
    }
    show() {
        // Append to selector or original parent.
        if (this.appendTo) {
            if (this.fluidPopper) {
                let popperWidth = this.popperActivator.nativeElement && this.popperActivator.nativeElement.offsetWidth;
                if (this.extraConfig && this.extraConfig.extraWidth) {
                    popperWidth = popperWidth + this.extraConfig.extraWidth;
                }
                const firstEle = this.popperContainer.nativeElement.firstElementChild;
                if (firstEle.classList.contains('devui-search-container')) {
                    for (const child of this.popperContainer.nativeElement.children) {
                        child.style.width = `${popperWidth}px`;
                    }
                }
                else {
                    firstEle.style.width = `${popperWidth}px`;
                }
            }
            this.attachPopperContainerToSelector(this.appendTo);
        }
        else {
            this.attachPopperContainerToNode(this.popperParent);
        }
        this.popper = this.createCustomPopper();
        this.renderer.setStyle(this.popperContainer.nativeElement, 'display', 'block');
    }
    close() {
        const popperContainer = this.popperContainer.nativeElement;
        this.setTransition('close');
        // For IE 11/Edge
        if (popperContainer.style.transform.match(/scale3d\(1, 1, 1\)/)) {
            // Replace transform open state with close state
            this.renderer.setStyle(popperContainer, 'transform', popperContainer.style.transform.replace('scale3d(1, 1, 1)', 'scale3d(1, 0.8, 1)'));
        }
        else {
            // perspective(1px) solves pixel shift caused by webkit transform
            this.renderer.setStyle(popperContainer, 'transform', popperContainer.style.transform + ` scale3d(1, 0.8, 1) perspective(1px)`);
        }
        // Set container to transparent
        this.renderer.setStyle(popperContainer, 'opacity', 0.8);
        // Can't use bind(this) since it calls itself
        const that = this;
        const handler = function (e) {
            if (!that.open && that.popper) {
                // Set final state of container to invisible
                that.renderer.setStyle(popperContainer, 'display', 'none');
                that.animate = false;
                // Remove transition
                that.setTransition();
                that.popper.destroy();
                that.popper = null;
                that.detachPopperContainer();
            }
            e.currentTarget.removeEventListener(e.type, handler);
        };
        if (this.showAnimation) {
            this.popperContainer.nativeElement.addEventListener('transitionend', handler);
        }
        else {
            that.renderer.setStyle(popperContainer, 'display', 'none');
            that.animate = false;
            that.popper.destroy();
            that.popper = null;
            that.detachPopperContainer();
        }
    }
    setBlurListener() {
        this.ngZone.runOutsideAngular(() => {
            if (this.open) {
                this.document.addEventListener('click', this.onDocumentClick);
                this.popperContainer.nativeElement.addEventListener('click', this.blockEvent);
            }
            else {
                this.document.removeEventListener('click', this.onDocumentClick);
                this.popperContainer.nativeElement.removeEventListener('click', this.blockEvent);
            }
        });
    }
    updateContainerTransitionDirection(flipped) {
        const direction = flipped ? 'top' : 'bottom';
        if (this.popperDirection !== direction) {
            this.popperDirection = direction;
            this.setTransitionOrigin();
        }
        this.directionSubject.next(this.popperDirection);
    }
    setTransitionOrigin() {
        if (this.popperContainer.nativeElement) {
            this.renderer.setStyle(this.popperContainer.nativeElement, 'transform-origin', this.directionAnimationTransformOrigin[this.popperDirection]);
        }
    }
    createCustomPopper() {
        return createPopper(this.popperActivator.nativeElement, this.popperContainer.nativeElement, {
            placement: 'bottom-start',
            modifiers: [
                {
                    name: 'preventOverflow',
                    options: {
                        mainAxis: true, // true by default
                    },
                },
                {
                    name: 'applyReactStyle',
                    phase: 'afterWrite',
                    enabled: true,
                    fn: this.applyTransitionStyle
                },
                {
                    name: 'offset',
                    options: {
                        offset: this.extraConfig && this.extraConfig.offset
                            ? [parseInt(this.extraConfig.offset.split(',')[0], 10), parseInt(this.extraConfig.offset.split(',')[1], 10)]
                            : [0, 5], // true by default
                    },
                },
                {
                    name: 'flip',
                    options: {
                        flipVariations: true, // true by default
                    },
                },
            ],
            strategy: this.appendTo ? 'fixed' : 'absolute',
        });
    }
    setTransition(command = null) {
        const popperContainer = this.popperContainer.nativeElement;
        if (this.animate && command) {
            if (command === 'open') {
                this.renderer.setStyle(popperContainer, 'transition', this.showAnimation
                    ? `all ${AnimationDuration.BASE} ${AnimationCurves.EASE_OUT}` : 'none');
            }
            else if (command === 'close') {
                popperContainer.style.transition = this.showAnimation ? `all ${AnimationDuration.BASE} ${AnimationCurves.EASE_IN}` : 'none';
            }
        }
        else {
            this.renderer.setStyle(popperContainer, 'transition', null);
        }
    }
    update() {
        PopperComponent.nextTick(() => {
            if (this.popper) {
                this.popper.forceUpdate();
            }
        });
    }
    ngOnDestroy() {
        // Close popper
        this.open = false;
    }
    detachPopperContainer() {
        // Cache popper's parent and popper node.
        this.popperParent = this.popperContainer.nativeElement.parentNode;
        this.popperNode = this.popperContainer.nativeElement;
        if (this.popperParent && this.popperNode) {
            this.popperParent.removeChild(this.popperNode);
        }
    }
    attachPopperContainerToNode(nodeParent) {
        if (nodeParent && this.popperNode) {
            this.popperParent = nodeParent;
            this.popperParent.appendChild(this.popperNode);
        }
    }
    attachPopperContainerToSelector(targetSelector) {
        const nodeParent = this.document.querySelector(targetSelector);
        this.attachPopperContainerToNode(nodeParent);
    }
    ngAfterViewInit() {
        // Detach popper container once view initialized.
        this.detachPopperContainer();
    }
    directionChange() {
        return this.directionSubject.asObservable();
    }
}
PopperComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: PopperComponent, deps: [{ token: i0.ElementRef }, { token: i0.Renderer2 }, { token: i0.NgZone }, { token: i0.ChangeDetectorRef }, { token: DOCUMENT }], target: i0.ɵɵFactoryTarget.Component });
PopperComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.3", type: PopperComponent, selector: "d-popper-component", inputs: { open: "open", fluidPopper: "fluidPopper", poppoverAppendDirection: "poppoverAppendDirection", appendTo: "appendTo", extraConfig: "extraConfig", showAnimation: "showAnimation" }, outputs: { openChange: "openChange" }, viewQueries: [{ propertyName: "popperActivator", first: true, predicate: ["popperActivator"], descendants: true, static: true }, { propertyName: "popperContainer", first: true, predicate: ["popperContainer"], descendants: true, static: true }], ngImport: i0, template: "<div class=\"popper\">\n  <div class=\"popper-activator\" #popperActivator>\n    <ng-content select=\"[popper-activator]\"></ng-content>\n  </div>\n\n  <div\n    class=\"popper-container\"\n    #popperContainer\n    [ngClass]=\"{\n      fluid: fluidPopper && !appendTo,\n      'devui-popover-container-right': poppoverAppendDirection === 'right',\n      'devui-popover-container-left': poppoverAppendDirection === 'left'\n    }\"\n  >\n    <div class=\"devui-dropdown-menu-wrap\">\n      <ng-content select=\"[popper-prepend]\"></ng-content>\n      <div class=\"popper-container-scrollable devui-scrollbar\">\n        <ng-content select=\"[popper-container]\"></ng-content>\n      </div>\n    </div>\n    <div class=\"popper-append-area\">\n      <ng-content select=\"[popper-append]\"></ng-content>\n    </div>\n  </div>\n</div>\n", styles: [".popper{position:relative;width:100%}.popper .popper-activator{width:100%}.popper-container{display:none;z-index:1052;z-index:var(--devui-z-index-dropdown, 1052);position:absolute;box-shadow:0 4px 16px rgba(37,43,58,.2);box-shadow:var(--devui-shadow-length-feedback-overlay, 0 4px 16px 0) var(--devui-shadow, rgba(37, 43, 58, .2));background:#ffffff;background:var(--devui-connected-overlay-bg, #ffffff);border:none;backface-visibility:hidden;-webkit-backface-visibility:hidden;border-radius:2px;border-radius:var(--devui-border-radius, 2px)}.popper-container.devui-popover-container-right,.popper-container.devui-popover-container-left{display:flex!important}.popper-container.devui-popover-container-right>.devui-dropdown-menu-wrap,.popper-container.devui-popover-container-left>.devui-dropdown-menu-wrap{display:inline-block}.popper-container.devui-popover-container-right>.popper-append-area,.popper-container.devui-popover-container-left>.popper-append-area{display:inline-block;overflow:auto}.popper-container.devui-popover-container-right .popper-append-area,.popper-container.devui-popover-container-left .popper-append-area{border-left:1px solid #f2f2f3;border-left:1px solid var(--devui-dividing-line, #f2f2f3)}.popper-container.devui-popover-container-right .popper-append-area:before,.popper-container.devui-popover-container-left .popper-append-area:before{display:none}.popper-container.devui-popover-container-left .popper-append-area{order:-1}.popper-container .popper-container-scrollable{min-height:40px;width:100%;overflow:auto;overflow:overlay}.popper-container.fluid{width:100%}:host{display:block}\n"], directives: [{ type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: PopperComponent, decorators: [{
            type: Component,
            args: [{ selector: 'd-popper-component', template: "<div class=\"popper\">\n  <div class=\"popper-activator\" #popperActivator>\n    <ng-content select=\"[popper-activator]\"></ng-content>\n  </div>\n\n  <div\n    class=\"popper-container\"\n    #popperContainer\n    [ngClass]=\"{\n      fluid: fluidPopper && !appendTo,\n      'devui-popover-container-right': poppoverAppendDirection === 'right',\n      'devui-popover-container-left': poppoverAppendDirection === 'left'\n    }\"\n  >\n    <div class=\"devui-dropdown-menu-wrap\">\n      <ng-content select=\"[popper-prepend]\"></ng-content>\n      <div class=\"popper-container-scrollable devui-scrollbar\">\n        <ng-content select=\"[popper-container]\"></ng-content>\n      </div>\n    </div>\n    <div class=\"popper-append-area\">\n      <ng-content select=\"[popper-append]\"></ng-content>\n    </div>\n  </div>\n</div>\n", styles: [".popper{position:relative;width:100%}.popper .popper-activator{width:100%}.popper-container{display:none;z-index:1052;z-index:var(--devui-z-index-dropdown, 1052);position:absolute;box-shadow:0 4px 16px rgba(37,43,58,.2);box-shadow:var(--devui-shadow-length-feedback-overlay, 0 4px 16px 0) var(--devui-shadow, rgba(37, 43, 58, .2));background:#ffffff;background:var(--devui-connected-overlay-bg, #ffffff);border:none;backface-visibility:hidden;-webkit-backface-visibility:hidden;border-radius:2px;border-radius:var(--devui-border-radius, 2px)}.popper-container.devui-popover-container-right,.popper-container.devui-popover-container-left{display:flex!important}.popper-container.devui-popover-container-right>.devui-dropdown-menu-wrap,.popper-container.devui-popover-container-left>.devui-dropdown-menu-wrap{display:inline-block}.popper-container.devui-popover-container-right>.popper-append-area,.popper-container.devui-popover-container-left>.popper-append-area{display:inline-block;overflow:auto}.popper-container.devui-popover-container-right .popper-append-area,.popper-container.devui-popover-container-left .popper-append-area{border-left:1px solid #f2f2f3;border-left:1px solid var(--devui-dividing-line, #f2f2f3)}.popper-container.devui-popover-container-right .popper-append-area:before,.popper-container.devui-popover-container-left .popper-append-area:before{display:none}.popper-container.devui-popover-container-left .popper-append-area{order:-1}.popper-container .popper-container-scrollable{min-height:40px;width:100%;overflow:auto;overflow:overlay}.popper-container.fluid{width:100%}:host{display:block}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.Renderer2 }, { type: i0.NgZone }, { type: i0.ChangeDetectorRef }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }]; }, propDecorators: { open: [{
                type: Input
            }], fluidPopper: [{
                type: Input
            }], poppoverAppendDirection: [{
                type: Input
            }], appendTo: [{
                type: Input
            }], extraConfig: [{
                type: Input
            }], showAnimation: [{
                type: Input
            }], openChange: [{
                type: Output
            }], popperActivator: [{
                type: ViewChild,
                args: ['popperActivator', { static: true }]
            }], popperContainer: [{
                type: ViewChild,
                args: ['popperContainer', { static: true }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wcGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2RldnVpL3V0aWxzL3BvcHBlci9wb3BwZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vZGV2dWkvdXRpbHMvcG9wcGVyL3BvcHBlci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUVMLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixNQUFNLEVBQ04sS0FBSyxFQUNMLE1BQU0sRUFFTixNQUFNLEVBQ04sU0FBUyxFQUNULFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUMsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUUsZUFBZSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDOzs7QUFZbkUsTUFBTSxPQUFPLGVBQWU7SUE0RDFCLFlBQXNCLEVBQWMsRUFBWSxRQUFtQixFQUFZLE1BQWMsRUFDdkUsaUJBQW9DLEVBQTRCLEdBQVE7UUFEeEUsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUFZLGFBQVEsR0FBUixRQUFRLENBQVc7UUFBWSxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ3ZFLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFBNEIsUUFBRyxHQUFILEdBQUcsQ0FBSztRQXhDckYsZ0JBQVcsR0FBRyxJQUFJLENBQUM7UUFDbkIsNEJBQXVCLEdBQUcsUUFBUSxDQUFDO1FBQ25DLGFBQVEsR0FBRyxNQUFNLENBQUM7UUFFbEIsa0JBQWEsR0FBRyxJQUFJLENBQUM7UUFDcEIsV0FBTSxHQUFHLElBQUksQ0FBQztRQUNkLFlBQU8sR0FBUSxLQUFLLENBQUM7UUFHckIs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O2dCQUNFLGVBQWU7c0JBQTlELFNBQVM7dUJBQUMsaUJBQWlCLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBJbmplY3QsXG4gIElucHV0LFxuICBOZ1pvbmUsXG4gIE9uRGVzdHJveSxcbiAgT3V0cHV0LFxuICBSZW5kZXJlcjIsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGNyZWF0ZVBvcHBlciB9IGZyb20gJ0Bwb3BwZXJqcy9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEFuaW1hdGlvbkN1cnZlcywgQW5pbWF0aW9uRHVyYXRpb24gfSBmcm9tICcuLi9hbmltYXRpb25zJztcblxuaW50ZXJmYWNlIEV4dHJhU2V0Q29uZmlnIHtcbiAgZXh0cmFXaWR0aD86IG51bWJlcjtcbiAgb2Zmc2V0Pzogc3RyaW5nO1xufVxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdkLXBvcHBlci1jb21wb25lbnQnLFxuICB0ZW1wbGF0ZVVybDogJy4vcG9wcGVyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbYC4vcG9wcGVyLmNvbXBvbmVudC5zY3NzYF0sXG59KVxuZXhwb3J0IGNsYXNzIFBvcHBlckNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG5cbiAgZ2V0IG9wZW4oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2lzT3BlbjtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBvcGVuKHZhbHVlKSB7XG4gICAgaWYgKHRoaXMuX2lzT3BlbiA9PT0gdmFsdWUpIHsgcmV0dXJuOyB9XG4gICAgdGhpcy5hbmltYXRlID0gdHJ1ZTtcbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIHRoaXMuc2hvdygpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICAgIHRoaXMuX2lzT3BlbiA9IHZhbHVlO1xuXG4gICAgUG9wcGVyQ29tcG9uZW50Lm5leHRUaWNrKCgpID0+IHtcbiAgICAgIHRoaXMub3BlbkNoYW5nZS5lbWl0KHZhbHVlKTtcbiAgICAgIHRoaXMuc2V0Qmx1ckxpc3RlbmVyKCk7XG4gICAgfSk7XG4gIH1cbiAgQElucHV0KCkgZmx1aWRQb3BwZXIgPSB0cnVlO1xuICBASW5wdXQoKSBwb3Bwb3ZlckFwcGVuZERpcmVjdGlvbiA9ICdib3R0b20nO1xuICBASW5wdXQoKSBhcHBlbmRUbyA9ICdib2R5JztcbiAgQElucHV0KCkgZXh0cmFDb25maWc6IEV4dHJhU2V0Q29uZmlnO1xuICBASW5wdXQoKSBzaG93QW5pbWF0aW9uID0gdHJ1ZTtcbiAgcHJvdGVjdGVkIHBvcHBlciA9IG51bGw7XG4gIHByb3RlY3RlZCBfaXNPcGVuOiBhbnkgPSBmYWxzZTtcbiAgcHJvdGVjdGVkIGFuaW1hdGU6IGJvb2xlYW47XG4gIHByb3RlY3RlZCBwb3BwZXJEaXJlY3Rpb246IHN0cmluZztcbiAgcHJvdGVjdGVkIGRpcmVjdGlvbkFuaW1hdGlvblRyYW5zZm9ybU9yaWdpbiA9IHtcbiAgICAndG9wJzogJzAgMTAwJScsXG4gICAgJ2JvdHRvbSc6ICcwIDAnXG4gIH07XG4gIHByb3RlY3RlZCBwb3BwZXJOb2RlO1xuICBwcm90ZWN0ZWQgcG9wcGVyUGFyZW50O1xuICBwcml2YXRlIGRpcmVjdGlvblN1YmplY3QgPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XG4gIGRvY3VtZW50OiBEb2N1bWVudDtcblxuICBAT3V0cHV0KCkgb3BlbkNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAVmlld0NoaWxkKCdwb3BwZXJBY3RpdmF0b3InLCB7IHN0YXRpYzogdHJ1ZSB9KSBwb3BwZXJBY3RpdmF0b3I6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ3BvcHBlckNvbnRhaW5lcicsIHsgc3RhdGljOiB0cnVlIH0pIHBvcHBlckNvbnRhaW5lcjogRWxlbWVudFJlZjtcblxuICBzdGF0aWMgbmV4dFRpY2soZm4pIHtcbiAgICAvLyBGb3JjZSB0byBydW4gZm4gYWZ0ZXIgY3VycmVudCBkYXRhIGNoYW5nZWQuXG4gICAgc2V0VGltZW91dCgoKSA9PiBmbi5iaW5kKHRoaXMpKCkpO1xuICB9XG4gIG9uRG9jdW1lbnRDbGljayA9ICgkZXZlbnQ6IE1vdXNlRXZlbnQpID0+IHtcbiAgICBpZiAoISF0aGlzLmFwcGVuZFRvICYmIHRoaXMucG9wcGVyQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQgIT09ICRldmVudC50YXJnZXQgJiZcbiAgICAgICF0aGlzLnBvcHBlckNvbnRhaW5lci5uYXRpdmVFbGVtZW50LmNvbnRhaW5zKCRldmVudC50YXJnZXQpKSB7XG4gICAgICB0aGlzLm9wZW4gPSBmYWxzZTtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLmFwcGVuZFRvICYmIHRoaXMub3BlbiAmJiAhdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNvbnRhaW5zKCRldmVudC50YXJnZXQpKSB7XG4gICAgICB0aGlzLm9wZW4gPSBmYWxzZTtcbiAgICB9XG4gIH07XG4gIHByaXZhdGUgYmxvY2tFdmVudCA9ICgkZXZlbnQ6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIH07XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIGVsOiBFbGVtZW50UmVmLCBwcm90ZWN0ZWQgcmVuZGVyZXI6IFJlbmRlcmVyMiwgcHJvdGVjdGVkIG5nWm9uZTogTmdab25lLFxuICAgICAgICAgICAgICBwcm90ZWN0ZWQgY2hhbmdlRGV0ZWN0b3JSZWY6IENoYW5nZURldGVjdG9yUmVmLCBASW5qZWN0KERPQ1VNRU5UKSBwcml2YXRlIGRvYzogYW55KSB7XG4gICAgdGhpcy5kb2N1bWVudCA9IHRoaXMuZG9jO1xuICB9XG5cbiAgc2hvdygpIHtcbiAgICAvLyBBcHBlbmQgdG8gc2VsZWN0b3Igb3Igb3JpZ2luYWwgcGFyZW50LlxuICAgIGlmICh0aGlzLmFwcGVuZFRvKSB7XG4gICAgICBpZiAodGhpcy5mbHVpZFBvcHBlcikge1xuICAgICAgICBsZXQgcG9wcGVyV2lkdGggPSB0aGlzLnBvcHBlckFjdGl2YXRvci5uYXRpdmVFbGVtZW50ICYmIHRoaXMucG9wcGVyQWN0aXZhdG9yLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgICAgIGlmICh0aGlzLmV4dHJhQ29uZmlnICYmIHRoaXMuZXh0cmFDb25maWcuZXh0cmFXaWR0aCkge1xuICAgICAgICAgIHBvcHBlcldpZHRoID0gcG9wcGVyV2lkdGggKyB0aGlzLmV4dHJhQ29uZmlnLmV4dHJhV2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmlyc3RFbGUgPSB0aGlzLnBvcHBlckNvbnRhaW5lci5uYXRpdmVFbGVtZW50LmZpcnN0RWxlbWVudENoaWxkO1xuICAgICAgICBpZiAoZmlyc3RFbGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdkZXZ1aS1zZWFyY2gtY29udGFpbmVyJykpIHtcbiAgICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXMucG9wcGVyQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW4pIHtcbiAgICAgICAgICAgIGNoaWxkLnN0eWxlLndpZHRoID0gYCR7cG9wcGVyV2lkdGh9cHhgO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmaXJzdEVsZS5zdHlsZS53aWR0aCA9IGAke3BvcHBlcldpZHRofXB4YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5hdHRhY2hQb3BwZXJDb250YWluZXJUb1NlbGVjdG9yKHRoaXMuYXBwZW5kVG8pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmF0dGFjaFBvcHBlckNvbnRhaW5lclRvTm9kZSh0aGlzLnBvcHBlclBhcmVudCk7XG4gICAgfVxuICAgIHRoaXMucG9wcGVyID0gdGhpcy5jcmVhdGVDdXN0b21Qb3BwZXIoKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMucG9wcGVyQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQsICdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gIH1cblxuICBwcml2YXRlIGNsb3NlKCkge1xuICAgIGNvbnN0IHBvcHBlckNvbnRhaW5lciA9IHRoaXMucG9wcGVyQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQ7XG4gICAgdGhpcy5zZXRUcmFuc2l0aW9uKCdjbG9zZScpO1xuICAgIC8vIEZvciBJRSAxMS9FZGdlXG4gICAgaWYgKHBvcHBlckNvbnRhaW5lci5zdHlsZS50cmFuc2Zvcm0ubWF0Y2goL3NjYWxlM2RcXCgxLCAxLCAxXFwpLykpIHtcbiAgICAgIC8vIFJlcGxhY2UgdHJhbnNmb3JtIG9wZW4gc3RhdGUgd2l0aCBjbG9zZSBzdGF0ZVxuICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShwb3BwZXJDb250YWluZXIsICd0cmFuc2Zvcm0nLFxuICAgICAgICBwb3BwZXJDb250YWluZXIuc3R5bGUudHJhbnNmb3JtLnJlcGxhY2UoJ3NjYWxlM2QoMSwgMSwgMSknLCAnc2NhbGUzZCgxLCAwLjgsIDEpJykpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBwZXJzcGVjdGl2ZSgxcHgpIHNvbHZlcyBwaXhlbCBzaGlmdCBjYXVzZWQgYnkgd2Via2l0IHRyYW5zZm9ybVxuICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShwb3BwZXJDb250YWluZXIsICd0cmFuc2Zvcm0nLFxuICAgICAgICBwb3BwZXJDb250YWluZXIuc3R5bGUudHJhbnNmb3JtICsgYCBzY2FsZTNkKDEsIDAuOCwgMSkgcGVyc3BlY3RpdmUoMXB4KWApO1xuICAgIH1cbiAgICAvLyBTZXQgY29udGFpbmVyIHRvIHRyYW5zcGFyZW50XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShwb3BwZXJDb250YWluZXIsICdvcGFjaXR5JywgMC44KTtcblxuICAgIC8vIENhbid0IHVzZSBiaW5kKHRoaXMpIHNpbmNlIGl0IGNhbGxzIGl0c2VsZlxuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIGNvbnN0IGhhbmRsZXIgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKCF0aGF0Lm9wZW4gJiYgdGhhdC5wb3BwZXIpIHtcbiAgICAgICAgLy8gU2V0IGZpbmFsIHN0YXRlIG9mIGNvbnRhaW5lciB0byBpbnZpc2libGVcbiAgICAgICAgdGhhdC5yZW5kZXJlci5zZXRTdHlsZShwb3BwZXJDb250YWluZXIsICdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgdGhhdC5hbmltYXRlID0gZmFsc2U7XG4gICAgICAgIC8vIFJlbW92ZSB0cmFuc2l0aW9uXG4gICAgICAgIHRoYXQuc2V0VHJhbnNpdGlvbigpO1xuICAgICAgICB0aGF0LnBvcHBlci5kZXN0cm95KCk7XG4gICAgICAgIHRoYXQucG9wcGVyID0gbnVsbDtcbiAgICAgICAgdGhhdC5kZXRhY2hQb3BwZXJDb250YWluZXIoKTtcbiAgICAgIH1cbiAgICAgIGUuY3VycmVudFRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKGUudHlwZSwgaGFuZGxlcik7XG4gICAgfTtcbiAgICBpZiAodGhpcy5zaG93QW5pbWF0aW9uKSB7XG4gICAgICB0aGlzLnBvcHBlckNvbnRhaW5lci5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RyYW5zaXRpb25lbmQnLCBoYW5kbGVyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhhdC5yZW5kZXJlci5zZXRTdHlsZShwb3BwZXJDb250YWluZXIsICdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgIHRoYXQuYW5pbWF0ZSA9IGZhbHNlO1xuICAgICAgdGhhdC5wb3BwZXIuZGVzdHJveSgpO1xuICAgICAgdGhhdC5wb3BwZXIgPSBudWxsO1xuICAgICAgdGhhdC5kZXRhY2hQb3BwZXJDb250YWluZXIoKTtcbiAgICB9XG4gIH1cblxuICBzZXRCbHVyTGlzdGVuZXIoKSB7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgaWYgKHRoaXMub3Blbikge1xuICAgICAgICB0aGlzLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkRvY3VtZW50Q2xpY2spO1xuICAgICAgICB0aGlzLnBvcHBlckNvbnRhaW5lci5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5ibG9ja0V2ZW50KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uRG9jdW1lbnRDbGljayk7XG4gICAgICAgIHRoaXMucG9wcGVyQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmJsb2NrRXZlbnQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhcHBseVRyYW5zaXRpb25TdHlsZSA9IChkYXRhKSA9PiB7XG4gICAgY29uc3Qgb3B0aW9uc0NvbnRhaW5lciA9IHRoaXMucG9wcGVyQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQ7XG4gICAgdGhpcy51cGRhdGVDb250YWluZXJUcmFuc2l0aW9uRGlyZWN0aW9uKGRhdGE/LnN0YXRlPy5tb2RpZmllcnNEYXRhPy5mbGlwPy5fc2tpcCk7XG4gICAgaWYgKHRoaXMuYW5pbWF0ZSkge1xuICAgICAgLy8gcGVyc3BlY3RpdmUoMXB4KSBzb2x2ZXMgcGl4ZWwgc2hpZnQgY2F1c2VkIGJ5IHdlYmtpdCB0cmFuc2Zvcm1cbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUob3B0aW9uc0NvbnRhaW5lciwgJ3RyYW5zZm9ybScsXG4gICAgICAgIG9wdGlvbnNDb250YWluZXIuc3R5bGUudHJhbnNmb3JtICtcbiAgICAgICAgYCBzY2FsZTNkKDEsIDAuOCwgMSkgcGVyc3BlY3RpdmUoMXB4KSAke3RoaXMucG9wcGVyRGlyZWN0aW9uID09PSAnYm90dG9tJyA/ICd0cmFuc2xhdGVZKC00cHgpJyA6ICd0cmFuc2xhdGVZKDRweCknfWApO1xuICAgICAgLy8gU2V0IGNvbnRhaW5lciBpbml0IHN0YXRlIHRvIHRyYW5zcGFyZW50IGFzIGJlZ2lubmluZyBvZiB0aGUgdHJhbnNpdGlvbi5cbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUob3B0aW9uc0NvbnRhaW5lciwgJ29wYWNpdHknLCAwKTtcbiAgICAgIFBvcHBlckNvbXBvbmVudC5uZXh0VGljaygoKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0VHJhbnNpdGlvbignb3BlbicpO1xuICAgICAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICAgICAgY29uc3QgaGFuZGxlciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgLy8gcmVtb3ZlIHRyYW5zaXRpb25cbiAgICAgICAgICB0aGF0LnNldFRyYW5zaXRpb24oKTtcbiAgICAgICAgICBlLmN1cnJlbnRUYXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihlLnR5cGUsIGhhbmRsZXIpO1xuICAgICAgICB9O1xuXG4gICAgICAgIG9wdGlvbnNDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigndHJhbnNpdGlvbmVuZCcsIGhhbmRsZXIpO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKG9wdGlvbnNDb250YWluZXIsICd0cmFuc2Zvcm0nLFxuICAgICAgICAgIG9wdGlvbnNDb250YWluZXIuc3R5bGUudHJhbnNmb3JtLnJlcGxhY2UoJ3NjYWxlM2QoMSwgMC44LCAxKScsICdzY2FsZTNkKDEsIDEsIDEpJykpO1xuICAgICAgICB0aGlzLnBvcHBlckRpcmVjdGlvbiA9PT0gJ2JvdHRvbScgP1xuICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUob3B0aW9uc0NvbnRhaW5lciwgJ3RyYW5zZm9ybScsXG4gICAgICAgICAgICBvcHRpb25zQ29udGFpbmVyLnN0eWxlLnRyYW5zZm9ybS5yZXBsYWNlKCd0cmFuc2xhdGVZKC00cHgpJywgJ3RyYW5zbGF0ZVkoMCknKSkgOlxuICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUob3B0aW9uc0NvbnRhaW5lciwgJ3RyYW5zZm9ybScsXG4gICAgICAgICAgICBvcHRpb25zQ29udGFpbmVyLnN0eWxlLnRyYW5zZm9ybS5yZXBsYWNlKCd0cmFuc2xhdGVZKDRweCknLCAndHJhbnNsYXRlWSgwKScpKTtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShvcHRpb25zQ29udGFpbmVyLCAnb3BhY2l0eScsIDEpO1xuICAgICAgICB0aGlzLmFuaW1hdGUgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBoYW5kbGUgcG9wcGVyIHJlLXJlbmRlcmluZywgaW5jb21pbmcgdHJhbnNmb3JtIGRvZXNuJ3QgaGF2ZSBzY2FsZSBpbmZvXG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKG9wdGlvbnNDb250YWluZXIsICd0cmFuc2Zvcm0nLFxuICAgICAgICBvcHRpb25zQ29udGFpbmVyLnN0eWxlLnRyYW5zZm9ybSArICh0aGlzLm9wZW4gPyAnIHNjYWxlM2QoMSwgMSwgMSknIDogJyBzY2FsZTNkKDEsIDAuOCwgMSknKSArICcgcGVyc3BlY3RpdmUoMXB4KScpO1xuICAgIH1cbiAgfTtcblxuICBwcml2YXRlIHVwZGF0ZUNvbnRhaW5lclRyYW5zaXRpb25EaXJlY3Rpb24oZmxpcHBlZDogYm9vbGVhbikge1xuICAgIGNvbnN0IGRpcmVjdGlvbiA9IGZsaXBwZWQgPyAndG9wJyA6ICdib3R0b20nO1xuICAgIGlmICh0aGlzLnBvcHBlckRpcmVjdGlvbiAhPT0gZGlyZWN0aW9uKSB7XG4gICAgICB0aGlzLnBvcHBlckRpcmVjdGlvbiA9IGRpcmVjdGlvbjtcbiAgICAgIHRoaXMuc2V0VHJhbnNpdGlvbk9yaWdpbigpO1xuICAgIH1cbiAgICB0aGlzLmRpcmVjdGlvblN1YmplY3QubmV4dCh0aGlzLnBvcHBlckRpcmVjdGlvbik7XG4gIH1cblxuICBwcml2YXRlIHNldFRyYW5zaXRpb25PcmlnaW4oKSB7XG4gICAgaWYgKHRoaXMucG9wcGVyQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5wb3BwZXJDb250YWluZXIubmF0aXZlRWxlbWVudCwgJ3RyYW5zZm9ybS1vcmlnaW4nLFxuICAgICAgICB0aGlzLmRpcmVjdGlvbkFuaW1hdGlvblRyYW5zZm9ybU9yaWdpblt0aGlzLnBvcHBlckRpcmVjdGlvbl0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlQ3VzdG9tUG9wcGVyKCkge1xuICAgIHJldHVybiBjcmVhdGVQb3BwZXIodGhpcy5wb3BwZXJBY3RpdmF0b3IubmF0aXZlRWxlbWVudCwgdGhpcy5wb3BwZXJDb250YWluZXIubmF0aXZlRWxlbWVudCwge1xuICAgICAgcGxhY2VtZW50OiAnYm90dG9tLXN0YXJ0JyxcbiAgICAgIG1vZGlmaWVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ3ByZXZlbnRPdmVyZmxvdycsXG4gICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgbWFpbkF4aXM6IHRydWUsIC8vIHRydWUgYnkgZGVmYXVsdFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnYXBwbHlSZWFjdFN0eWxlJyxcbiAgICAgICAgICBwaGFzZTogJ2FmdGVyV3JpdGUnLFxuICAgICAgICAgIGVuYWJsZWQ6IHRydWUsIC8vIHRydWUgYnkgZGVmYXVsdFxuICAgICAgICAgIGZuOiB0aGlzLmFwcGx5VHJhbnNpdGlvblN0eWxlXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnb2Zmc2V0JyxcbiAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICBvZmZzZXQ6IHRoaXMuZXh0cmFDb25maWcgJiYgdGhpcy5leHRyYUNvbmZpZy5vZmZzZXRcbiAgICAgICAgICAgICAgPyBbcGFyc2VJbnQodGhpcy5leHRyYUNvbmZpZy5vZmZzZXQuc3BsaXQoJywnKVswXSwgMTApLCBwYXJzZUludCh0aGlzLmV4dHJhQ29uZmlnLm9mZnNldC5zcGxpdCgnLCcpWzFdLCAxMCldXG4gICAgICAgICAgICAgIDogWzAsIDVdLCAvLyB0cnVlIGJ5IGRlZmF1bHRcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ2ZsaXAnLFxuICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgIGZsaXBWYXJpYXRpb25zOiB0cnVlLCAvLyB0cnVlIGJ5IGRlZmF1bHRcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIHN0cmF0ZWd5OiB0aGlzLmFwcGVuZFRvID8gJ2ZpeGVkJyA6ICdhYnNvbHV0ZScsXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHNldFRyYW5zaXRpb24oY29tbWFuZCA9IG51bGwpIHtcbiAgICBjb25zdCBwb3BwZXJDb250YWluZXIgPSB0aGlzLnBvcHBlckNvbnRhaW5lci5uYXRpdmVFbGVtZW50O1xuICAgIGlmICh0aGlzLmFuaW1hdGUgJiYgY29tbWFuZCkge1xuICAgICAgaWYgKGNvbW1hbmQgPT09ICdvcGVuJykge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHBvcHBlckNvbnRhaW5lciwgJ3RyYW5zaXRpb24nLCB0aGlzLnNob3dBbmltYXRpb25cbiAgICAgICAgICA/IGBhbGwgJHtBbmltYXRpb25EdXJhdGlvbi5CQVNFfSAke0FuaW1hdGlvbkN1cnZlcy5FQVNFX09VVH1gIDogJ25vbmUnKTtcbiAgICAgIH0gZWxzZSBpZiAoY29tbWFuZCA9PT0gJ2Nsb3NlJykge1xuICAgICAgICBwb3BwZXJDb250YWluZXIuc3R5bGUudHJhbnNpdGlvbiA9IHRoaXMuc2hvd0FuaW1hdGlvbiA/IGBhbGwgJHtBbmltYXRpb25EdXJhdGlvbi5CQVNFfSAke0FuaW1hdGlvbkN1cnZlcy5FQVNFX0lOfWAgOiAnbm9uZSc7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUocG9wcGVyQ29udGFpbmVyLCAndHJhbnNpdGlvbicsIG51bGwpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGUoKSB7XG4gICAgUG9wcGVyQ29tcG9uZW50Lm5leHRUaWNrKCgpID0+IHtcbiAgICAgIGlmICh0aGlzLnBvcHBlcikgeyB0aGlzLnBvcHBlci5mb3JjZVVwZGF0ZSgpOyB9XG4gICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICAvLyBDbG9zZSBwb3BwZXJcbiAgICB0aGlzLm9wZW4gPSBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgZGV0YWNoUG9wcGVyQ29udGFpbmVyKCkge1xuICAgIC8vIENhY2hlIHBvcHBlcidzIHBhcmVudCBhbmQgcG9wcGVyIG5vZGUuXG4gICAgdGhpcy5wb3BwZXJQYXJlbnQgPSB0aGlzLnBvcHBlckNvbnRhaW5lci5uYXRpdmVFbGVtZW50LnBhcmVudE5vZGU7XG4gICAgdGhpcy5wb3BwZXJOb2RlID0gdGhpcy5wb3BwZXJDb250YWluZXIubmF0aXZlRWxlbWVudDtcbiAgICBpZiAodGhpcy5wb3BwZXJQYXJlbnQgJiYgdGhpcy5wb3BwZXJOb2RlKSB7XG4gICAgICB0aGlzLnBvcHBlclBhcmVudC5yZW1vdmVDaGlsZCh0aGlzLnBvcHBlck5vZGUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXR0YWNoUG9wcGVyQ29udGFpbmVyVG9Ob2RlKG5vZGVQYXJlbnQpIHtcbiAgICBpZiAobm9kZVBhcmVudCAmJiB0aGlzLnBvcHBlck5vZGUpIHtcbiAgICAgIHRoaXMucG9wcGVyUGFyZW50ID0gbm9kZVBhcmVudDtcbiAgICAgIHRoaXMucG9wcGVyUGFyZW50LmFwcGVuZENoaWxkKHRoaXMucG9wcGVyTm9kZSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhdHRhY2hQb3BwZXJDb250YWluZXJUb1NlbGVjdG9yKHRhcmdldFNlbGVjdG9yKSB7XG4gICAgY29uc3Qgbm9kZVBhcmVudCA9IHRoaXMuZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0YXJnZXRTZWxlY3Rvcik7XG4gICAgdGhpcy5hdHRhY2hQb3BwZXJDb250YWluZXJUb05vZGUobm9kZVBhcmVudCk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgLy8gRGV0YWNoIHBvcHBlciBjb250YWluZXIgb25jZSB2aWV3IGluaXRpYWxpemVkLlxuICAgIHRoaXMuZGV0YWNoUG9wcGVyQ29udGFpbmVyKCk7XG4gIH1cblxuICBwdWJsaWMgZGlyZWN0aW9uQ2hhbmdlKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgcmV0dXJuIHRoaXMuZGlyZWN0aW9uU3ViamVjdC5hc09ic2VydmFibGUoKTtcbiAgfVxufVxuIiwiPGRpdiBjbGFzcz1cInBvcHBlclwiPlxuICA8ZGl2IGNsYXNzPVwicG9wcGVyLWFjdGl2YXRvclwiICNwb3BwZXJBY3RpdmF0b3I+XG4gICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwiW3BvcHBlci1hY3RpdmF0b3JdXCI+PC9uZy1jb250ZW50PlxuICA8L2Rpdj5cblxuICA8ZGl2XG4gICAgY2xhc3M9XCJwb3BwZXItY29udGFpbmVyXCJcbiAgICAjcG9wcGVyQ29udGFpbmVyXG4gICAgW25nQ2xhc3NdPVwie1xuICAgICAgZmx1aWQ6IGZsdWlkUG9wcGVyICYmICFhcHBlbmRUbyxcbiAgICAgICdkZXZ1aS1wb3BvdmVyLWNvbnRhaW5lci1yaWdodCc6IHBvcHBvdmVyQXBwZW5kRGlyZWN0aW9uID09PSAncmlnaHQnLFxuICAgICAgJ2RldnVpLXBvcG92ZXItY29udGFpbmVyLWxlZnQnOiBwb3Bwb3ZlckFwcGVuZERpcmVjdGlvbiA9PT0gJ2xlZnQnXG4gICAgfVwiXG4gID5cbiAgICA8ZGl2IGNsYXNzPVwiZGV2dWktZHJvcGRvd24tbWVudS13cmFwXCI+XG4gICAgICA8bmctY29udGVudCBzZWxlY3Q9XCJbcG9wcGVyLXByZXBlbmRdXCI+PC9uZy1jb250ZW50PlxuICAgICAgPGRpdiBjbGFzcz1cInBvcHBlci1jb250YWluZXItc2Nyb2xsYWJsZSBkZXZ1aS1zY3JvbGxiYXJcIj5cbiAgICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwiW3BvcHBlci1jb250YWluZXJdXCI+PC9uZy1jb250ZW50PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cInBvcHBlci1hcHBlbmQtYXJlYVwiPlxuICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwiW3BvcHBlci1hcHBlbmRdXCI+PC9uZy1jb250ZW50PlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvZGl2PlxuIl19