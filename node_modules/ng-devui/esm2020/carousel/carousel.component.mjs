import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChildren, ElementRef, EventEmitter, Input, Output, QueryList, Renderer2 } from '@angular/core';
import { CarouselItemComponent } from './carousel-item.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
export class CarouselComponent {
    constructor(el, renderer, cdr) {
        this.el = el;
        this.renderer = renderer;
        this.cdr = cdr;
        // 切换箭头的显示方式
        this.arrowTrigger = 'hover';
        // 是否自动播放
        this.autoplay = false;
        // 默认自动播放间隔时间
        this.autoplaySpeed = 3000;
        // 卡片切换动画速度，单位ms
        this.transitionSpeed = 500;
        // 卡片高度
        this.height = '100%';
        // 是否显示面板指示器
        this.showDots = true;
        // 面板指示器位置
        this.dotPosition = 'bottom';
        // 指示器触发滚动方式
        this.dotTrigger = 'click';
        // 当前激活面板索引，默认从0开始
        this.activeIndex = 0;
        // 卡片切换时，返回当前卡片索引，索引从0开始
        this.activeIndexChange = new EventEmitter();
        this.showArrow = false;
    }
    ngOnInit() {
        this.showArrow = this.arrowTrigger === 'always';
        this.itemContainer = this.el.nativeElement.querySelector('.devui-carousel-item-container');
    }
    ngOnChanges(changes) {
        const { arrowTrigger, activeIndex } = changes;
        if (arrowTrigger && !arrowTrigger.isFirstChange()) {
            this.showArrow = this.arrowTrigger === 'always';
        }
        if (activeIndex && activeIndex.currentValue !== this.currentIndex && !activeIndex.isFirstChange()) {
            this.translatePosition(this.activeIndex);
        }
        if (!this.autoplay || !this.autoplaySpeed) {
            this.clearScheduledTransition();
        }
        else {
            this.autoScheduleTransition();
        }
    }
    // 切换箭头监听事件，用于处理hover方式
    arrowMouseEvent(type) {
        if (this.arrowTrigger !== 'hover') {
            return;
        }
        if (type === 'enter') {
            this.showArrow = true;
        }
        else {
            this.showArrow = false;
        }
    }
    // 向前切换
    prev() {
        this.goTo(this.activeIndex - 1);
    }
    // 向后切换
    next() {
        this.goTo(this.activeIndex + 1);
    }
    // 指定跳转位置
    goTo(index) {
        if (index === this.activeIndex) {
            return;
        }
        this.renderer.setStyle(this.itemContainer, 'transition', `left ${this.transitionSpeed}ms ease`);
        if (index < 0 && this.activeIndex === 0) {
            // 第一个卡片向前切换
            this.activeIndex = this.itemCount - 1;
            const targetEl = this.el.nativeElement.querySelectorAll('d-carousel-item')[this.activeIndex];
            this.adjustPosition(targetEl, true);
            this.translatePosition(-1);
            this.adjustTransition(targetEl);
        }
        else if (index >= this.itemCount && this.activeIndex === this.itemCount - 1) {
            // 最后一个卡片向后切换
            this.activeIndex = 0;
            const targetEl = this.el.nativeElement.querySelectorAll('d-carousel-item')[this.activeIndex];
            this.adjustPosition(targetEl, false);
            this.translatePosition(this.itemCount);
            this.adjustTransition(targetEl);
        }
        else {
            this.activeIndex = index < 0 ? 0 : index > this.itemCount - 1 ? this.itemCount - 1 : index;
            this.translatePosition(this.activeIndex);
        }
        this.activeIndexChange.emit(this.activeIndex);
        this.currentIndex = this.activeIndex;
        this.cdr.detectChanges();
        this.autoScheduleTransition();
    }
    // 指示器触发切换函数
    switchStep(index, type) {
        if (type === this.dotTrigger) {
            this.goTo(index);
        }
    }
    // 调整首尾翻页后的动画
    adjustTransition(targetEl) {
        setTimeout(() => {
            this.renderer.removeStyle(this.itemContainer, 'transition');
            this.renderer.removeStyle(targetEl, 'transform');
            this.translatePosition(this.activeIndex);
        }, this.transitionSpeed);
    }
    // 调整首尾翻动时的位置
    adjustPosition(targetEl, firstToLast) {
        const wrapperRect = this.el.nativeElement.querySelector('.devui-carousel-item-wrapper').getBoundingClientRect();
        this.renderer.setStyle(targetEl, 'transform', `translateX(${(firstToLast ? -this.itemCount : this.itemCount) * wrapperRect.width}px)`);
    }
    // 翻页位移
    translatePosition(size) {
        this.renderer.setStyle(this.itemContainer, 'left', `${-size * 100}%`);
    }
    // 初始化container的宽度
    initCarouselWidth() {
        this.itemCount = this.items.length;
        this.renderer.setStyle(this.itemContainer, 'width', `${this.itemCount * 100}%`);
    }
    // 自动轮播调度任务
    autoScheduleTransition() {
        this.clearScheduledTransition();
        if (this.autoplay && this.autoplaySpeed) {
            this.scheduledId = setTimeout(() => {
                this.next();
            }, this.autoplaySpeed);
        }
    }
    // 清除自动轮播任务
    clearScheduledTransition() {
        if (this.scheduledId) {
            clearTimeout(this.scheduledId);
            this.scheduledId = null;
        }
    }
    ngAfterContentInit() {
        this.initCarouselWidth();
        this.translatePosition(this.activeIndex);
        this.renderer.setStyle(this.itemContainer, 'transition', `left ${this.transitionSpeed}ms ease`);
        // contentChildren 变化时，触发重新设置pane
        this.items.changes.subscribe((items) => {
            if (items.length !== this.itemCount) {
                this.activeIndex = 0;
                this.initCarouselWidth();
                this.translatePosition(this.activeIndex);
            }
        });
    }
    ngOnDestroy() {
        // 组件销毁时清理掉当前的定时任务
        this.clearScheduledTransition();
    }
}
CarouselComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: CarouselComponent, deps: [{ token: i0.ElementRef }, { token: i0.Renderer2 }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
CarouselComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.3", type: CarouselComponent, selector: "d-carousel", inputs: { arrowTrigger: "arrowTrigger", autoplay: "autoplay", autoplaySpeed: "autoplaySpeed", transitionSpeed: "transitionSpeed", height: "height", showDots: "showDots", dotPosition: "dotPosition", dotTrigger: "dotTrigger", activeIndex: "activeIndex" }, outputs: { activeIndexChange: "activeIndexChange" }, queries: [{ propertyName: "items", predicate: CarouselItemComponent }], exportAs: ["dCarousel"], usesOnChanges: true, ngImport: i0, template: "<div\n  class=\"devui-carousel-container\"\n  [style.height]=\"height\"\n  (mouseenter)=\"arrowMouseEvent('enter')\"\n  (mouseleave)=\"arrowMouseEvent('leave')\"\n>\n  <!-- carousel arrow -->\n  <div class=\"devui-carousel-arrow\" *ngIf=\"arrowTrigger !== 'never' && showArrow\">\n    <button class=\"arrow-left\" (click)=\"prev()\">\n      <svg width=\"18px\" height=\"18px\" viewBox=\"0 0 16 16\" version=\"1.1\">\n        <g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n          <polygon\n            fill=\"#293040\"\n            fill-rule=\"nonzero\"\n            points=\"10.7071068 12.2928932 9.29289322 13.7071068 3.58578644 8 9.29289322 2.29289322 10.7071068 3.70710678 6.41421356 8\"\n          ></polygon>\n        </g>\n      </svg>\n    </button>\n    <button class=\"arrow-right\" (click)=\"next()\">\n      <svg width=\"18px\" height=\"18px\" viewBox=\"0 0 16 16\" version=\"1.1\">\n        <g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n          <polygon\n            fill=\"#293040\"\n            fill-rule=\"nonzero\"\n            transform=\"translate(8.146447, 8.000000) scale(-1, 1) translate(-8.146447, -8.000000) \"\n            points=\"11.7071068 12.2928932 10.2928932 13.7071068 4.58578644 8 10.2928932 2.29289322 11.7071068 3.70710678 7.41421356 8\"\n          ></polygon>\n        </g>\n      </svg>\n    </button>\n  </div>\n  <!-- carousel items -->\n  <div class=\"devui-carousel-item-wrapper\">\n    <div class=\"devui-carousel-item-container\">\n      <ng-content select=\"d-carousel-item\"></ng-content>\n    </div>\n  </div>\n  <!-- carousel dots -->\n  <ul class=\"devui-carousel-dots {{ dotPosition }}\" *ngIf=\"items?.length > 1 && showDots\">\n    <li\n      class=\"dot-item\"\n      (click)=\"switchStep(index, 'click')\"\n      (mouseenter)=\"switchStep(index, 'hover')\"\n      [ngClass]=\"{ active: activeIndex === index }\"\n      *ngFor=\"let item of items; let index = index\"\n    ></li>\n  </ul>\n</div>\n", styles: [".devui-carousel-container{display:block;position:relative}.devui-carousel-container .devui-carousel-arrow{position:absolute;width:100%;top:50%}.devui-carousel-container .devui-carousel-arrow .arrow-left{position:absolute;top:-18px;z-index:2;cursor:pointer;width:36px;height:36px;border-radius:100%;background:rgba(255,255,255,.8);background:var(--devui-highlight-overlay, rgba(255, 255, 255, .8));box-shadow:0 4px 16px rgba(37,43,58,.1);box-shadow:var(--devui-shadow-length-hover, 0 4px 16px 0) var(--devui-light-shadow, rgba(37, 43, 58, .1));display:inline-flex;align-items:center;justify-content:center;left:10px}.devui-carousel-container .devui-carousel-arrow .arrow-left:hover{background:#f5f5f5;background:var(--devui-area, #f5f5f5)}.devui-carousel-container .devui-carousel-arrow .arrow-left svg polygon{fill:#252b3a;fill:var(--devui-text, #252b3a)}.devui-carousel-container .devui-carousel-arrow .arrow-right{position:absolute;top:-18px;z-index:2;cursor:pointer;width:36px;height:36px;border-radius:100%;background:rgba(255,255,255,.8);background:var(--devui-highlight-overlay, rgba(255, 255, 255, .8));box-shadow:0 4px 16px rgba(37,43,58,.1);box-shadow:var(--devui-shadow-length-hover, 0 4px 16px 0) var(--devui-light-shadow, rgba(37, 43, 58, .1));display:inline-flex;align-items:center;justify-content:center;right:10px}.devui-carousel-container .devui-carousel-arrow .arrow-right:hover{background:#f5f5f5;background:var(--devui-area, #f5f5f5)}.devui-carousel-container .devui-carousel-arrow .arrow-right svg polygon{fill:#252b3a;fill:var(--devui-text, #252b3a)}.devui-carousel-container .devui-carousel-item-wrapper{position:relative;overflow:hidden;height:100%}.devui-carousel-container .devui-carousel-item-wrapper .devui-carousel-item-container{display:flex;height:100%;position:relative}.devui-carousel-container .devui-carousel-item-wrapper .devui-carousel-item-container ::ng-deep d-carousel-item{flex:1;position:relative;height:100%}.devui-carousel-container .devui-carousel-dots{position:absolute;display:flex;justify-content:center;width:100%}.devui-carousel-container .devui-carousel-dots.bottom{bottom:8px}.devui-carousel-container .devui-carousel-dots.top{top:8px}.devui-carousel-container .devui-carousel-dots .dot-item{width:6px;height:6px;border-radius:3px;margin-right:8px;background:#71757f;background:var(--devui-icon-fill, #71757f)}.devui-carousel-container .devui-carousel-dots .dot-item:hover{cursor:pointer;background:#252b3a;background:var(--devui-icon-fill-hover, #252b3a)}.devui-carousel-container .devui-carousel-dots .dot-item.active{width:24px;background:#252b3a;background:var(--devui-icon-fill-active, #252b3a);transition:all .3s cubic-bezier(.645,.045,.355,1);transition:all var(--devui-animation-duration-slow, .3s) var(--devui-animation-ease-in-out-smooth, cubic-bezier(.645, .045, .355, 1))}.devui-carousel-container .devui-carousel-arrow .arrow-left,.devui-carousel-container .devui-carousel-arrow .arrow-right{transition:background-color .3s cubic-bezier(.645,.045,.355,1);transition:background-color var(--devui-animation-duration-slow, .3s) var(--devui-animation-ease-in-out-smooth, cubic-bezier(.645, .045, .355, 1))}\n"], directives: [{ type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: CarouselComponent, decorators: [{
            type: Component,
            args: [{ selector: 'd-carousel', exportAs: 'dCarousel', changeDetection: ChangeDetectionStrategy.OnPush, preserveWhitespaces: false, template: "<div\n  class=\"devui-carousel-container\"\n  [style.height]=\"height\"\n  (mouseenter)=\"arrowMouseEvent('enter')\"\n  (mouseleave)=\"arrowMouseEvent('leave')\"\n>\n  <!-- carousel arrow -->\n  <div class=\"devui-carousel-arrow\" *ngIf=\"arrowTrigger !== 'never' && showArrow\">\n    <button class=\"arrow-left\" (click)=\"prev()\">\n      <svg width=\"18px\" height=\"18px\" viewBox=\"0 0 16 16\" version=\"1.1\">\n        <g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n          <polygon\n            fill=\"#293040\"\n            fill-rule=\"nonzero\"\n            points=\"10.7071068 12.2928932 9.29289322 13.7071068 3.58578644 8 9.29289322 2.29289322 10.7071068 3.70710678 6.41421356 8\"\n          ></polygon>\n        </g>\n      </svg>\n    </button>\n    <button class=\"arrow-right\" (click)=\"next()\">\n      <svg width=\"18px\" height=\"18px\" viewBox=\"0 0 16 16\" version=\"1.1\">\n        <g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n          <polygon\n            fill=\"#293040\"\n            fill-rule=\"nonzero\"\n            transform=\"translate(8.146447, 8.000000) scale(-1, 1) translate(-8.146447, -8.000000) \"\n            points=\"11.7071068 12.2928932 10.2928932 13.7071068 4.58578644 8 10.2928932 2.29289322 11.7071068 3.70710678 7.41421356 8\"\n          ></polygon>\n        </g>\n      </svg>\n    </button>\n  </div>\n  <!-- carousel items -->\n  <div class=\"devui-carousel-item-wrapper\">\n    <div class=\"devui-carousel-item-container\">\n      <ng-content select=\"d-carousel-item\"></ng-content>\n    </div>\n  </div>\n  <!-- carousel dots -->\n  <ul class=\"devui-carousel-dots {{ dotPosition }}\" *ngIf=\"items?.length > 1 && showDots\">\n    <li\n      class=\"dot-item\"\n      (click)=\"switchStep(index, 'click')\"\n      (mouseenter)=\"switchStep(index, 'hover')\"\n      [ngClass]=\"{ active: activeIndex === index }\"\n      *ngFor=\"let item of items; let index = index\"\n    ></li>\n  </ul>\n</div>\n", styles: [".devui-carousel-container{display:block;position:relative}.devui-carousel-container .devui-carousel-arrow{position:absolute;width:100%;top:50%}.devui-carousel-container .devui-carousel-arrow .arrow-left{position:absolute;top:-18px;z-index:2;cursor:pointer;width:36px;height:36px;border-radius:100%;background:rgba(255,255,255,.8);background:var(--devui-highlight-overlay, rgba(255, 255, 255, .8));box-shadow:0 4px 16px rgba(37,43,58,.1);box-shadow:var(--devui-shadow-length-hover, 0 4px 16px 0) var(--devui-light-shadow, rgba(37, 43, 58, .1));display:inline-flex;align-items:center;justify-content:center;left:10px}.devui-carousel-container .devui-carousel-arrow .arrow-left:hover{background:#f5f5f5;background:var(--devui-area, #f5f5f5)}.devui-carousel-container .devui-carousel-arrow .arrow-left svg polygon{fill:#252b3a;fill:var(--devui-text, #252b3a)}.devui-carousel-container .devui-carousel-arrow .arrow-right{position:absolute;top:-18px;z-index:2;cursor:pointer;width:36px;height:36px;border-radius:100%;background:rgba(255,255,255,.8);background:var(--devui-highlight-overlay, rgba(255, 255, 255, .8));box-shadow:0 4px 16px rgba(37,43,58,.1);box-shadow:var(--devui-shadow-length-hover, 0 4px 16px 0) var(--devui-light-shadow, rgba(37, 43, 58, .1));display:inline-flex;align-items:center;justify-content:center;right:10px}.devui-carousel-container .devui-carousel-arrow .arrow-right:hover{background:#f5f5f5;background:var(--devui-area, #f5f5f5)}.devui-carousel-container .devui-carousel-arrow .arrow-right svg polygon{fill:#252b3a;fill:var(--devui-text, #252b3a)}.devui-carousel-container .devui-carousel-item-wrapper{position:relative;overflow:hidden;height:100%}.devui-carousel-container .devui-carousel-item-wrapper .devui-carousel-item-container{display:flex;height:100%;position:relative}.devui-carousel-container .devui-carousel-item-wrapper .devui-carousel-item-container ::ng-deep d-carousel-item{flex:1;position:relative;height:100%}.devui-carousel-container .devui-carousel-dots{position:absolute;display:flex;justify-content:center;width:100%}.devui-carousel-container .devui-carousel-dots.bottom{bottom:8px}.devui-carousel-container .devui-carousel-dots.top{top:8px}.devui-carousel-container .devui-carousel-dots .dot-item{width:6px;height:6px;border-radius:3px;margin-right:8px;background:#71757f;background:var(--devui-icon-fill, #71757f)}.devui-carousel-container .devui-carousel-dots .dot-item:hover{cursor:pointer;background:#252b3a;background:var(--devui-icon-fill-hover, #252b3a)}.devui-carousel-container .devui-carousel-dots .dot-item.active{width:24px;background:#252b3a;background:var(--devui-icon-fill-active, #252b3a);transition:all .3s cubic-bezier(.645,.045,.355,1);transition:all var(--devui-animation-duration-slow, .3s) var(--devui-animation-ease-in-out-smooth, cubic-bezier(.645, .045, .355, 1))}.devui-carousel-container .devui-carousel-arrow .arrow-left,.devui-carousel-container .devui-carousel-arrow .arrow-right{transition:background-color .3s cubic-bezier(.645,.045,.355,1);transition:background-color var(--devui-animation-duration-slow, .3s) var(--devui-animation-ease-in-out-smooth, cubic-bezier(.645, .045, .355, 1))}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.Renderer2 }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { arrowTrigger: [{
                type: Input
            }], autoplay: [{
                type: Input
            }], autoplaySpeed: [{
                type: Input
            }], transitionSpeed: [{
                type: Input
            }], height: [{
                type: Input
            }], showDots: [{
                type: Input
            }], dotPosition: [{
                type: Input
            }], dotTrigger: [{
                type: Input
            }], activeIndex: [{
                type: Input
            }], activeIndexChange: [{
                type: Output
            }], items: [{
                type: ContentChildren,
                args: [CarouselItemComponent]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2Fyb3VzZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vZGV2dWkvY2Fyb3VzZWwvY2Fyb3VzZWwuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vZGV2dWkvY2Fyb3VzZWwvY2Fyb3VzZWwuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULGVBQWUsRUFDZixVQUFVLEVBQ1YsWUFBWSxFQUNaLEtBQUssRUFJTCxNQUFNLEVBQ04sU0FBUyxFQUNULFNBQVMsRUFFVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQzs7O0FBYWxFLE1BQU0sT0FBTyxpQkFBaUI7SUFnQzVCLFlBQW9CLEVBQWMsRUFBVSxRQUFtQixFQUFVLEdBQXNCO1FBQTNFLE9BQUUsR0FBRixFQUFFLENBQVk7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQVUsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUEvQi9GLFlBQVk7UUFDSCxpQkFBWSxHQUFpQixPQUFPLENBQUM7UUFDOUMsU0FBUztRQUNBLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDMUIsYUFBYTtRQUNKLGtCQUFhLEdBQUcsSUFBSSxDQUFDO1FBQzlCLGdCQUFnQjtRQUNQLG9CQUFlLEdBQUcsR0FBRyxDQUFDO1FBQy9CLE9BQU87UUFDRSxXQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3pCLFlBQVk7UUFDSCxhQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ3pCLFVBQVU7UUFDRCxnQkFBVyxHQUFnQixRQUFRLENBQUM7UUFDN0MsWUFBWTtRQUNILGVBQVUsR0FBZSxPQUFPLENBQUM7UUFDMUMsa0JBQWtCO1FBQ1QsZ0JBQVcsR0FBRyxDQUFDLENBQUM7UUFDekIsd0JBQXdCO1FBQ2Qsc0JBQWlCLEdBQUcsSUFBSSxZQUFZLEVBQVUsQ0FB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QXdCLEVBQUUsQ0FBQztJQUNsQyxDQUFDOzs4R0E5S1UsaUJBQWlCO2tHQUFqQixpQkFBaUIsMlhBcUJYLHFCQUFxQiwyRUNuRHhDLCs5REFpREE7MkZEbkJhLGlCQUFpQjtrQkFSN0IsU0FBUzsrQkFDRSxZQUFZLFlBQ1osV0FBVyxtQkFHSix1QkFBdUIsQ0FBQyxNQUFNLHVCQUMxQixLQUFLO3lKQUlqQixZQUFZO3NCQUFwQixLQUFLO2dCQUVHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBRUcsYUFBYTtzQkFBckIsS0FBSztnQkFFRyxlQUFlO3NCQUF2QixLQUFLO2dCQUVHLE1BQU07c0JBQWQsS0FBSztnQkFFRyxRQUFRO3NCQUFoQixLQUFLO2dCQUVHLFdBQVc7c0JBQW5CLEtBQUs7Z0JBRUcsVUFBVTtzQkFBbEIsS0FBSztnQkFFRyxXQUFXO3NCQUFuQixLQUFLO2dCQUVJLGlCQUFpQjtzQkFBMUIsTUFBTTtnQkFDaUMsS0FBSztzQkFBNUMsZUFBZTt1QkFBQyxxQkFBcUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlckNvbnRlbnRJbml0LFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFF1ZXJ5TGlzdCxcbiAgUmVuZGVyZXIyLFxuICBTaW1wbGVDaGFuZ2VzXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ2Fyb3VzZWxJdGVtQ29tcG9uZW50IH0gZnJvbSAnLi9jYXJvdXNlbC1pdGVtLmNvbXBvbmVudCc7XG5cbmV4cG9ydCB0eXBlIEFycm93VHJpZ2dlciA9ICdob3ZlcicgfCAnbmV2ZXInIHwgJ2Fsd2F5cyc7XG5leHBvcnQgdHlwZSBEb3RUcmlnZ2VyID0gJ2NsaWNrJyB8ICdob3Zlcic7XG5leHBvcnQgdHlwZSBEb3RQb3NpdGlvbiA9ICdib3R0b20nIHwgJ3RvcCc7XG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdkLWNhcm91c2VsJyxcbiAgZXhwb3J0QXM6ICdkQ2Fyb3VzZWwnLFxuICB0ZW1wbGF0ZVVybDogJy4vY2Fyb3VzZWwuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9jYXJvdXNlbC5jb21wb25lbnQuc2NzcyddLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgcHJlc2VydmVXaGl0ZXNwYWNlczogZmFsc2UsXG59KVxuZXhwb3J0IGNsYXNzIENhcm91c2VsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlckNvbnRlbnRJbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG4gIC8vIOWIh+aNoueureWktOeahOaYvuekuuaWueW8j1xuICBASW5wdXQoKSBhcnJvd1RyaWdnZXI6IEFycm93VHJpZ2dlciA9ICdob3Zlcic7XG4gIC8vIOaYr+WQpuiHquWKqOaSreaUvlxuICBASW5wdXQoKSBhdXRvcGxheSA9IGZhbHNlO1xuICAvLyDpu5jorqToh6rliqjmkq3mlL7pl7TpmpTml7bpl7RcbiAgQElucHV0KCkgYXV0b3BsYXlTcGVlZCA9IDMwMDA7XG4gIC8vIOWNoeeJh+WIh+aNouWKqOeUu+mAn+W6pu+8jOWNleS9jW1zXG4gIEBJbnB1dCgpIHRyYW5zaXRpb25TcGVlZCA9IDUwMDtcbiAgLy8g5Y2h54mH6auY5bqmXG4gIEBJbnB1dCgpIGhlaWdodCA9ICcxMDAlJztcbiAgLy8g5piv5ZCm5pi+56S66Z2i5p2/5oyH56S65ZmoXG4gIEBJbnB1dCgpIHNob3dEb3RzID0gdHJ1ZTtcbiAgLy8g6Z2i5p2/5oyH56S65Zmo5L2N572uXG4gIEBJbnB1dCgpIGRvdFBvc2l0aW9uOiBEb3RQb3NpdGlvbiA9ICdib3R0b20nO1xuICAvLyDmjIfnpLrlmajop6blj5Hmu5rliqjmlrnlvI9cbiAgQElucHV0KCkgZG90VHJpZ2dlcjogRG90VHJpZ2dlciA9ICdjbGljayc7XG4gIC8vIOW9k+WJjea/gOa0u+mdouadv+e0ouW8le+8jOm7mOiupOS7jjDlvIDlp4tcbiAgQElucHV0KCkgYWN0aXZlSW5kZXggPSAwO1xuICAvLyDljaHniYfliIfmjaLml7bvvIzov5Tlm57lvZPliY3ljaHniYfntKLlvJXvvIzntKLlvJXku44w5byA5aeLXG4gIEBPdXRwdXQoKSBhY3RpdmVJbmRleENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xuICBAQ29udGVudENoaWxkcmVuKENhcm91c2VsSXRlbUNvbXBvbmVudCkgaXRlbXM6IFF1ZXJ5TGlzdDxDYXJvdXNlbEl0ZW1Db21wb25lbnQ+O1xuXG4gIHNob3dBcnJvdyA9IGZhbHNlO1xuICAvLyDljaHniYflrrnlmahcbiAgcHJpdmF0ZSBpdGVtQ29udGFpbmVyO1xuICAvLyDljaHniYfmlbDph49cbiAgcHJpdmF0ZSBpdGVtQ291bnQ7XG4gIC8vIOiHquWKqOiwg+W6pmlkXG4gIHByaXZhdGUgc2NoZWR1bGVkSWQ7XG4gIC8vIOiusOW9leW9k+WJjemhteeggVxuICBwcml2YXRlIGN1cnJlbnRJbmRleDtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLCBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHt9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5zaG93QXJyb3cgPSB0aGlzLmFycm93VHJpZ2dlciA9PT0gJ2Fsd2F5cyc7XG4gICAgdGhpcy5pdGVtQ29udGFpbmVyID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kZXZ1aS1jYXJvdXNlbC1pdGVtLWNvbnRhaW5lcicpO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGNvbnN0IHsgYXJyb3dUcmlnZ2VyLCBhY3RpdmVJbmRleCB9ID0gY2hhbmdlcztcbiAgICBpZiAoYXJyb3dUcmlnZ2VyICYmICFhcnJvd1RyaWdnZXIuaXNGaXJzdENoYW5nZSgpKSB7XG4gICAgICB0aGlzLnNob3dBcnJvdyA9IHRoaXMuYXJyb3dUcmlnZ2VyID09PSAnYWx3YXlzJztcbiAgICB9XG4gICAgaWYgKGFjdGl2ZUluZGV4ICYmIGFjdGl2ZUluZGV4LmN1cnJlbnRWYWx1ZSAhPT0gdGhpcy5jdXJyZW50SW5kZXggJiYgIWFjdGl2ZUluZGV4LmlzRmlyc3RDaGFuZ2UoKSkge1xuICAgICAgdGhpcy50cmFuc2xhdGVQb3NpdGlvbih0aGlzLmFjdGl2ZUluZGV4KTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLmF1dG9wbGF5IHx8ICF0aGlzLmF1dG9wbGF5U3BlZWQpIHtcbiAgICAgIHRoaXMuY2xlYXJTY2hlZHVsZWRUcmFuc2l0aW9uKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYXV0b1NjaGVkdWxlVHJhbnNpdGlvbigpO1xuICAgIH1cbiAgfVxuXG4gIC8vIOWIh+aNoueureWktOebkeWQrOS6i+S7tu+8jOeUqOS6juWkhOeQhmhvdmVy5pa55byPXG4gIGFycm93TW91c2VFdmVudCh0eXBlKSB7XG4gICAgaWYgKHRoaXMuYXJyb3dUcmlnZ2VyICE9PSAnaG92ZXInKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0eXBlID09PSAnZW50ZXInKSB7XG4gICAgICB0aGlzLnNob3dBcnJvdyA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2hvd0Fycm93ID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLy8g5ZCR5YmN5YiH5o2iXG4gIHByZXYoKSB7XG4gICAgdGhpcy5nb1RvKHRoaXMuYWN0aXZlSW5kZXggLSAxKTtcbiAgfVxuXG4gIC8vIOWQkeWQjuWIh+aNolxuICBuZXh0KCkge1xuICAgIHRoaXMuZ29Ubyh0aGlzLmFjdGl2ZUluZGV4ICsgMSk7XG4gIH1cblxuICAvLyDmjIflrprot7PovazkvY3nva5cbiAgZ29UbyhpbmRleCkge1xuICAgIGlmIChpbmRleCA9PT0gdGhpcy5hY3RpdmVJbmRleCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuaXRlbUNvbnRhaW5lciwgJ3RyYW5zaXRpb24nLCBgbGVmdCAke3RoaXMudHJhbnNpdGlvblNwZWVkfW1zIGVhc2VgKTtcbiAgICBpZiAoaW5kZXggPCAwICYmIHRoaXMuYWN0aXZlSW5kZXggPT09IDApIHtcbiAgICAgIC8vIOesrOS4gOS4quWNoeeJh+WQkeWJjeWIh+aNolxuICAgICAgdGhpcy5hY3RpdmVJbmRleCA9IHRoaXMuaXRlbUNvdW50IC0gMTtcbiAgICAgIGNvbnN0IHRhcmdldEVsID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2QtY2Fyb3VzZWwtaXRlbScpW3RoaXMuYWN0aXZlSW5kZXhdO1xuICAgICAgdGhpcy5hZGp1c3RQb3NpdGlvbih0YXJnZXRFbCwgdHJ1ZSk7XG4gICAgICB0aGlzLnRyYW5zbGF0ZVBvc2l0aW9uKC0xKTtcbiAgICAgIHRoaXMuYWRqdXN0VHJhbnNpdGlvbih0YXJnZXRFbCk7XG4gICAgfSBlbHNlIGlmIChpbmRleCA+PSB0aGlzLml0ZW1Db3VudCAmJiB0aGlzLmFjdGl2ZUluZGV4ID09PSB0aGlzLml0ZW1Db3VudCAtIDEpIHtcbiAgICAgIC8vIOacgOWQjuS4gOS4quWNoeeJh+WQkeWQjuWIh+aNolxuICAgICAgdGhpcy5hY3RpdmVJbmRleCA9IDA7XG4gICAgICBjb25zdCB0YXJnZXRFbCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdkLWNhcm91c2VsLWl0ZW0nKVt0aGlzLmFjdGl2ZUluZGV4XTtcbiAgICAgIHRoaXMuYWRqdXN0UG9zaXRpb24odGFyZ2V0RWwsIGZhbHNlKTtcbiAgICAgIHRoaXMudHJhbnNsYXRlUG9zaXRpb24odGhpcy5pdGVtQ291bnQpO1xuICAgICAgdGhpcy5hZGp1c3RUcmFuc2l0aW9uKHRhcmdldEVsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5hY3RpdmVJbmRleCA9IGluZGV4IDwgMCA/IDAgOiBpbmRleCA+IHRoaXMuaXRlbUNvdW50IC0gMSA/IHRoaXMuaXRlbUNvdW50IC0gMSA6IGluZGV4O1xuICAgICAgdGhpcy50cmFuc2xhdGVQb3NpdGlvbih0aGlzLmFjdGl2ZUluZGV4KTtcbiAgICB9XG4gICAgdGhpcy5hY3RpdmVJbmRleENoYW5nZS5lbWl0KHRoaXMuYWN0aXZlSW5kZXgpO1xuICAgIHRoaXMuY3VycmVudEluZGV4ID0gdGhpcy5hY3RpdmVJbmRleDtcbiAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgdGhpcy5hdXRvU2NoZWR1bGVUcmFuc2l0aW9uKCk7XG4gIH1cblxuICAvLyDmjIfnpLrlmajop6blj5HliIfmjaLlh73mlbBcbiAgc3dpdGNoU3RlcChpbmRleCwgdHlwZSkge1xuICAgIGlmICh0eXBlID09PSB0aGlzLmRvdFRyaWdnZXIpIHtcbiAgICAgIHRoaXMuZ29UbyhpbmRleCk7XG4gICAgfVxuICB9XG5cbiAgLy8g6LCD5pW06aaW5bC+57+76aG15ZCO55qE5Yqo55S7XG4gIHByaXZhdGUgYWRqdXN0VHJhbnNpdGlvbih0YXJnZXRFbCkge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVTdHlsZSh0aGlzLml0ZW1Db250YWluZXIsICd0cmFuc2l0aW9uJyk7XG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZVN0eWxlKHRhcmdldEVsLCAndHJhbnNmb3JtJyk7XG4gICAgICB0aGlzLnRyYW5zbGF0ZVBvc2l0aW9uKHRoaXMuYWN0aXZlSW5kZXgpO1xuICAgIH0sIHRoaXMudHJhbnNpdGlvblNwZWVkKTtcbiAgfVxuXG4gIC8vIOiwg+aVtOmmluWwvue/u+WKqOaXtueahOS9jee9rlxuICBwcml2YXRlIGFkanVzdFBvc2l0aW9uKHRhcmdldEVsLCBmaXJzdFRvTGFzdDogYm9vbGVhbikge1xuICAgIGNvbnN0IHdyYXBwZXJSZWN0ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kZXZ1aS1jYXJvdXNlbC1pdGVtLXdyYXBwZXInKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRhcmdldEVsLCAndHJhbnNmb3JtJywgYHRyYW5zbGF0ZVgoJHsoZmlyc3RUb0xhc3QgPyAtdGhpcy5pdGVtQ291bnQgOiB0aGlzLml0ZW1Db3VudCkgKiB3cmFwcGVyUmVjdC53aWR0aH1weClgKTtcbiAgfVxuXG4gIC8vIOe/u+mhteS9jeenu1xuICBwcml2YXRlIHRyYW5zbGF0ZVBvc2l0aW9uKHNpemU6IG51bWJlcikge1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5pdGVtQ29udGFpbmVyLCAnbGVmdCcsIGAkey1zaXplICogMTAwfSVgKTtcbiAgfVxuXG4gIC8vIOWIneWni+WMlmNvbnRhaW5lcueahOWuveW6plxuICBwcml2YXRlIGluaXRDYXJvdXNlbFdpZHRoKCkge1xuICAgIHRoaXMuaXRlbUNvdW50ID0gdGhpcy5pdGVtcy5sZW5ndGg7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLml0ZW1Db250YWluZXIsICd3aWR0aCcsIGAke3RoaXMuaXRlbUNvdW50ICogMTAwfSVgKTtcbiAgfVxuXG4gIC8vIOiHquWKqOi9ruaSreiwg+W6puS7u+WKoVxuICBwcml2YXRlIGF1dG9TY2hlZHVsZVRyYW5zaXRpb24oKSB7XG4gICAgdGhpcy5jbGVhclNjaGVkdWxlZFRyYW5zaXRpb24oKTtcbiAgICBpZiAodGhpcy5hdXRvcGxheSAmJiB0aGlzLmF1dG9wbGF5U3BlZWQpIHtcbiAgICAgIHRoaXMuc2NoZWR1bGVkSWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5uZXh0KCk7XG4gICAgICB9LCB0aGlzLmF1dG9wbGF5U3BlZWQpO1xuICAgIH1cbiAgfVxuXG4gIC8vIOa4hemZpOiHquWKqOi9ruaSreS7u+WKoVxuICBwcml2YXRlIGNsZWFyU2NoZWR1bGVkVHJhbnNpdGlvbigpIHtcbiAgICBpZiAodGhpcy5zY2hlZHVsZWRJZCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc2NoZWR1bGVkSWQpO1xuICAgICAgdGhpcy5zY2hlZHVsZWRJZCA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgIHRoaXMuaW5pdENhcm91c2VsV2lkdGgoKTtcbiAgICB0aGlzLnRyYW5zbGF0ZVBvc2l0aW9uKHRoaXMuYWN0aXZlSW5kZXgpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5pdGVtQ29udGFpbmVyLCAndHJhbnNpdGlvbicsIGBsZWZ0ICR7dGhpcy50cmFuc2l0aW9uU3BlZWR9bXMgZWFzZWApO1xuICAgIC8vIGNvbnRlbnRDaGlsZHJlbiDlj5jljJbml7bvvIzop6blj5Hph43mlrDorr7nva5wYW5lXG4gICAgdGhpcy5pdGVtcy5jaGFuZ2VzLnN1YnNjcmliZSgoaXRlbXMpID0+IHtcbiAgICAgIGlmIChpdGVtcy5sZW5ndGggIT09IHRoaXMuaXRlbUNvdW50KSB7XG4gICAgICAgIHRoaXMuYWN0aXZlSW5kZXggPSAwO1xuICAgICAgICB0aGlzLmluaXRDYXJvdXNlbFdpZHRoKCk7XG4gICAgICAgIHRoaXMudHJhbnNsYXRlUG9zaXRpb24odGhpcy5hY3RpdmVJbmRleCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICAvLyDnu4Tku7bplIDmr4Hml7bmuIXnkIbmjonlvZPliY3nmoTlrprml7bku7vliqFcbiAgICB0aGlzLmNsZWFyU2NoZWR1bGVkVHJhbnNpdGlvbigpO1xuICB9XG59XG4iLCI8ZGl2XG4gIGNsYXNzPVwiZGV2dWktY2Fyb3VzZWwtY29udGFpbmVyXCJcbiAgW3N0eWxlLmhlaWdodF09XCJoZWlnaHRcIlxuICAobW91c2VlbnRlcik9XCJhcnJvd01vdXNlRXZlbnQoJ2VudGVyJylcIlxuICAobW91c2VsZWF2ZSk9XCJhcnJvd01vdXNlRXZlbnQoJ2xlYXZlJylcIlxuPlxuICA8IS0tIGNhcm91c2VsIGFycm93IC0tPlxuICA8ZGl2IGNsYXNzPVwiZGV2dWktY2Fyb3VzZWwtYXJyb3dcIiAqbmdJZj1cImFycm93VHJpZ2dlciAhPT0gJ25ldmVyJyAmJiBzaG93QXJyb3dcIj5cbiAgICA8YnV0dG9uIGNsYXNzPVwiYXJyb3ctbGVmdFwiIChjbGljayk9XCJwcmV2KClcIj5cbiAgICAgIDxzdmcgd2lkdGg9XCIxOHB4XCIgaGVpZ2h0PVwiMThweFwiIHZpZXdCb3g9XCIwIDAgMTYgMTZcIiB2ZXJzaW9uPVwiMS4xXCI+XG4gICAgICAgIDxnIHN0cm9rZT1cIm5vbmVcIiBzdHJva2Utd2lkdGg9XCIxXCIgZmlsbD1cIm5vbmVcIiBmaWxsLXJ1bGU9XCJldmVub2RkXCI+XG4gICAgICAgICAgPHBvbHlnb25cbiAgICAgICAgICAgIGZpbGw9XCIjMjkzMDQwXCJcbiAgICAgICAgICAgIGZpbGwtcnVsZT1cIm5vbnplcm9cIlxuICAgICAgICAgICAgcG9pbnRzPVwiMTAuNzA3MTA2OCAxMi4yOTI4OTMyIDkuMjkyODkzMjIgMTMuNzA3MTA2OCAzLjU4NTc4NjQ0IDggOS4yOTI4OTMyMiAyLjI5Mjg5MzIyIDEwLjcwNzEwNjggMy43MDcxMDY3OCA2LjQxNDIxMzU2IDhcIlxuICAgICAgICAgID48L3BvbHlnb24+XG4gICAgICAgIDwvZz5cbiAgICAgIDwvc3ZnPlxuICAgIDwvYnV0dG9uPlxuICAgIDxidXR0b24gY2xhc3M9XCJhcnJvdy1yaWdodFwiIChjbGljayk9XCJuZXh0KClcIj5cbiAgICAgIDxzdmcgd2lkdGg9XCIxOHB4XCIgaGVpZ2h0PVwiMThweFwiIHZpZXdCb3g9XCIwIDAgMTYgMTZcIiB2ZXJzaW9uPVwiMS4xXCI+XG4gICAgICAgIDxnIHN0cm9rZT1cIm5vbmVcIiBzdHJva2Utd2lkdGg9XCIxXCIgZmlsbD1cIm5vbmVcIiBmaWxsLXJ1bGU9XCJldmVub2RkXCI+XG4gICAgICAgICAgPHBvbHlnb25cbiAgICAgICAgICAgIGZpbGw9XCIjMjkzMDQwXCJcbiAgICAgICAgICAgIGZpbGwtcnVsZT1cIm5vbnplcm9cIlxuICAgICAgICAgICAgdHJhbnNmb3JtPVwidHJhbnNsYXRlKDguMTQ2NDQ3LCA4LjAwMDAwMCkgc2NhbGUoLTEsIDEpIHRyYW5zbGF0ZSgtOC4xNDY0NDcsIC04LjAwMDAwMCkgXCJcbiAgICAgICAgICAgIHBvaW50cz1cIjExLjcwNzEwNjggMTIuMjkyODkzMiAxMC4yOTI4OTMyIDEzLjcwNzEwNjggNC41ODU3ODY0NCA4IDEwLjI5Mjg5MzIgMi4yOTI4OTMyMiAxMS43MDcxMDY4IDMuNzA3MTA2NzggNy40MTQyMTM1NiA4XCJcbiAgICAgICAgICA+PC9wb2x5Z29uPlxuICAgICAgICA8L2c+XG4gICAgICA8L3N2Zz5cbiAgICA8L2J1dHRvbj5cbiAgPC9kaXY+XG4gIDwhLS0gY2Fyb3VzZWwgaXRlbXMgLS0+XG4gIDxkaXYgY2xhc3M9XCJkZXZ1aS1jYXJvdXNlbC1pdGVtLXdyYXBwZXJcIj5cbiAgICA8ZGl2IGNsYXNzPVwiZGV2dWktY2Fyb3VzZWwtaXRlbS1jb250YWluZXJcIj5cbiAgICAgIDxuZy1jb250ZW50IHNlbGVjdD1cImQtY2Fyb3VzZWwtaXRlbVwiPjwvbmctY29udGVudD5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG4gIDwhLS0gY2Fyb3VzZWwgZG90cyAtLT5cbiAgPHVsIGNsYXNzPVwiZGV2dWktY2Fyb3VzZWwtZG90cyB7eyBkb3RQb3NpdGlvbiB9fVwiICpuZ0lmPVwiaXRlbXM/Lmxlbmd0aCA+IDEgJiYgc2hvd0RvdHNcIj5cbiAgICA8bGlcbiAgICAgIGNsYXNzPVwiZG90LWl0ZW1cIlxuICAgICAgKGNsaWNrKT1cInN3aXRjaFN0ZXAoaW5kZXgsICdjbGljaycpXCJcbiAgICAgIChtb3VzZWVudGVyKT1cInN3aXRjaFN0ZXAoaW5kZXgsICdob3ZlcicpXCJcbiAgICAgIFtuZ0NsYXNzXT1cInsgYWN0aXZlOiBhY3RpdmVJbmRleCA9PT0gaW5kZXggfVwiXG4gICAgICAqbmdGb3I9XCJsZXQgaXRlbSBvZiBpdGVtczsgbGV0IGluZGV4ID0gaW5kZXhcIlxuICAgID48L2xpPlxuICA8L3VsPlxuPC9kaXY+XG4iXX0=