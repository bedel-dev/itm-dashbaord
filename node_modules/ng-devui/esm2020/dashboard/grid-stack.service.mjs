import { Injectable, isDevMode } from '@angular/core';
import { GridStackDDI, Utils } from 'gridstack';
import 'gridstack/dist/h5/gridstack-dd-native';
import * as i0 from "@angular/core";
export class GridStackService {
    constructor() {
        this._itemRemoving = (el, remove) => {
            const node = el ? el.gridstackNode : undefined;
            if (!node || !node.grid) {
                return;
            }
            remove ? node['_isAboutToRemove'] = true : delete node['_isAboutToRemove'];
            remove ? el.classList.add('grid-stack-item-removing') : el.classList.remove('grid-stack-item-removing');
        };
    }
    getDD() {
        return GridStackDDI.get();
    }
    static cleanDragIn(el) {
        if (el.classList.contains('ui-draggable')) {
            GridStackDDI.get().draggable(el, 'destroy');
        }
    }
    static isDraggable(el) {
        return Boolean(el.classList.contains('ui-draggable'));
    }
    static isDroppable(el) {
        return Boolean(el.classList.contains('ui-droppable'));
    }
    static enableDrag(el) {
        if (!GridStackService.isDraggable(el)) {
            return;
        }
        GridStackDDI.get().draggable(el, 'enable');
    }
    static disableDrag(el) {
        if (!GridStackService.isDraggable(el)) {
            return;
        }
        GridStackDDI.get().draggable(el, 'disable');
    }
    static enableDrop(el) {
        if (!GridStackService.isDroppable(el)) {
            return;
        }
        GridStackDDI.get().droppable(el, 'enable');
    }
    static disableDrop(el) {
        if (!GridStackService.isDroppable(el)) {
            return;
        }
        GridStackDDI.get().droppable(el, 'disable');
    }
    resetAcceptWidget(dashboard) {
        if (!this.gridStack) {
            if (isDevMode()) {
                console.warn('call resetAcceptWidget after gridStack init');
            }
            return;
        }
        if (this.gridStack.opts.staticGrid || !this.gridStack.opts.acceptWidgets) {
            return;
        }
        if (!this.getDD().isDroppable(this.gridStack.el)) {
            const that = this.gridStack;
            this.getDD().droppable(that.el, {
                accept: (el) => {
                    const node = el.gridstackNode;
                    // set accept drop to true on ourself (which we ignore) so we don't get "can't drop" icon in HTML5 mode while moving
                    if (node && node.grid === that) {
                        return true;
                    }
                    if (!that.opts.acceptWidgets) {
                        return false;
                    }
                    // check for accept method or class matching
                    let canAccept = true;
                    if (typeof that.opts.acceptWidgets === 'function') {
                        canAccept = that.opts.acceptWidgets(el);
                    }
                    else {
                        const selector = (that.opts.acceptWidgets === true ? '.grid-stack-item' : that.opts.acceptWidgets);
                        canAccept = el.matches(selector);
                    }
                    // finally check to make sure we actually have space left #1571
                    if (canAccept && node && that.opts.maxRow) {
                        const n = { w: node.w, h: node.h, minW: node.minW, minH: node.minH }; // only width/height matters and autoPosition
                        canAccept = that.engine.willItFit(n);
                    }
                    return canAccept;
                },
            });
        }
        this.getDD()
            .off(this.gridStack.el, 'dropout')
            .on(this.gridStack.el, 'dropout', (event, el, helper) => {
            // 覆盖这个方法是因为 float模式下 dropout影响了原来的布局
            const that = this.gridStack;
            const node = el.gridstackNode;
            if (!node.grid || node.grid === that) {
                that['_leave'](el, helper);
            }
            this.fixFloat(that, node); // 增加了float模式下的恢复
            this.getDD().off(el, 'drag');
            return false;
        })
            .off(this.gridStack.el, 'drop')
            .on(this.gridStack.el, 'drop', (event, el, helper) => {
            // 覆盖这个方法是因为 drop的情况不想让它放进去而是只发射通知
            const that = this.gridStack;
            const node = el.gridstackNode;
            if (node && node.grid === that && !node['_isExternal']) {
                return false;
            }
            const wasAdded = !!that['placeholder'].parentElement;
            that['placeholder'].remove();
            const origNode = el['_gridstackNodeOrig'];
            delete el['_gridstackNodeOrig'];
            if (!node) {
                return false;
            }
            if (wasAdded) {
                that.engine.cleanupNode(node); // 好像没用
                node.grid = that;
            }
            if (helper !== el) {
                helper.remove();
                el.gridstackNode = origNode; // original item (left behind) is re-stored to pre dragging as the node now has drop info
            }
            else {
                Utils.removePositioningStyles(el);
            }
            this.getDD().off(el, 'drag');
            that.engine.removeNode(node);
            this.fixFloat(that, node);
            that['_updateContainerHeight']();
            dashboard.handleDragInNode(node, origNode, this.dragInWidget);
        });
    }
    resetRemoveDrop(dashboard) {
        if (!this.gridStack) {
            if (isDevMode()) {
                console.warn('call resetDragDrop after gridStack init');
            }
            return;
        }
        if (!(!this.gridStack.opts.staticGrid && typeof this.gridStack.opts.removable === 'string')) {
            return;
        }
        const trashZone = document.querySelector(this.gridStack.opts.removable);
        if (!trashZone) {
            return;
        }
        if (this.getDD().isDroppable(trashZone)) {
            // 清理掉了dropover和dropout 直接重新绑定对应的逻辑
            this.getDD().off(trashZone, 'dropover').off(trashZone, 'dropout');
        }
    }
    fixFloat(gridstack, node) {
        if (gridstack.getFloat()) {
            gridstack.engine.batchUpdate();
            gridstack.engine.nodes
                .filter((n) => n !== node)
                .reverse()
                .forEach((n) => {
                if (n['_origX'] !== undefined || n['_origY'] !== undefined) {
                    n.x = n['_origX'] !== undefined ? n['_origX'] : n.x;
                    n.y = n['_origY'] !== undefined ? n['_orig&'] : n.y;
                    gridstack.engine.moveNode(n, { x: n.x, y: n.y });
                    gridstack['_writeAttrs'](n.el, n.x, n.y);
                }
            });
            gridstack.engine.commit();
        }
    }
    /* 设置新的可拖入的widget */
    setupDragIn(el, widget, helper, notify) {
        this.getDD().dragIn(el, {
            ...widget.targetDashboard.finalOption.dragInOptions,
            ...{ helper: helper || widget.targetDashboard.finalOption.dragInOptions.helper, handle: this.gridStack.opts.handle },
            ...{
                start: () => {
                    this.dragInWidget = widget;
                    if (notify) {
                        notify('dragStart')();
                    }
                },
                stop: () => {
                    this.dragInWidget = undefined;
                    if (notify) {
                        notify('dragStop')();
                    }
                },
            },
        });
    }
    destroyDragIn(el) {
        this.getDD().draggable(el, 'destroy');
    }
    /* 设置自定义的回收站 */
    setupRemoveDropArea(trashZone, dashboard, trash) {
        if (!this.gridStack) {
            if (isDevMode()) {
                console.warn('call setupRemoveDropArea after gridStack init');
            }
            return;
        }
        const trashEl = trashZone;
        this.getDD().droppable(trashEl, this.gridStack.opts.removableOptions)
            .on(trashEl, 'dropover', (event, el) => this._itemRemoving(el, true))
            .on(trashEl, 'dropout', (event, el) => this._itemRemoving(el, false));
    }
    /* 清理自定义的回收站 */
    destroyRemoveDropAreas(trashZone) {
        if (!this.gridStack) {
            console.warn('call destroyRemoveDropAreas after gridStack init');
            return;
        }
        const that = this.gridStack;
        if (!this.getDD().isDroppable(trashZone)) {
            return;
        }
        this.getDD().off(trashZone, 'dropover').off(trashZone, 'dropout').off(trashZone, 'drop');
    }
    // 设置背景
    updateBackgroundGridBlock() {
        if (this.gridStack) {
            if (!this.lastStyleSheet) {
                this.lastStyleSheet = Utils.createStylesheet('d-dashboard-' + this.gridStack.opts['_styleSheetClass'], this.gridStack.el.parentElement);
            }
            else {
                this.lastStyleSheet.removeRule(0);
            }
            const column = this.gridStack.opts.column;
            const margin = this.gridStack.opts.margin;
            const marginUnit = this.gridStack.opts.marginUnit;
            const cellHeight = this.gridStack.opts.cellHeight;
            const cellHeightUnit = this.gridStack.opts.cellHeightUnit;
            const prefix = `.${this.gridStack.opts['_styleSheetClass']}`;
            if (!this.lastStyleSheet) {
                return;
            }
            Utils.addCSSRule(this.lastStyleSheet, `${prefix}.d-dashboard-show-grid-block::before`, `
      background-image:
        linear-gradient(#fff 0, #fff ${margin * 2}${marginUnit},
          transparent ${margin * 2}${marginUnit}, transparent 100%),
        linear-gradient(90deg, #fff 0, #fff ${margin * 2}${marginUnit},
          transparent ${margin * 2}${marginUnit}, transparent 100%),
        linear-gradient(#f8f8f8 0 , #f8f8f8 100%);
      background-image:
        linear-gradient(var(--devui-base-bg, #fff) 0, var(--devui-base-bg, #fff) ${margin * 2}${marginUnit},
          transparent ${margin * 2}${marginUnit}, transparent 100%),
        linear-gradient(90deg, var(--devui-base-bg, #fff) 0, var(--devui-base-bg, #fff) ${margin * 2}${marginUnit},
          transparent ${margin * 2}${marginUnit}, transparent 100%),
        linear-gradient(var(--devui-area, #f8f8f8) 0 , var(--devui-area, #f8f8f8) 100%);
      background-size: ${100 / column}% ${cellHeight}${cellHeightUnit};
      background-position: -${margin}${marginUnit} -${margin}${marginUnit};
      `);
            this.lastColumn = column;
        }
    }
    setBackgroundGridBlockIfColumnChange() {
        if (this.gridStack?.opts?.column !== this.lastColumn) {
            this.updateBackgroundGridBlock();
        }
    }
    removeBackgroundGridBlockStyleSheet() {
        if (this.lastStyleSheet) {
            Utils.removeStylesheet('d-dashboard-' + this.gridStack.opts['_class']);
        }
    }
}
GridStackService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: GridStackService, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
GridStackService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: GridStackService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: GridStackService, decorators: [{
            type: Injectable
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC1zdGFjay5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vZGV2dWkvZGFzaGJvYXJkL2dyaWQtc3RhY2suc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN0RCxPQUFPLEVBQWtDLFlBQVksRUFBaUIsS0FBSyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQy9GLE9BQU8sdUNBQXVDLENBQUM7O0FBTS9DLE1BQU0sT0FBTyxnQkFBZ0I7SUFEN0I7UUE4Q0Usa0JBQWEsR0FBRyxDQUFDLEVBQXVCLEVBQUUsTUFBZSxFQUFFLEVBQUU7WUFDM0QsTUFBTSxJQUFJLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFDL0MsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUU7Z0JBQUUsT0FBTzthQUFFO1lBQ3BDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1lBQzNFLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUMxRyxDQUFDLENBQUM7S0E0T0g7SUF4UkMsS0FBSztRQUNILE9BQVEsWUFBWSxDQUFDLEdBQUcsRUFBd0IsQ0FBQztJQUNuRCxDQUFDO0lBRUQsTUFBTSxDQUFDLFdBQVcsQ0FBQyxFQUFlO1FBQ2hDLElBQUksRUFBRSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLEVBQUU7WUFD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L2NvcmUnO1xuaW1wb3J0IHsgR3JpZEl0ZW1IVE1MRWxlbWVudCwgR3JpZFN0YWNrLCBHcmlkU3RhY2tEREksIEdyaWRTdGFja05vZGUsIFV0aWxzIH0gZnJvbSAnZ3JpZHN0YWNrJztcbmltcG9ydCAnZ3JpZHN0YWNrL2Rpc3QvaDUvZ3JpZHN0YWNrLWRkLW5hdGl2ZSc7XG5pbXBvcnQgeyBHcmlkU3RhY2tERE5hdGl2ZSB9IGZyb20gJ2dyaWRzdGFjay9kaXN0L2g1L2dyaWRzdGFjay1kZC1uYXRpdmUnO1xuaW1wb3J0IHsgRGFzaGJvYXJkQ29tcG9uZW50IH0gZnJvbSAnLi9kYXNoYm9hcmQuY29tcG9uZW50JztcbmltcG9ydCB7IERhc2hib2FyZExpYnJhcnlUcmFzaERpcmVjdGl2ZSB9IGZyb20gJy4vd2lkZ2V0LWxpYnJhcnkvbGlicmFyeS10cmFzaC5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgRGFzaGJvYXJkTGlicmFyeVdpZGdldERpcmVjdGl2ZSB9IGZyb20gJy4vd2lkZ2V0LWxpYnJhcnkvbGlicmFyeS13aWRnZXQuZGlyZWN0aXZlJztcbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBHcmlkU3RhY2tTZXJ2aWNlIHtcbiAgZ3JpZFN0YWNrOiBHcmlkU3RhY2s7XG4gIGRyYWdJbldpZGdldDogRGFzaGJvYXJkTGlicmFyeVdpZGdldERpcmVjdGl2ZTtcbiAgbGFzdENvbHVtbjogbnVtYmVyO1xuICBsYXN0U3R5bGVTaGVldDogQ1NTU3R5bGVTaGVldDtcblxuICBnZXRERCgpIHtcbiAgICByZXR1cm4gKEdyaWRTdGFja0RESS5nZXQoKSBhcyBHcmlkU3RhY2tERE5hdGl2ZSk7XG4gIH1cblxuICBzdGF0aWMgY2xlYW5EcmFnSW4oZWw6IEhUTUxFbGVtZW50KSB7XG4gICAgaWYgKGVsLmNsYXNzTGlzdC5jb250YWlucygndWktZHJhZ2dhYmxlJykpIHtcbiAgICAgIChHcmlkU3RhY2tEREkuZ2V0KCkgYXMgR3JpZFN0YWNrREROYXRpdmUpLmRyYWdnYWJsZShlbCwgJ2Rlc3Ryb3knKTtcbiAgICB9XG4gIH1cbiAgc3RhdGljIGlzRHJhZ2dhYmxlKGVsOiBIVE1MRWxlbWVudCkge1xuICAgIHJldHVybiBCb29sZWFuKGVsLmNsYXNzTGlzdC5jb250YWlucygndWktZHJhZ2dhYmxlJykpO1xuICB9XG4gIHN0YXRpYyBpc0Ryb3BwYWJsZShlbDogSFRNTEVsZW1lbnQpIHtcbiAgICByZXR1cm4gQm9vbGVhbihlbC5jbGFzc0xpc3QuY29udGFpbnMoJ3VpLWRyb3BwYWJsZScpKTtcbiAgfVxuICBzdGF0aWMgZW5hYmxlRHJhZyhlbDogSFRNTEVsZW1lbnQpIHtcbiAgICBpZiAoIUdyaWRTdGFja1NlcnZpY2UuaXNEcmFnZ2FibGUoZWwpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIChHcmlkU3RhY2tEREkuZ2V0KCkgYXMgR3JpZFN0YWNrREROYXRpdmUpLmRyYWdnYWJsZShlbCwgJ2VuYWJsZScpO1xuICB9XG4gIHN0YXRpYyBkaXNhYmxlRHJhZyhlbDogSFRNTEVsZW1lbnQpIHtcbiAgICBpZiAoIUdyaWRTdGFja1NlcnZpY2UuaXNEcmFnZ2FibGUoZWwpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIChHcmlkU3RhY2tEREkuZ2V0KCkgYXMgR3JpZFN0YWNrREROYXRpdmUpLmRyYWdnYWJsZShlbCwgJ2Rpc2FibGUnKTtcbiAgfVxuICBzdGF0aWMgZW5hYmxlRHJvcChlbDogSFRNTEVsZW1lbnQpIHtcbiAgICBpZiAoIUdyaWRTdGFja1NlcnZpY2UuaXNEcm9wcGFibGUoZWwpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIChHcmlkU3RhY2tEREkuZ2V0KCkgYXMgR3JpZFN0YWNrREROYXRpdmUpLmRyb3BwYWJsZShlbCwgJ2VuYWJsZScpO1xuICB9XG4gIHN0YXRpYyBkaXNhYmxlRHJvcChlbDogSFRNTEVsZW1lbnQpIHtcbiAgICBpZiAoIUdyaWRTdGFja1NlcnZpY2UuaXNEcm9wcGFibGUoZWwpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIChHcmlkU3RhY2tEREkuZ2V0KCkgYXMgR3JpZFN0YWNrREROYXRpdmUpLmRyb3BwYWJsZShlbCwgJ2Rpc2FibGUnKTtcbiAgfVxuICBfaXRlbVJlbW92aW5nID0gKGVsOiBHcmlkSXRlbUhUTUxFbGVtZW50LCByZW1vdmU6IGJvb2xlYW4pID0+IHtcbiAgICBjb25zdCBub2RlID0gZWwgPyBlbC5ncmlkc3RhY2tOb2RlIDogdW5kZWZpbmVkO1xuICAgIGlmICghbm9kZSB8fCAhbm9kZS5ncmlkKSB7IHJldHVybjsgfVxuICAgIHJlbW92ZSA/IG5vZGVbJ19pc0Fib3V0VG9SZW1vdmUnXSA9IHRydWUgOiBkZWxldGUgbm9kZVsnX2lzQWJvdXRUb1JlbW92ZSddO1xuICAgIHJlbW92ZSA/IGVsLmNsYXNzTGlzdC5hZGQoJ2dyaWQtc3RhY2staXRlbS1yZW1vdmluZycpIDogZWwuY2xhc3NMaXN0LnJlbW92ZSgnZ3JpZC1zdGFjay1pdGVtLXJlbW92aW5nJyk7XG4gIH07XG4gIHJlc2V0QWNjZXB0V2lkZ2V0KGRhc2hib2FyZDogRGFzaGJvYXJkQ29tcG9uZW50KSB7XG4gICAgaWYgKCF0aGlzLmdyaWRTdGFjaykge1xuICAgICAgaWYgKGlzRGV2TW9kZSgpKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignY2FsbCByZXNldEFjY2VwdFdpZGdldCBhZnRlciBncmlkU3RhY2sgaW5pdCcpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy5ncmlkU3RhY2sub3B0cy5zdGF0aWNHcmlkIHx8ICF0aGlzLmdyaWRTdGFjay5vcHRzLmFjY2VwdFdpZGdldHMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCF0aGlzLmdldEREKCkuaXNEcm9wcGFibGUodGhpcy5ncmlkU3RhY2suZWwpKSB7XG4gICAgICBjb25zdCB0aGF0ID0gdGhpcy5ncmlkU3RhY2s7XG4gICAgICB0aGlzLmdldEREKCkuZHJvcHBhYmxlKHRoYXQuZWwsIHtcbiAgICAgICAgYWNjZXB0OiAoZWw6IEdyaWRJdGVtSFRNTEVsZW1lbnQpID0+IHtcbiAgICAgICAgICBjb25zdCBub2RlOiBHcmlkU3RhY2tOb2RlID0gZWwuZ3JpZHN0YWNrTm9kZTtcbiAgICAgICAgICAvLyBzZXQgYWNjZXB0IGRyb3AgdG8gdHJ1ZSBvbiBvdXJzZWxmICh3aGljaCB3ZSBpZ25vcmUpIHNvIHdlIGRvbid0IGdldCBcImNhbid0IGRyb3BcIiBpY29uIGluIEhUTUw1IG1vZGUgd2hpbGUgbW92aW5nXG4gICAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5ncmlkID09PSB0aGF0KSB7IHJldHVybiB0cnVlOyB9XG4gICAgICAgICAgaWYgKCF0aGF0Lm9wdHMuYWNjZXB0V2lkZ2V0cykgeyByZXR1cm4gZmFsc2U7IH1cbiAgICAgICAgICAvLyBjaGVjayBmb3IgYWNjZXB0IG1ldGhvZCBvciBjbGFzcyBtYXRjaGluZ1xuICAgICAgICAgIGxldCBjYW5BY2NlcHQgPSB0cnVlO1xuICAgICAgICAgIGlmICh0eXBlb2YgdGhhdC5vcHRzLmFjY2VwdFdpZGdldHMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGNhbkFjY2VwdCA9IHRoYXQub3B0cy5hY2NlcHRXaWRnZXRzKGVsKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0b3IgPSAodGhhdC5vcHRzLmFjY2VwdFdpZGdldHMgPT09IHRydWUgPyAnLmdyaWQtc3RhY2staXRlbScgOiB0aGF0Lm9wdHMuYWNjZXB0V2lkZ2V0cyBhcyBzdHJpbmcpO1xuICAgICAgICAgICAgY2FuQWNjZXB0ID0gZWwubWF0Y2hlcyhzZWxlY3Rvcik7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIGZpbmFsbHkgY2hlY2sgdG8gbWFrZSBzdXJlIHdlIGFjdHVhbGx5IGhhdmUgc3BhY2UgbGVmdCAjMTU3MVxuICAgICAgICAgIGlmIChjYW5BY2NlcHQgJiYgbm9kZSAmJiB0aGF0Lm9wdHMubWF4Um93KSB7XG4gICAgICAgICAgICBjb25zdCBuID0geyB3OiBub2RlLncsIGg6IG5vZGUuaCwgbWluVzogbm9kZS5taW5XLCBtaW5IOiBub2RlLm1pbkggfTsgLy8gb25seSB3aWR0aC9oZWlnaHQgbWF0dGVycyBhbmQgYXV0b1Bvc2l0aW9uXG4gICAgICAgICAgICBjYW5BY2NlcHQgPSB0aGF0LmVuZ2luZS53aWxsSXRGaXQobik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBjYW5BY2NlcHQ7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG4gICAgdGhpcy5nZXRERCgpXG4gICAgICAub2ZmKHRoaXMuZ3JpZFN0YWNrLmVsLCAnZHJvcG91dCcpXG4gICAgICAub24odGhpcy5ncmlkU3RhY2suZWwsICdkcm9wb3V0JywgKGV2ZW50LCBlbDogR3JpZEl0ZW1IVE1MRWxlbWVudCwgaGVscGVyKSA9PiB7XG4gICAgICAgIC8vIOimhueblui/meS4quaWueazleaYr+WboOS4uiBmbG9hdOaooeW8j+S4iyBkcm9wb3V05b2x5ZON5LqG5Y6f5p2l55qE5biD5bGAXG4gICAgICAgIGNvbnN0IHRoYXQgPSB0aGlzLmdyaWRTdGFjaztcbiAgICAgICAgY29uc3Qgbm9kZSA9IGVsLmdyaWRzdGFja05vZGU7XG4gICAgICAgIGlmICghbm9kZS5ncmlkIHx8IG5vZGUuZ3JpZCA9PT0gdGhhdCkge1xuICAgICAgICAgIHRoYXRbJ19sZWF2ZSddKGVsLCBoZWxwZXIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZml4RmxvYXQodGhhdCwgbm9kZSk7IC8vIOWinuWKoOS6hmZsb2F05qih5byP5LiL55qE5oGi5aSNXG4gICAgICAgIHRoaXMuZ2V0REQoKS5vZmYoZWwsICdkcmFnJyk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pXG4gICAgICAub2ZmKHRoaXMuZ3JpZFN0YWNrLmVsLCAnZHJvcCcpXG4gICAgICAub24odGhpcy5ncmlkU3RhY2suZWwsICdkcm9wJywgKGV2ZW50LCBlbDogR3JpZEl0ZW1IVE1MRWxlbWVudCwgaGVscGVyOiBHcmlkSXRlbUhUTUxFbGVtZW50KSA9PiB7XG4gICAgICAgIC8vIOimhueblui/meS4quaWueazleaYr+WboOS4uiBkcm9w55qE5oOF5Ya15LiN5oOz6K6p5a6D5pS+6L+b5Y676ICM5piv5Y+q5Y+R5bCE6YCa55+lXG4gICAgICAgIGNvbnN0IHRoYXQgPSB0aGlzLmdyaWRTdGFjaztcblxuICAgICAgICBjb25zdCBub2RlOiBHcmlkU3RhY2tOb2RlID0gZWwuZ3JpZHN0YWNrTm9kZTtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5ncmlkID09PSB0aGF0ICYmICFub2RlWydfaXNFeHRlcm5hbCddKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIGNvbnN0IHdhc0FkZGVkID0gISF0aGF0WydwbGFjZWhvbGRlciddLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgIHRoYXRbJ3BsYWNlaG9sZGVyJ10ucmVtb3ZlKCk7XG5cbiAgICAgICAgY29uc3Qgb3JpZ05vZGUgPSBlbFsnX2dyaWRzdGFja05vZGVPcmlnJ107XG4gICAgICAgIGRlbGV0ZSBlbFsnX2dyaWRzdGFja05vZGVPcmlnJ107XG5cbiAgICAgICAgaWYgKCFub2RlKSB7IHJldHVybiBmYWxzZTsgfVxuICAgICAgICBpZiAod2FzQWRkZWQpIHtcbiAgICAgICAgICB0aGF0LmVuZ2luZS5jbGVhbnVwTm9kZShub2RlKTsgLy8g5aW95YOP5rKh55SoXG4gICAgICAgICAgbm9kZS5ncmlkID0gdGhhdDtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgaWYgKGhlbHBlciAhPT0gZWwpIHtcbiAgICAgICAgICBoZWxwZXIucmVtb3ZlKCk7XG4gICAgICAgICAgZWwuZ3JpZHN0YWNrTm9kZSA9IG9yaWdOb2RlOyAvLyBvcmlnaW5hbCBpdGVtIChsZWZ0IGJlaGluZCkgaXMgcmUtc3RvcmVkIHRvIHByZSBkcmFnZ2luZyBhcyB0aGUgbm9kZSBub3cgaGFzIGRyb3AgaW5mb1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIFV0aWxzLnJlbW92ZVBvc2l0aW9uaW5nU3R5bGVzKGVsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZ2V0REQoKS5vZmYoZWwsICdkcmFnJyk7XG4gICAgICAgIHRoYXQuZW5naW5lLnJlbW92ZU5vZGUobm9kZSk7XG4gICAgICAgIHRoaXMuZml4RmxvYXQodGhhdCwgbm9kZSk7XG5cbiAgICAgICAgdGhhdFsnX3VwZGF0ZUNvbnRhaW5lckhlaWdodCddKCk7XG5cbiAgICAgICAgZGFzaGJvYXJkLmhhbmRsZURyYWdJbk5vZGUobm9kZSwgb3JpZ05vZGUsIHRoaXMuZHJhZ0luV2lkZ2V0KTtcbiAgICAgIH0pO1xuICB9XG4gIHJlc2V0UmVtb3ZlRHJvcChkYXNoYm9hcmQ6IERhc2hib2FyZENvbXBvbmVudCkge1xuICAgIGlmICghdGhpcy5ncmlkU3RhY2spIHtcbiAgICAgIGlmIChpc0Rldk1vZGUoKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ2NhbGwgcmVzZXREcmFnRHJvcCBhZnRlciBncmlkU3RhY2sgaW5pdCcpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoISghdGhpcy5ncmlkU3RhY2sub3B0cy5zdGF0aWNHcmlkICYmIHR5cGVvZiB0aGlzLmdyaWRTdGFjay5vcHRzLnJlbW92YWJsZSA9PT0gJ3N0cmluZycpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHRyYXNoWm9uZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5ncmlkU3RhY2sub3B0cy5yZW1vdmFibGUpIGFzIEhUTUxFbGVtZW50O1xuICAgIGlmICghdHJhc2hab25lKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLmdldEREKCkuaXNEcm9wcGFibGUodHJhc2hab25lKSkge1xuICAgICAgLy8g5riF55CG5o6J5LqGZHJvcG92ZXLlkoxkcm9wb3V0IOebtOaOpemHjeaWsOe7keWumuWvueW6lOeahOmAu+i+kVxuICAgICAgdGhpcy5nZXRERCgpLm9mZih0cmFzaFpvbmUsICdkcm9wb3ZlcicpLm9mZih0cmFzaFpvbmUsICdkcm9wb3V0Jyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBmaXhGbG9hdChncmlkc3RhY2s6IEdyaWRTdGFjaywgbm9kZTogR3JpZFN0YWNrTm9kZSkge1xuICAgIGlmIChncmlkc3RhY2suZ2V0RmxvYXQoKSkge1xuICAgICAgZ3JpZHN0YWNrLmVuZ2luZS5iYXRjaFVwZGF0ZSgpO1xuICAgICAgZ3JpZHN0YWNrLmVuZ2luZS5ub2Rlc1xuICAgICAgICAuZmlsdGVyKChuKSA9PiBuICE9PSBub2RlKVxuICAgICAgICAucmV2ZXJzZSgpXG4gICAgICAgIC5mb3JFYWNoKChuKSA9PiB7XG4gICAgICAgICAgaWYgKG5bJ19vcmlnWCddICE9PSB1bmRlZmluZWQgfHwgblsnX29yaWdZJ10gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbi54ID0gblsnX29yaWdYJ10gIT09IHVuZGVmaW5lZCA/IG5bJ19vcmlnWCddIDogbi54O1xuICAgICAgICAgICAgbi55ID0gblsnX29yaWdZJ10gIT09IHVuZGVmaW5lZCA/IG5bJ19vcmlnJiddIDogbi55O1xuICAgICAgICAgICAgZ3JpZHN0YWNrLmVuZ2luZS5tb3ZlTm9kZShuLCB7IHg6IG4ueCwgeTogbi55IH0pO1xuICAgICAgICAgICAgZ3JpZHN0YWNrWydfd3JpdGVBdHRycyddKG4uZWwsIG4ueCwgbi55KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgZ3JpZHN0YWNrLmVuZ2luZS5jb21taXQoKTtcbiAgICB9XG4gIH1cbiAgLyog6K6+572u5paw55qE5Y+v5ouW5YWl55qEd2lkZ2V0ICovXG4gIHNldHVwRHJhZ0luKFxuICAgIGVsOiBIVE1MRWxlbWVudCxcbiAgICB3aWRnZXQ6IERhc2hib2FyZExpYnJhcnlXaWRnZXREaXJlY3RpdmUsXG4gICAgaGVscGVyPzogKChldmVudDogYW55KSA9PiBIVE1MRWxlbWVudCkgfCBzdHJpbmcsXG4gICAgbm90aWZ5PzogKGV2ZW50VHlwZTogc3RyaW5nKSA9PiAoLi4uYXJnczogYW55KSA9PiB2b2lkXG4gICkge1xuICAgIHRoaXMuZ2V0REQoKS5kcmFnSW4oZWwsIHtcbiAgICAgIC4uLndpZGdldC50YXJnZXREYXNoYm9hcmQuZmluYWxPcHRpb24uZHJhZ0luT3B0aW9ucyxcbiAgICAgIC4uLnsgaGVscGVyOiBoZWxwZXIgfHwgd2lkZ2V0LnRhcmdldERhc2hib2FyZC5maW5hbE9wdGlvbi5kcmFnSW5PcHRpb25zLmhlbHBlciAsaGFuZGxlOnRoaXMuZ3JpZFN0YWNrLm9wdHMuaGFuZGxlfSxcbiAgICAgIC4uLntcbiAgICAgICAgc3RhcnQ6ICgpID0+IHtcbiAgICAgICAgICB0aGlzLmRyYWdJbldpZGdldCA9IHdpZGdldDtcbiAgICAgICAgICBpZiAobm90aWZ5KSB7XG4gICAgICAgICAgICBub3RpZnkoJ2RyYWdTdGFydCcpKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBzdG9wOiAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5kcmFnSW5XaWRnZXQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgaWYgKG5vdGlmeSkge1xuICAgICAgICAgICAgbm90aWZ5KCdkcmFnU3RvcCcpKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuICBkZXN0cm95RHJhZ0luKGVsOiBIVE1MRWxlbWVudCkge1xuICAgIHRoaXMuZ2V0REQoKS5kcmFnZ2FibGUoZWwsICdkZXN0cm95Jyk7XG4gIH1cblxuICAvKiDorr7nva7oh6rlrprkuYnnmoTlm57mlLbnq5kgKi9cbiAgc2V0dXBSZW1vdmVEcm9wQXJlYSh0cmFzaFpvbmU6IEhUTUxFbGVtZW50LCBkYXNoYm9hcmQ6IERhc2hib2FyZENvbXBvbmVudCwgdHJhc2g/OiBEYXNoYm9hcmRMaWJyYXJ5VHJhc2hEaXJlY3RpdmUpIHtcbiAgICBpZiAoIXRoaXMuZ3JpZFN0YWNrKSB7XG4gICAgICBpZiAoaXNEZXZNb2RlKCkpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdjYWxsIHNldHVwUmVtb3ZlRHJvcEFyZWEgYWZ0ZXIgZ3JpZFN0YWNrIGluaXQnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdHJhc2hFbCA9IHRyYXNoWm9uZTtcbiAgICB0aGlzLmdldEREKCkuZHJvcHBhYmxlKHRyYXNoRWwsIHRoaXMuZ3JpZFN0YWNrLm9wdHMucmVtb3ZhYmxlT3B0aW9ucylcbiAgICAgIC5vbih0cmFzaEVsLCAnZHJvcG92ZXInLCAoZXZlbnQsIGVsKSA9PiB0aGlzLl9pdGVtUmVtb3ZpbmcoZWwsIHRydWUpKVxuICAgICAgLm9uKHRyYXNoRWwsICdkcm9wb3V0JywgKGV2ZW50LCBlbCkgPT4gdGhpcy5faXRlbVJlbW92aW5nKGVsLCBmYWxzZSkpO1xuICB9XG5cbiAgLyog5riF55CG6Ieq5a6a5LmJ55qE5Zue5pS256uZICovXG4gIGRlc3Ryb3lSZW1vdmVEcm9wQXJlYXModHJhc2hab25lOiBIVE1MRWxlbWVudCkge1xuICAgIGlmICghdGhpcy5ncmlkU3RhY2spIHtcbiAgICAgIGNvbnNvbGUud2FybignY2FsbCBkZXN0cm95UmVtb3ZlRHJvcEFyZWFzIGFmdGVyIGdyaWRTdGFjayBpbml0Jyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHRoYXQgPSB0aGlzLmdyaWRTdGFjaztcbiAgICBpZiAoIXRoaXMuZ2V0REQoKS5pc0Ryb3BwYWJsZSh0cmFzaFpvbmUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuZ2V0REQoKS5vZmYodHJhc2hab25lLCAnZHJvcG92ZXInKS5vZmYodHJhc2hab25lLCAnZHJvcG91dCcpLm9mZih0cmFzaFpvbmUsICdkcm9wJyk7XG4gIH1cblxuICAvLyDorr7nva7og4zmma9cbiAgdXBkYXRlQmFja2dyb3VuZEdyaWRCbG9jaygpIHtcbiAgICBpZiAodGhpcy5ncmlkU3RhY2spIHtcbiAgICAgIGlmICghdGhpcy5sYXN0U3R5bGVTaGVldCkge1xuICAgICAgICB0aGlzLmxhc3RTdHlsZVNoZWV0ID0gVXRpbHMuY3JlYXRlU3R5bGVzaGVldChcbiAgICAgICAgICAnZC1kYXNoYm9hcmQtJyArIHRoaXMuZ3JpZFN0YWNrLm9wdHNbJ19zdHlsZVNoZWV0Q2xhc3MnXSxcbiAgICAgICAgICB0aGlzLmdyaWRTdGFjay5lbC5wYXJlbnRFbGVtZW50XG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmxhc3RTdHlsZVNoZWV0LnJlbW92ZVJ1bGUoMCk7XG4gICAgICB9XG4gICAgICBjb25zdCBjb2x1bW4gPSB0aGlzLmdyaWRTdGFjay5vcHRzLmNvbHVtbjtcbiAgICAgIGNvbnN0IG1hcmdpbiA9IHRoaXMuZ3JpZFN0YWNrLm9wdHMubWFyZ2luIGFzIG51bWJlcjtcbiAgICAgIGNvbnN0IG1hcmdpblVuaXQgPSB0aGlzLmdyaWRTdGFjay5vcHRzLm1hcmdpblVuaXQ7XG4gICAgICBjb25zdCBjZWxsSGVpZ2h0ID0gdGhpcy5ncmlkU3RhY2sub3B0cy5jZWxsSGVpZ2h0IGFzIG51bWJlcjtcbiAgICAgIGNvbnN0IGNlbGxIZWlnaHRVbml0ID0gdGhpcy5ncmlkU3RhY2sub3B0cy5jZWxsSGVpZ2h0VW5pdDtcbiAgICAgIGNvbnN0IHByZWZpeCA9IGAuJHt0aGlzLmdyaWRTdGFjay5vcHRzWydfc3R5bGVTaGVldENsYXNzJ119YDtcbiAgICAgIGlmICghdGhpcy5sYXN0U3R5bGVTaGVldCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIFV0aWxzLmFkZENTU1J1bGUoXG4gICAgICAgIHRoaXMubGFzdFN0eWxlU2hlZXQsXG4gICAgICAgIGAke3ByZWZpeH0uZC1kYXNoYm9hcmQtc2hvdy1ncmlkLWJsb2NrOjpiZWZvcmVgLFxuICAgICAgICBgXG4gICAgICBiYWNrZ3JvdW5kLWltYWdlOlxuICAgICAgICBsaW5lYXItZ3JhZGllbnQoI2ZmZiAwLCAjZmZmICR7bWFyZ2luICogMn0ke21hcmdpblVuaXR9LFxuICAgICAgICAgIHRyYW5zcGFyZW50ICR7bWFyZ2luICogMn0ke21hcmdpblVuaXR9LCB0cmFuc3BhcmVudCAxMDAlKSxcbiAgICAgICAgbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZmZmIDAsICNmZmYgJHttYXJnaW4gKiAyfSR7bWFyZ2luVW5pdH0sXG4gICAgICAgICAgdHJhbnNwYXJlbnQgJHttYXJnaW4gKiAyfSR7bWFyZ2luVW5pdH0sIHRyYW5zcGFyZW50IDEwMCUpLFxuICAgICAgICBsaW5lYXItZ3JhZGllbnQoI2Y4ZjhmOCAwICwgI2Y4ZjhmOCAxMDAlKTtcbiAgICAgIGJhY2tncm91bmQtaW1hZ2U6XG4gICAgICAgIGxpbmVhci1ncmFkaWVudCh2YXIoLS1kZXZ1aS1iYXNlLWJnLCAjZmZmKSAwLCB2YXIoLS1kZXZ1aS1iYXNlLWJnLCAjZmZmKSAke21hcmdpbiAqIDJ9JHttYXJnaW5Vbml0fSxcbiAgICAgICAgICB0cmFuc3BhcmVudCAke21hcmdpbiAqIDJ9JHttYXJnaW5Vbml0fSwgdHJhbnNwYXJlbnQgMTAwJSksXG4gICAgICAgIGxpbmVhci1ncmFkaWVudCg5MGRlZywgdmFyKC0tZGV2dWktYmFzZS1iZywgI2ZmZikgMCwgdmFyKC0tZGV2dWktYmFzZS1iZywgI2ZmZikgJHttYXJnaW4gKiAyfSR7bWFyZ2luVW5pdH0sXG4gICAgICAgICAgdHJhbnNwYXJlbnQgJHttYXJnaW4gKiAyfSR7bWFyZ2luVW5pdH0sIHRyYW5zcGFyZW50IDEwMCUpLFxuICAgICAgICBsaW5lYXItZ3JhZGllbnQodmFyKC0tZGV2dWktYXJlYSwgI2Y4ZjhmOCkgMCAsIHZhcigtLWRldnVpLWFyZWEsICNmOGY4ZjgpIDEwMCUpO1xuICAgICAgYmFja2dyb3VuZC1zaXplOiAkezEwMCAvIGNvbHVtbn0lICR7Y2VsbEhlaWdodH0ke2NlbGxIZWlnaHRVbml0fTtcbiAgICAgIGJhY2tncm91bmQtcG9zaXRpb246IC0ke21hcmdpbn0ke21hcmdpblVuaXR9IC0ke21hcmdpbn0ke21hcmdpblVuaXR9O1xuICAgICAgYFxuICAgICAgKTtcbiAgICAgIHRoaXMubGFzdENvbHVtbiA9IGNvbHVtbjtcbiAgICB9XG4gIH1cblxuICBzZXRCYWNrZ3JvdW5kR3JpZEJsb2NrSWZDb2x1bW5DaGFuZ2UoKSB7XG4gICAgaWYgKHRoaXMuZ3JpZFN0YWNrPy5vcHRzPy5jb2x1bW4gIT09IHRoaXMubGFzdENvbHVtbikge1xuICAgICAgdGhpcy51cGRhdGVCYWNrZ3JvdW5kR3JpZEJsb2NrKCk7XG4gICAgfVxuICB9XG5cbiAgcmVtb3ZlQmFja2dyb3VuZEdyaWRCbG9ja1N0eWxlU2hlZXQoKSB7XG4gICAgaWYgKHRoaXMubGFzdFN0eWxlU2hlZXQpIHtcbiAgICAgIFV0aWxzLnJlbW92ZVN0eWxlc2hlZXQoJ2QtZGFzaGJvYXJkLScgKyB0aGlzLmdyaWRTdGFjay5vcHRzWydfY2xhc3MnXSk7XG4gICAgfVxuICB9XG59XG4iXX0=