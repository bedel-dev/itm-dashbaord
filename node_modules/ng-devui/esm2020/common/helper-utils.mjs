import { HttpEventType, HttpParams } from '@angular/common/http';
import { Directive, HostListener, Input } from '@angular/core';
import * as i0 from "@angular/core";
;
export class HelperUtils {
    static getBrowserName() {
        !this._browserName && this.getBrowserInfo();
        return this._browserName;
    }
    static getBrowserVersion() {
        !this._browserVersion && this.getBrowserInfo();
        return this._browserVersion;
    }
    static getBrowserInfo() {
        if (typeof navigator !== 'undefined') {
            const ua = navigator.userAgent.toLowerCase();
            const isIE = ua.match(/rv:([\d.]+)\) like gecko/) || ua.match(/msie ([\d\.]+)/);
            const isClassicEdge = ua.match(/edge\/([\d\.]+)/);
            const isFirefox = ua.match(/firefox\/([\d\.]+)/);
            const isOpera = ua.match(/(?:opera|opr).([\d\.]+)/);
            const isEdge = ua.match(/edg\/([\d\.]+)/);
            const isChrome = ua.match(/chrome\/([\d\.]+)/);
            const isSafari = ua.match(/version\/([\d\.]+).*safari/);
            const infos = isIE || isClassicEdge || isFirefox || isOpera || isEdge || isChrome || isSafari;
            this._browserName = isIE
                ? "IE" /* IE */
                : isClassicEdge
                    ? "ClassicEdge" /* ClassicEdge */
                    : isFirefox
                        ? "Firefox" /* Firefox */
                        : isOpera
                            ? "Opera" /* Opera */
                            : isEdge
                                ? "Edge" /* Edge */
                                : isChrome
                                    ? "Chrome" /* Chrome */
                                    : isSafari
                                        ? "Safari" /* Safari */
                                        : "Other" /* Other */;
            this._browserVersion = infos ? parseInt(infos[1], 10) : 0;
        }
    }
    static jumpOuterUrl(url, target = '_blank') {
        if (url !== undefined && typeof document !== 'undefined') {
            const tempLink = document.createElement('a');
            tempLink.style.display = 'none'; // for IE 11
            tempLink.target = target;
            tempLink.href = url;
            document.body.appendChild(tempLink); // for IE 11, IE11需要append到document.body里面的a链接才会生效
            const event = document.createEvent('MouseEvents');
            event.initEvent('click', false, true);
            tempLink.dispatchEvent(event);
            document.body.removeChild(tempLink); // for IE 11
        }
    }
    static downloadFile(url, option, onError) {
        if (typeof document === 'undefined') {
            return;
        }
        if (document.querySelector('iframe[name=' + (option && option.iframename || 'download') + ']')) {
            document.body.removeChild(document.querySelector('iframe[name=' + (option && option.iframename || 'download') + ']'));
        }
        const tempiframe = document.createElement('iframe');
        tempiframe.name = option && option.iframename || 'download';
        tempiframe.style.display = 'none';
        const tempform = document.createElement('form');
        tempform.action = url;
        tempform.method = option && option.method || 'post';
        tempform.target = option && option.iframename || 'download';
        tempform.enctype = option && option.enctype || 'application/x-www-form-urlencoded';
        tempform.style.display = 'none';
        if (option && option.params) {
            Object.keys(option.params).forEach(key => {
                const opt = document.createElement('input');
                opt.name = key;
                opt.value = option.params[key];
                tempform.appendChild(opt);
            });
        }
        const submit = document.createElement('input');
        submit.type = 'submit';
        tempform.appendChild(submit);
        tempiframe.appendChild(tempform);
        document.body.appendChild(tempiframe);
        // 下载错误处理。下载成功并不会响应，因为响应头中带有Content-Disposition（下载头）的url，无法监听iframe的load事件，load事件不会触发
        tempiframe.addEventListener('load', (event) => {
            try {
                const iframeDoc = tempiframe.contentDocument;
                if (onError !== undefined) {
                    let response;
                    try {
                        response = JSON.parse(iframeDoc.body && iframeDoc.body.textContent);
                    }
                    catch (e) {
                        response = iframeDoc.body && iframeDoc.body.textContent;
                    }
                    if (!response) {
                        response = 'Error';
                    }
                    onError(response);
                }
            }
            catch (e) {
                onError('Error');
            }
            document.body.removeChild(tempiframe);
        });
        tempform.submit();
    }
    static downloadFileByHttpClient(httpClient, url, option, onError, onSuccess, onProgress) {
        const requestMethod = option && option.method && option.method.toLowerCase() || 'post';
        const requestHeaderContentType = option.enctype || 'application/x-www-form-urlencoded';
        const requestParams = option.params ? new HttpParams({
            fromObject: option.params
        }) : null;
        const requestUrl = url;
        const requestOptionParams = requestMethod === 'get' ? requestParams : undefined;
        const requestBody = requestMethod === 'post' ? requestParams && requestParams.toString() : undefined;
        const responseOption = option.responseOption;
        /* eslint-disable-next-line prefer-object-spread */
        const requestOption = Object.assign({}, {
            body: requestBody,
            observe: (option.reportProgress ? 'events' : 'response'),
            params: requestOptionParams,
            headers: {
                'Content-Type': requestHeaderContentType
            },
            withCredentials: option.withCredentials,
            reportProgress: option.reportProgress,
            responseType: (option.reportProgress ? 'blob' : 'arraybuffer')
        }, {
            headers: option.header
        });
        const handleResponse = (resOption => {
            switch (resOption) {
                case 'response':
                    return (res) => res;
                case 'body':
                    return (res) => {
                        const arrayBuffer = res.body || res.error;
                        const body = HelperUtils.utf8ArrayToStr(arrayBuffer);
                        return body;
                    };
                case 'json':
                default:
                    return (res) => {
                        const arrayBuffer = res.body || res.error;
                        let response;
                        try {
                            const body = HelperUtils.utf8ArrayToStr(arrayBuffer);
                            try {
                                response = JSON.parse(body);
                            }
                            catch (e) {
                                const parser = new DOMParser();
                                const html = parser.parseFromString(body, 'text/html');
                                response = html.body.textContent;
                            }
                        }
                        catch (e) {
                            throw new Error('Parsing Error:' + e);
                        }
                        if (!response) {
                            response = 'Error';
                        }
                        return response;
                    };
            }
        })(responseOption);
        const downloadFileFromArrayBuffer = (data, filename, contentType) => {
            if (typeof document === 'undefined' || typeof window === 'undefined') {
                return;
            }
            if (window.navigator && window.navigator['msSaveOrOpenBlob']) { // IE11 support
                const blob = new Blob([data], { type: contentType });
                window.navigator['msSaveOrOpenBlob'](blob, filename);
            }
            else { // other browsers
                if ('download' in document.createElement('a')) {
                    const blob = new Blob([data], { type: contentType });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(link.href);
                }
                else {
                    // not support tag a download attribute use file download, filename won't support
                    const file = new File([data], filename, { type: contentType });
                    const exportUrl = URL.createObjectURL(file);
                    window.location.assign(exportUrl);
                    URL.revokeObjectURL(exportUrl);
                }
            }
        };
        const getFilenameFromDisposition = (disposition) => {
            const filenamePair = disposition.split(';').filter(str => /^filename=/.test(str.trim())).pop();
            if (filenamePair) {
                let str = filenamePair.trim();
                str = str.split('=')[1];
                str = str.replace(/['"]/g, '');
                return decodeURIComponent(str);
            }
            else {
                return null;
            }
        };
        httpClient.request(requestMethod, requestUrl, requestOption).subscribe((res) => {
            if (res.type === HttpEventType.DownloadProgress) {
                if (onProgress) {
                    onProgress(res);
                }
            }
            else if (res.type === HttpEventType.Response) {
                const httpResponse = res;
                const disposition = httpResponse.headers.get('content-disposition');
                const contentType = httpResponse.headers.get('content-type');
                if (/^attachment/i.test(disposition) || option.downloadWithoutDispositionHeader) {
                    const downloadFilename = option.filename || disposition && getFilenameFromDisposition(disposition) || url;
                    downloadFileFromArrayBuffer(httpResponse.body, downloadFilename, contentType);
                    if (onSuccess) {
                        onSuccess(httpResponse);
                    }
                }
                else {
                    if (onError) {
                        let response;
                        try {
                            response = handleResponse(httpResponse);
                        }
                        catch (e) {
                            response = httpResponse;
                        }
                        onError(response);
                    }
                }
            }
        }, err => {
            if (onError) {
                let response;
                try {
                    response = handleResponse(err);
                }
                catch (e) {
                    response = err;
                }
                onError(response);
            }
        });
    }
    static utf8ArrayToStr(arrayBuffer) {
        if (typeof TextDecoder !== 'undefined') {
            return new TextDecoder('utf-8').decode(arrayBuffer);
        }
        else {
            /**
             * fallback 方案，无TextDecoder场景使用直接解析，英文无问题，中文会存在乱码
             * ie 11 下支持中文需要使用MDN推荐的 fastestsmallesttextencoderdecoder以支持TextDecoder
             * npm install fastestsmallesttextencoderdecoder
             * polyfill.ts includes
             * ```
             * // polyfill for TextDecoder on IE 11
             * import 'fastestsmallesttextencoderdecoder';
             * ```
             */
            return String.fromCharCode.apply(null, new Uint8Array(arrayBuffer));
        }
    }
}
HelperUtils._browserName = null;
HelperUtils._browserVersion = null;
export class SimulateATagDirective {
    constructor() {
        this.target = '_blank';
    }
    onClick() {
        HelperUtils.jumpOuterUrl(this.href, this.target);
    }
}
SimulateATagDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: SimulateATagDirective, deps: [], target: i0.ɵɵFactoryTarget.Directive });
SimulateATagDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.1.3", type: SimulateATagDirective, selector: "[dSimulateATag]", inputs: { href: "href", target: "target" }, host: { listeners: { "click": "onClick()" } }, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: SimulateATagDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[dSimulateATag]'
                }]
        }], ctorParameters: function () { return []; }, propDecorators: { href: [{
                type: Input
            }], target: [{
                type: Input
            }], onClick: [{
                type: HostListener,
                args: ['click']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscGVyLXV0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vZGV2dWkvY29tbW9uL2hlbHBlci11dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQTRDLGFBQWEsRUFBZSxVQUFVLEVBQWdCLE1BQU0sc0JBQXNCLENBQUM7QUFDdEksT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQVc5RCxDQUFDO0FBR0YsTUFBTSxPQUFPLFdBQVc7SUFJdEIsTUFBTSxDQUFDLGNBQWM7UUFDbkIsQ0FBQyxJQUFJLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUM1QyxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUM7SUFDM0IsQ0FBQztJQUVELE1BQU0sQ0FBQyxpQkFBaUI7UUFDdEIsQ0FBQyxJQUFJLENBQUMsZUFBZSxJQUFJLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUMvQyxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUM7SUFDOUIsQ0FBQztJQUVPLE1BQU0sQ0FBQyxjQUFjO1FBQzNCLElBQUksT0FBTyxTQUFTLEtBQUssV0FBVyxFQUFFO1lBQ3BDLE1BQU0sRUFBRSxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDN0MsTUFBTSxJQUFJLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztZQUNoRixNQUFNLGFBQWEsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUM7WUFDbEQsTUFBTSxTQUFTLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1lBQ2pELE1BQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMseUJBQXlCLENBQUMsQ0FBQztZQUNw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YixJQUFJO29CQUNGLFFBQVEsR0FBRyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUM7aUJBQ2hDO2dCQUFDLE9BQU8sQ0FBQyxFQUFFO29CQUNWLFFBQVEsR0FBRyxHQUFHLENBQUM7aUJBQ2hCO2dCQUNELE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUNuQjtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVPLE1BQU0sQ0FBQyxjQUFjLENBQUMsV0FBVztRQUN2QyxJQUFJLE9BQU8sV0FBVyxLQUFLLFdBQVcsRUFBRTtZQUN0QyxPQUFPLElBQUksV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUNyRDthQUFNO1lBQ0w7Ozs7Ozs7OztlQVNHO1lBQ0gsT0FBTyxNQUFNLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztTQUNyRTtJQUNILENBQUM7O0FBOVNjLHdCQUFZLEdBQVksSUFBSSxDQUFDO0FBQzdCLDJCQUFlLEdBQUcsSUFBSSxDQUFDO0FBbVR4QyxNQUFNLE9BQU8scUJBQXFCO0lBR2hDO1FBRFMsV0FBTSxHQUF1RCxRQUFRLENBQUM7SUFDaEUsQ0FBQztJQUNPLE9BQU87UUFDNUIsV0FBVyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNuRCxDQUFDOztrSEFOVSxxQkFBcUI7c0dBQXJCLHFCQUFxQjsyRkFBckIscUJBQXFCO2tCQUhqQyxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxpQkFBaUI7aUJBQzVCOzBFQUVVLElBQUk7c0JBQVosS0FBSztnQkFDRyxNQUFNO3NCQUFkLEtBQUs7Z0JBRWlCLE9BQU87c0JBQTdCLFlBQVk7dUJBQUMsT0FBTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBFcnJvclJlc3BvbnNlLCBIdHRwRXZlbnQsIEh0dHBFdmVudFR5cGUsIEh0dHBIZWFkZXJzLCBIdHRwUGFyYW1zLCBIdHRwUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBEaXJlY3RpdmUsIEhvc3RMaXN0ZW5lciwgSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuY29uc3QgZW51bSBCcm93c2VyIHtcbiAgSUUgPSAnSUUnLFxuICBDbGFzc2ljRWRnZSA9ICdDbGFzc2ljRWRnZScsXG4gIEZpcmVmb3ggPSAnRmlyZWZveCcsXG4gIE9wZXJhID0gJ09wZXJhJyxcbiAgRWRnZSA9ICdFZGdlJyxcbiAgQ2hyb21lID0gJ0Nocm9tZScsXG4gIFNhZmFyaSA9ICdTYWZhcmknLFxuICBPdGhlciA9ICdPdGhlcicsXG59O1xuZGVjbGFyZSB0eXBlIEh0dHBPYnNlcnZlID0gJ2JvZHknIHwgJ2V2ZW50cycgfCAncmVzcG9uc2UnO1xuZGVjbGFyZSB0eXBlIFJlc3BvbnNlVHlwZSA9ICdhcnJheWJ1ZmZlcicgfCAnYmxvYicgfCAnanNvbicgfCAndGV4dCc7XG5leHBvcnQgY2xhc3MgSGVscGVyVXRpbHMge1xuICBwcml2YXRlIHN0YXRpYyBfYnJvd3Nlck5hbWU6IEJyb3dzZXIgPSBudWxsO1xuICBwcml2YXRlIHN0YXRpYyBfYnJvd3NlclZlcnNpb24gPSBudWxsO1xuXG4gIHN0YXRpYyBnZXRCcm93c2VyTmFtZSgpIHtcbiAgICAhdGhpcy5fYnJvd3Nlck5hbWUgJiYgdGhpcy5nZXRCcm93c2VySW5mbygpO1xuICAgIHJldHVybiB0aGlzLl9icm93c2VyTmFtZTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRCcm93c2VyVmVyc2lvbigpIHtcbiAgICAhdGhpcy5fYnJvd3NlclZlcnNpb24gJiYgdGhpcy5nZXRCcm93c2VySW5mbygpO1xuICAgIHJldHVybiB0aGlzLl9icm93c2VyVmVyc2lvbjtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIGdldEJyb3dzZXJJbmZvKCkge1xuICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgY29uc3QgdWEgPSBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCk7XG4gICAgICBjb25zdCBpc0lFID0gdWEubWF0Y2goL3J2OihbXFxkLl0rKVxcKSBsaWtlIGdlY2tvLykgfHwgdWEubWF0Y2goL21zaWUgKFtcXGRcXC5dKykvKTtcbiAgICAgIGNvbnN0IGlzQ2xhc3NpY0VkZ2UgPSB1YS5tYXRjaCgvZWRnZVxcLyhbXFxkXFwuXSspLyk7XG4gICAgICBjb25zdCBpc0ZpcmVmb3ggPSB1YS5tYXRjaCgvZmlyZWZveFxcLyhbXFxkXFwuXSspLyk7XG4gICAgICBjb25zdCBpc09wZXJhID0gdWEubWF0Y2goLyg/Om9wZXJhfG9wcikuKFtcXGRcXC5dKykvKTtcbiAgICAgIGNvbnN0IGlzRWRnZSA9IHVhLm1hdGNoKC9lZGdcXC8oW1xcZFxcLl0rKS8pO1xuICAgICAgY29uc3QgaXNDaHJvbWUgPSB1YS5tYXRjaCgvY2hyb21lXFwvKFtcXGRcXC5dKykvKTtcbiAgICAgIGNvbnN0IGlzU2FmYXJpID0gdWEubWF0Y2goL3ZlcnNpb25cXC8oW1xcZFxcLl0rKS4qc2FmYXJpLyk7XG4gICAgICBjb25zdCBpbmZvcyA9IGlzSUUgfHwgaXNDbGFzc2ljRWRnZSB8fCBpc0ZpcmVmb3ggfHwgaXNPcGVyYSB8fCBpc0VkZ2UgfHwgaXNDaHJvbWUgfHwgaXNTYWZhcmk7XG4gICAgICB0aGlzLl9icm93c2VyTmFtZSA9IGlzSUVcbiAgICAgICAgPyBCcm93c2VyLklFXG4gICAgICAgIDogaXNDbGFzc2ljRWRnZVxuICAgICAgICAgID8gQnJvd3Nlci5DbGFzc2ljRWRnZVxuICAgICAgICAgIDogaXNGaXJlZm94XG4gICAgICAgICAgICA/IEJyb3dzZXIuRmlyZWZveFxuICAgICAgICAgICAgOiBpc09wZXJhXG4gICAgICAgICAgICAgID8gQnJvd3Nlci5PcGVyYVxuICAgICAgICAgICAgICA6IGlzRWRnZVxuICAgICAgICAgICAgICAgID8gQnJvd3Nlci5FZGdlXG4gICAgICAgICAgICAgICAgOiBpc0Nocm9tZVxuICAgICAgICAgICAgICAgICAgPyBCcm93c2VyLkNocm9tZVxuICAgICAgICAgICAgICAgICAgOiBpc1NhZmFyaVxuICAgICAgICAgICAgICAgICAgICA/IEJyb3dzZXIuU2FmYXJpXG4gICAgICAgICAgICAgICAgICAgIDogQnJvd3Nlci5PdGhlcjtcbiAgICAgIHRoaXMuX2Jyb3dzZXJWZXJzaW9uID0gaW5mb3MgPyBwYXJzZUludChpbmZvc1sxXSwgMTApIDogMDtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMganVtcE91dGVyVXJsKHVybCwgdGFyZ2V0ID0gJ19ibGFuaycpIHtcbiAgICBpZiAodXJsICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgY29uc3QgdGVtcExpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgICB0ZW1wTGluay5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyAgICAgLy8gZm9yIElFIDExXG4gICAgICB0ZW1wTGluay50YXJnZXQgPSB0YXJnZXQ7XG4gICAgICB0ZW1wTGluay5ocmVmID0gdXJsO1xuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0ZW1wTGluayk7IC8vIGZvciBJRSAxMSwgSUUxMemcgOimgWFwcGVuZOWIsGRvY3VtZW50LmJvZHnph4zpnaLnmoRh6ZO+5o6l5omN5Lya55Sf5pWIXG4gICAgICBjb25zdCBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdNb3VzZUV2ZW50cycpO1xuICAgICAgZXZlbnQuaW5pdEV2ZW50KCdjbGljaycsIGZhbHNlLCB0cnVlKTtcbiAgICAgIHRlbXBMaW5rLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0ZW1wTGluayk7IC8vIGZvciBJRSAxMVxuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBkb3dubG9hZEZpbGUoXG4gICAgdXJsOiBzdHJpbmcsXG4gICAgb3B0aW9uPzoge1xuICAgICAgbWV0aG9kPzogJ1BPU1QnfCAnR0VUJyB8ICdwb3N0JyB8ICdnZXQnO1xuICAgICAgcGFyYW1zPzoge1twcm9wZXJ0eTogc3RyaW5nXTogc3RyaW5nfTtcbiAgICAgIGVuY3R5cGU/OiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyB8ICdtdWx0aXBhcnQvZm9ybS1kYXRhJ3wgJ3RleHQvcGxhaW4nO1xuICAgICAgaWZyYW1lbmFtZT86IHN0cmluZztcbiAgICB9LFxuICAgIG9uRXJyb3I/OiAocmVzcG9uc2UpID0+IHZvaWRcbiAgKSB7XG4gICAgaWYgKHR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lmcmFtZVtuYW1lPScgKyAob3B0aW9uICYmIG9wdGlvbi5pZnJhbWVuYW1lIHx8ICdkb3dubG9hZCcpICsgJ10nKSkge1xuICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpZnJhbWVbbmFtZT0nICsgKG9wdGlvbiAmJiBvcHRpb24uaWZyYW1lbmFtZSB8fCAnZG93bmxvYWQnKSArICddJykpO1xuICAgIH1cbiAgICBjb25zdCB0ZW1waWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XG4gICAgdGVtcGlmcmFtZS5uYW1lID0gb3B0aW9uICYmIG9wdGlvbi5pZnJhbWVuYW1lIHx8ICdkb3dubG9hZCc7XG4gICAgdGVtcGlmcmFtZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXG4gICAgY29uc3QgdGVtcGZvcm0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmb3JtJyk7XG4gICAgdGVtcGZvcm0uYWN0aW9uID0gdXJsO1xuICAgIHRlbXBmb3JtLm1ldGhvZCA9IG9wdGlvbiAmJiBvcHRpb24ubWV0aG9kIHx8ICdwb3N0JztcbiAgICB0ZW1wZm9ybS50YXJnZXQgPSBvcHRpb24gJiYgb3B0aW9uLmlmcmFtZW5hbWUgfHwgJ2Rvd25sb2FkJztcbiAgICB0ZW1wZm9ybS5lbmN0eXBlID0gb3B0aW9uICYmIG9wdGlvbi5lbmN0eXBlIHx8ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnO1xuICAgIHRlbXBmb3JtLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cbiAgICBpZiAob3B0aW9uICYmIG9wdGlvbi5wYXJhbXMpIHtcbiAgICAgIE9iamVjdC5rZXlzKG9wdGlvbi5wYXJhbXMpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgY29uc3Qgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICAgICAgb3B0Lm5hbWUgPSBrZXk7XG4gICAgICAgIG9wdC52YWx1ZSA9IG9wdGlvbi5wYXJhbXNba2V5XTtcbiAgICAgICAgdGVtcGZvcm0uYXBwZW5kQ2hpbGQob3B0KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHN1Ym1pdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgc3VibWl0LnR5cGUgPSAnc3VibWl0JztcblxuICAgIHRlbXBmb3JtLmFwcGVuZENoaWxkKHN1Ym1pdCk7XG4gICAgdGVtcGlmcmFtZS5hcHBlbmRDaGlsZCh0ZW1wZm9ybSk7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0ZW1waWZyYW1lKTtcblxuICAgIC8vIOS4i+i9vemUmeivr+WkhOeQhuOAguS4i+i9veaIkOWKn+W5tuS4jeS8muWTjeW6lO+8jOWboOS4uuWTjeW6lOWktOS4reW4puaciUNvbnRlbnQtRGlzcG9zaXRpb27vvIjkuIvovb3lpLTvvInnmoR1cmzvvIzml6Dms5Xnm5HlkKxpZnJhbWXnmoRsb2Fk5LqL5Lu277yMbG9hZOS6i+S7tuS4jeS8muinpuWPkVxuICAgIHRlbXBpZnJhbWUuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIChldmVudCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaWZyYW1lRG9jID0gIHRlbXBpZnJhbWUuY29udGVudERvY3VtZW50O1xuICAgICAgICBpZiAob25FcnJvciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgbGV0IHJlc3BvbnNlO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXNwb25zZSA9IEpTT04ucGFyc2UoaWZyYW1lRG9jLmJvZHkgJiYgaWZyYW1lRG9jLmJvZHkudGV4dENvbnRlbnQpO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gaWZyYW1lRG9jLmJvZHkgJiYgaWZyYW1lRG9jLmJvZHkudGV4dENvbnRlbnQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghcmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gJ0Vycm9yJztcbiAgICAgICAgICB9XG4gICAgICAgICAgb25FcnJvcihyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgb25FcnJvcignRXJyb3InKTtcbiAgICAgIH1cbiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGVtcGlmcmFtZSk7XG4gICAgfSk7XG4gICAgdGVtcGZvcm0uc3VibWl0KCk7XG4gIH1cblxuICBzdGF0aWMgZG93bmxvYWRGaWxlQnlIdHRwQ2xpZW50KFxuICAgIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQsXG4gICAgdXJsOiBzdHJpbmcsXG4gICAgb3B0aW9uPzoge1xuICAgICAgbWV0aG9kPzogJ1BPU1QnIHwgJ0dFVCcgfCAncG9zdCcgfCAnZ2V0JztcbiAgICAgIHBhcmFtcz86IHtbcHJvcGVydHk6IHN0cmluZ106IHN0cmluZ307XG4gICAgICBlbmN0eXBlPzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcgfCAnbXVsdGlwYXJ0L2Zvcm0tZGF0YScgfCAndGV4dC9wbGFpbic7XG4gICAgICBoZWFkZXI/OiB7XG4gICAgICAgIFtoZWFkZXI6IHN0cmluZ106IHN0cmluZyB8IHN0cmluZ1tdO1xuICAgICAgfTtcbiAgICAgIHJlc3BvbnNlT3B0aW9uPzogJ3Jlc3BvbnNlJyB8ICdib2R5JyB8ICdqc29uJztcbiAgICAgIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbjtcbiAgICAgIGZpbGVuYW1lPzogc3RyaW5nO1xuICAgICAgd2l0aENyZWRlbnRpYWxzPzogYm9vbGVhbjtcbiAgICAgIGRvd25sb2FkV2l0aG91dERpc3Bvc2l0aW9uSGVhZGVyPzogYm9vbGVhbjtcbiAgICB9LFxuICAgIG9uRXJyb3I/OiAocmVzcG9uc2UpID0+IHZvaWQsXG4gICAgb25TdWNjZXNzPzogKHJlc3BvbnNlKSA9PiB2b2lkLFxuICAgIG9uUHJvZ3Jlc3M/OiAocmVzcG9uc2UpID0+IHZvaWQsXG4gICkge1xuXG4gICAgY29uc3QgcmVxdWVzdE1ldGhvZCA9IG9wdGlvbiAmJiBvcHRpb24ubWV0aG9kICYmIG9wdGlvbi5tZXRob2QudG9Mb3dlckNhc2UoKSB8fCAncG9zdCc7XG4gICAgY29uc3QgcmVxdWVzdEhlYWRlckNvbnRlbnRUeXBlID0gb3B0aW9uLmVuY3R5cGUgfHwgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCc7XG4gICAgY29uc3QgcmVxdWVzdFBhcmFtcyA9IG9wdGlvbi5wYXJhbXMgPyBuZXcgSHR0cFBhcmFtcyh7XG4gICAgICBmcm9tT2JqZWN0OiBvcHRpb24ucGFyYW1zXG4gICAgfSkgOiBudWxsO1xuXG4gICAgY29uc3QgcmVxdWVzdFVybCA9IHVybDtcbiAgICBjb25zdCByZXF1ZXN0T3B0aW9uUGFyYW1zID0gcmVxdWVzdE1ldGhvZCA9PT0gJ2dldCcgPyByZXF1ZXN0UGFyYW1zIDogdW5kZWZpbmVkO1xuICAgIGNvbnN0IHJlcXVlc3RCb2R5ID0gcmVxdWVzdE1ldGhvZCA9PT0gJ3Bvc3QnID8gcmVxdWVzdFBhcmFtcyAmJiByZXF1ZXN0UGFyYW1zLnRvU3RyaW5nKCkgOiB1bmRlZmluZWQ7XG5cbiAgICBjb25zdCByZXNwb25zZU9wdGlvbiA9IG9wdGlvbi5yZXNwb25zZU9wdGlvbjtcbiAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLW9iamVjdC1zcHJlYWQgKi9cbiAgICBjb25zdCByZXF1ZXN0T3B0aW9uID0gT2JqZWN0LmFzc2lnbih7fSwge1xuICAgICAgYm9keTogcmVxdWVzdEJvZHksXG4gICAgICBvYnNlcnZlOiAob3B0aW9uLnJlcG9ydFByb2dyZXNzID8gJ2V2ZW50cycgOiAncmVzcG9uc2UnKSBhcyBIdHRwT2JzZXJ2ZSxcbiAgICAgIHBhcmFtczogcmVxdWVzdE9wdGlvblBhcmFtcyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6IHJlcXVlc3RIZWFkZXJDb250ZW50VHlwZVxuICAgICAgfSxcbiAgICAgIHdpdGhDcmVkZW50aWFsczogb3B0aW9uLndpdGhDcmVkZW50aWFscyxcbiAgICAgIHJlcG9ydFByb2dyZXNzOiBvcHRpb24ucmVwb3J0UHJvZ3Jlc3MsXG4gICAgICByZXNwb25zZVR5cGU6IChvcHRpb24ucmVwb3J0UHJvZ3Jlc3MgPyAnYmxvYicgOiAnYXJyYXlidWZmZXInKSBhcyBSZXNwb25zZVR5cGVcbiAgICB9LCB7XG4gICAgICBoZWFkZXJzOiBvcHRpb24uaGVhZGVyXG4gICAgfSk7XG5cbiAgICBjb25zdCBoYW5kbGVSZXNwb25zZSA9IChyZXNPcHRpb24gPT4ge1xuICAgICAgc3dpdGNoIChyZXNPcHRpb24pIHtcbiAgICAgIGNhc2UgJ3Jlc3BvbnNlJzpcbiAgICAgICAgcmV0dXJuIChyZXM6IEh0dHBSZXNwb25zZTxBcnJheUJ1ZmZlcj4pID0+IHJlcztcbiAgICAgIGNhc2UgJ2JvZHknOlxuICAgICAgICByZXR1cm4gKHJlczogSHR0cFJlc3BvbnNlPEFycmF5QnVmZmVyPiB8IEh0dHBFcnJvclJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSA8QXJyYXlCdWZmZXI+KDxIdHRwUmVzcG9uc2U8QXJyYXlCdWZmZXI+PnJlcykuYm9keSB8fCAoPEh0dHBFcnJvclJlc3BvbnNlPnJlcykuZXJyb3I7XG4gICAgICAgICAgY29uc3QgYm9keSA9IEhlbHBlclV0aWxzLnV0ZjhBcnJheVRvU3RyKGFycmF5QnVmZmVyKTtcbiAgICAgICAgICByZXR1cm4gYm9keTtcbiAgICAgICAgfTtcbiAgICAgIGNhc2UgJ2pzb24nOlxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIChyZXM6IEh0dHBSZXNwb25zZTxBcnJheUJ1ZmZlcj4gfCBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gPEFycmF5QnVmZmVyPig8SHR0cFJlc3BvbnNlPEFycmF5QnVmZmVyPj5yZXMpLmJvZHkgfHwgKDxIdHRwRXJyb3JSZXNwb25zZT5yZXMpLmVycm9yO1xuICAgICAgICAgIGxldCByZXNwb25zZTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgYm9keSA9IEhlbHBlclV0aWxzLnV0ZjhBcnJheVRvU3RyKGFycmF5QnVmZmVyKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIHJlc3BvbnNlID0gSlNPTi5wYXJzZShib2R5KTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgY29uc3QgcGFyc2VyID0gbmV3IERPTVBhcnNlcigpO1xuICAgICAgICAgICAgICBjb25zdCBodG1sID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhib2R5LCAndGV4dC9odG1sJyk7XG4gICAgICAgICAgICAgIHJlc3BvbnNlID0gaHRtbC5ib2R5LnRleHRDb250ZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUGFyc2luZyBFcnJvcjonICsgZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghcmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gJ0Vycm9yJztcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0pKHJlc3BvbnNlT3B0aW9uKTtcblxuICAgIGNvbnN0IGRvd25sb2FkRmlsZUZyb21BcnJheUJ1ZmZlciA9IChkYXRhOiBBcnJheUJ1ZmZlciwgZmlsZW5hbWU6IHN0cmluZywgY29udGVudFR5cGU6IHN0cmluZykgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHdpbmRvdy5uYXZpZ2F0b3IgJiYgd2luZG93Lm5hdmlnYXRvclsnbXNTYXZlT3JPcGVuQmxvYiddKSB7IC8vIElFMTEgc3VwcG9ydFxuICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2RhdGFdLCB7dHlwZTogY29udGVudFR5cGV9KTtcbiAgICAgICAgd2luZG93Lm5hdmlnYXRvclsnbXNTYXZlT3JPcGVuQmxvYiddKGJsb2IsIGZpbGVuYW1lKTtcbiAgICAgIH0gZWxzZSB7Ly8gb3RoZXIgYnJvd3NlcnNcbiAgICAgICAgaWYgKCdkb3dubG9hZCcgaW4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpKSB7XG4gICAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtkYXRhXSwge3R5cGU6IGNvbnRlbnRUeXBlfSk7XG4gICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICAgICAgICBsaW5rLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgICAgIGxpbmsuZG93bmxvYWQgPSBmaWxlbmFtZTtcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspO1xuICAgICAgICAgIGxpbmsuY2xpY2soKTtcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmspO1xuICAgICAgICAgIFVSTC5yZXZva2VPYmplY3RVUkwobGluay5ocmVmKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBub3Qgc3VwcG9ydCB0YWcgYSBkb3dubG9hZCBhdHRyaWJ1dGUgdXNlIGZpbGUgZG93bmxvYWQsIGZpbGVuYW1lIHdvbid0IHN1cHBvcnRcbiAgICAgICAgICBjb25zdCBmaWxlID0gbmV3IEZpbGUoW2RhdGFdLCBmaWxlbmFtZSwge3R5cGU6IGNvbnRlbnRUeXBlfSk7XG4gICAgICAgICAgY29uc3QgZXhwb3J0VXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKTtcbiAgICAgICAgICB3aW5kb3cubG9jYXRpb24uYXNzaWduKGV4cG9ydFVybCk7XG4gICAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTChleHBvcnRVcmwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IGdldEZpbGVuYW1lRnJvbURpc3Bvc2l0aW9uID0gKGRpc3Bvc2l0aW9uOiBzdHJpbmcpID0+IHtcbiAgICAgIGNvbnN0IGZpbGVuYW1lUGFpciA9ICBkaXNwb3NpdGlvbi5zcGxpdCgnOycpLmZpbHRlcihzdHIgPT4gL15maWxlbmFtZT0vLnRlc3Qoc3RyLnRyaW0oKSkpLnBvcCgpO1xuICAgICAgaWYgKGZpbGVuYW1lUGFpcikge1xuICAgICAgICBsZXQgc3RyID0gZmlsZW5hbWVQYWlyLnRyaW0oKTtcbiAgICAgICAgc3RyID0gc3RyLnNwbGl0KCc9JylbMV07XG4gICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9bJ1wiXS9nLCAnJyk7XG4gICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoc3RyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBodHRwQ2xpZW50LnJlcXVlc3QocmVxdWVzdE1ldGhvZCwgcmVxdWVzdFVybCwgcmVxdWVzdE9wdGlvbikuc3Vic2NyaWJlKChyZXM6IEh0dHBFdmVudDxhbnk+KSA9PiB7XG4gICAgICBpZiAocmVzLnR5cGUgPT09IEh0dHBFdmVudFR5cGUuRG93bmxvYWRQcm9ncmVzcykge1xuICAgICAgICBpZiAob25Qcm9ncmVzcykge1xuICAgICAgICAgIG9uUHJvZ3Jlc3MocmVzKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChyZXMudHlwZSA9PT0gSHR0cEV2ZW50VHlwZS5SZXNwb25zZSkge1xuICAgICAgICBjb25zdCBodHRwUmVzcG9uc2UgPSByZXMgYXMgSHR0cFJlc3BvbnNlPGFueT47XG4gICAgICAgIGNvbnN0IGRpc3Bvc2l0aW9uID0gKDxIdHRwSGVhZGVycz5odHRwUmVzcG9uc2UuaGVhZGVycykuZ2V0KCdjb250ZW50LWRpc3Bvc2l0aW9uJyk7XG4gICAgICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gKDxIdHRwSGVhZGVycz5odHRwUmVzcG9uc2UuaGVhZGVycykuZ2V0KCdjb250ZW50LXR5cGUnKTtcblxuICAgICAgICBpZiAoL15hdHRhY2htZW50L2kudGVzdChkaXNwb3NpdGlvbikgfHwgb3B0aW9uLmRvd25sb2FkV2l0aG91dERpc3Bvc2l0aW9uSGVhZGVyKSB7XG4gICAgICAgICAgY29uc3QgZG93bmxvYWRGaWxlbmFtZSA9IG9wdGlvbi5maWxlbmFtZSB8fCBkaXNwb3NpdGlvbiAmJiBnZXRGaWxlbmFtZUZyb21EaXNwb3NpdGlvbihkaXNwb3NpdGlvbikgfHwgdXJsIDtcbiAgICAgICAgICBkb3dubG9hZEZpbGVGcm9tQXJyYXlCdWZmZXIoaHR0cFJlc3BvbnNlLmJvZHksIGRvd25sb2FkRmlsZW5hbWUsIGNvbnRlbnRUeXBlKTtcbiAgICAgICAgICBpZiAob25TdWNjZXNzKSB7XG4gICAgICAgICAgICBvblN1Y2Nlc3MoaHR0cFJlc3BvbnNlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKG9uRXJyb3IpIHtcbiAgICAgICAgICAgIGxldCByZXNwb25zZTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIHJlc3BvbnNlID0gaGFuZGxlUmVzcG9uc2UoaHR0cFJlc3BvbnNlKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgcmVzcG9uc2UgPSBodHRwUmVzcG9uc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvbkVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LCBlcnIgPT4ge1xuICAgICAgaWYgKG9uRXJyb3IpIHtcbiAgICAgICAgbGV0IHJlc3BvbnNlO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHJlc3BvbnNlID0gaGFuZGxlUmVzcG9uc2UoZXJyKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHJlc3BvbnNlID0gZXJyO1xuICAgICAgICB9XG4gICAgICAgIG9uRXJyb3IocmVzcG9uc2UpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgdXRmOEFycmF5VG9TdHIoYXJyYXlCdWZmZXIpIHtcbiAgICBpZiAodHlwZW9mIFRleHREZWNvZGVyICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgcmV0dXJuIG5ldyBUZXh0RGVjb2RlcigndXRmLTgnKS5kZWNvZGUoYXJyYXlCdWZmZXIpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvKipcbiAgICAgICAqIGZhbGxiYWNrIOaWueahiO+8jOaXoFRleHREZWNvZGVy5Zy65pmv5L2/55So55u05o6l6Kej5p6Q77yM6Iux5paH5peg6Zeu6aKY77yM5Lit5paH5Lya5a2Y5Zyo5Lmx56CBXG4gICAgICAgKiBpZSAxMSDkuIvmlK/mjIHkuK3mlofpnIDopoHkvb/nlKhNRE7mjqjojZDnmoQgZmFzdGVzdHNtYWxsZXN0dGV4dGVuY29kZXJkZWNvZGVy5Lul5pSv5oyBVGV4dERlY29kZXJcbiAgICAgICAqIG5wbSBpbnN0YWxsIGZhc3Rlc3RzbWFsbGVzdHRleHRlbmNvZGVyZGVjb2RlclxuICAgICAgICogcG9seWZpbGwudHMgaW5jbHVkZXNcbiAgICAgICAqIGBgYFxuICAgICAgICogLy8gcG9seWZpbGwgZm9yIFRleHREZWNvZGVyIG9uIElFIDExXG4gICAgICAgKiBpbXBvcnQgJ2Zhc3Rlc3RzbWFsbGVzdHRleHRlbmNvZGVyZGVjb2Rlcic7XG4gICAgICAgKiBgYGBcbiAgICAgICAqL1xuICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWZmZXIpKTtcbiAgICB9XG4gIH1cbn1cblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW2RTaW11bGF0ZUFUYWddJ1xufSlcbmV4cG9ydCBjbGFzcyBTaW11bGF0ZUFUYWdEaXJlY3RpdmUge1xuICBASW5wdXQoKSBocmVmOiBzdHJpbmc7XG4gIEBJbnB1dCgpIHRhcmdldDogJ19ibGFuaycgfCAnX3NlbGYnIHwgJ19wYXJlbnQnIHwgJ190b3AnIHwgc3RyaW5nICAgPSAnX2JsYW5rJztcbiAgY29uc3RydWN0b3IoKSB7fVxuICBASG9zdExpc3RlbmVyKCdjbGljaycpIG9uQ2xpY2soKSB7XG4gICAgSGVscGVyVXRpbHMuanVtcE91dGVyVXJsKHRoaXMuaHJlZiwgdGhpcy50YXJnZXQpO1xuICB9XG59XG4iXX0=