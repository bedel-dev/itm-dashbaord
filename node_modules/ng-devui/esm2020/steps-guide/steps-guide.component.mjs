import { DOCUMENT } from '@angular/common';
import { Component, ElementRef, HostBinding, Inject, Renderer2 } from '@angular/core';
import { I18nService } from 'ng-devui/i18n';
import { PositionService } from 'ng-devui/position';
import { fromEvent } from 'rxjs';
import { debounceTime, throttleTime } from 'rxjs/operators';
import { StepsGuideService } from './steps-guide.service';
import * as i0 from "@angular/core";
import * as i1 from "./steps-guide.service";
import * as i2 from "ng-devui/position";
import * as i3 from "ng-devui/i18n";
import * as i4 from "@angular/common";
import * as i5 from "ng-devui/utils";
export class StepsGuideComponent {
    constructor(stepService, renderer, positionService, elm, i18n, doc) {
        this.stepService = stepService;
        this.renderer = renderer;
        this.positionService = positionService;
        this.elm = elm;
        this.i18n = i18n;
        this.doc = doc;
        this.position = 'top';
        this.zIndex = 1100;
        this.dots = [];
        this.SCROLL_REFRESH_INTERVAL = 100;
        this.DOT_HORIZONTAL_MARGIN = 27;
        this.DOT_VERTICAL_MARGIN = 22;
        this.document = this.doc;
    }
    get class() {
        return 'devui-step-item ' + this.position;
    }
    get display() {
        return 'block';
    }
    ngOnInit() {
        this.dots = new Array(this.stepsCount);
        this.elm.nativeElement.style.zIndex = this.zIndex;
        this.i18nCommonText = this.i18n.getI18nText().stepsGuide;
        const i18nSubscription = this.i18n.langChange().subscribe((data) => {
            this.i18nCommonText = data.stepsGuide;
        });
        this.subScriber = fromEvent(window, 'resize')
            .pipe(debounceTime(this.SCROLL_REFRESH_INTERVAL))
            .subscribe(() => {
            this.updatePosition();
        });
        this.subScriber.add(i18nSubscription);
    }
    ngAfterViewInit() {
        this.updatePosition();
        if (!this.scrollElement) {
            const currentScrollElement = this.positionService.getScrollParent(this.triggerElement);
            this.scrollElement = currentScrollElement === this.document.body ? window : currentScrollElement;
        }
        const scrollSubscriber = fromEvent(this.scrollElement, 'scroll')
            .pipe(throttleTime(this.SCROLL_REFRESH_INTERVAL, undefined, { leading: true, trailing: true }))
            .subscribe(() => {
            this.updatePosition();
        });
        this.subScriber.add(scrollSubscriber);
    }
    ngOnDestroy() {
        if (this.subScriber) {
            this.subScriber.unsubscribe();
        }
    }
    updatePosition() {
        const calcPosition = this.position === 'left' ? 'left-top' : this.position === 'right' ? 'right-top' : this.position;
        const rect = this.positionService.positionElements(this.triggerElement, this.elm.nativeElement, calcPosition, true);
        const targetRect = this.triggerElement.getBoundingClientRect();
        let left = rect.left;
        let top = rect.top;
        switch (rect.placementPrimary) {
            case 'top':
                left = targetRect.left + this.triggerElement.clientWidth / 2 - this.elm.nativeElement.clientWidth / 2;
                top = top + this.triggerElement.clientHeight / 2 - this.DOT_HORIZONTAL_MARGIN;
                break;
            case 'bottom':
                left = targetRect.left + this.triggerElement.clientWidth / 2 - this.elm.nativeElement.clientWidth / 2;
                top = top + this.DOT_HORIZONTAL_MARGIN / 2;
                break;
            case 'left':
                left = left + this.triggerElement.clientWidth / 2 - this.DOT_HORIZONTAL_MARGIN;
                top = top + this.triggerElement.clientHeight / 2 - this.DOT_VERTICAL_MARGIN;
                break;
            case 'right':
                left = left - this.triggerElement.clientWidth / 2 + this.DOT_HORIZONTAL_MARGIN;
                top = top + this.triggerElement.clientHeight / 2 - this.DOT_VERTICAL_MARGIN;
                break;
            default:
        }
        switch (rect.placementSecondary) {
            case 'left':
                left = targetRect.left;
                break;
            case 'right':
                left = targetRect.left - this.elm.nativeElement.clientWidth + this.triggerElement.clientWidth;
                break;
            default:
        }
        this.renderer.setStyle(this.elm.nativeElement, 'left', `${left}px`);
        this.renderer.setStyle(this.elm.nativeElement, 'top', `${top}px`);
        if (this.leftFix) {
            this.renderer.setStyle(this.elm.nativeElement, 'marginLeft', `${this.leftFix}px`);
        }
        if (this.topFix) {
            this.renderer.setStyle(this.elm.nativeElement, 'marginTop', `${this.topFix}px`);
        }
    }
    next() {
        const newStep = (this.stepIndex + 1 < this.stepsCount && this.stepIndex + 1) || this.stepsCount - 1;
        this.stepService.setCurrentIndex(newStep);
        this.close(newStep, 'next');
    }
    prev() {
        const newStep = (this.stepIndex - 1 > 0 && this.stepIndex - 1) || 0;
        this.stepService.setCurrentIndex(newStep);
        this.close(newStep, 'prev');
    }
    closeAll() {
        localStorage.setItem(`devui_guide_${this.pageName}`, '0');
        this.close(this.stepService.getCurrentStep(), 'close');
    }
    close(step, type) { }
}
StepsGuideComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: StepsGuideComponent, deps: [{ token: i1.StepsGuideService }, { token: i0.Renderer2 }, { token: i2.PositionService }, { token: i0.ElementRef }, { token: i3.I18nService }, { token: DOCUMENT }], target: i0.ɵɵFactoryTarget.Component });
StepsGuideComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.3", type: StepsGuideComponent, selector: "ng-component", host: { properties: { "class": "this.class", "style.display": "this.display" } }, ngImport: i0, template: "<div class=\"devui-shining-dot\"></div>\n<div class=\"devui-shining-plus\"></div>\n<div class=\"devui-arrow\"></div>\n<div class=\"devui-guide-container\">\n  <p class=\"devui-title\">{{ title }}</p>\n  <div class=\"icon icon-close\" (click)=\"closeAll()\"></div>\n  <div class=\"devui-content\" [innerHTML]=\"content | safe: 'html'\"></div>\n  <div class=\"devui-ctrl\">\n    <div *ngIf=\"dots.length > 1 && !extraConfig?.hideStepNav\" class=\"devui-dots\">\n      <em *ngFor=\"let dot of dots; index as i\" class=\"icon icon-dot-status {{ i === stepIndex ? 'devui-active' : '' }}\"></em>\n    </div>\n    <div class=\"devui-guide-btn\">\n      <div *ngIf=\"stepIndex > 0 && !extraConfig?.hidePreStep\" class=\"devui-prev-step\" (click)=\"prev()\">{{ i18nCommonText.previous }}</div>\n      <div *ngIf=\"stepIndex + 1 < stepsCount\" (click)=\"next()\">{{ i18nCommonText.next }}</div>\n      <div *ngIf=\"stepIndex === stepsCount - 1\" (click)=\"closeAll()\">{{ i18nCommonText.finish }}</div>\n    </div>\n  </div>\n</div>\n", styles: ["@charset \"UTF-8\";.devui-font-size-base{font-size:12px;font-size:var(--devui-font-size, 12px)}.devui-font-base{font-size:12px;font-size:var(--devui-font-size, 12px);font-weight:400;line-height:1.5}.devui-font-size-modal-title{font-size:18px;font-size:var(--devui-font-size-modal-title, 18px)}.devui-font-modal-title{font-size:18px;font-size:var(--devui-font-size-modal-title, 18px);font-weight:700;line-height:1.5}.devui-font-size-page-title{font-size:16px;font-size:var(--devui-font-size-page-title, 16px)}.devui-font-page-title{font-size:16px;font-size:var(--devui-font-size-page-title, 16px);font-weight:700;line-height:1.5}.devui-font-size-secondary-title{font-size:14px;font-size:var(--devui-font-size-card-title, 14px)}.devui-font-secondary-title{font-size:14px;font-size:var(--devui-font-size-card-title, 14px);font-weight:700;line-height:1.5}:host.devui-step-item{width:400px;min-height:160px;background:#5e7ce0;background:var(--devui-brand, #5e7ce0);box-shadow:0 4px 16px rgba(37,43,58,.1);box-shadow:var(--devui-shadow-length-feedback-overlay, 0 4px 16px 0) var(--devui-light-shadow, rgba(37, 43, 58, .1));border-radius:4px;border-radius:var(--devui-border-radius-feedback, 4px);font-size:12px;font-size:var(--devui-font-size, 12px);color:#fff;color:var(--devui-light-text, #ffffff);padding:20px;position:absolute}:host.devui-step-item .devui-title{font-size:16px;font-size:var(--devui-font-size-page-title, 16px);opacity:1;margin:0 0 20px;padding:0}:host.devui-step-item>.devui-arrow,:host.devui-step-item>.devui-arrow:after{position:absolute;display:block;width:0;height:0;border-color:transparent;border-style:solid}:host.devui-step-item>.devui-arrow{border-width:8px}:host.devui-step-item.left>.devui-arrow{top:23px;right:-6px;margin-top:-3px;border-right-width:0;transform:rotate(-135deg);border-left-color:#5e7ce0;border-left-color:var(--devui-brand, #5e7ce0)}:host.devui-step-item.top>.devui-arrow,:host.devui-step-item.top-left>.devui-arrow,:host.devui-step-item.top-right>.devui-arrow{bottom:-6px;border-bottom-width:0;border-top-color:#5e7ce0;border-top-color:var(--devui-brand, #5e7ce0);transform:rotate(135deg)}:host.devui-step-item.top>.devui-arrow{left:calc(50% - 4px)}:host.devui-step-item.top-left>.devui-arrow{left:23px}:host.devui-step-item.top-right>.devui-arrow{right:23px;transform:rotate(-135deg)}:host.devui-step-item.right>.devui-arrow{top:23px;left:-6px;margin-top:-3px;border-left-width:0;transform:rotate(135deg);border-right-color:#5e7ce0;border-right-color:var(--devui-brand, #5e7ce0)}:host.devui-step-item.bottom>.devui-arrow,:host.devui-step-item.bottom-left>.devui-arrow,:host.devui-step-item.bottom-right>.devui-arrow{top:-6px;margin-left:3px;border-top-width:0;border-bottom-color:#5e7ce0;border-bottom-color:var(--devui-brand, #5e7ce0)}:host.devui-step-item.bottom>.devui-arrow{left:calc(50% - 4px);transform:rotate(-135deg)}:host.devui-step-item.bottom-right>.devui-arrow{right:23px;transform:rotate(135deg)}:host.devui-step-item.bottom-left>.devui-arrow{left:23px;transform:rotate(-135deg)}:host.devui-step-item>.devui-shining-dot,:host.devui-step-item .devui-shining-plus{position:absolute;background:#5e7ce0;background:var(--devui-brand, #5e7ce0);width:6px;height:6px;border-radius:4px;border-radius:var(--devui-border-radius-feedback, 4px)}:host.devui-step-item.left>.devui-shining-dot,:host.devui-step-item.left>.devui-shining-plus{top:21px;right:-30px}:host.devui-step-item.right>.devui-shining-dot,:host.devui-step-item.right>.devui-shining-plus{top:21px;left:-30px}:host.devui-step-item.top>.devui-shining-dot,:host.devui-step-item.top>.devui-shining-plus{left:calc(50% - 3px);bottom:-30px}:host.devui-step-item.top-left>.devui-shining-dot,:host.devui-step-item.top-left>.devui-shining-plus{left:21px;bottom:-30px}:host.devui-step-item.top-right>.devui-shining-dot,:host.devui-step-item.top-right>.devui-shining-plus{right:21px;bottom:-30px}:host.devui-step-item.bottom>.devui-shining-dot,:host.devui-step-item.bottom>.devui-shining-plus{left:calc(50% - 3px);top:-30px}:host.devui-step-item.bottom-right>.devui-shining-dot,:host.devui-step-item.bottom-right>.devui-shining-plus{top:-30px;right:21px}:host.devui-step-item.bottom-left>.devui-shining-dot,:host.devui-step-item.bottom-left>.devui-shining-plus{top:-30px;left:21px}:host.devui-step-item .devui-shining-plus{-webkit-animation:devui-glow 2s 0s infinite;animation:devui-glow 2s 0s infinite}:host.devui-step-item .devui-guide-container{position:relative}:host.devui-step-item .devui-guide-container>.icon-close{position:absolute;top:0;right:0;cursor:pointer}:host.devui-step-item .devui-guide-container .devui-ctrl{display:flex;flex-wrap:wrap}:host.devui-step-item .devui-guide-container .devui-ctrl .devui-dots{color:#fff;color:var(--devui-light-text, #ffffff);position:relative;top:25px;font-size:12px;font-size:var(--devui-font-size, 12px);height:30px}:host.devui-step-item .devui-guide-container .devui-ctrl .devui-dots>em{opacity:.2;margin:0 5px 0 2px}:host.devui-step-item .devui-guide-container .devui-ctrl .devui-dots>em.devui-active{opacity:1}:host.devui-step-item .devui-guide-container .devui-ctrl .devui-guide-btn{display:flex;flex-flow:row nowrap;flex-grow:1;justify-content:flex-end;padding:20px 0 0;white-space:nowrap}:host.devui-step-item .devui-guide-container .devui-ctrl .devui-guide-btn>div{color:#fff;color:var(--devui-light-text, #ffffff);background:rgba(255,255,255,.1);border-radius:2px;border-radius:var(--devui-border-radius, 2px);padding:5px 15px;cursor:pointer;margin-left:10px}:host.devui-step-item .devui-guide-container .devui-ctrl .devui-guide-btn>div.devui-prev-step{background:none;border:solid 1px rgba(255,255,255,.1)}@-webkit-keyframes devui-glow{0%{transform:scale(1);opacity:.5}25%{transform:scale(2);opacity:.3}50%{transform:scale(3);opacity:.1}75%{transform:scale(2);opacity:.3}to{transform:scale(1);opacity:.5}}@keyframes devui-glow{0%{transform:scale(1);opacity:.5}25%{transform:scale(2);opacity:.3}50%{transform:scale(3);opacity:.1}75%{transform:scale(2);opacity:.3}to{transform:scale(1);opacity:.5}}\n"], directives: [{ type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i4.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }], pipes: { "safe": i5.SafePipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: StepsGuideComponent, decorators: [{
            type: Component,
            args: [{ preserveWhitespaces: false, template: "<div class=\"devui-shining-dot\"></div>\n<div class=\"devui-shining-plus\"></div>\n<div class=\"devui-arrow\"></div>\n<div class=\"devui-guide-container\">\n  <p class=\"devui-title\">{{ title }}</p>\n  <div class=\"icon icon-close\" (click)=\"closeAll()\"></div>\n  <div class=\"devui-content\" [innerHTML]=\"content | safe: 'html'\"></div>\n  <div class=\"devui-ctrl\">\n    <div *ngIf=\"dots.length > 1 && !extraConfig?.hideStepNav\" class=\"devui-dots\">\n      <em *ngFor=\"let dot of dots; index as i\" class=\"icon icon-dot-status {{ i === stepIndex ? 'devui-active' : '' }}\"></em>\n    </div>\n    <div class=\"devui-guide-btn\">\n      <div *ngIf=\"stepIndex > 0 && !extraConfig?.hidePreStep\" class=\"devui-prev-step\" (click)=\"prev()\">{{ i18nCommonText.previous }}</div>\n      <div *ngIf=\"stepIndex + 1 < stepsCount\" (click)=\"next()\">{{ i18nCommonText.next }}</div>\n      <div *ngIf=\"stepIndex === stepsCount - 1\" (click)=\"closeAll()\">{{ i18nCommonText.finish }}</div>\n    </div>\n  </div>\n</div>\n", styles: ["@charset \"UTF-8\";.devui-font-size-base{font-size:12px;font-size:var(--devui-font-size, 12px)}.devui-font-base{font-size:12px;font-size:var(--devui-font-size, 12px);font-weight:400;line-height:1.5}.devui-font-size-modal-title{font-size:18px;font-size:var(--devui-font-size-modal-title, 18px)}.devui-font-modal-title{font-size:18px;font-size:var(--devui-font-size-modal-title, 18px);font-weight:700;line-height:1.5}.devui-font-size-page-title{font-size:16px;font-size:var(--devui-font-size-page-title, 16px)}.devui-font-page-title{font-size:16px;font-size:var(--devui-font-size-page-title, 16px);font-weight:700;line-height:1.5}.devui-font-size-secondary-title{font-size:14px;font-size:var(--devui-font-size-card-title, 14px)}.devui-font-secondary-title{font-size:14px;font-size:var(--devui-font-size-card-title, 14px);font-weight:700;line-height:1.5}:host.devui-step-item{width:400px;min-height:160px;background:#5e7ce0;background:var(--devui-brand, #5e7ce0);box-shadow:0 4px 16px rgba(37,43,58,.1);box-shadow:var(--devui-shadow-length-feedback-overlay, 0 4px 16px 0) var(--devui-light-shadow, rgba(37, 43, 58, .1));border-radius:4px;border-radius:var(--devui-border-radius-feedback, 4px);font-size:12px;font-size:var(--devui-font-size, 12px);color:#fff;color:var(--devui-light-text, #ffffff);padding:20px;position:absolute}:host.devui-step-item .devui-title{font-size:16px;font-size:var(--devui-font-size-page-title, 16px);opacity:1;margin:0 0 20px;padding:0}:host.devui-step-item>.devui-arrow,:host.devui-step-item>.devui-arrow:after{position:absolute;display:block;width:0;height:0;border-color:transparent;border-style:solid}:host.devui-step-item>.devui-arrow{border-width:8px}:host.devui-step-item.left>.devui-arrow{top:23px;right:-6px;margin-top:-3px;border-right-width:0;transform:rotate(-135deg);border-left-color:#5e7ce0;border-left-color:var(--devui-brand, #5e7ce0)}:host.devui-step-item.top>.devui-arrow,:host.devui-step-item.top-left>.devui-arrow,:host.devui-step-item.top-right>.devui-arrow{bottom:-6px;border-bottom-width:0;border-top-color:#5e7ce0;border-top-color:var(--devui-brand, #5e7ce0);transform:rotate(135deg)}:host.devui-step-item.top>.devui-arrow{left:calc(50% - 4px)}:host.devui-step-item.top-left>.devui-arrow{left:23px}:host.devui-step-item.top-right>.devui-arrow{right:23px;transform:rotate(-135deg)}:host.devui-step-item.right>.devui-arrow{top:23px;left:-6px;margin-top:-3px;border-left-width:0;transform:rotate(135deg);border-right-color:#5e7ce0;border-right-color:var(--devui-brand, #5e7ce0)}:host.devui-step-item.bottom>.devui-arrow,:host.devui-step-item.bottom-left>.devui-arrow,:host.devui-step-item.bottom-right>.devui-arrow{top:-6px;margin-left:3px;border-top-width:0;border-bottom-color:#5e7ce0;border-bottom-color:var(--devui-brand, #5e7ce0)}:host.devui-step-item.bottom>.devui-arrow{left:calc(50% - 4px);transform:rotate(-135deg)}:host.devui-step-item.bottom-right>.devui-arrow{right:23px;transform:rotate(135deg)}:host.devui-step-item.bottom-left>.devui-arrow{left:23px;transform:rotate(-135deg)}:host.devui-step-item>.devui-shining-dot,:host.devui-step-item .devui-shining-plus{position:absolute;background:#5e7ce0;background:var(--devui-brand, #5e7ce0);width:6px;height:6px;border-radius:4px;border-radius:var(--devui-border-radius-feedback, 4px)}:host.devui-step-item.left>.devui-shining-dot,:host.devui-step-item.left>.devui-shining-plus{top:21px;right:-30px}:host.devui-step-item.right>.devui-shining-dot,:host.devui-step-item.right>.devui-shining-plus{top:21px;left:-30px}:host.devui-step-item.top>.devui-shining-dot,:host.devui-step-item.top>.devui-shining-plus{left:calc(50% - 3px);bottom:-30px}:host.devui-step-item.top-left>.devui-shining-dot,:host.devui-step-item.top-left>.devui-shining-plus{left:21px;bottom:-30px}:host.devui-step-item.top-right>.devui-shining-dot,:host.devui-step-item.top-right>.devui-shining-plus{right:21px;bottom:-30px}:host.devui-step-item.bottom>.devui-shining-dot,:host.devui-step-item.bottom>.devui-shining-plus{left:calc(50% - 3px);top:-30px}:host.devui-step-item.bottom-right>.devui-shining-dot,:host.devui-step-item.bottom-right>.devui-shining-plus{top:-30px;right:21px}:host.devui-step-item.bottom-left>.devui-shining-dot,:host.devui-step-item.bottom-left>.devui-shining-plus{top:-30px;left:21px}:host.devui-step-item .devui-shining-plus{-webkit-animation:devui-glow 2s 0s infinite;animation:devui-glow 2s 0s infinite}:host.devui-step-item .devui-guide-container{position:relative}:host.devui-step-item .devui-guide-container>.icon-close{position:absolute;top:0;right:0;cursor:pointer}:host.devui-step-item .devui-guide-container .devui-ctrl{display:flex;flex-wrap:wrap}:host.devui-step-item .devui-guide-container .devui-ctrl .devui-dots{color:#fff;color:var(--devui-light-text, #ffffff);position:relative;top:25px;font-size:12px;font-size:var(--devui-font-size, 12px);height:30px}:host.devui-step-item .devui-guide-container .devui-ctrl .devui-dots>em{opacity:.2;margin:0 5px 0 2px}:host.devui-step-item .devui-guide-container .devui-ctrl .devui-dots>em.devui-active{opacity:1}:host.devui-step-item .devui-guide-container .devui-ctrl .devui-guide-btn{display:flex;flex-flow:row nowrap;flex-grow:1;justify-content:flex-end;padding:20px 0 0;white-space:nowrap}:host.devui-step-item .devui-guide-container .devui-ctrl .devui-guide-btn>div{color:#fff;color:var(--devui-light-text, #ffffff);background:rgba(255,255,255,.1);border-radius:2px;border-radius:var(--devui-border-radius, 2px);padding:5px 15px;cursor:pointer;margin-left:10px}:host.devui-step-item .devui-guide-container .devui-ctrl .devui-guide-btn>div.devui-prev-step{background:none;border:solid 1px rgba(255,255,255,.1)}@-webkit-keyframes devui-glow{0%{transform:scale(1);opacity:.5}25%{transform:scale(2);opacity:.3}50%{transform:scale(3);opacity:.1}75%{transform:scale(2);opacity:.3}to{transform:scale(1);opacity:.5}}@keyframes devui-glow{0%{transform:scale(1);opacity:.5}25%{transform:scale(2);opacity:.3}50%{transform:scale(3);opacity:.1}75%{transform:scale(2);opacity:.3}to{transform:scale(1);opacity:.5}}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.StepsGuideService }, { type: i0.Renderer2 }, { type: i2.PositionService }, { type: i0.ElementRef }, { type: i3.I18nService }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }]; }, propDecorators: { class: [{
                type: HostBinding,
                args: ['class']
            }], display: [{
                type: HostBinding,
                args: ['style.display']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RlcHMtZ3VpZGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vZGV2dWkvc3RlcHMtZ3VpZGUvc3RlcHMtZ3VpZGUuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vZGV2dWkvc3RlcHMtZ3VpZGUvc3RlcHMtZ3VpZGUuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBaUIsU0FBUyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFxQixTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEgsT0FBTyxFQUFpQixXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxTQUFTLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQy9DLE9BQU8sRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7Ozs7Ozs7QUFRMUQsTUFBTSxPQUFPLG1CQUFtQjtJQTZCOUIsWUFDVSxXQUE4QixFQUM5QixRQUFtQixFQUNuQixlQUFnQyxFQUNoQyxHQUFlLEVBQ2YsSUFBaUIsRUFDQyxHQUFRO1FBTDFCLGdCQUFXLEdBQVgsV0FBVyxDQUFtQjtRQUM5QixhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQ25CLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUNoQyxRQUFHLEdBQUgsR0FBRyxDQUFZO1FBQ2YsU0FBSSxHQUFKLElBQUksQ0FBYTtRQUNDLFFBQUcsR0FBSCxHQUFHLENBQUs7UUFuQnBDLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFHakIsV0FBTSxHQUFHLElBQUksQ0FBQztRQUVkLFNBQUksR0FBcUIsRUFBRSxDQUFDO1FB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QUFXO3VCQUFDLE9BQU87Z0JBS2hCLE9BQU87c0JBRFYsV0FBVzt1QkFBQyxlQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBIb3N0QmluZGluZywgSW5qZWN0LCBPbkRlc3Ryb3ksIE9uSW5pdCwgUmVuZGVyZXIyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBJMThuSW50ZXJmYWNlLCBJMThuU2VydmljZSB9IGZyb20gJ25nLWRldnVpL2kxOG4nO1xuaW1wb3J0IHsgUG9zaXRpb25TZXJ2aWNlIH0gZnJvbSAnbmctZGV2dWkvcG9zaXRpb24nO1xuaW1wb3J0IHsgZnJvbUV2ZW50LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgdGhyb3R0bGVUaW1lIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgU3RlcHNHdWlkZVNlcnZpY2UgfSBmcm9tICcuL3N0ZXBzLWd1aWRlLnNlcnZpY2UnO1xuaW1wb3J0IHsgRXh0cmFDb25maWcgfSBmcm9tICcuL3N0ZXBzLWd1aWRlLnR5cGVzJztcblxuQENvbXBvbmVudCh7XG4gIHRlbXBsYXRlVXJsOiAnLi9zdGVwcy1ndWlkZS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3N0ZXBzLWd1aWRlLmNvbXBvbmVudC5zY3NzJ10sXG4gIHByZXNlcnZlV2hpdGVzcGFjZXM6IGZhbHNlLFxufSlcbmV4cG9ydCBjbGFzcyBTdGVwc0d1aWRlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICBASG9zdEJpbmRpbmcoJ2NsYXNzJylcbiAgZ2V0IGNsYXNzKCkge1xuICAgIHJldHVybiAnZGV2dWktc3RlcC1pdGVtICcgKyB0aGlzLnBvc2l0aW9uO1xuICB9XG4gIEBIb3N0QmluZGluZygnc3R5bGUuZGlzcGxheScpXG4gIGdldCBkaXNwbGF5KCkge1xuICAgIHJldHVybiAnYmxvY2snO1xuICB9XG4gIHRyaWdnZXJFbGVtZW50OiBIVE1MRWxlbWVudDtcbiAgc2Nyb2xsRWxlbWVudDogSFRNTEVsZW1lbnQ7XG4gIHBhZ2VOYW1lOiBzdHJpbmc7IC8vIOmhtemdouWQjeensO+8jOeUqOS6juagh+iusOW9k+mhteW4ruWKqeS/oeaBr+aYr+WQpuWFs+mXrVxuICB0aXRsZTogc3RyaW5nOyAvLyDlvJXlr7zmoIfpophcbiAgY29udGVudDogc3RyaW5nOyAvLyDlvJXlr7zku4vnu43lhoXlrrlcbiAgc3RlcHNDb3VudDogbnVtYmVyOyAvLyDmgLvmraXpqqTmlbBcbiAgc3RlcEluZGV4OiBudW1iZXI7IC8vIOivpeatpemqpOW6j+WPt1xuICBwb3NpdGlvbiA9ICd0b3AnO1xuICBsZWZ0Rml4OiBudW1iZXI7XG4gIHRvcEZpeDogbnVtYmVyO1xuICB6SW5kZXggPSAxMTAwO1xuICBleHRyYUNvbmZpZzogRXh0cmFDb25maWc7XG4gIGRvdHM6IEFycmF5PHVuZGVmaW5lZD4gPSBbXTtcbiAgc3ViU2NyaWJlcjogU3Vic2NyaXB0aW9uO1xuICBTQ1JPTExfUkVGUkVTSF9JTlRFUlZBTCA9IDEwMDtcbiAgaTE4bkNvbW1vblRleHQ6IEkxOG5JbnRlcmZhY2VbJ3N0ZXBzR3VpZGUnXTtcbiAgRE9UX0hPUklaT05UQUxfTUFSR0lOID0gMjc7XG4gIERPVF9WRVJUSUNBTF9NQVJHSU4gPSAyMjtcbiAgZG9jdW1lbnQ6IERvY3VtZW50O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgc3RlcFNlcnZpY2U6IFN0ZXBzR3VpZGVTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgICBwcml2YXRlIHBvc2l0aW9uU2VydmljZTogUG9zaXRpb25TZXJ2aWNlLFxuICAgIHByaXZhdGUgZWxtOiBFbGVtZW50UmVmLFxuICAgIHByaXZhdGUgaTE4bjogSTE4blNlcnZpY2UsXG4gICAgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2M6IGFueVxuICApIHtcbiAgICB0aGlzLmRvY3VtZW50ID0gdGhpcy5kb2M7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmRvdHMgPSBuZXcgQXJyYXkodGhpcy5zdGVwc0NvdW50KTtcbiAgICB0aGlzLmVsbS5uYXRpdmVFbGVtZW50LnN0eWxlLnpJbmRleCA9IHRoaXMuekluZGV4O1xuICAgIHRoaXMuaTE4bkNvbW1vblRleHQgPSB0aGlzLmkxOG4uZ2V0STE4blRleHQoKS5zdGVwc0d1aWRlO1xuICAgIGNvbnN0IGkxOG5TdWJzY3JpcHRpb24gPSB0aGlzLmkxOG4ubGFuZ0NoYW5nZSgpLnN1YnNjcmliZSgoZGF0YSkgPT4ge1xuICAgICAgdGhpcy5pMThuQ29tbW9uVGV4dCA9IGRhdGEuc3RlcHNHdWlkZTtcbiAgICB9KTtcblxuICAgIHRoaXMuc3ViU2NyaWJlciA9IGZyb21FdmVudCh3aW5kb3csICdyZXNpemUnKVxuICAgICAgLnBpcGUoZGVib3VuY2VUaW1lKHRoaXMuU0NST0xMX1JFRlJFU0hfSU5URVJWQUwpKVxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIHRoaXMudXBkYXRlUG9zaXRpb24oKTtcbiAgICAgIH0pO1xuICAgIHRoaXMuc3ViU2NyaWJlci5hZGQoaTE4blN1YnNjcmlwdGlvbik7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy51cGRhdGVQb3NpdGlvbigpO1xuICAgIGlmICghdGhpcy5zY3JvbGxFbGVtZW50KSB7XG4gICAgICBjb25zdCBjdXJyZW50U2Nyb2xsRWxlbWVudCA9IHRoaXMucG9zaXRpb25TZXJ2aWNlLmdldFNjcm9sbFBhcmVudCh0aGlzLnRyaWdnZXJFbGVtZW50KTtcbiAgICAgIHRoaXMuc2Nyb2xsRWxlbWVudCA9IGN1cnJlbnRTY3JvbGxFbGVtZW50ID09PSB0aGlzLmRvY3VtZW50LmJvZHkgPyB3aW5kb3cgOiBjdXJyZW50U2Nyb2xsRWxlbWVudDtcbiAgICB9XG4gICAgY29uc3Qgc2Nyb2xsU3Vic2NyaWJlciA9IGZyb21FdmVudCh0aGlzLnNjcm9sbEVsZW1lbnQsICdzY3JvbGwnKVxuICAgICAgLnBpcGUodGhyb3R0bGVUaW1lKHRoaXMuU0NST0xMX1JFRlJFU0hfSU5URVJWQUwsIHVuZGVmaW5lZCwgeyBsZWFkaW5nOiB0cnVlLCB0cmFpbGluZzogdHJ1ZSB9KSlcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLnVwZGF0ZVBvc2l0aW9uKCk7XG4gICAgICB9KTtcbiAgICB0aGlzLnN1YlNjcmliZXIuYWRkKHNjcm9sbFN1YnNjcmliZXIpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuc3ViU2NyaWJlcikge1xuICAgICAgdGhpcy5zdWJTY3JpYmVyLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgdXBkYXRlUG9zaXRpb24oKSB7XG4gICAgY29uc3QgY2FsY1Bvc2l0aW9uID0gdGhpcy5wb3NpdGlvbiA9PT0gJ2xlZnQnID8gJ2xlZnQtdG9wJyA6IHRoaXMucG9zaXRpb24gPT09ICdyaWdodCcgPyAncmlnaHQtdG9wJyA6IHRoaXMucG9zaXRpb247XG4gICAgY29uc3QgcmVjdCA9IHRoaXMucG9zaXRpb25TZXJ2aWNlLnBvc2l0aW9uRWxlbWVudHModGhpcy50cmlnZ2VyRWxlbWVudCwgdGhpcy5lbG0ubmF0aXZlRWxlbWVudCwgY2FsY1Bvc2l0aW9uLCB0cnVlKTtcbiAgICBjb25zdCB0YXJnZXRSZWN0ID0gdGhpcy50cmlnZ2VyRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBsZXQgbGVmdCA9IHJlY3QubGVmdDtcbiAgICBsZXQgdG9wID0gcmVjdC50b3A7XG5cbiAgICBzd2l0Y2ggKHJlY3QucGxhY2VtZW50UHJpbWFyeSkge1xuICAgIGNhc2UgJ3RvcCc6XG4gICAgICBsZWZ0ID0gdGFyZ2V0UmVjdC5sZWZ0ICsgdGhpcy50cmlnZ2VyRWxlbWVudC5jbGllbnRXaWR0aCAvIDIgLSB0aGlzLmVsbS5uYXRpdmVFbGVtZW50LmNsaWVudFdpZHRoIC8gMjtcbiAgICAgIHRvcCA9IHRvcCArIHRoaXMudHJpZ2dlckVsZW1lbnQuY2xpZW50SGVpZ2h0IC8gMiAtIHRoaXMuRE9UX0hPUklaT05UQUxfTUFSR0lOO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnYm90dG9tJzpcbiAgICAgIGxlZnQgPSB0YXJnZXRSZWN0LmxlZnQgKyB0aGlzLnRyaWdnZXJFbGVtZW50LmNsaWVudFdpZHRoIC8gMiAtIHRoaXMuZWxtLm5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGggLyAyO1xuICAgICAgdG9wID0gdG9wICsgdGhpcy5ET1RfSE9SSVpPTlRBTF9NQVJHSU4gLyAyO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnbGVmdCc6XG4gICAgICBsZWZ0ID0gbGVmdCArIHRoaXMudHJpZ2dlckVsZW1lbnQuY2xpZW50V2lkdGggLyAyIC0gdGhpcy5ET1RfSE9SSVpPTlRBTF9NQVJHSU47XG4gICAgICB0b3AgPSB0b3AgKyB0aGlzLnRyaWdnZXJFbGVtZW50LmNsaWVudEhlaWdodCAvIDIgLSB0aGlzLkRPVF9WRVJUSUNBTF9NQVJHSU47XG4gICAgICBicmVhaztcbiAgICBjYXNlICdyaWdodCc6XG4gICAgICBsZWZ0ID0gbGVmdCAtIHRoaXMudHJpZ2dlckVsZW1lbnQuY2xpZW50V2lkdGggLyAyICsgdGhpcy5ET1RfSE9SSVpPTlRBTF9NQVJHSU47XG4gICAgICB0b3AgPSB0b3AgKyB0aGlzLnRyaWdnZXJFbGVtZW50LmNsaWVudEhlaWdodCAvIDIgLSB0aGlzLkRPVF9WRVJUSUNBTF9NQVJHSU47XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgIH1cblxuICAgIHN3aXRjaCAocmVjdC5wbGFjZW1lbnRTZWNvbmRhcnkpIHtcbiAgICBjYXNlICdsZWZ0JzpcbiAgICAgIGxlZnQgPSB0YXJnZXRSZWN0LmxlZnQ7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdyaWdodCc6XG4gICAgICBsZWZ0ID0gdGFyZ2V0UmVjdC5sZWZ0IC0gdGhpcy5lbG0ubmF0aXZlRWxlbWVudC5jbGllbnRXaWR0aCArIHRoaXMudHJpZ2dlckVsZW1lbnQuY2xpZW50V2lkdGg7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgIH1cblxuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbG0ubmF0aXZlRWxlbWVudCwgJ2xlZnQnLCBgJHtsZWZ0fXB4YCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsbS5uYXRpdmVFbGVtZW50LCAndG9wJywgYCR7dG9wfXB4YCk7XG5cbiAgICBpZiAodGhpcy5sZWZ0Rml4KSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxtLm5hdGl2ZUVsZW1lbnQsICdtYXJnaW5MZWZ0JywgYCR7dGhpcy5sZWZ0Rml4fXB4YCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnRvcEZpeCkge1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsbS5uYXRpdmVFbGVtZW50LCAnbWFyZ2luVG9wJywgYCR7dGhpcy50b3BGaXh9cHhgKTtcbiAgICB9XG4gIH1cblxuICBuZXh0KCkge1xuICAgIGNvbnN0IG5ld1N0ZXAgPSAodGhpcy5zdGVwSW5kZXggKyAxIDwgdGhpcy5zdGVwc0NvdW50ICYmIHRoaXMuc3RlcEluZGV4ICsgMSkgfHwgdGhpcy5zdGVwc0NvdW50IC0gMTtcbiAgICB0aGlzLnN0ZXBTZXJ2aWNlLnNldEN1cnJlbnRJbmRleChuZXdTdGVwKTtcbiAgICB0aGlzLmNsb3NlKG5ld1N0ZXAsICduZXh0Jyk7XG4gIH1cblxuICBwcmV2KCkge1xuICAgIGNvbnN0IG5ld1N0ZXAgPSAodGhpcy5zdGVwSW5kZXggLSAxID4gMCAmJiB0aGlzLnN0ZXBJbmRleCAtIDEpIHx8IDA7XG4gICAgdGhpcy5zdGVwU2VydmljZS5zZXRDdXJyZW50SW5kZXgobmV3U3RlcCk7XG4gICAgdGhpcy5jbG9zZShuZXdTdGVwLCAncHJldicpO1xuICB9XG5cbiAgY2xvc2VBbGwoKSB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYGRldnVpX2d1aWRlXyR7dGhpcy5wYWdlTmFtZX1gLCAnMCcpO1xuICAgIHRoaXMuY2xvc2UodGhpcy5zdGVwU2VydmljZS5nZXRDdXJyZW50U3RlcCgpLCAnY2xvc2UnKTtcbiAgfVxuXG4gIGNsb3NlKHN0ZXAsIHR5cGU/KSB7fVxufVxuIiwiPGRpdiBjbGFzcz1cImRldnVpLXNoaW5pbmctZG90XCI+PC9kaXY+XG48ZGl2IGNsYXNzPVwiZGV2dWktc2hpbmluZy1wbHVzXCI+PC9kaXY+XG48ZGl2IGNsYXNzPVwiZGV2dWktYXJyb3dcIj48L2Rpdj5cbjxkaXYgY2xhc3M9XCJkZXZ1aS1ndWlkZS1jb250YWluZXJcIj5cbiAgPHAgY2xhc3M9XCJkZXZ1aS10aXRsZVwiPnt7IHRpdGxlIH19PC9wPlxuICA8ZGl2IGNsYXNzPVwiaWNvbiBpY29uLWNsb3NlXCIgKGNsaWNrKT1cImNsb3NlQWxsKClcIj48L2Rpdj5cbiAgPGRpdiBjbGFzcz1cImRldnVpLWNvbnRlbnRcIiBbaW5uZXJIVE1MXT1cImNvbnRlbnQgfCBzYWZlOiAnaHRtbCdcIj48L2Rpdj5cbiAgPGRpdiBjbGFzcz1cImRldnVpLWN0cmxcIj5cbiAgICA8ZGl2ICpuZ0lmPVwiZG90cy5sZW5ndGggPiAxICYmICFleHRyYUNvbmZpZz8uaGlkZVN0ZXBOYXZcIiBjbGFzcz1cImRldnVpLWRvdHNcIj5cbiAgICAgIDxlbSAqbmdGb3I9XCJsZXQgZG90IG9mIGRvdHM7IGluZGV4IGFzIGlcIiBjbGFzcz1cImljb24gaWNvbi1kb3Qtc3RhdHVzIHt7IGkgPT09IHN0ZXBJbmRleCA/ICdkZXZ1aS1hY3RpdmUnIDogJycgfX1cIj48L2VtPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJkZXZ1aS1ndWlkZS1idG5cIj5cbiAgICAgIDxkaXYgKm5nSWY9XCJzdGVwSW5kZXggPiAwICYmICFleHRyYUNvbmZpZz8uaGlkZVByZVN0ZXBcIiBjbGFzcz1cImRldnVpLXByZXYtc3RlcFwiIChjbGljayk9XCJwcmV2KClcIj57eyBpMThuQ29tbW9uVGV4dC5wcmV2aW91cyB9fTwvZGl2PlxuICAgICAgPGRpdiAqbmdJZj1cInN0ZXBJbmRleCArIDEgPCBzdGVwc0NvdW50XCIgKGNsaWNrKT1cIm5leHQoKVwiPnt7IGkxOG5Db21tb25UZXh0Lm5leHQgfX08L2Rpdj5cbiAgICAgIDxkaXYgKm5nSWY9XCJzdGVwSW5kZXggPT09IHN0ZXBzQ291bnQgLSAxXCIgKGNsaWNrKT1cImNsb3NlQWxsKClcIj57eyBpMThuQ29tbW9uVGV4dC5maW5pc2ggfX08L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L2Rpdj5cbiJdfQ==