import { DOCUMENT } from '@angular/common';
import { Inject, Injectable } from '@angular/core';
import { Subject } from 'rxjs';
import * as i0 from "@angular/core";
export class DatepickerProService {
    constructor(doc) {
        this.doc = doc;
        this.curRangeDate = [];
        this.calendarRange = [1970, 2099];
        this.currentActiveInput = 'start';
        this._minDate = new Date(this.calendarRange[0], 0, 1);
        this._maxDate = new Date(this.calendarRange[1], 11, 31);
        this.toggleEvent = new Subject();
        this.closeDropdownEvent = new Subject();
        this.activeInputChange = new Subject();
        this.selectedDateChange = new Subject();
        this.updateDateValue = new Subject();
        this.selectedTimeChange = new Subject();
        this.updateTimeChange = new Subject();
        this.detectedChanges = new Subject();
        this.document = this.doc;
    }
    set minDate(value) {
        this._minDate = new Date(value) || new Date(this.calendarRange[0], 0, 1);
        this.detectedChanges.next();
    }
    get minDate() {
        return this._minDate;
    }
    set maxDate(value) {
        this._maxDate = new Date(value) || new Date(this.calendarRange[1], 11, 31);
        this.detectedChanges.next();
    }
    get maxDate() {
        return this._maxDate;
    }
    get closeAfterSelected() {
        return !this.isRange && !this.showTime;
    }
    get curHour() {
        if (this.isRange) {
            return (this.currentActiveInput === 'start' ? this.curRangeDate[0]?.getHours() : this.curRangeDate[1]?.getHours()) || 0;
        }
        else {
            return this.curDate?.getHours() || 0;
        }
    }
    get curMin() {
        if (this.isRange) {
            return (this.currentActiveInput === 'start' ? this.curRangeDate[0]?.getMinutes() : this.curRangeDate[1]?.getMinutes()) || 0;
        }
        else {
            return this.curDate?.getMinutes() || 0;
        }
    }
    get curSec() {
        if (this.isRange) {
            return (this.currentActiveInput === 'start' ? this.curRangeDate[0]?.getSeconds() : this.curRangeDate[1]?.getSeconds()) || 0;
        }
        else {
            return this.curDate?.getSeconds() || 0;
        }
    }
    dateInRange(date) {
        if (!date) {
            return true;
        }
        return (date.getTime() > this.minDate.getTime() && date.getTime() < this.maxDate.getTime()) ||
            date.toDateString() === this.minDate.toDateString() || date.toDateString() === this.maxDate.toDateString();
    }
    // 对范围模式下一些非法的选择进行修正
    fixRangeDate() {
        const start = this.curRangeDate[0]?.getTime();
        const end = this.curRangeDate[1]?.getTime();
        if (start && end && end < start) {
            if (this.currentActiveInput === 'start') {
                this.curRangeDate[1] = null;
            }
            else if (this.currentActiveInput === 'end') {
                this.curRangeDate[0] = null;
            }
        }
    }
    // 判断日期是否为起始日期
    isStartDate(date) {
        if (!this.isRange) {
            return false;
        }
        if (this.currentActiveInput === 'start') {
            return date.toDateString() === this.curHoverDate?.toDateString() || date.toDateString() === this.curRangeDate[0]?.toDateString();
        }
        return date.toDateString() === this.curRangeDate[0]?.toDateString();
    }
    // 判断日期是否为结束日期
    isEndDate(date) {
        if (!this.isRange) {
            return false;
        }
        if (this.currentActiveInput === 'end') {
            return date.toDateString() === this.curHoverDate?.toDateString() || date.toDateString() === this.curRangeDate[1]?.toDateString();
        }
        return date.toDateString() === this.curRangeDate[1]?.toDateString();
    }
    // 判断日期是否在hover范围或者选中的范围内
    isDateInRange(date) {
        const dateTime = date.getTime();
        const dateStr = date.toDateString();
        if (this.isRange) {
            if (this.currentActiveInput === 'start') {
                return (this.curHoverDate || this.curRangeDate[0])?.getTime() < dateTime &&
                    (this.curHoverDate || this.curRangeDate[0])?.toDateString() !== dateStr &&
                    this.curRangeDate[1]?.getTime() > dateTime &&
                    this.curRangeDate[1]?.toDateString() !== dateStr;
            }
            else {
                return this.curRangeDate[0]?.getTime() < dateTime &&
                    this.curRangeDate[0]?.toDateString() !== dateStr &&
                    (this.curHoverDate || this.curRangeDate[1])?.getTime() > dateTime &&
                    (this.curHoverDate || this.curRangeDate[1]).toDateString() !== dateStr;
            }
        }
        else {
            return false;
        }
    }
    // 判断日期是否在已选中的范围内，与hover做区分
    isDateInSelectRange(date) {
        if (!this.isRange) {
            return false;
        }
        if (!this.curRangeDate[0] || !this.curRangeDate[1]) {
            return false;
        }
        return this.curRangeDate[0].getTime() < date.getTime() && this.curRangeDate[1].getTime() > date.getTime() &&
            this.curRangeDate[1].toDateString() !== date.toDateString() && this.curRangeDate[0].toDateString() !== date.toDateString();
    }
    isDateActive(date) {
        const dateStr = date.toDateString();
        if (this.isRange) {
            return dateStr === this.curRangeDate[0]?.toDateString() || dateStr === this.curRangeDate[1]?.toDateString();
        }
        else {
            return dateStr === this.curDate?.toDateString();
        }
    }
    isMonthActive(yearIndex, monthIndex) {
        if (this.isRange) {
            return (yearIndex === this.curRangeDate[0]?.getFullYear() && monthIndex === this.curRangeDate[0]?.getMonth()) ||
                (yearIndex === this.curRangeDate[1]?.getFullYear() && monthIndex === this.curRangeDate[1]?.getMonth());
        }
        else {
            return yearIndex === this.curDate?.getFullYear() && monthIndex === this.curDate?.getMonth();
        }
    }
    isYearActive(yearIndex) {
        if (this.isRange) {
            return yearIndex === this.curRangeDate[0]?.getFullYear() || yearIndex === this.curRangeDate[1]?.getFullYear();
        }
        else {
            return yearIndex === this.curDate?.getFullYear();
        }
    }
    // 是否为范围选中日期中对应的input激活项
    isActiveInputTypeDate(date) {
        if (!this.isRange) {
            return false;
        }
        if (this.currentActiveInput === 'start') {
            return date.toDateString() === this.curRangeDate[0]?.toDateString();
        }
        else {
            return date.toDateString() === this.curRangeDate[1]?.toDateString();
        }
    }
    // 是否为选中日期且在废弃范围逻辑内
    isDateAbandon(date) {
        if (!this.isRange || (!this.curRangeDate[0] || !this.curRangeDate[1])) {
            return false;
        }
        if (!this.isDateActive(date)) {
            return false;
        }
        if (this.currentActiveInput === 'start') {
            return this.curHoverDate?.getTime() > date.getTime();
        }
        else {
            return this.curHoverDate?.getTime() < date.getTime();
        }
    }
    isInSuggestList(date) {
        if (!this.markedRangeDateList) {
            return false;
        }
        for (let index = 0; index < this.markedRangeDateList.length; index++) {
            const range = this.markedRangeDateList[index];
            if (range[0]?.getTime() < date.getTime() && range[1]?.getTime() > date.getTime()) {
                return true;
            }
            if (range[0]?.toDateString() === date.toDateString() || range[1]?.toDateString() === date.toDateString()) {
                return true;
            }
        }
        return false;
    }
    isMarkedDate(date) {
        for (let index = 0; index < this.markedDateList?.length; index++) {
            if (this.markedDateList[index]?.toDateString() === date.toDateString()) {
                return true;
            }
        }
        return false;
    }
    mearsureStrWidth(str) {
        const mearsureDom = this.document.createElement('span');
        mearsureDom.innerText = str;
        mearsureDom.style.visibility = 'hidden';
        this.document.body.appendChild(mearsureDom);
        const domWidth = mearsureDom.offsetWidth;
        this.document.body.removeChild(mearsureDom);
        return domWidth;
    }
    ngOnDestroy() {
        this.toggleEvent.complete();
        this.selectedDateChange.complete();
        this.closeDropdownEvent.complete();
        this.updateDateValue.complete();
        this.updateTimeChange.complete();
        this.selectedTimeChange.complete();
        this.activeInputChange.complete();
        this.detectedChanges.complete();
    }
}
DatepickerProService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DatepickerProService, deps: [{ token: DOCUMENT }], target: i0.ɵɵFactoryTarget.Injectable });
DatepickerProService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DatepickerProService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DatepickerProService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }]; } });
export class DatepickerProCommonDataService {
    constructor() {
        this.calendarDataCache = {};
    }
}
DatepickerProCommonDataService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DatepickerProCommonDataService, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
DatepickerProCommonDataService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DatepickerProCommonDataService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DatepickerProCommonDataService, decorators: [{
            type: Injectable
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZXBpY2tlci1wcm8uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2RldnVpL2RhdGVwaWNrZXItcHJvL2RhdGVwaWNrZXItcHJvLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUEwQixNQUFNLGVBQWUsQ0FBQztBQUMzRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDOztBQUcvQixNQUFNLE9BQU8sb0JBQW9CO0lBK0UvQixZQUFzQyxHQUFRO1FBQVIsUUFBRyxHQUFILEdBQUcsQ0FBSztRQTdFOUMsaUJBQVksR0FBVyxFQUFFLENBQUM7UUFRMUIsa0JBQWEsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUM3Qix1QkFBa0IsR0FBb0IsT0FBTyxDQUFDO1FBQzlDLGFBQVEsR0FBUyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQVF2RCxhQUFRLEdBQVMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFrQ2hELGdCQUFXLEdBQUcsSUFBSSxPQUFPLEVBQVcsQ0FBQztRQUNyQyx1QkFBa0IsR0FBRyxJQUFJLE9BQU8sRUFBVyxDQUFDO1FBQzVDLHNCQUFpQixHQUFHLElBQUksT0FBTyxFQUFtQixDQUFDO1FBQ25ELHVCQUFrQixHQUFHLElBQUksT0FBTyxFQUdyQyxDQUFDO1FBQ0ksb0JBQWUsR0FBRyxJQUFJLE9BQU8sRUFHbEMsQ0FBQztRQUNJLHVCQUFrQixHQUFHLElBQUksT0FBTyxFQUtyQyxDQUFDO1FBQ0kscUJBQWdCLEdBQUcsSUFBSSxPQUFP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RkFBcEIsb0JBQW9CO2tCQURoQyxVQUFVOzswQkFnRkksTUFBTTsyQkFBQyxRQUFROztBQXVNOUIsTUFBTSxPQUFPLDhCQUE4QjtJQUQzQztRQUVFLHNCQUFpQixHQUFHLEVBQUUsQ0FBQztLQUN4Qjs7MkhBRlksOEJBQThCOytIQUE5Qiw4QkFBOEI7MkZBQTlCLDhCQUE4QjtrQkFEMUMsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSwgT25EZXN0cm95LCBUZW1wbGF0ZVJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRGF0ZXBpY2tlclByb1NlcnZpY2UgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuICBjdXJEYXRlOiBEYXRlO1xuICBjdXJSYW5nZURhdGU6IERhdGVbXSA9IFtdO1xuICBjdXJIb3ZlckRhdGU6IERhdGU7XG4gIHN0YXJ0SW5kZXhPZldlZWs6IG51bWJlcjtcbiAgaXNSYW5nZTogYm9vbGVhbjtcbiAgbWFya2VkUmFuZ2VEYXRlTGlzdDogRGF0ZVtdW107XG4gIG1hcmtEYXRlSW5mb1RlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xuICBtYXJrZWREYXRlTGlzdDogRGF0ZVtdO1xuICBzaG93VGltZTogYm9vbGVhbjtcbiAgY2FsZW5kYXJSYW5nZSA9IFsxOTcwLCAyMDk5XTtcbiAgY3VycmVudEFjdGl2ZUlucHV0OiAnc3RhcnQnIHwgJ2VuZCcgPSAnc3RhcnQnO1xuICBfbWluRGF0ZTogRGF0ZSA9IG5ldyBEYXRlKHRoaXMuY2FsZW5kYXJSYW5nZVswXSwgMCwgMSk7XG4gIHNldCBtaW5EYXRlKHZhbHVlOiBEYXRlKSB7XG4gICAgdGhpcy5fbWluRGF0ZSA9IG5ldyBEYXRlKHZhbHVlKSB8fCBuZXcgRGF0ZSh0aGlzLmNhbGVuZGFyUmFuZ2VbMF0sIDAsIDEpO1xuICAgIHRoaXMuZGV0ZWN0ZWRDaGFuZ2VzLm5leHQoKTtcbiAgfVxuICBnZXQgbWluRGF0ZSgpOiBEYXRlIHtcbiAgICByZXR1cm4gdGhpcy5fbWluRGF0ZTtcbiAgfVxuICBfbWF4RGF0ZTogRGF0ZSA9IG5ldyBEYXRlKHRoaXMuY2FsZW5kYXJSYW5nZVsxXSwgMTEsIDMxKTtcbiAgc2V0IG1heERhdGUodmFsdWU6IERhdGUpIHtcbiAgICB0aGlzLl9tYXhEYXRlID0gbmV3IERhdGUodmFsdWUpIHx8IG5ldyBEYXRlKHRoaXMuY2FsZW5kYXJSYW5nZVsxXSwgMTEsIDMxKTtcbiAgICB0aGlzLmRldGVjdGVkQ2hhbmdlcy5uZXh0KCk7XG4gIH1cbiAgZ2V0IG1heERhdGUoKTogRGF0ZSB7XG4gICAgcmV0dXJuIHRoaXMuX21heERhdGU7XG4gIH1cbiAgZG9jdW1lbnQ6IERvY3VtZW50O1xuICBnZXQgY2xvc2VBZnRlclNlbGVjdGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy5pc1JhbmdlICYmICF0aGlzLnNob3dUaW1lO1xuICB9XG5cbiAgZ2V0IGN1ckhvdXIoKSB7XG4gICAgaWYgKHRoaXMuaXNSYW5nZSkge1xuICAgICAgcmV0dXJuICh0aGlzLmN1cnJlbnRBY3RpdmVJbnB1dCA9PT0gJ3N0YXJ0JyA/IHRoaXMuY3VyUmFuZ2VEYXRlWzBdPy5nZXRIb3VycygpIDogdGhpcy5jdXJSYW5nZURhdGVbMV0/LmdldEhvdXJzKCkpIHx8IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLmN1ckRhdGU/LmdldEhvdXJzKCkgfHwgMDtcbiAgICB9XG4gIH1cbiAgZ2V0IGN1ck1pbigpIHtcbiAgICBpZiAodGhpcy5pc1JhbmdlKSB7XG4gICAgICByZXR1cm4gKHRoaXMuY3VycmVudEFjdGl2ZUlucHV0ID09PSAnc3RhcnQnID8gdGhpcy5jdXJSYW5nZURhdGVbMF0/LmdldE1pbnV0ZXMoKSA6IHRoaXMuY3VyUmFuZ2VEYXRlWzFdPy5nZXRNaW51dGVzKCkpIHx8IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLmN1ckRhdGU/LmdldE1pbnV0ZXMoKSB8fCAwO1xuICAgIH1cbiAgfVxuICBnZXQgY3VyU2VjKCkge1xuICAgIGlmICh0aGlzLmlzUmFuZ2UpIHtcbiAgICAgIHJldHVybiAodGhpcy5jdXJyZW50QWN0aXZlSW5wdXQgPT09ICdzdGFydCcgPyB0aGlzLmN1clJhbmdlRGF0ZVswXT8uZ2V0U2Vjb25kcygpIDogdGhpcy5jdXJSYW5nZURhdGVbMV0/LmdldFNlY29uZHMoKSkgfHwgMDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuY3VyRGF0ZT8uZ2V0U2Vjb25kcygpIHx8IDA7XG4gICAgfVxuICB9XG4gIHJlYWRvbmx5IHRvZ2dsZUV2ZW50ID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcbiAgcmVhZG9ubHkgY2xvc2VEcm9wZG93bkV2ZW50ID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcbiAgcmVhZG9ubHkgYWN0aXZlSW5wdXRDaGFuZ2UgPSBuZXcgU3ViamVjdDwnc3RhcnQnIHwgJ2VuZCc+KCk7XG4gIHJlYWRvbmx5IHNlbGVjdGVkRGF0ZUNoYW5nZSA9IG5ldyBTdWJqZWN0PHtcbiAgICB0eXBlOiAnc2luZ2xlJyB8ICdyYW5nZSc7XG4gICAgdmFsdWU6IERhdGUgfCBEYXRlW107XG4gIH0+KCk7XG4gIHJlYWRvbmx5IHVwZGF0ZURhdGVWYWx1ZSA9IG5ldyBTdWJqZWN0PHtcbiAgICB0eXBlOiAnc2luZ2xlJyB8ICdyYW5nZSc7XG4gICAgdmFsdWU6IERhdGUgfCBEYXRlW107XG4gIH0+KCk7XG4gIHJlYWRvbmx5IHNlbGVjdGVkVGltZUNoYW5nZSA9IG5ldyBTdWJqZWN0PHtcbiAgICBhY3RpdmVJbnB1dD86ICdzdGFydCcgfCAnZW5kJztcbiAgICBob3VyOiBudW1iZXI7XG4gICAgbWluOiBudW1iZXI7XG4gICAgc2Vjb25kczogbnVtYmVyO1xuICB9PigpO1xuICByZWFkb25seSB1cGRhdGVUaW1lQ2hhbmdlID0gbmV3IFN1YmplY3Q8e1xuICAgIGFjdGl2ZUlucHV0PzogJ3N0YXJ0JyB8ICdlbmQnO1xuICAgIGhvdXI6IG51bWJlcjtcbiAgICBtaW46IG51bWJlcjtcbiAgICBzZWNvbmRzOiBudW1iZXI7XG4gIH0+KCk7XG4gIHJlYWRvbmx5IGRldGVjdGVkQ2hhbmdlcyA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG5cbiAgY29uc3RydWN0b3IoQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2M6IGFueSkge1xuICAgIHRoaXMuZG9jdW1lbnQgPSB0aGlzLmRvYztcbiAgfVxuICBkYXRlSW5SYW5nZShkYXRlOiBEYXRlKTogYm9vbGVhbiB7XG4gICAgaWYgKCFkYXRlKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIChkYXRlLmdldFRpbWUoKSA+IHRoaXMubWluRGF0ZS5nZXRUaW1lKCkgJiYgZGF0ZS5nZXRUaW1lKCkgPCB0aGlzLm1heERhdGUuZ2V0VGltZSgpKSB8fFxuICAgICAgZGF0ZS50b0RhdGVTdHJpbmcoKSA9PT0gdGhpcy5taW5EYXRlLnRvRGF0ZVN0cmluZygpIHx8IGRhdGUudG9EYXRlU3RyaW5nKCkgPT09IHRoaXMubWF4RGF0ZS50b0RhdGVTdHJpbmcoKTtcbiAgfVxuXG4gIC8vIOWvueiMg+WbtOaooeW8j+S4i+S4gOS6m+mdnuazleeahOmAieaLqei/m+ihjOS/ruato1xuICBmaXhSYW5nZURhdGUoKSB7XG4gICAgY29uc3Qgc3RhcnQgPSB0aGlzLmN1clJhbmdlRGF0ZVswXT8uZ2V0VGltZSgpO1xuICAgIGNvbnN0IGVuZCA9IHRoaXMuY3VyUmFuZ2VEYXRlWzFdPy5nZXRUaW1lKCk7XG5cbiAgICBpZiAoc3RhcnQgJiYgZW5kICYmIGVuZCA8IHN0YXJ0KSB7XG4gICAgICBpZiAodGhpcy5jdXJyZW50QWN0aXZlSW5wdXQgPT09ICdzdGFydCcpIHtcbiAgICAgICAgdGhpcy5jdXJSYW5nZURhdGVbMV0gPSBudWxsO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmN1cnJlbnRBY3RpdmVJbnB1dCA9PT0gJ2VuZCcpIHtcbiAgICAgICAgdGhpcy5jdXJSYW5nZURhdGVbMF0gPSBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIOWIpOaWreaXpeacn+aYr+WQpuS4uui1t+Wni+aXpeacn1xuICBpc1N0YXJ0RGF0ZShkYXRlOiBEYXRlKTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLmlzUmFuZ2UpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jdXJyZW50QWN0aXZlSW5wdXQgPT09ICdzdGFydCcpIHtcbiAgICAgIHJldHVybiBkYXRlLnRvRGF0ZVN0cmluZygpID09PSB0aGlzLmN1ckhvdmVyRGF0ZT8udG9EYXRlU3RyaW5nKCkgfHwgZGF0ZS50b0RhdGVTdHJpbmcoKSA9PT0gdGhpcy5jdXJSYW5nZURhdGVbMF0/LnRvRGF0ZVN0cmluZygpO1xuICAgIH1cblxuICAgIHJldHVybiBkYXRlLnRvRGF0ZVN0cmluZygpID09PSB0aGlzLmN1clJhbmdlRGF0ZVswXT8udG9EYXRlU3RyaW5nKCk7XG4gIH1cblxuICAvLyDliKTmlq3ml6XmnJ/mmK/lkKbkuLrnu5PmnZ/ml6XmnJ9cbiAgaXNFbmREYXRlKGRhdGU6IERhdGUpOiBib29sZWFuIHtcbiAgICBpZiAoIXRoaXMuaXNSYW5nZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmN1cnJlbnRBY3RpdmVJbnB1dCA9PT0gJ2VuZCcpIHtcbiAgICAgIHJldHVybiBkYXRlLnRvRGF0ZVN0cmluZygpID09PSB0aGlzLmN1ckhvdmVyRGF0ZT8udG9EYXRlU3RyaW5nKCkgfHwgZGF0ZS50b0RhdGVTdHJpbmcoKSA9PT0gdGhpcy5jdXJSYW5nZURhdGVbMV0/LnRvRGF0ZVN0cmluZygpO1xuICAgIH1cblxuICAgIHJldHVybiBkYXRlLnRvRGF0ZVN0cmluZygpID09PSB0aGlzLmN1clJhbmdlRGF0ZVsxXT8udG9EYXRlU3RyaW5nKCk7XG4gIH1cblxuICAvLyDliKTmlq3ml6XmnJ/mmK/lkKblnKhob3ZlcuiMg+WbtOaIluiAhemAieS4reeahOiMg+WbtOWGhVxuICBpc0RhdGVJblJhbmdlKGRhdGU6IERhdGUpOiBib29sZWFuIHtcbiAgICBjb25zdCBkYXRlVGltZSA9IGRhdGUuZ2V0VGltZSgpO1xuICAgIGNvbnN0IGRhdGVTdHIgPSBkYXRlLnRvRGF0ZVN0cmluZygpO1xuICAgIGlmICh0aGlzLmlzUmFuZ2UpIHtcbiAgICAgIGlmICh0aGlzLmN1cnJlbnRBY3RpdmVJbnB1dCA9PT0gJ3N0YXJ0Jykge1xuICAgICAgICByZXR1cm4gKHRoaXMuY3VySG92ZXJEYXRlIHx8IHRoaXMuY3VyUmFuZ2VEYXRlWzBdKT8uZ2V0VGltZSgpIDwgZGF0ZVRpbWUgJiZcbiAgICAgICAgICAodGhpcy5jdXJIb3ZlckRhdGUgfHwgdGhpcy5jdXJSYW5nZURhdGVbMF0pPy50b0RhdGVTdHJpbmcoKSAhPT0gZGF0ZVN0ciAmJlxuICAgICAgICAgIHRoaXMuY3VyUmFuZ2VEYXRlWzFdPy5nZXRUaW1lKCkgPiBkYXRlVGltZSAmJlxuICAgICAgICAgIHRoaXMuY3VyUmFuZ2VEYXRlWzFdPy50b0RhdGVTdHJpbmcoKSAhPT0gZGF0ZVN0cjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1clJhbmdlRGF0ZVswXT8uZ2V0VGltZSgpIDwgZGF0ZVRpbWUgJiZcbiAgICAgICAgICB0aGlzLmN1clJhbmdlRGF0ZVswXT8udG9EYXRlU3RyaW5nKCkgIT09IGRhdGVTdHIgJiZcbiAgICAgICAgICAodGhpcy5jdXJIb3ZlckRhdGUgfHwgdGhpcy5jdXJSYW5nZURhdGVbMV0pPy5nZXRUaW1lKCkgPiBkYXRlVGltZSAmJlxuICAgICAgICAgICh0aGlzLmN1ckhvdmVyRGF0ZSB8fCB0aGlzLmN1clJhbmdlRGF0ZVsxXSkudG9EYXRlU3RyaW5nKCkgIT09IGRhdGVTdHI7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvLyDliKTmlq3ml6XmnJ/mmK/lkKblnKjlt7LpgInkuK3nmoTojIPlm7TlhoXvvIzkuI5ob3ZlcuWBmuWMuuWIhlxuICBpc0RhdGVJblNlbGVjdFJhbmdlKGRhdGU6IERhdGUpIHtcbiAgICBpZiAoIXRoaXMuaXNSYW5nZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5jdXJSYW5nZURhdGVbMF0gfHwgIXRoaXMuY3VyUmFuZ2VEYXRlWzFdKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuY3VyUmFuZ2VEYXRlWzBdLmdldFRpbWUoKSA8IGRhdGUuZ2V0VGltZSgpICYmIHRoaXMuY3VyUmFuZ2VEYXRlWzFdLmdldFRpbWUoKSA+IGRhdGUuZ2V0VGltZSgpICYmXG4gICAgICB0aGlzLmN1clJhbmdlRGF0ZVsxXS50b0RhdGVTdHJpbmcoKSAhPT0gZGF0ZS50b0RhdGVTdHJpbmcoKSAmJiB0aGlzLmN1clJhbmdlRGF0ZVswXS50b0RhdGVTdHJpbmcoKSAhPT0gZGF0ZS50b0RhdGVTdHJpbmcoKTtcbiAgfVxuXG4gIGlzRGF0ZUFjdGl2ZShkYXRlOiBEYXRlKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZGF0ZVN0ciA9IGRhdGUudG9EYXRlU3RyaW5nKCk7XG4gICAgaWYgKHRoaXMuaXNSYW5nZSkge1xuICAgICAgcmV0dXJuIGRhdGVTdHIgPT09IHRoaXMuY3VyUmFuZ2VEYXRlWzBdPy50b0RhdGVTdHJpbmcoKSB8fCBkYXRlU3RyID09PSB0aGlzLmN1clJhbmdlRGF0ZVsxXT8udG9EYXRlU3RyaW5nKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBkYXRlU3RyID09PSB0aGlzLmN1ckRhdGU/LnRvRGF0ZVN0cmluZygpO1xuICAgIH1cbiAgfVxuXG4gIGlzTW9udGhBY3RpdmUoeWVhckluZGV4OiBudW1iZXIsIG1vbnRoSW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmlzUmFuZ2UpIHtcbiAgICAgIHJldHVybiAoeWVhckluZGV4ID09PSB0aGlzLmN1clJhbmdlRGF0ZVswXT8uZ2V0RnVsbFllYXIoKSAmJiBtb250aEluZGV4ID09PSB0aGlzLmN1clJhbmdlRGF0ZVswXT8uZ2V0TW9udGgoKSkgfHxcbiAgICAgICAgKHllYXJJbmRleCA9PT0gdGhpcy5jdXJSYW5nZURhdGVbMV0/LmdldEZ1bGxZZWFyKCkgJiYgbW9udGhJbmRleCA9PT0gdGhpcy5jdXJSYW5nZURhdGVbMV0/LmdldE1vbnRoKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4geWVhckluZGV4ID09PSB0aGlzLmN1ckRhdGU/LmdldEZ1bGxZZWFyKCkgJiYgbW9udGhJbmRleCA9PT0gdGhpcy5jdXJEYXRlPy5nZXRNb250aCgpO1xuICAgIH1cbiAgfVxuXG4gIGlzWWVhckFjdGl2ZSh5ZWFySW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmlzUmFuZ2UpIHtcbiAgICAgIHJldHVybiB5ZWFySW5kZXggPT09IHRoaXMuY3VyUmFuZ2VEYXRlWzBdPy5nZXRGdWxsWWVhcigpIHx8IHllYXJJbmRleCA9PT0gdGhpcy5jdXJSYW5nZURhdGVbMV0/LmdldEZ1bGxZZWFyKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB5ZWFySW5kZXggPT09IHRoaXMuY3VyRGF0ZT8uZ2V0RnVsbFllYXIoKTtcbiAgICB9XG4gIH1cblxuICAvLyDmmK/lkKbkuLrojIPlm7TpgInkuK3ml6XmnJ/kuK3lr7nlupTnmoRpbnB1dOa/gOa0u+mhuVxuICBpc0FjdGl2ZUlucHV0VHlwZURhdGUoZGF0ZTogRGF0ZSkge1xuICAgIGlmICghdGhpcy5pc1JhbmdlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY3VycmVudEFjdGl2ZUlucHV0ID09PSAnc3RhcnQnKSB7XG4gICAgICByZXR1cm4gZGF0ZS50b0RhdGVTdHJpbmcoKSA9PT0gdGhpcy5jdXJSYW5nZURhdGVbMF0/LnRvRGF0ZVN0cmluZygpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZGF0ZS50b0RhdGVTdHJpbmcoKSA9PT0gdGhpcy5jdXJSYW5nZURhdGVbMV0/LnRvRGF0ZVN0cmluZygpO1xuICAgIH1cbiAgfVxuXG4gIC8vIOaYr+WQpuS4uumAieS4reaXpeacn+S4lOWcqOW6n+W8g+iMg+WbtOmAu+i+keWGhVxuICBpc0RhdGVBYmFuZG9uKGRhdGU6IERhdGUpOiBib29sZWFuIHtcbiAgICBpZiAoIXRoaXMuaXNSYW5nZSB8fCAoIXRoaXMuY3VyUmFuZ2VEYXRlWzBdIHx8ICF0aGlzLmN1clJhbmdlRGF0ZVsxXSkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuaXNEYXRlQWN0aXZlKGRhdGUpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY3VycmVudEFjdGl2ZUlucHV0ID09PSAnc3RhcnQnKSB7XG4gICAgICByZXR1cm4gdGhpcy5jdXJIb3ZlckRhdGU/LmdldFRpbWUoKSA+IGRhdGUuZ2V0VGltZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5jdXJIb3ZlckRhdGU/LmdldFRpbWUoKSA8IGRhdGUuZ2V0VGltZSgpO1xuICAgIH1cbiAgfVxuXG4gIGlzSW5TdWdnZXN0TGlzdChkYXRlOiBEYXRlKTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLm1hcmtlZFJhbmdlRGF0ZUxpc3QpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5tYXJrZWRSYW5nZURhdGVMaXN0Lmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgcmFuZ2UgPSB0aGlzLm1hcmtlZFJhbmdlRGF0ZUxpc3RbaW5kZXhdO1xuICAgICAgaWYgKFxuICAgICAgICByYW5nZVswXT8uZ2V0VGltZSgpIDwgZGF0ZS5nZXRUaW1lKCkgJiYgcmFuZ2VbMV0/LmdldFRpbWUoKSA+IGRhdGUuZ2V0VGltZSgpXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgcmFuZ2VbMF0/LnRvRGF0ZVN0cmluZygpID09PSBkYXRlLnRvRGF0ZVN0cmluZygpIHx8IHJhbmdlWzFdPy50b0RhdGVTdHJpbmcoKSA9PT0gZGF0ZS50b0RhdGVTdHJpbmcoKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpc01hcmtlZERhdGUoZGF0ZTogRGF0ZSk6IGJvb2xlYW4ge1xuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLm1hcmtlZERhdGVMaXN0Py5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIGlmICh0aGlzLm1hcmtlZERhdGVMaXN0W2luZGV4XT8udG9EYXRlU3RyaW5nKCkgPT09IGRhdGUudG9EYXRlU3RyaW5nKCkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIG1lYXJzdXJlU3RyV2lkdGgoc3RyOiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGNvbnN0IG1lYXJzdXJlRG9tID0gdGhpcy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgbWVhcnN1cmVEb20uaW5uZXJUZXh0ID0gc3RyO1xuICAgIG1lYXJzdXJlRG9tLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcbiAgICB0aGlzLmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobWVhcnN1cmVEb20pO1xuXG4gICAgY29uc3QgZG9tV2lkdGggPSBtZWFyc3VyZURvbS5vZmZzZXRXaWR0aDtcblxuICAgIHRoaXMuZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChtZWFyc3VyZURvbSk7XG4gICAgcmV0dXJuIGRvbVdpZHRoO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy50b2dnbGVFdmVudC5jb21wbGV0ZSgpO1xuICAgIHRoaXMuc2VsZWN0ZWREYXRlQ2hhbmdlLmNvbXBsZXRlKCk7XG4gICAgdGhpcy5jbG9zZURyb3Bkb3duRXZlbnQuY29tcGxldGUoKTtcbiAgICB0aGlzLnVwZGF0ZURhdGVWYWx1ZS5jb21wbGV0ZSgpO1xuICAgIHRoaXMudXBkYXRlVGltZUNoYW5nZS5jb21wbGV0ZSgpO1xuICAgIHRoaXMuc2VsZWN0ZWRUaW1lQ2hhbmdlLmNvbXBsZXRlKCk7XG4gICAgdGhpcy5hY3RpdmVJbnB1dENoYW5nZS5jb21wbGV0ZSgpO1xuICAgIHRoaXMuZGV0ZWN0ZWRDaGFuZ2VzLmNvbXBsZXRlKCk7XG4gIH1cblxufVxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRGF0ZXBpY2tlclByb0NvbW1vbkRhdGFTZXJ2aWNlIHtcbiAgY2FsZW5kYXJEYXRhQ2FjaGUgPSB7fTtcbn1cbiJdfQ==