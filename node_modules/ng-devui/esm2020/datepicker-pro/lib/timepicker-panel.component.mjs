import { Component, ElementRef } from '@angular/core';
import { I18nService } from 'ng-devui/i18n';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { DatepickerProService } from '../datepicker-pro.service';
import * as i0 from "@angular/core";
import * as i1 from "../datepicker-pro.service";
import * as i2 from "ng-devui/i18n";
import * as i3 from "@angular/common";
export class TimepickerPanelComponent {
    constructor(el, pickSrv, i18n) {
        this.el = el;
        this.pickSrv = pickSrv;
        this.i18n = i18n;
        this.firstList = [];
        this.secondList = [];
        this.thirdList = [];
        this.hourIndex = null;
        this.minIndex = null;
        this.secIndex = null;
        this.typeList = ['hour', 'min', 'sec'];
        this.unsubscribe$ = new Subject();
    }
    ngOnInit() {
        this.initDateList();
        this.initObservable();
        this.setI18nText();
    }
    setI18nText() {
        this.i18nText = this.i18n.getI18nText().datePickerPro;
        this.i18nSubscription = this.i18n.langChange().subscribe((data) => {
            this.i18nText = data.datePickerPro;
        });
    }
    initObservable() {
        this.pickSrv.toggleEvent.pipe(takeUntil(this.unsubscribe$)).subscribe(isOpen => {
            if (isOpen) {
                setTimeout(() => {
                    this.initDateList(true);
                });
            }
        });
        this.pickSrv.updateTimeChange.pipe(takeUntil(this.unsubscribe$)).subscribe(value => {
            if (this.hourIndex !== value.hour) {
                this.chooseTime('hour', value.hour);
            }
            if (this.minIndex !== value.min) {
                this.chooseTime('min', value.min);
            }
            if (this.secIndex !== value.seconds) {
                this.chooseTime('sec', value.seconds);
            }
        });
        if (this.pickSrv.isRange) {
            this.pickSrv.activeInputChange.pipe(takeUntil(this.unsubscribe$)).subscribe(type => {
                const isNull = (type === 'start' && !this.pickSrv.curRangeDate[0]) ||
                    (type === 'end' && !this.pickSrv.curRangeDate[1]);
                if (this.hourIndex !== this.pickSrv.curHour || isNull) {
                    this.chooseTime('hour', isNull ? null : this.pickSrv.curHour);
                }
                if (this.minIndex !== this.pickSrv.curMin || isNull) {
                    this.chooseTime('min', isNull ? null : this.pickSrv.curMin);
                }
                if (this.secIndex !== this.pickSrv.curSec || isNull) {
                    this.chooseTime('sec', isNull ? null : this.pickSrv.curSec);
                }
            });
        }
    }
    initDateList(justScroll = false) {
        if (this.pickSrv.curDate) {
            this.hourIndex = this.pickSrv.curDate.getHours();
            this.minIndex = this.pickSrv.curDate.getMinutes();
            this.secIndex = this.pickSrv.curDate.getSeconds();
        }
        this.typeList.forEach(type => {
            this.chooseTime(type, this[`${type}Index`], false, justScroll);
        });
    }
    chooseTime(type, index, handle = false, justScroll = false) {
        switch (type) {
            case 'hour':
                this.hourIndex = index;
                this.firstList = new Array(24).fill(1).map((t, i) => {
                    return {
                        time: i < 10 ? `0${i}` : String(i),
                        type: 'hour',
                        active: this.hourIndex === i,
                        disabled: false
                    };
                });
                this.setAllScroll(index, this.pickSrv.curMin, this.pickSrv.curSec, justScroll);
                break;
            case 'min':
                this.minIndex = index;
                this.secondList = new Array(60).fill(1).map((t, i) => {
                    return {
                        time: i < 10 ? `0${i}` : String(i),
                        type: 'min',
                        active: this.minIndex === i,
                        disabled: false
                    };
                });
                this.setAllScroll(this.pickSrv.curHour, index, this.pickSrv.curSec, justScroll);
                break;
            case 'sec':
                this.secIndex = index;
                this.thirdList = new Array(60).fill(1).map((t, i) => {
                    return {
                        time: i < 10 ? `0${i}` : String(i),
                        type: 'sec',
                        active: this.secIndex === i,
                        disabled: false
                    };
                });
                this.setAllScroll(this.pickSrv.curHour, this.pickSrv.curMin, index, justScroll);
        }
        if (handle) {
            this.pickSrv.selectedTimeChange.next({
                activeInput: this.pickSrv.currentActiveInput,
                hour: this.hourIndex,
                min: this.minIndex,
                seconds: this.secIndex
            });
        }
    }
    setAllScroll(first, second, third, justScroll) {
        this.setScroll('first', first, justScroll);
        this.setScroll('second', second, justScroll);
        this.setScroll('third', third, justScroll);
    }
    setScroll(whichList, index, justScroll) {
        const scroll = (22 + 8) * index;
        const duration = justScroll ? 0 : 100;
        if (this.el) {
            this.scrollTo(this.el.nativeElement.querySelector(`.devui-${whichList}-list`), scroll, duration);
        }
    }
    scrollTo(element, to, duration) {
        if (typeof window === undefined || !element) {
            return;
        }
        if (duration <= 0) {
            element.scrollTop = to;
            return;
        }
        const difference = to - element.scrollTop;
        const perTick = (difference / duration) * 10;
        const reqAnimFrame = window['requestAnimationFrame'] ||
            window['mozRequestAnimationFrame'] ||
            window['msRequestAnimationFrame'] ||
            window['oRequestAnimationFrame'];
        reqAnimFrame(() => {
            element.scrollTop = element.scrollTop + perTick;
            if (element.scrollTop === to) {
                return;
            }
            this.scrollTo(element, to, duration - 10);
        });
    }
    ngOnDestroy() {
        this.unsubscribe$.next();
        this.unsubscribe$.complete();
    }
}
TimepickerPanelComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: TimepickerPanelComponent, deps: [{ token: i0.ElementRef }, { token: i1.DatepickerProService }, { token: i2.I18nService }], target: i0.ɵɵFactoryTarget.Component });
TimepickerPanelComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.3", type: TimepickerPanelComponent, selector: "d-timepicker-panel", ngImport: i0, template: "<div class=\"devui-timepicker-panel\">\n  <div class=\"devui-time-header\">\n    <span class=\"devui-time-header-item\">{{ i18nText?.hour }}</span>\n    <span class=\"devui-time-header-item\">{{ i18nText?.min }}</span>\n    <span class=\"devui-time-header-item\">{{ i18nText?.second }}</span>\n  </div>\n  <div class=\"devui-time-picker\">\n    <ul *ngIf=\"firstList.length\" class=\"devui-time-list devui-first-list\">\n      <li\n        *ngFor=\"let item of firstList; let i = index\"\n        class=\"devui-time-item devui-first-item\"\n        [ngClass]=\"{\n          active: item?.active,\n          disabled: item?.disabled\n        }\"\n        (click)=\"chooseTime(item.type, i, true)\"\n      >\n        {{ item?.time }}\n      </li>\n    </ul>\n    <ul *ngIf=\"secondList.length\" class=\"devui-time-list devui-second-list\">\n      <li\n        *ngFor=\"let item of secondList; let i = index\"\n        class=\"devui-time-item devui-second-item\"\n        [ngClass]=\"{\n          active: item?.active,\n          disabled: item?.disabled\n        }\"\n        (click)=\"chooseTime(item.type, i, true)\"\n      >\n        {{ item?.time }}\n      </li>\n    </ul>\n    <ul *ngIf=\"thirdList.length\" class=\"devui-time-list devui-third-list\">\n      <li\n        *ngFor=\"let item of thirdList; let i = index\"\n        class=\"devui-time-item devui-third-item\"\n        [ngClass]=\"{\n          active: item?.active,\n          disabled: item?.disabled\n        }\"\n        (click)=\"chooseTime(item.type, i, true)\"\n      >\n        {{ item?.time }}\n      </li>\n    </ul>\n  </div>\n</div>\n", styles: [":host{display:inline-block;vertical-align:top;font-size:12px}.devui-timepicker-panel{width:115px;height:306px;text-align:center;border-left:1px solid #f2f2f3;border-left:1px solid var(--devui-dividing-line, #f2f2f3)}.devui-timepicker-panel .devui-time-header{display:flex;height:30px;padding:0 12px}.devui-timepicker-panel .devui-time-header-item{flex:1;line-height:30px;margin-right:12px}.devui-timepicker-panel .devui-time-header-item:last-child{margin-right:0}.devui-timepicker-panel .devui-time-picker{display:flex;height:276px;width:114px;padding:0 12px;overflow:hidden;border-radius:2px 2px 0 0;border-radius:var(--devui-border-radius, 2px) var(--devui-border-radius, 2px) 0 0}.devui-timepicker-panel .devui-time-picker .devui-time-list{flex:1;overflow-x:hidden;overflow-y:scroll;overflow-y:overlay;scroll-behavior:auto;padding-right:12px;scrollbar-width:none}.devui-timepicker-panel .devui-time-picker .devui-time-list:last-child{padding-right:0}.devui-timepicker-panel .devui-time-picker .devui-time-list::-webkit-scrollbar{width:0!important}.devui-timepicker-panel .devui-time-picker .devui-time-list:hover{scrollbar-width:thin}.devui-timepicker-panel .devui-time-picker .devui-time-list:hover::-webkit-scrollbar{width:4px!important}.devui-timepicker-panel .devui-time-picker .devui-time-list .devui-time-item{width:100%;height:22px;line-height:22px;text-align:center;cursor:pointer}.devui-timepicker-panel .devui-time-picker .devui-time-list .devui-time-item:not(:last-child){margin-bottom:8px}.devui-timepicker-panel .devui-time-picker .devui-time-list .devui-time-item:last-child{margin-bottom:260px}.devui-timepicker-panel .devui-time-picker:not(.devui-disabled) .devui-time-list .devui-time-item:hover{color:#252b3a;color:var(--devui-list-item-hover-text, #252b3a);background-color:#f2f2f3;background-color:var(--devui-list-item-hover-bg, #f2f2f3);border-radius:4px;border-radius:var(--devui-border-radius-feedback, 4px)}.devui-timepicker-panel .devui-time-picker:not(.devui-disabled) .devui-time-list .devui-time-item.active{color:#252b3a;color:var(--devui-list-item-active-text, #252b3a);background-color:#f2f5fc;background-color:var(--devui-list-item-active-bg, #f2f5fc);border-radius:4px;border-radius:var(--devui-border-radius-feedback, 4px)}.devui-timepicker-panel .devui-time-picker:not(.devui-disabled) .devui-time-list .devui-time-item.disabled{color:#cfd0d3;color:var(--devui-disabled-text, #cfd0d3);background-color:#f5f5f5;background-color:var(--devui-disabled-bg, #f5f5f5);border-radius:4px;border-radius:var(--devui-border-radius-feedback, 4px)}\n"], directives: [{ type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i3.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: TimepickerPanelComponent, decorators: [{
            type: Component,
            args: [{ selector: 'd-timepicker-panel', preserveWhitespaces: false, template: "<div class=\"devui-timepicker-panel\">\n  <div class=\"devui-time-header\">\n    <span class=\"devui-time-header-item\">{{ i18nText?.hour }}</span>\n    <span class=\"devui-time-header-item\">{{ i18nText?.min }}</span>\n    <span class=\"devui-time-header-item\">{{ i18nText?.second }}</span>\n  </div>\n  <div class=\"devui-time-picker\">\n    <ul *ngIf=\"firstList.length\" class=\"devui-time-list devui-first-list\">\n      <li\n        *ngFor=\"let item of firstList; let i = index\"\n        class=\"devui-time-item devui-first-item\"\n        [ngClass]=\"{\n          active: item?.active,\n          disabled: item?.disabled\n        }\"\n        (click)=\"chooseTime(item.type, i, true)\"\n      >\n        {{ item?.time }}\n      </li>\n    </ul>\n    <ul *ngIf=\"secondList.length\" class=\"devui-time-list devui-second-list\">\n      <li\n        *ngFor=\"let item of secondList; let i = index\"\n        class=\"devui-time-item devui-second-item\"\n        [ngClass]=\"{\n          active: item?.active,\n          disabled: item?.disabled\n        }\"\n        (click)=\"chooseTime(item.type, i, true)\"\n      >\n        {{ item?.time }}\n      </li>\n    </ul>\n    <ul *ngIf=\"thirdList.length\" class=\"devui-time-list devui-third-list\">\n      <li\n        *ngFor=\"let item of thirdList; let i = index\"\n        class=\"devui-time-item devui-third-item\"\n        [ngClass]=\"{\n          active: item?.active,\n          disabled: item?.disabled\n        }\"\n        (click)=\"chooseTime(item.type, i, true)\"\n      >\n        {{ item?.time }}\n      </li>\n    </ul>\n  </div>\n</div>\n", styles: [":host{display:inline-block;vertical-align:top;font-size:12px}.devui-timepicker-panel{width:115px;height:306px;text-align:center;border-left:1px solid #f2f2f3;border-left:1px solid var(--devui-dividing-line, #f2f2f3)}.devui-timepicker-panel .devui-time-header{display:flex;height:30px;padding:0 12px}.devui-timepicker-panel .devui-time-header-item{flex:1;line-height:30px;margin-right:12px}.devui-timepicker-panel .devui-time-header-item:last-child{margin-right:0}.devui-timepicker-panel .devui-time-picker{display:flex;height:276px;width:114px;padding:0 12px;overflow:hidden;border-radius:2px 2px 0 0;border-radius:var(--devui-border-radius, 2px) var(--devui-border-radius, 2px) 0 0}.devui-timepicker-panel .devui-time-picker .devui-time-list{flex:1;overflow-x:hidden;overflow-y:scroll;overflow-y:overlay;scroll-behavior:auto;padding-right:12px;scrollbar-width:none}.devui-timepicker-panel .devui-time-picker .devui-time-list:last-child{padding-right:0}.devui-timepicker-panel .devui-time-picker .devui-time-list::-webkit-scrollbar{width:0!important}.devui-timepicker-panel .devui-time-picker .devui-time-list:hover{scrollbar-width:thin}.devui-timepicker-panel .devui-time-picker .devui-time-list:hover::-webkit-scrollbar{width:4px!important}.devui-timepicker-panel .devui-time-picker .devui-time-list .devui-time-item{width:100%;height:22px;line-height:22px;text-align:center;cursor:pointer}.devui-timepicker-panel .devui-time-picker .devui-time-list .devui-time-item:not(:last-child){margin-bottom:8px}.devui-timepicker-panel .devui-time-picker .devui-time-list .devui-time-item:last-child{margin-bottom:260px}.devui-timepicker-panel .devui-time-picker:not(.devui-disabled) .devui-time-list .devui-time-item:hover{color:#252b3a;color:var(--devui-list-item-hover-text, #252b3a);background-color:#f2f2f3;background-color:var(--devui-list-item-hover-bg, #f2f2f3);border-radius:4px;border-radius:var(--devui-border-radius-feedback, 4px)}.devui-timepicker-panel .devui-time-picker:not(.devui-disabled) .devui-time-list .devui-time-item.active{color:#252b3a;color:var(--devui-list-item-active-text, #252b3a);background-color:#f2f5fc;background-color:var(--devui-list-item-active-bg, #f2f5fc);border-radius:4px;border-radius:var(--devui-border-radius-feedback, 4px)}.devui-timepicker-panel .devui-time-picker:not(.devui-disabled) .devui-time-list .devui-time-item.disabled{color:#cfd0d3;color:var(--devui-disabled-text, #cfd0d3);background-color:#f5f5f5;background-color:var(--devui-disabled-bg, #f5f5f5);border-radius:4px;border-radius:var(--devui-border-radius-feedback, 4px)}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i1.DatepickerProService }, { type: i2.I18nService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZXBpY2tlci1wYW5lbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9kZXZ1aS9kYXRlcGlja2VyLXByby9saWIvdGltZXBpY2tlci1wYW5lbC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9kZXZ1aS9kYXRlcGlja2VyLXByby9saWIvdGltZXBpY2tlci1wYW5lbC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUFFLFVBQVUsRUFDdEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFpQixXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0QsT0FBTyxFQUFFLE9BQU8sRUFBZ0IsTUFBTSxNQUFNLENBQUM7QUFDN0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDOzs7OztBQWVqRSxNQUFNLE9BQU8sd0JBQXdCO0lBZ0JuQyxZQUNVLEVBQWMsRUFDZCxPQUE2QixFQUMzQixJQUFpQjtRQUZuQixPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQ2QsWUFBTyxHQUFQLE9BQU8sQ0FBc0I7UUFDM0IsU0FBSSxHQUFKLElBQUksQ0FBYTtRQWpCN0IsY0FBUyxHQUFtQixFQUFFLENBQUM7UUFDL0IsZUFBVSxHQUFtQixFQUFFLENBQUM7UUFDaEMsY0FBUyxHQUFtQixFQUFFLENBQUM7UUFFL0IsY0FBUyxHQUFHLElBQUksQ0FBQztRQUNqQixhQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLGFBQVEsR0FBRyxJQUFJLENBQUM7UUFFaEIsYUFBUSxHQUFHLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztRQUVsQyxpQkFBWSxHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7SUFRMUIsQ0FBQztJQUVKLFFBQVE7UUFDTixJQUFJLENBQUMs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Q25DLFlBQVksQ0FBQyxHQUFHLEVBQUU7WUFDaEIsT0FBTyxDQUFDLFNBQVMsR0FBRyxPQUFPLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQztZQUNoRCxJQUFJLE9BQU8sQ0FBQyxTQUFTLEtBQUssRUFBRSxFQUFFO2dCQUM1QixPQUFPO2FBQ1I7WUFDRCxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxFQUFFLEVBQUUsUUFBUSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQzVDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDL0IsQ0FBQzs7cUhBdkxVLHdCQUF3Qjt5R0FBeEIsd0JBQXdCLDBEQ3JCckMsNmtEQWdEQTsyRkQzQmEsd0JBQXdCO2tCQU5wQyxTQUFTOytCQUNFLG9CQUFvQix1QkFHVCxLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBPbkRlc3Ryb3ksIE9uSW5pdFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEkxOG5JbnRlcmZhY2UsIEkxOG5TZXJ2aWNlIH0gZnJvbSAnbmctZGV2dWkvaTE4bic7XG5pbXBvcnQgeyBTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IERhdGVwaWNrZXJQcm9TZXJ2aWNlIH0gZnJvbSAnLi4vZGF0ZXBpY2tlci1wcm8uc2VydmljZSc7XG5cbmludGVyZmFjZSBUaW1lT2JqIHtcbiAgdGltZTogc3RyaW5nO1xuICB0eXBlPzogc3RyaW5nO1xuICBhY3RpdmU/OiBib29sZWFuO1xuICBkaXNhYmxlZD86IGJvb2xlYW47XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2QtdGltZXBpY2tlci1wYW5lbCcsXG4gIHRlbXBsYXRlVXJsOiAnLi90aW1lcGlja2VyLXBhbmVsLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vdGltZXBpY2tlci1wYW5lbC5jb21wb25lbnQuc2NzcyddLFxuICBwcmVzZXJ2ZVdoaXRlc3BhY2VzOiBmYWxzZSxcbn0pXG5leHBvcnQgY2xhc3MgVGltZXBpY2tlclBhbmVsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuXG4gIGZpcnN0TGlzdDogQXJyYXk8VGltZU9iaj4gPSBbXTtcbiAgc2Vjb25kTGlzdDogQXJyYXk8VGltZU9iaj4gPSBbXTtcbiAgdGhpcmRMaXN0OiBBcnJheTxUaW1lT2JqPiA9IFtdO1xuXG4gIGhvdXJJbmRleCA9IG51bGw7XG4gIG1pbkluZGV4ID0gbnVsbDtcbiAgc2VjSW5kZXggPSBudWxsO1xuXG4gIHR5cGVMaXN0ID0gWydob3VyJywgJ21pbicsICdzZWMnXTtcblxuICB1bnN1YnNjcmliZSQgPSBuZXcgU3ViamVjdCgpO1xuICBpMThuVGV4dDogSTE4bkludGVyZmFjZVsnZGF0ZVBpY2tlclBybyddO1xuICBpMThuU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBlbDogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIHBpY2tTcnY6IERhdGVwaWNrZXJQcm9TZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBpMThuOiBJMThuU2VydmljZVxuICApIHt9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5pbml0RGF0ZUxpc3QoKTtcbiAgICB0aGlzLmluaXRPYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5zZXRJMThuVGV4dCgpO1xuICB9XG5cbiAgc2V0STE4blRleHQoKSB7XG4gICAgdGhpcy5pMThuVGV4dCA9IHRoaXMuaTE4bi5nZXRJMThuVGV4dCgpLmRhdGVQaWNrZXJQcm87XG4gICAgdGhpcy5pMThuU3Vic2NyaXB0aW9uID0gdGhpcy5pMThuLmxhbmdDaGFuZ2UoKS5zdWJzY3JpYmUoKGRhdGEpID0+IHtcbiAgICAgIHRoaXMuaTE4blRleHQgPSBkYXRhLmRhdGVQaWNrZXJQcm87XG4gICAgfSk7XG4gIH1cblxuICBpbml0T2JzZXJ2YWJsZSgpIHtcbiAgICB0aGlzLnBpY2tTcnYudG9nZ2xlRXZlbnQucGlwZShcbiAgICAgIHRha2VVbnRpbCh0aGlzLnVuc3Vic2NyaWJlJClcbiAgICApLnN1YnNjcmliZShpc09wZW4gPT4ge1xuICAgICAgaWYgKGlzT3Blbikge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB0aGlzLmluaXREYXRlTGlzdCh0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnBpY2tTcnYudXBkYXRlVGltZUNoYW5nZS5waXBlKFxuICAgICAgdGFrZVVudGlsKHRoaXMudW5zdWJzY3JpYmUkKVxuICAgICkuc3Vic2NyaWJlKHZhbHVlID0+IHtcbiAgICAgIGlmICh0aGlzLmhvdXJJbmRleCAhPT0gdmFsdWUuaG91cikge1xuICAgICAgICB0aGlzLmNob29zZVRpbWUoJ2hvdXInLCB2YWx1ZS5ob3VyKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMubWluSW5kZXggIT09IHZhbHVlLm1pbikge1xuICAgICAgICB0aGlzLmNob29zZVRpbWUoJ21pbicsIHZhbHVlLm1pbik7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLnNlY0luZGV4ICE9PSB2YWx1ZS5zZWNvbmRzKSB7XG4gICAgICAgIHRoaXMuY2hvb3NlVGltZSgnc2VjJywgdmFsdWUuc2Vjb25kcyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAodGhpcy5waWNrU3J2LmlzUmFuZ2UpIHtcbiAgICAgIHRoaXMucGlja1Nydi5hY3RpdmVJbnB1dENoYW5nZS5waXBlKFxuICAgICAgICB0YWtlVW50aWwodGhpcy51bnN1YnNjcmliZSQpXG4gICAgICApLnN1YnNjcmliZSh0eXBlID0+IHtcbiAgICAgICAgY29uc3QgaXNOdWxsID0gKHR5cGUgPT09ICdzdGFydCcgJiYgIXRoaXMucGlja1Nydi5jdXJSYW5nZURhdGVbMF0pIHx8XG4gICAgICAgICAgKHR5cGUgPT09ICdlbmQnICYmICF0aGlzLnBpY2tTcnYuY3VyUmFuZ2VEYXRlWzFdKTtcbiAgICAgICAgaWYgKHRoaXMuaG91ckluZGV4ICE9PSB0aGlzLnBpY2tTcnYuY3VySG91ciB8fCBpc051bGwpIHtcbiAgICAgICAgICB0aGlzLmNob29zZVRpbWUoJ2hvdXInLCBpc051bGwgPyBudWxsIDogdGhpcy5waWNrU3J2LmN1ckhvdXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMubWluSW5kZXggIT09IHRoaXMucGlja1Nydi5jdXJNaW4gfHwgaXNOdWxsKSB7XG4gICAgICAgICAgdGhpcy5jaG9vc2VUaW1lKCdtaW4nLCBpc051bGwgPyBudWxsIDogdGhpcy5waWNrU3J2LmN1ck1pbik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zZWNJbmRleCAhPT0gdGhpcy5waWNrU3J2LmN1clNlYyB8fCBpc051bGwpIHtcbiAgICAgICAgICB0aGlzLmNob29zZVRpbWUoJ3NlYycsIGlzTnVsbCA/IG51bGwgOiB0aGlzLnBpY2tTcnYuY3VyU2VjKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgaW5pdERhdGVMaXN0KGp1c3RTY3JvbGwgPSBmYWxzZSkge1xuICAgIGlmICh0aGlzLnBpY2tTcnYuY3VyRGF0ZSkge1xuICAgICAgdGhpcy5ob3VySW5kZXggPSB0aGlzLnBpY2tTcnYuY3VyRGF0ZS5nZXRIb3VycygpO1xuICAgICAgdGhpcy5taW5JbmRleCA9IHRoaXMucGlja1Nydi5jdXJEYXRlLmdldE1pbnV0ZXMoKTtcbiAgICAgIHRoaXMuc2VjSW5kZXggPSB0aGlzLnBpY2tTcnYuY3VyRGF0ZS5nZXRTZWNvbmRzKCk7XG4gICAgfVxuICAgIHRoaXMudHlwZUxpc3QuZm9yRWFjaCh0eXBlID0+IHtcbiAgICAgIHRoaXMuY2hvb3NlVGltZSh0eXBlLCB0aGlzW2Ake3R5cGV9SW5kZXhgXSwgZmFsc2UsIGp1c3RTY3JvbGwpO1xuICAgIH0pO1xuICB9XG5cbiAgY2hvb3NlVGltZSh0eXBlOiBzdHJpbmcsIGluZGV4OiBudW1iZXIsIGhhbmRsZSA9IGZhbHNlLCBqdXN0U2Nyb2xsID0gZmFsc2UpIHtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlICdob3VyJzpcbiAgICAgIHRoaXMuaG91ckluZGV4ID0gaW5kZXg7XG4gICAgICB0aGlzLmZpcnN0TGlzdCA9IG5ldyBBcnJheSgyNCkuZmlsbCgxKS5tYXAoKHQsIGkpID0+IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0aW1lOiBpIDwgMTAgPyBgMCR7aX1gIDogU3RyaW5nKGkpLFxuICAgICAgICAgIHR5cGU6ICdob3VyJyxcbiAgICAgICAgICBhY3RpdmU6IHRoaXMuaG91ckluZGV4ID09PSBpLFxuICAgICAgICAgIGRpc2FibGVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICB0aGlzLnNldEFsbFNjcm9sbChpbmRleCwgdGhpcy5waWNrU3J2LmN1ck1pbiwgdGhpcy5waWNrU3J2LmN1clNlYywganVzdFNjcm9sbCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdtaW4nOlxuICAgICAgdGhpcy5taW5JbmRleCA9IGluZGV4O1xuICAgICAgdGhpcy5zZWNvbmRMaXN0ID0gbmV3IEFycmF5KDYwKS5maWxsKDEpLm1hcCgodCwgaSkgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRpbWU6IGkgPCAxMCA/IGAwJHtpfWAgOiBTdHJpbmcoaSksXG4gICAgICAgICAgdHlwZTogJ21pbicsXG4gICAgICAgICAgYWN0aXZlOiB0aGlzLm1pbkluZGV4ID09PSBpLFxuICAgICAgICAgIGRpc2FibGVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICB0aGlzLnNldEFsbFNjcm9sbCh0aGlzLnBpY2tTcnYuY3VySG91ciwgaW5kZXgsIHRoaXMucGlja1Nydi5jdXJTZWMsIGp1c3RTY3JvbGwpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnc2VjJzpcbiAgICAgIHRoaXMuc2VjSW5kZXggPSBpbmRleDtcbiAgICAgIHRoaXMudGhpcmRMaXN0ID0gbmV3IEFycmF5KDYwKS5maWxsKDEpLm1hcCgodCwgaSkgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRpbWU6IGkgPCAxMCA/IGAwJHtpfWAgOiBTdHJpbmcoaSksXG4gICAgICAgICAgdHlwZTogJ3NlYycsXG4gICAgICAgICAgYWN0aXZlOiB0aGlzLnNlY0luZGV4ID09PSBpLFxuICAgICAgICAgIGRpc2FibGVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICB0aGlzLnNldEFsbFNjcm9sbCh0aGlzLnBpY2tTcnYuY3VySG91ciwgdGhpcy5waWNrU3J2LmN1ck1pbiwgaW5kZXgsIGp1c3RTY3JvbGwpO1xuICAgIH1cblxuICAgIGlmIChoYW5kbGUpIHtcbiAgICAgIHRoaXMucGlja1Nydi5zZWxlY3RlZFRpbWVDaGFuZ2UubmV4dCh7XG4gICAgICAgIGFjdGl2ZUlucHV0OiB0aGlzLnBpY2tTcnYuY3VycmVudEFjdGl2ZUlucHV0LFxuICAgICAgICBob3VyOiB0aGlzLmhvdXJJbmRleCxcbiAgICAgICAgbWluOiB0aGlzLm1pbkluZGV4LFxuICAgICAgICBzZWNvbmRzOiB0aGlzLnNlY0luZGV4XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBzZXRBbGxTY3JvbGwoZmlyc3Q6IG51bWJlciwgc2Vjb25kOiBudW1iZXIsIHRoaXJkOiBudW1iZXIsIGp1c3RTY3JvbGw6IGJvb2xlYW4pIHtcbiAgICB0aGlzLnNldFNjcm9sbCgnZmlyc3QnLCBmaXJzdCwganVzdFNjcm9sbCk7XG4gICAgdGhpcy5zZXRTY3JvbGwoJ3NlY29uZCcsIHNlY29uZCwganVzdFNjcm9sbCk7XG4gICAgdGhpcy5zZXRTY3JvbGwoJ3RoaXJkJywgdGhpcmQsIGp1c3RTY3JvbGwpO1xuICB9XG5cbiAgc2V0U2Nyb2xsKHdoaWNoTGlzdCwgaW5kZXgsIGp1c3RTY3JvbGw/KSB7XG4gICAgY29uc3Qgc2Nyb2xsID0gKDIyICsgOCkgKiBpbmRleDtcbiAgICBjb25zdCBkdXJhdGlvbiA9IGp1c3RTY3JvbGwgPyAwIDogMTAwO1xuICAgIGlmICh0aGlzLmVsKSB7XG4gICAgICB0aGlzLnNjcm9sbFRvKHRoaXMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAuZGV2dWktJHt3aGljaExpc3R9LWxpc3RgKSwgc2Nyb2xsLCBkdXJhdGlvbik7XG4gICAgfVxuICB9XG5cbiAgc2Nyb2xsVG8oZWxlbWVudDogSFRNTEVsZW1lbnQsIHRvOiBudW1iZXIsIGR1cmF0aW9uOiBudW1iZXIpOiB2b2lkIHtcbiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gdW5kZWZpbmVkIHx8ICFlbGVtZW50KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChkdXJhdGlvbiA8PSAwKSB7XG4gICAgICBlbGVtZW50LnNjcm9sbFRvcCA9IHRvO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBkaWZmZXJlbmNlID0gdG8gLSBlbGVtZW50LnNjcm9sbFRvcDtcbiAgICBjb25zdCBwZXJUaWNrID0gKGRpZmZlcmVuY2UgLyBkdXJhdGlvbikgKiAxMDtcbiAgICBjb25zdCByZXFBbmltRnJhbWUgPSB3aW5kb3dbJ3JlcXVlc3RBbmltYXRpb25GcmFtZSddIHx8XG4gICAgICB3aW5kb3dbJ21velJlcXVlc3RBbmltYXRpb25GcmFtZSddIHx8XG4gICAgICB3aW5kb3dbJ21zUmVxdWVzdEFuaW1hdGlvbkZyYW1lJ10gfHxcbiAgICAgIHdpbmRvd1snb1JlcXVlc3RBbmltYXRpb25GcmFtZSddO1xuICAgIHJlcUFuaW1GcmFtZSgoKSA9PiB7XG4gICAgICBlbGVtZW50LnNjcm9sbFRvcCA9IGVsZW1lbnQuc2Nyb2xsVG9wICsgcGVyVGljaztcbiAgICAgIGlmIChlbGVtZW50LnNjcm9sbFRvcCA9PT0gdG8pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5zY3JvbGxUbyhlbGVtZW50LCB0bywgZHVyYXRpb24gLSAxMCk7XG4gICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnVuc3Vic2NyaWJlJC5uZXh0KCk7XG4gICAgdGhpcy51bnN1YnNjcmliZSQuY29tcGxldGUoKTtcbiAgfVxuXG59XG4iLCI8ZGl2IGNsYXNzPVwiZGV2dWktdGltZXBpY2tlci1wYW5lbFwiPlxuICA8ZGl2IGNsYXNzPVwiZGV2dWktdGltZS1oZWFkZXJcIj5cbiAgICA8c3BhbiBjbGFzcz1cImRldnVpLXRpbWUtaGVhZGVyLWl0ZW1cIj57eyBpMThuVGV4dD8uaG91ciB9fTwvc3Bhbj5cbiAgICA8c3BhbiBjbGFzcz1cImRldnVpLXRpbWUtaGVhZGVyLWl0ZW1cIj57eyBpMThuVGV4dD8ubWluIH19PC9zcGFuPlxuICAgIDxzcGFuIGNsYXNzPVwiZGV2dWktdGltZS1oZWFkZXItaXRlbVwiPnt7IGkxOG5UZXh0Py5zZWNvbmQgfX08L3NwYW4+XG4gIDwvZGl2PlxuICA8ZGl2IGNsYXNzPVwiZGV2dWktdGltZS1waWNrZXJcIj5cbiAgICA8dWwgKm5nSWY9XCJmaXJzdExpc3QubGVuZ3RoXCIgY2xhc3M9XCJkZXZ1aS10aW1lLWxpc3QgZGV2dWktZmlyc3QtbGlzdFwiPlxuICAgICAgPGxpXG4gICAgICAgICpuZ0Zvcj1cImxldCBpdGVtIG9mIGZpcnN0TGlzdDsgbGV0IGkgPSBpbmRleFwiXG4gICAgICAgIGNsYXNzPVwiZGV2dWktdGltZS1pdGVtIGRldnVpLWZpcnN0LWl0ZW1cIlxuICAgICAgICBbbmdDbGFzc109XCJ7XG4gICAgICAgICAgYWN0aXZlOiBpdGVtPy5hY3RpdmUsXG4gICAgICAgICAgZGlzYWJsZWQ6IGl0ZW0/LmRpc2FibGVkXG4gICAgICAgIH1cIlxuICAgICAgICAoY2xpY2spPVwiY2hvb3NlVGltZShpdGVtLnR5cGUsIGksIHRydWUpXCJcbiAgICAgID5cbiAgICAgICAge3sgaXRlbT8udGltZSB9fVxuICAgICAgPC9saT5cbiAgICA8L3VsPlxuICAgIDx1bCAqbmdJZj1cInNlY29uZExpc3QubGVuZ3RoXCIgY2xhc3M9XCJkZXZ1aS10aW1lLWxpc3QgZGV2dWktc2Vjb25kLWxpc3RcIj5cbiAgICAgIDxsaVxuICAgICAgICAqbmdGb3I9XCJsZXQgaXRlbSBvZiBzZWNvbmRMaXN0OyBsZXQgaSA9IGluZGV4XCJcbiAgICAgICAgY2xhc3M9XCJkZXZ1aS10aW1lLWl0ZW0gZGV2dWktc2Vjb25kLWl0ZW1cIlxuICAgICAgICBbbmdDbGFzc109XCJ7XG4gICAgICAgICAgYWN0aXZlOiBpdGVtPy5hY3RpdmUsXG4gICAgICAgICAgZGlzYWJsZWQ6IGl0ZW0/LmRpc2FibGVkXG4gICAgICAgIH1cIlxuICAgICAgICAoY2xpY2spPVwiY2hvb3NlVGltZShpdGVtLnR5cGUsIGksIHRydWUpXCJcbiAgICAgID5cbiAgICAgICAge3sgaXRlbT8udGltZSB9fVxuICAgICAgPC9saT5cbiAgICA8L3VsPlxuICAgIDx1bCAqbmdJZj1cInRoaXJkTGlzdC5sZW5ndGhcIiBjbGFzcz1cImRldnVpLXRpbWUtbGlzdCBkZXZ1aS10aGlyZC1saXN0XCI+XG4gICAgICA8bGlcbiAgICAgICAgKm5nRm9yPVwibGV0IGl0ZW0gb2YgdGhpcmRMaXN0OyBsZXQgaSA9IGluZGV4XCJcbiAgICAgICAgY2xhc3M9XCJkZXZ1aS10aW1lLWl0ZW0gZGV2dWktdGhpcmQtaXRlbVwiXG4gICAgICAgIFtuZ0NsYXNzXT1cIntcbiAgICAgICAgICBhY3RpdmU6IGl0ZW0/LmFjdGl2ZSxcbiAgICAgICAgICBkaXNhYmxlZDogaXRlbT8uZGlzYWJsZWRcbiAgICAgICAgfVwiXG4gICAgICAgIChjbGljayk9XCJjaG9vc2VUaW1lKGl0ZW0udHlwZSwgaSwgdHJ1ZSlcIlxuICAgICAgPlxuICAgICAgICB7eyBpdGVtPy50aW1lIH19XG4gICAgICA8L2xpPlxuICAgIDwvdWw+XG4gIDwvZGl2PlxuPC9kaXY+XG4iXX0=