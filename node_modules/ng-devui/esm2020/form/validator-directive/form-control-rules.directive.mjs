import { ComponentFactoryResolver, Directive, ElementRef, EventEmitter, Host, Input, Optional, Output, Self, SkipSelf } from '@angular/core';
import { AbstractControlDirective, ControlContainer, NgControl } from '@angular/forms';
import { I18nService } from 'ng-devui/i18n';
import { OverlayContainerRef } from 'ng-devui/overlay-container';
import { PopoverComponent } from 'ng-devui/popover';
import { fromEvent, merge, Subject, timer } from 'rxjs';
import { map, switchMap, takeUntil } from 'rxjs/operators';
import { FormItemComponent } from '../form-item.component';
import { dDefaultValidators, ruleReservedWords } from './validate.type';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "ng-devui/i18n";
import * as i3 from "../form-item.component";
import * as i4 from "ng-devui/overlay-container";
export class DAbstractControlRuleDirective {
    constructor(cd, parent) {
        /* 统一设置错误抛出策略 */
        this._errorStrategy = 'dirty'; // 统一设置错误抛出策略
        /* 是否已经注册监听 */
        this._registered = false;
        this._errorMessage = null;
        this.dRulesStatusChange = new EventEmitter();
        this._cd = cd;
        this._parent = parent;
    }
    set locale(key) {
        this._locale = key;
        this._parseErrors(this._cd.control.errors);
        this.updateStatusAndMessageToView(this._cd.control.status);
    }
    get locale() {
        return this._locale;
    }
    get errorMessage() {
        return this._cd && this._cd.control.invalid
            ? this._errorMessage || (this._rules && this._rules.message)
            : null;
    }
    set errorMessage(msg) {
        if (this._cd && this._cd.control.invalid) {
            this._errorMessage = msg;
        }
        else {
            this._errorMessage = null;
        }
    }
    get isReady() {
        return this._cd.control ? !(this._cd.control.invalid || this._cd.control.pending) : true;
    }
    get pending() {
        return this._cd.control ? this._cd.control.pending : true;
    }
    /* 包含继承自父级的rule */
    get fullRules() {
        const keysCanInherit = ['messageShowType', 'errorStrategy', 'messageToView', 'popPosition', 'asyncDebounceTime'];
        const resRules = { ...this._rules };
        keysCanInherit.forEach((key) => {
            if (this._parent && this._parent.fullRules) {
                resRules[key] = resRules[key] !== undefined ? resRules[key] : this._parent.fullRules[key];
            }
        });
        return resRules;
    }
    get asyncValidatorDebounceTime() {
        const time = this.fullRules.asyncDebounceTime;
        return time === undefined ? 300 : time;
    }
    ngOnChanges(changes) {
        if ('rules' in changes && !this._rules) {
            // TODO：提供外部调用可手动更新rule方法
            this._rules = { ...this._originRules, ...this._translateRulesToObject(changes['rules'].currentValue) };
            this.setupOrUpdateRules();
        }
        if (!this._registered) {
            this._registerOnStatusChange();
        }
    }
    updateRules(rules) {
        this._rules = { ...this._originRules, ...this._translateRulesToObject(rules) };
        this.setupOrUpdateRules();
    }
    setOriginRules(rules) {
        this._originRules = this._translateRulesToObject(rules);
    }
    setupOrUpdateRules() {
        // TODO：校验rules规则是否合法
        this._transformRulesAndUpdateToModel();
        this._setUpdateStrategy();
    }
    _transformRulesAndUpdateToModel() {
        this._messageOpts = {};
        if (!Array.isArray(this._rules)) {
            if (this._rules.validators) {
                const validators = this._transformValidatorsToFnArray(this._rules.validators);
                this._updateValidators(validators);
            }
            if (this._rules.asyncValidators) {
                const asyncValidators = this._transformValidatorsToFnArray(this._rules.asyncValidators, true);
                this._updateAsyncValidators(asyncValidators);
            }
        }
        else {
            const validators = this._transformValidatorsToFnArray(this._rules);
            this._updateValidators(validators);
        }
        this._updateValueAndValidity();
    }
    _transformValidatorsToFnArray(validators, async = false) {
        const resultFns = [];
        validators.forEach((validatorRule) => {
            // TODO: 提供可全局统一注册方法
            const validatorId = this._autoGetIdFromRule(validatorRule);
            let validator = null;
            if (!validatorId) {
                // TODO：抛出错误
            }
            if (validatorId in dDefaultValidators) {
                validator = this._generateValidatorFnFromDefault(validatorId, validatorRule[validatorId]);
            }
            else {
                if (typeof validatorRule[validatorId] === 'string') {
                    validator = validatorRule.validator;
                }
                else {
                    validator = validatorRule[validatorId];
                }
                if (!validatorRule.isNgValidator) {
                    if (!async) {
                        validator = this._transformRuleToNgValidator(validatorId, validator, validatorRule.message);
                    }
                    else {
                        validator = this._transformRuleToNgAsyncValidator(validatorId, validator, validatorRule.message);
                    }
                }
            }
            if (validator) {
                if (async && this.asyncValidatorDebounceTime) {
                    const oldValidator = validator;
                    validator = (control) => {
                        return timer(this.asyncValidatorDebounceTime).pipe(switchMap(() => {
                            return oldValidator(control);
                        }));
                    };
                }
                resultFns.push(validator);
                this._messageOpts[validatorId] = validatorRule;
            }
            // else {
            //   // TODO: 抛出错误
            // }
        });
        return resultFns;
    }
    _translateRulesToObject(rules) {
        if (Array.isArray(rules)) {
            return {
                validators: rules,
            };
        }
        return rules;
    }
    _findNgValidatorInDefault(validatorRule) {
        for (const key in dDefaultValidators) {
            if (Object.prototype.hasOwnProperty.call(validatorRule, key)) {
                return { id: key, ngValidator: this._generateValidatorFnFromDefault(key, validatorRule[key]) };
            }
        }
        return null;
    }
    _generateValidatorFnFromDefault(key, value) {
        if (typeof value === 'boolean' && value) {
            // boolean无需再执行函数进行传值
            return dDefaultValidators[key];
        }
        else if (typeof value !== 'boolean') {
            return dDefaultValidators[key](value);
        }
        return null;
    }
    _transformRuleToNgValidator(id, validatorFn, message) {
        return (control) => {
            const res = validatorFn(control.value);
            return this._transValidatorResultToNgError(id, res, message);
        };
    }
    _transformRuleToNgAsyncValidator(id, validator, message) {
        return (control) => {
            return validator(control.value).pipe(map((res) => {
                return this._transValidatorResultToNgError(id, res, message);
            }));
        };
    }
    _transValidatorResultToNgError(id, res, message) {
        let error = null;
        if (typeof res === 'boolean' && !res) {
            error = {};
            error[id] = message;
        }
        else if (typeof res === 'string' || (res && typeof res === 'object')) {
            // 兼容国际化词条
            error = {};
            error[id] = res;
        }
        return error;
    }
    _autoGetIdFromRule(rule) {
        for (const key in rule) {
            if (!(key in ruleReservedWords)) {
                return key;
            }
        }
        return rule.id || null;
    }
    // TODO: 考虑自定义函数返回多种key场景
    get dClassError() {
        if (this._errorStrategy === 'dirty') {
            return this._cd.control ? this._cd.control.invalid && this._cd.control.dirty : false;
        }
        else {
            return this._cd.control ? this._cd.control.invalid : false;
        }
    }
    get showError() {
        return this.dClassError;
    }
    get showStatus() {
        if (this._errorStrategy === 'dirty') {
            return this._cd.control ? this._cd.control.dirty : false;
        }
        else {
            return true;
        }
    }
    get dClassSuccess() {
        // COMMENT: 暂不默认提供
        if (this._rules['errorStrategy'] === 'dirty') {
            return this._cd.control ? this._cd.control.valid && this._cd.control.dirty : false;
        }
        else if (!this._rules['errorStrategy']) {
            return false;
        }
        else {
            return this._cd.control ? this._cd.control.valid : false;
        }
    }
    get dClassWarning() {
        return this._warning ? true : false;
    }
    get invalid() {
        return this._cd.control ? this._cd.control.invalid : false;
    }
    _registerOnStatusChange() {
        if (this._cd && this._cd.control) {
            this._cd.control.statusChanges.subscribe((status) => {
                this._parseErrors(this._cd.control.errors);
                this._updateParent(); // update error message to parent directive
                this.updateStatusAndMessageToView(status);
            });
            this._registered = true;
        }
    }
    _parseErrors(errors) {
        if (!errors) {
            this._errorMessage = null;
        }
        else {
            /* if a rule did not have a message, we will try to get a message from errors by id */
            const { resId, resRule } = this._getARuleByErrors(errors);
            this._errorStrategy = this._getErrorStrategy(resRule);
            this._errorMessage =
                resRule &&
                    (resRule.message ||
                        this._getMessageFormErrorsById(errors, resId) ||
                        this._getDefaultErrorMessage(resRule, resId) ||
                        this._rules.message);
        }
        this.dRulesStatusChange.emit({
            showError: this.showError,
            errorMessage: this._errorMessage,
            errors: errors,
        });
    }
    _getDefaultErrorMessage(rule, id) {
        return rule && rule[id] && this.i18nFormText[id] && this.i18nFormText[id](rule[id]);
    }
    _getErrorStrategy(rule) {
        return (rule && rule.errorStrategy) || this._rules['errorStrategy'] || 'dirty';
    }
    _getMessageFormErrorsById(errors, id) {
        if (errors[id] && typeof errors[id] === 'string') {
            return errors[id];
        }
        else if (errors[id] && typeof errors[id] === 'object' && (errors[id][this.locale] || errors[id]['default'])) {
            return errors[id];
        }
        else {
            return null;
        }
    }
    _getARuleByErrors(errors) {
        // TODO：处理errors为null
        let resId;
        let resRule = null;
        for (const key of Object.keys(errors)) {
            if (this._messageOpts[key]) {
                if (resRule) {
                    const priority = resRule.priority || 0;
                    if (this._messageOpts[key].priority && this._messageOpts[key].priority > priority) {
                        resId = key;
                        resRule = this._messageOpts[key];
                    }
                }
                else {
                    resId = key;
                    resRule = this._messageOpts[key];
                }
            }
        }
        return { resId: resId, resRule: resRule };
    }
    _updateParent() {
        if (this._parent) {
            // TODO
        }
    }
    _setUpdateStrategy() {
        if (!Array.isArray(this._rules) && typeof this._rules === 'object' && this._rules.updateOn) {
            this._cd.control._updateOn = this._rules.updateOn;
        }
    }
    _updateValueAndValidity() {
        if (this._cd && this._cd.control) {
            this._cd.control.updateValueAndValidity();
        }
    }
    _updateValidators(newValidator) {
        if (this._cd && this._cd.control) {
            this._cd.control.setValidators(newValidator);
        }
    }
    _updateAsyncValidators(newValidator) {
        if (this._cd && this._cd.control) {
            this._cd.control.setAsyncValidators(newValidator);
        }
    }
}
DAbstractControlRuleDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DAbstractControlRuleDirective, deps: [{ token: i1.AbstractControlDirective }, { token: DAbstractControlRuleDirective }], target: i0.ɵɵFactoryTarget.Directive });
DAbstractControlRuleDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.1.3", type: DAbstractControlRuleDirective, outputs: { dRulesStatusChange: "dRulesStatusChange" }, usesOnChanges: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DAbstractControlRuleDirective, decorators: [{
            type: Directive
        }], ctorParameters: function () { return [{ type: i1.AbstractControlDirective }, { type: DAbstractControlRuleDirective }]; }, propDecorators: { dRulesStatusChange: [{
                type: Output
            }] } });
const dControlErrorStatusHost = {
    '[class.devui-error]': 'dClassError',
    '[class.devui-success]': 'dClassSuccess',
    '[class.devui-warning]': 'dClassWarning',
};
export class DFormGroupRuleDirective extends DAbstractControlRuleDirective {
    constructor(cd, parentDir, i18n) {
        super(cd, parentDir);
        this.i18n = i18n;
        this.dRulesStatusChange = new EventEmitter();
        this.destroy$ = new Subject();
    }
    ngOnInit() {
        this.i18nFormText = this.i18n.getI18nText().form;
        this.locale = this.i18n.getI18nText().locale;
        this.i18n
            .langChange()
            .pipe(takeUntil(this.destroy$))
            .subscribe((data) => {
            this.i18nFormText = data.form;
            this.locale = data.locale;
        });
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
    setErrorMessageByChild(msg) {
        if (!this.errorMessage) {
            this.errorMessage = msg;
        }
    }
    updateStatusAndMessageToView(status) {
        // do nothing
    }
}
DFormGroupRuleDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DFormGroupRuleDirective, deps: [{ token: i1.ControlContainer, self: true }, { token: DFormGroupRuleDirective, host: true, optional: true, skipSelf: true }, { token: i2.I18nService }], target: i0.ɵɵFactoryTarget.Directive });
DFormGroupRuleDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.1.3", type: DFormGroupRuleDirective, selector: "[dValidateRules][formGroupName],[dValidateRules][formArrayName],[dValidateRules][ngModelGroup],\n          [dValidateRules][formGroup],[dValidateRules]form:not([ngNoForm]),[dValidateRules][ngForm]", inputs: { rules: ["dValidateRules", "rules"] }, outputs: { dRulesStatusChange: "dRulesStatusChange" }, host: { properties: { "class.devui-error": "dClassError", "class.devui-success": "dClassSuccess", "class.devui-warning": "dClassWarning" } }, exportAs: ["dValidateRules"], usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DFormGroupRuleDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: `[dValidateRules][formGroupName],[dValidateRules][formArrayName],[dValidateRules][ngModelGroup],
          [dValidateRules][formGroup],[dValidateRules]form:not([ngNoForm]),[dValidateRules][ngForm]`,
                    /* eslint-disable-next-line @angular-eslint/no-host-metadata-property*/
                    host: dControlErrorStatusHost,
                    exportAs: 'dValidateRules',
                }]
        }], ctorParameters: function () { return [{ type: i1.ControlContainer, decorators: [{
                    type: Self
                }] }, { type: DFormGroupRuleDirective, decorators: [{
                    type: Optional
                }, {
                    type: Host
                }, {
                    type: SkipSelf
                }] }, { type: i2.I18nService }]; }, propDecorators: { rules: [{
                type: Input,
                args: ['dValidateRules']
            }], dRulesStatusChange: [{
                type: Output
            }] } });
export class DFormControlRuleDirective extends DAbstractControlRuleDirective {
    constructor(cd, dFormItem, parentDir, i18n, triggerElementRef, overlayContainerRef, componentFactoryResolver) {
        super(cd, parentDir);
        this.dFormItem = dFormItem;
        this.i18n = i18n;
        this.triggerElementRef = triggerElementRef;
        this.overlayContainerRef = overlayContainerRef;
        this.componentFactoryResolver = componentFactoryResolver;
        this.dRulesStatusChange = new EventEmitter();
        this.destroy$ = new Subject();
    }
    get showType() {
        return this.fullRules.messageShowType || 'popover';
    }
    get popPosition() {
        return this.fullRules.popPosition || ['right', 'bottom'];
    }
    ngOnInit() {
        this.setI18nText();
        this._registerFocusChange();
    }
    setI18nText() {
        this.i18nFormText = this.i18n.getI18nText().form;
        this.locale = this.i18n.getI18nText().locale;
        this.i18n
            .langChange()
            .pipe(takeUntil(this.destroy$))
            .subscribe((data) => {
            this.i18nFormText = data.form;
            this.locale = data.locale;
        });
    }
    _registerFocusChange() {
        merge(fromEvent(this.triggerElementRef.nativeElement, 'focusin'), fromEvent(this.triggerElementRef.nativeElement, 'focusout'))
            .pipe(takeUntil(this.destroy$))
            .subscribe((event) => {
            if (event.type === 'focusin') {
                this.showPopMessage();
            }
            if (event.type === 'focusout') {
                this.hidePopMessage();
            }
        });
    }
    _updateFormContainer(status, message) {
        if (this.dFormItem) {
            this.dFormItem.updateFeedback(status, message);
        }
    }
    _updatePopMessage(status, message) {
        this.popMessage = status === 'error' ? message : null; // 暂不提供除errorMessage外提示
        if (this.popoverComponentRef) {
            this.hidePopMessage();
            this.showPopMessage();
        }
    }
    updateStatusAndMessageToView(status) {
        let controlStatus = null;
        let message = null;
        if (this.showStatus) {
            [controlStatus, message] = this.getFormControlStatusAndMessage(status);
        }
        /* 国际化适配 */
        if (message && typeof message === 'object') {
            message = message[this.locale] || message['default'] || null;
        }
        if (this.showType === 'popover') {
            this._updatePopMessage(controlStatus, message);
            this._updateFormContainer(controlStatus, null);
        }
        else if (this.showType === 'text') {
            this._updateFormContainer(controlStatus, message);
        }
    }
    getFormControlStatusAndMessage(ngStatus) {
        let status = null;
        let message = null;
        if (ngStatus === 'INVALID') {
            status = 'error';
            message = this.errorMessage;
        }
        else if (ngStatus === 'PENDING') {
            status = 'pending';
        }
        else if (ngStatus === 'VALID') {
            status = 'success';
        }
        return [status, message];
    }
    createPopover(type, content) {
        this.popoverComponentRef = this.overlayContainerRef.createComponent(this.componentFactoryResolver.resolveComponentFactory(PopoverComponent));
        Object.assign(this.popoverComponentRef.instance, {
            content: content,
            triggerElementRef: this.triggerElementRef,
            position: this.popPosition,
            popType: type,
            popMaxWidth: this.popConfig?.popMaxWidth || 200,
            appendToBody: true,
            zIndex: this.popConfig?.zIndex || 1060,
        });
    }
    showPopMessage() {
        this.showPop('error', this.popMessage);
        if (this.popMessage) {
            this._updateFormContainer(null, null);
        }
    }
    hidePopMessage() {
        this.hidePop();
        if (this.popMessage) {
            this._updateFormContainer(this.showError ? 'error' : null, null);
        }
    }
    showPop(type, message) {
        this.hidePop();
        this.createPopover(type, message);
    }
    hidePop() {
        if (this.popoverComponentRef) {
            this.destroyPop();
        }
    }
    destroyPop() {
        if (this.popoverComponentRef) {
            this.popoverComponentRef.destroy();
            this.popoverComponentRef = null;
        }
    }
    ngOnDestroy() {
        this.destroyPop();
        this.destroy$.next();
        this.destroy$.complete();
    }
}
DFormControlRuleDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DFormControlRuleDirective, deps: [{ token: i1.NgControl, self: true }, { token: i3.FormItemComponent, host: true, optional: true }, { token: DFormGroupRuleDirective, host: true, optional: true, skipSelf: true }, { token: i2.I18nService }, { token: i0.ElementRef }, { token: i4.OverlayContainerRef }, { token: i0.ComponentFactoryResolver }], target: i0.ɵɵFactoryTarget.Directive });
DFormControlRuleDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.1.3", type: DFormControlRuleDirective, selector: "[dValidateRules][formControlName],[dValidateRules][ngModel],[dValidateRules][formControl]", inputs: { rules: ["dValidateRules", "rules"], popConfig: ["dValidatePopConfig", "popConfig"] }, outputs: { dRulesStatusChange: "dRulesStatusChange" }, host: { properties: { "class.devui-error": "dClassError", "class.devui-success": "dClassSuccess", "class.devui-warning": "dClassWarning" } }, exportAs: ["dValidateRules"], usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.3", ngImport: i0, type: DFormControlRuleDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[dValidateRules][formControlName],[dValidateRules][ngModel],[dValidateRules][formControl]',
                    /* eslint-disable-next-line @angular-eslint/no-host-metadata-property*/
                    host: dControlErrorStatusHost,
                    exportAs: 'dValidateRules',
                }]
        }], ctorParameters: function () { return [{ type: i1.NgControl, decorators: [{
                    type: Self
                }] }, { type: i3.FormItemComponent, decorators: [{
                    type: Optional
                }, {
                    type: Host
                }] }, { type: DFormGroupRuleDirective, decorators: [{
                    type: Optional
                }, {
                    type: Host
                }, {
                    type: SkipSelf
                }] }, { type: i2.I18nService }, { type: i0.ElementRef }, { type: i4.OverlayContainerRef }, { type: i0.ComponentFactoryResolver }]; }, propDecorators: { rules: [{
                type: Input,
                args: ['dValidateRules']
            }], dRulesStatusChange: [{
                type: Output
            }], popConfig: [{
                type: Input,
                args: ['dValidatePopConfig']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1jb250cm9sLXJ1bGVzLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2RldnVpL2Zvcm0vdmFsaWRhdG9yLWRpcmVjdGl2ZS9mb3JtLWNvbnRyb2wtcnVsZXMuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCx3QkFBd0IsRUFFeEIsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osSUFBSSxFQUNKLEtBQUssRUFJTCxRQUFRLEVBQ1IsTUFBTSxFQUNOLElBQUksRUFFSixRQUFRLEVBQ1QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUVMLHdCQUF3QixFQUV4QixnQkFBZ0IsRUFDaEIsU0FBUyxFQUdWLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEIsT0FBTyxFQUFpQixXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0QsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDakUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDcEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQWMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNwRSxPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUMzRCxPQUFPLEVBRUwsa0JBQWtCLEVBT2xCLGlCQUFpQixFQUNsQixNQUFNLGlCQUFpQixDQUFDOzs7Ozs7QUFHekIsTUFBTSxPQUFnQiw2QkFBNkI7SUE0RGpELFlBQVksRUFBNEIsRUFBRSxNQUFxQztRQS9DL0UsZ0JBQWdCO1FBQ1IsbUJBQWMsR0FBNkIsT0FBTyxDQUFDLENBQUMsYUFBYTtRQUt6RSxjQUFjO1FBQ04sZ0JBQVcsR0FBRyxLQUFLLENBQUM7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Q1QsUUFBUSxFQUFFLDJGQUEyRjtvQkFDckcsdUVBQXVFO29CQUN2RSxJQUFJLEVBQUUsdUJBQXVCO29CQUM3QixRQUFRLEVBQUUsZ0JBQWdCO2lCQUMzQjs7MEJBb0JFLElBQUk7OzBCQUNJLFFBQVE7OzBCQUFJLElBQUk7OEJBQzBCLHVCQUF1QjswQkFBakUsUUFBUTs7MEJBQUksSUFBSTs7MEJBQUksUUFBUTt3S0FwQlosS0FBSztzQkFBN0IsS0FBSzt1QkFBQyxnQkFBZ0I7Z0JBQ2Isa0JBQWtCO3NCQUEzQixNQUFNO2dCQUVzQixTQUFTO3NCQUFyQyxLQUFLO3VCQUFDLG9CQUFvQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgQ29tcG9uZW50UmVmLFxuICBEaXJlY3RpdmUsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdCxcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE9wdGlvbmFsLFxuICBPdXRwdXQsXG4gIFNlbGYsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFNraXBTZWxmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgQWJzdHJhY3RDb250cm9sLFxuICBBYnN0cmFjdENvbnRyb2xEaXJlY3RpdmUsXG4gIEFzeW5jVmFsaWRhdG9yRm4sXG4gIENvbnRyb2xDb250YWluZXIsXG4gIE5nQ29udHJvbCxcbiAgVmFsaWRhdGlvbkVycm9ycyxcbiAgVmFsaWRhdG9yRm5cbn0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgSTE4bkludGVyZmFjZSwgSTE4blNlcnZpY2UgfSBmcm9tICduZy1kZXZ1aS9pMThuJztcbmltcG9ydCB7IE92ZXJsYXlDb250YWluZXJSZWYgfSBmcm9tICduZy1kZXZ1aS9vdmVybGF5LWNvbnRhaW5lcic7XG5pbXBvcnQgeyBQb3BvdmVyQ29tcG9uZW50IH0gZnJvbSAnbmctZGV2dWkvcG9wb3Zlcic7XG5pbXBvcnQgeyBmcm9tRXZlbnQsIG1lcmdlLCBPYnNlcnZhYmxlLCBTdWJqZWN0LCB0aW1lciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwLCBzd2l0Y2hNYXAsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEZvcm1JdGVtQ29tcG9uZW50IH0gZnJvbSAnLi4vZm9ybS1pdGVtLmNvbXBvbmVudCc7XG5pbXBvcnQge1xuICBEQXN5bmNWYWxpZGF0ZVJ1bGUsXG4gIGREZWZhdWx0VmFsaWRhdG9ycyxcbiAgREZvcm1Db250cm9sU3RhdHVzLFxuICBEUG9wQ29uZmlnLFxuICBEVmFsaWRhdGVFcnJvclN0YXR1cyxcbiAgRFZhbGlkYXRlUnVsZSxcbiAgRFZhbGlkYXRlUnVsZXMsXG4gIERWYWxpZGF0aW9uRXJyb3JTdHJhdGVneSxcbiAgcnVsZVJlc2VydmVkV29yZHNcbn0gZnJvbSAnLi92YWxpZGF0ZS50eXBlJztcblxuQERpcmVjdGl2ZSgpXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgREFic3RyYWN0Q29udHJvbFJ1bGVEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xuICAvKiBtb2RlIGlzIF9jZC5jb250cm9sICovXG4gIHB1YmxpYyByZWFkb25seSBfY2Q6IEFic3RyYWN0Q29udHJvbERpcmVjdGl2ZTsgLy8gbW9kZWwgaXMgX2NkLmNvbnRyb2xcblxuICAvKiBwYXJlbnQgZFZhbGlkYXRlUnVsZURpcmVjdGl2ZSAqL1xuICBwcml2YXRlIF9wYXJlbnQ6IERBYnN0cmFjdENvbnRyb2xSdWxlRGlyZWN0aXZlO1xuXG4gIC8qIOmihOe9rnJ1bGVzOiBvcmlnaW5SdWxlcyAqL1xuICBwcml2YXRlIF9vcmlnaW5SdWxlczogRFZhbGlkYXRlUnVsZXM7XG5cbiAgLyogcnVsZXMgKi9cbiAgcHJpdmF0ZSBfcnVsZXM6IERWYWxpZGF0ZVJ1bGVzO1xuXG4gIC8qIOe7n+S4gOiuvue9rumUmeivr+aKm+WHuuetlueVpSAqL1xuICBwcml2YXRlIF9lcnJvclN0cmF0ZWd5OiBEVmFsaWRhdGlvbkVycm9yU3RyYXRlZ3kgPSAnZGlydHknOyAvLyDnu5/kuIDorr7nva7plJnor6/mipvlh7rnrZbnlaVcblxuICAvKiBydWxlcyBtYXAgKi9cbiAgcHJpdmF0ZSBfbWVzc2FnZU9wdHM6IHsgW2tleTogc3RyaW5nXTogRFZhbGlkYXRlUnVsZSB8IERBc3luY1ZhbGlkYXRlUnVsZSB9O1xuXG4gIC8qIOaYr+WQpuW3sue7j+azqOWGjOebkeWQrCAqL1xuICBwcml2YXRlIF9yZWdpc3RlcmVkID0gZmFsc2U7XG5cbiAgcHVibGljIHJlYWRvbmx5IGVycm9yczogeyBba2V5OiBzdHJpbmddOiBhbnkgfSB8IG51bGw7XG5cbiAgcHJpdmF0ZSBfZXJyb3JNZXNzYWdlOiBzdHJpbmcgPSBudWxsO1xuXG4gIC8qIHN0YXR1cyB3YXJuaW5nICovXG4gIHByaXZhdGUgX3dhcm5pbmc6IGJvb2xlYW47XG5cbiAgLyog5YaF572u5Zu96ZmF5YyWdGV4dCAqL1xuICBpMThuRm9ybVRleHQ6IEkxOG5JbnRlcmZhY2VbJ2Zvcm0nXTtcblxuICAvKiBsYW5ndWFnZSBrZXkgKi9cbiAgX2xvY2FsZTogc3RyaW5nO1xuICBzZXQgbG9jYWxlKGtleTogc3RyaW5nKSB7XG4gICAgdGhpcy5fbG9jYWxlID0ga2V5O1xuICAgIHRoaXMuX3BhcnNlRXJyb3JzKHRoaXMuX2NkLmNvbnRyb2wuZXJyb3JzKTtcbiAgICB0aGlzLnVwZGF0ZVN0YXR1c0FuZE1lc3NhZ2VUb1ZpZXcodGhpcy5fY2QuY29udHJvbC5zdGF0dXMpO1xuICB9XG5cbiAgZ2V0IGxvY2FsZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLl9sb2NhbGU7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGVycm9yTWVzc2FnZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fY2QgJiYgdGhpcy5fY2QuY29udHJvbC5pbnZhbGlkXG4gICAgICA/IHRoaXMuX2Vycm9yTWVzc2FnZSB8fCAodGhpcy5fcnVsZXMgJiYgKHRoaXMuX3J1bGVzIGFzIHsgbWVzc2FnZTogc3RyaW5nIH0pLm1lc3NhZ2UpXG4gICAgICA6IG51bGw7XG4gIH1cblxuICBwdWJsaWMgc2V0IGVycm9yTWVzc2FnZShtc2c6IHN0cmluZykge1xuICAgIGlmICh0aGlzLl9jZCAmJiB0aGlzLl9jZC5jb250cm9sLmludmFsaWQpIHtcbiAgICAgIHRoaXMuX2Vycm9yTWVzc2FnZSA9IG1zZztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fZXJyb3JNZXNzYWdlID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBAT3V0cHV0KCkgZFJ1bGVzU3RhdHVzQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxEVmFsaWRhdGVFcnJvclN0YXR1cz4oKTtcblxuICBjb25zdHJ1Y3RvcihjZDogQWJzdHJhY3RDb250cm9sRGlyZWN0aXZlLCBwYXJlbnQ6IERBYnN0cmFjdENvbnRyb2xSdWxlRGlyZWN0aXZlKSB7XG4gICAgdGhpcy5fY2QgPSBjZDtcbiAgICB0aGlzLl9wYXJlbnQgPSBwYXJlbnQ7XG4gIH1cblxuICBnZXQgaXNSZWFkeSgpIHtcbiAgICByZXR1cm4gdGhpcy5fY2QuY29udHJvbCA/ICEodGhpcy5fY2QuY29udHJvbC5pbnZhbGlkIHx8IHRoaXMuX2NkLmNvbnRyb2wucGVuZGluZykgOiB0cnVlO1xuICB9XG5cbiAgZ2V0IHBlbmRpbmcoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NkLmNvbnRyb2wgPyB0aGlzLl9jZC5jb250cm9sLnBlbmRpbmcgOiB0cnVlO1xuICB9XG5cbiAgLyog5YyF5ZCr57un5om/6Ieq54i257qn55qEcnVsZSAqL1xuICBnZXQgZnVsbFJ1bGVzKCk6IERWYWxpZGF0ZVJ1bGVzIHtcbiAgICBjb25zdCBrZXlzQ2FuSW5oZXJpdCA9IFsnbWVzc2FnZVNob3dUeXBlJywgJ2Vycm9yU3RyYXRlZ3knLCAnbWVzc2FnZVRvVmlldycsICdwb3BQb3NpdGlvbicsICdhc3luY0RlYm91bmNlVGltZSddO1xuICAgIGNvbnN0IHJlc1J1bGVzID0geyAuLi50aGlzLl9ydWxlcyB9O1xuICAgIGtleXNDYW5Jbmhlcml0LmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgaWYgKHRoaXMuX3BhcmVudCAmJiB0aGlzLl9wYXJlbnQuZnVsbFJ1bGVzKSB7XG4gICAgICAgIHJlc1J1bGVzW2tleV0gPSByZXNSdWxlc1trZXldICE9PSB1bmRlZmluZWQgPyByZXNSdWxlc1trZXldIDogdGhpcy5fcGFyZW50LmZ1bGxSdWxlc1trZXldO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiByZXNSdWxlcztcbiAgfVxuXG4gIGdldCBhc3luY1ZhbGlkYXRvckRlYm91bmNlVGltZSgpOiBudW1iZXIge1xuICAgIGNvbnN0IHRpbWUgPSAodGhpcy5mdWxsUnVsZXMgYXMgeyBhc3luY0RlYm91bmNlVGltZTogbnVtYmVyIH0pLmFzeW5jRGVib3VuY2VUaW1lO1xuICAgIHJldHVybiB0aW1lID09PSB1bmRlZmluZWQgPyAzMDAgOiB0aW1lO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmICgncnVsZXMnIGluIGNoYW5nZXMgJiYgIXRoaXMuX3J1bGVzKSB7XG4gICAgICAvLyBUT0RP77ya5o+Q5L6b5aSW6YOo6LCD55So5Y+v5omL5Yqo5pu05pawcnVsZeaWueazlVxuICAgICAgdGhpcy5fcnVsZXMgPSB7IC4uLnRoaXMuX29yaWdpblJ1bGVzLCAuLi50aGlzLl90cmFuc2xhdGVSdWxlc1RvT2JqZWN0KGNoYW5nZXNbJ3J1bGVzJ10uY3VycmVudFZhbHVlKSB9O1xuICAgICAgdGhpcy5zZXR1cE9yVXBkYXRlUnVsZXMoKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuX3JlZ2lzdGVyZWQpIHtcbiAgICAgIHRoaXMuX3JlZ2lzdGVyT25TdGF0dXNDaGFuZ2UoKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlUnVsZXMocnVsZXM6IERWYWxpZGF0ZVJ1bGVzKTogdm9pZCB7XG4gICAgdGhpcy5fcnVsZXMgPSB7IC4uLnRoaXMuX29yaWdpblJ1bGVzLCAuLi50aGlzLl90cmFuc2xhdGVSdWxlc1RvT2JqZWN0KHJ1bGVzKSB9O1xuICAgIHRoaXMuc2V0dXBPclVwZGF0ZVJ1bGVzKCk7XG4gIH1cblxuICBwdWJsaWMgc2V0T3JpZ2luUnVsZXMocnVsZXM6IERWYWxpZGF0ZVJ1bGVzKTogdm9pZCB7XG4gICAgdGhpcy5fb3JpZ2luUnVsZXMgPSB0aGlzLl90cmFuc2xhdGVSdWxlc1RvT2JqZWN0KHJ1bGVzKTtcbiAgfVxuXG4gIHB1YmxpYyBzZXR1cE9yVXBkYXRlUnVsZXMoKTogdm9pZCB7XG4gICAgLy8gVE9ET++8muagoemqjHJ1bGVz6KeE5YiZ5piv5ZCm5ZCI5rOVXG4gICAgdGhpcy5fdHJhbnNmb3JtUnVsZXNBbmRVcGRhdGVUb01vZGVsKCk7XG4gICAgdGhpcy5fc2V0VXBkYXRlU3RyYXRlZ3koKTtcbiAgfVxuICBwcml2YXRlIF90cmFuc2Zvcm1SdWxlc0FuZFVwZGF0ZVRvTW9kZWwoKTogdm9pZCB7XG4gICAgdGhpcy5fbWVzc2FnZU9wdHMgPSB7fTtcblxuICAgIGlmICghQXJyYXkuaXNBcnJheSh0aGlzLl9ydWxlcykpIHtcbiAgICAgIGlmICh0aGlzLl9ydWxlcy52YWxpZGF0b3JzKSB7XG4gICAgICAgIGNvbnN0IHZhbGlkYXRvcnM6IFZhbGlkYXRvckZuW10gPSB0aGlzLl90cmFuc2Zvcm1WYWxpZGF0b3JzVG9GbkFycmF5KHRoaXMuX3J1bGVzLnZhbGlkYXRvcnMpIGFzIFZhbGlkYXRvckZuW107XG4gICAgICAgIHRoaXMuX3VwZGF0ZVZhbGlkYXRvcnModmFsaWRhdG9ycyk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5fcnVsZXMuYXN5bmNWYWxpZGF0b3JzKSB7XG4gICAgICAgIGNvbnN0IGFzeW5jVmFsaWRhdG9yczogQXN5bmNWYWxpZGF0b3JGbltdID0gdGhpcy5fdHJhbnNmb3JtVmFsaWRhdG9yc1RvRm5BcnJheShcbiAgICAgICAgICB0aGlzLl9ydWxlcy5hc3luY1ZhbGlkYXRvcnMsXG4gICAgICAgICAgdHJ1ZVxuICAgICAgICApIGFzIEFzeW5jVmFsaWRhdG9yRm5bXTtcbiAgICAgICAgdGhpcy5fdXBkYXRlQXN5bmNWYWxpZGF0b3JzKGFzeW5jVmFsaWRhdG9ycyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHZhbGlkYXRvcnM6IFZhbGlkYXRvckZuW10gPSB0aGlzLl90cmFuc2Zvcm1WYWxpZGF0b3JzVG9GbkFycmF5KHRoaXMuX3J1bGVzKSBhcyBWYWxpZGF0b3JGbltdO1xuICAgICAgdGhpcy5fdXBkYXRlVmFsaWRhdG9ycyh2YWxpZGF0b3JzKTtcbiAgICB9XG4gICAgdGhpcy5fdXBkYXRlVmFsdWVBbmRWYWxpZGl0eSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBfdHJhbnNmb3JtVmFsaWRhdG9yc1RvRm5BcnJheShcbiAgICB2YWxpZGF0b3JzOiBEVmFsaWRhdGVSdWxlW10gfCBEQXN5bmNWYWxpZGF0ZVJ1bGVbXSxcbiAgICBhc3luYyA9IGZhbHNlXG4gICk6IFZhbGlkYXRvckZuW10gfCBBc3luY1ZhbGlkYXRvckZuW10ge1xuICAgIGNvbnN0IHJlc3VsdEZucyA9IFtdO1xuICAgIHZhbGlkYXRvcnMuZm9yRWFjaCgodmFsaWRhdG9yUnVsZTogRFZhbGlkYXRlUnVsZSkgPT4ge1xuICAgICAgLy8gVE9ETzog5o+Q5L6b5Y+v5YWo5bGA57uf5LiA5rOo5YaM5pa55rOVXG4gICAgICBjb25zdCB2YWxpZGF0b3JJZDogc3RyaW5nID0gdGhpcy5fYXV0b0dldElkRnJvbVJ1bGUodmFsaWRhdG9yUnVsZSk7XG4gICAgICBsZXQgdmFsaWRhdG9yID0gbnVsbDtcblxuICAgICAgaWYgKCF2YWxpZGF0b3JJZCkge1xuICAgICAgICAvLyBUT0RP77ya5oqb5Ye66ZSZ6K+vXG4gICAgICB9XG5cbiAgICAgIGlmICh2YWxpZGF0b3JJZCBpbiBkRGVmYXVsdFZhbGlkYXRvcnMpIHtcbiAgICAgICAgdmFsaWRhdG9yID0gdGhpcy5fZ2VuZXJhdGVWYWxpZGF0b3JGbkZyb21EZWZhdWx0KHZhbGlkYXRvcklkLCB2YWxpZGF0b3JSdWxlW3ZhbGlkYXRvcklkXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodHlwZW9mIHZhbGlkYXRvclJ1bGVbdmFsaWRhdG9ySWRdID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIHZhbGlkYXRvciA9IHZhbGlkYXRvclJ1bGUudmFsaWRhdG9yO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhbGlkYXRvciA9IHZhbGlkYXRvclJ1bGVbdmFsaWRhdG9ySWRdO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdmFsaWRhdG9yUnVsZS5pc05nVmFsaWRhdG9yKSB7XG4gICAgICAgICAgaWYgKCFhc3luYykge1xuICAgICAgICAgICAgdmFsaWRhdG9yID0gdGhpcy5fdHJhbnNmb3JtUnVsZVRvTmdWYWxpZGF0b3IodmFsaWRhdG9ySWQsIHZhbGlkYXRvciwgdmFsaWRhdG9yUnVsZS5tZXNzYWdlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFsaWRhdG9yID0gdGhpcy5fdHJhbnNmb3JtUnVsZVRvTmdBc3luY1ZhbGlkYXRvcih2YWxpZGF0b3JJZCwgdmFsaWRhdG9yLCB2YWxpZGF0b3JSdWxlLm1lc3NhZ2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAodmFsaWRhdG9yKSB7XG4gICAgICAgIGlmIChhc3luYyAmJiB0aGlzLmFzeW5jVmFsaWRhdG9yRGVib3VuY2VUaW1lKSB7XG4gICAgICAgICAgY29uc3Qgb2xkVmFsaWRhdG9yID0gdmFsaWRhdG9yO1xuICAgICAgICAgIHZhbGlkYXRvciA9IChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiBPYnNlcnZhYmxlPFZhbGlkYXRpb25FcnJvcnMgfCBudWxsPiA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGltZXIodGhpcy5hc3luY1ZhbGlkYXRvckRlYm91bmNlVGltZSkucGlwZShcbiAgICAgICAgICAgICAgc3dpdGNoTWFwKCgpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb2xkVmFsaWRhdG9yKGNvbnRyb2wpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdEZucy5wdXNoKHZhbGlkYXRvcik7XG4gICAgICAgIHRoaXMuX21lc3NhZ2VPcHRzW3ZhbGlkYXRvcklkXSA9IHZhbGlkYXRvclJ1bGU7XG4gICAgICB9XG4gICAgICAvLyBlbHNlIHtcbiAgICAgIC8vICAgLy8gVE9ETzog5oqb5Ye66ZSZ6K+vXG4gICAgICAvLyB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdEZucyBhcyBBc3luY1ZhbGlkYXRvckZuW10gfCBWYWxpZGF0b3JGbltdO1xuICB9XG5cbiAgcHJpdmF0ZSBfdHJhbnNsYXRlUnVsZXNUb09iamVjdChydWxlczogRFZhbGlkYXRlUnVsZXMpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShydWxlcykpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkYXRvcnM6IHJ1bGVzLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gcnVsZXM7XG4gIH1cblxuICBwcml2YXRlIF9maW5kTmdWYWxpZGF0b3JJbkRlZmF1bHQodmFsaWRhdG9yUnVsZTogRFZhbGlkYXRlUnVsZSkge1xuICAgIGZvciAoY29uc3Qga2V5IGluIGREZWZhdWx0VmFsaWRhdG9ycykge1xuICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh2YWxpZGF0b3JSdWxlLCBrZXkpKSB7XG4gICAgICAgIHJldHVybiB7IGlkOiBrZXksIG5nVmFsaWRhdG9yOiB0aGlzLl9nZW5lcmF0ZVZhbGlkYXRvckZuRnJvbURlZmF1bHQoa2V5LCB2YWxpZGF0b3JSdWxlW2tleV0pIH07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBfZ2VuZXJhdGVWYWxpZGF0b3JGbkZyb21EZWZhdWx0KGtleSwgdmFsdWUpIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicgJiYgdmFsdWUpIHtcbiAgICAgIC8vIGJvb2xlYW7ml6DpnIDlho3miafooYzlh73mlbDov5vooYzkvKDlgLxcbiAgICAgIHJldHVybiBkRGVmYXVsdFZhbGlkYXRvcnNba2V5XTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICByZXR1cm4gZERlZmF1bHRWYWxpZGF0b3JzW2tleV0odmFsdWUpO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgX3RyYW5zZm9ybVJ1bGVUb05nVmFsaWRhdG9yKGlkLCB2YWxpZGF0b3JGbiwgbWVzc2FnZSkge1xuICAgIHJldHVybiAoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogVmFsaWRhdGlvbkVycm9ycyB8IG51bGwgPT4ge1xuICAgICAgY29uc3QgcmVzID0gdmFsaWRhdG9yRm4oY29udHJvbC52YWx1ZSk7XG4gICAgICByZXR1cm4gdGhpcy5fdHJhbnNWYWxpZGF0b3JSZXN1bHRUb05nRXJyb3IoaWQsIHJlcywgbWVzc2FnZSk7XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgX3RyYW5zZm9ybVJ1bGVUb05nQXN5bmNWYWxpZGF0b3IoaWQsIHZhbGlkYXRvciwgbWVzc2FnZSkge1xuICAgIHJldHVybiAoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogT2JzZXJ2YWJsZTxWYWxpZGF0aW9uRXJyb3JzIHwgbnVsbD4gPT4ge1xuICAgICAgcmV0dXJuICh2YWxpZGF0b3IoY29udHJvbC52YWx1ZSkgYXMgT2JzZXJ2YWJsZTxib29sZWFuPikucGlwZShcbiAgICAgICAgbWFwKChyZXMpID0+IHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhbnNWYWxpZGF0b3JSZXN1bHRUb05nRXJyb3IoaWQsIHJlcywgbWVzc2FnZSk7XG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH07XG4gIH1cblxuICBwcml2YXRlIF90cmFuc1ZhbGlkYXRvclJlc3VsdFRvTmdFcnJvcihpZDogc3RyaW5nLCByZXM6IGJvb2xlYW4gfCBzdHJpbmcgfCBudWxsLCBtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICBsZXQgZXJyb3IgPSBudWxsO1xuICAgIGlmICh0eXBlb2YgcmVzID09PSAnYm9vbGVhbicgJiYgIXJlcykge1xuICAgICAgZXJyb3IgPSB7fTtcbiAgICAgIGVycm9yW2lkXSA9IG1lc3NhZ2U7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgcmVzID09PSAnc3RyaW5nJyB8fCAocmVzICYmIHR5cGVvZiByZXMgPT09ICdvYmplY3QnKSkge1xuICAgICAgLy8g5YW85a655Zu96ZmF5YyW6K+N5p2hXG4gICAgICBlcnJvciA9IHt9O1xuICAgICAgZXJyb3JbaWRdID0gcmVzO1xuICAgIH1cbiAgICByZXR1cm4gZXJyb3I7XG4gIH1cblxuICBwcml2YXRlIF9hdXRvR2V0SWRGcm9tUnVsZShydWxlOiBEVmFsaWRhdGVSdWxlIHwgREFzeW5jVmFsaWRhdGVSdWxlKSB7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gcnVsZSkge1xuICAgICAgaWYgKCEoa2V5IGluIHJ1bGVSZXNlcnZlZFdvcmRzKSkge1xuICAgICAgICByZXR1cm4ga2V5O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcnVsZS5pZCB8fCBudWxsO1xuICB9XG5cbiAgLy8gVE9ETzog6ICD6JmR6Ieq5a6a5LmJ5Ye95pWw6L+U5Zue5aSa56eNa2V55Zy65pmvXG4gIGdldCBkQ2xhc3NFcnJvcigpIHtcbiAgICBpZiAodGhpcy5fZXJyb3JTdHJhdGVneSA9PT0gJ2RpcnR5Jykge1xuICAgICAgcmV0dXJuIHRoaXMuX2NkLmNvbnRyb2wgPyB0aGlzLl9jZC5jb250cm9sLmludmFsaWQgJiYgdGhpcy5fY2QuY29udHJvbC5kaXJ0eSA6IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5fY2QuY29udHJvbCA/IHRoaXMuX2NkLmNvbnRyb2wuaW52YWxpZCA6IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGdldCBzaG93RXJyb3IoKSB7XG4gICAgcmV0dXJuIHRoaXMuZENsYXNzRXJyb3I7XG4gIH1cblxuICBnZXQgc2hvd1N0YXR1cygpIHtcbiAgICBpZiAodGhpcy5fZXJyb3JTdHJhdGVneSA9PT0gJ2RpcnR5Jykge1xuICAgICAgcmV0dXJuIHRoaXMuX2NkLmNvbnRyb2wgPyB0aGlzLl9jZC5jb250cm9sLmRpcnR5IDogZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIGdldCBkQ2xhc3NTdWNjZXNzKCkge1xuICAgIC8vIENPTU1FTlQ6IOaaguS4jem7mOiupOaPkOS+m1xuICAgIGlmICh0aGlzLl9ydWxlc1snZXJyb3JTdHJhdGVneSddID09PSAnZGlydHknKSB7XG4gICAgICByZXR1cm4gdGhpcy5fY2QuY29udHJvbCA/IHRoaXMuX2NkLmNvbnRyb2wudmFsaWQgJiYgdGhpcy5fY2QuY29udHJvbC5kaXJ0eSA6IGZhbHNlO1xuICAgIH0gZWxzZSBpZiAoIXRoaXMuX3J1bGVzWydlcnJvclN0cmF0ZWd5J10pIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuX2NkLmNvbnRyb2wgPyB0aGlzLl9jZC5jb250cm9sLnZhbGlkIDogZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGRDbGFzc1dhcm5pbmcoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3dhcm5pbmcgPyB0cnVlIDogZmFsc2U7XG4gIH1cblxuICBnZXQgaW52YWxpZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fY2QuY29udHJvbCA/IHRoaXMuX2NkLmNvbnRyb2wuaW52YWxpZCA6IGZhbHNlO1xuICB9XG5cbiAgcHJpdmF0ZSBfcmVnaXN0ZXJPblN0YXR1c0NoYW5nZSgpIHtcbiAgICBpZiAodGhpcy5fY2QgJiYgdGhpcy5fY2QuY29udHJvbCkge1xuICAgICAgdGhpcy5fY2QuY29udHJvbC5zdGF0dXNDaGFuZ2VzLnN1YnNjcmliZSgoc3RhdHVzKSA9PiB7XG4gICAgICAgIHRoaXMuX3BhcnNlRXJyb3JzKHRoaXMuX2NkLmNvbnRyb2wuZXJyb3JzKTtcbiAgICAgICAgdGhpcy5fdXBkYXRlUGFyZW50KCk7IC8vIHVwZGF0ZSBlcnJvciBtZXNzYWdlIHRvIHBhcmVudCBkaXJlY3RpdmVcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0dXNBbmRNZXNzYWdlVG9WaWV3KHN0YXR1cyk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuX3JlZ2lzdGVyZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX3BhcnNlRXJyb3JzKGVycm9yczogeyBba2V5OiBzdHJpbmddOiBhbnkgfSk6IHZvaWQge1xuICAgIGlmICghZXJyb3JzKSB7XG4gICAgICB0aGlzLl9lcnJvck1lc3NhZ2UgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICAvKiBpZiBhIHJ1bGUgZGlkIG5vdCBoYXZlIGEgbWVzc2FnZSwgd2Ugd2lsbCB0cnkgdG8gZ2V0IGEgbWVzc2FnZSBmcm9tIGVycm9ycyBieSBpZCAqL1xuICAgICAgY29uc3QgeyByZXNJZCwgcmVzUnVsZSB9ID0gdGhpcy5fZ2V0QVJ1bGVCeUVycm9ycyhlcnJvcnMpO1xuICAgICAgdGhpcy5fZXJyb3JTdHJhdGVneSA9IHRoaXMuX2dldEVycm9yU3RyYXRlZ3kocmVzUnVsZSk7XG4gICAgICB0aGlzLl9lcnJvck1lc3NhZ2UgPVxuICAgICAgICByZXNSdWxlICYmXG4gICAgICAgIChyZXNSdWxlLm1lc3NhZ2UgfHxcbiAgICAgICAgICB0aGlzLl9nZXRNZXNzYWdlRm9ybUVycm9yc0J5SWQoZXJyb3JzLCByZXNJZCkgfHxcbiAgICAgICAgICB0aGlzLl9nZXREZWZhdWx0RXJyb3JNZXNzYWdlKHJlc1J1bGUsIHJlc0lkKSB8fFxuICAgICAgICAgICh0aGlzLl9ydWxlcyBhcyB7IG1lc3NhZ2U6IHN0cmluZyB9KS5tZXNzYWdlKTtcbiAgICB9XG5cbiAgICB0aGlzLmRSdWxlc1N0YXR1c0NoYW5nZS5lbWl0KHtcbiAgICAgIHNob3dFcnJvcjogdGhpcy5zaG93RXJyb3IsXG4gICAgICBlcnJvck1lc3NhZ2U6IHRoaXMuX2Vycm9yTWVzc2FnZSxcbiAgICAgIGVycm9yczogZXJyb3JzLFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBfZ2V0RGVmYXVsdEVycm9yTWVzc2FnZShydWxlLCBpZCkge1xuICAgIHJldHVybiBydWxlICYmIHJ1bGVbaWRdICYmIHRoaXMuaTE4bkZvcm1UZXh0W2lkXSAmJiB0aGlzLmkxOG5Gb3JtVGV4dFtpZF0ocnVsZVtpZF0pO1xuICB9XG5cbiAgcHJpdmF0ZSBfZ2V0RXJyb3JTdHJhdGVneShydWxlPykge1xuICAgIHJldHVybiAocnVsZSAmJiBydWxlLmVycm9yU3RyYXRlZ3kpIHx8IHRoaXMuX3J1bGVzWydlcnJvclN0cmF0ZWd5J10gfHwgJ2RpcnR5JztcbiAgfVxuXG4gIHByaXZhdGUgX2dldE1lc3NhZ2VGb3JtRXJyb3JzQnlJZChlcnJvcnM6IHsgW2tleTogc3RyaW5nXTogYW55IH0sIGlkOiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsIHtcbiAgICBpZiAoZXJyb3JzW2lkXSAmJiB0eXBlb2YgZXJyb3JzW2lkXSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiBlcnJvcnNbaWRdO1xuICAgIH0gZWxzZSBpZiAoZXJyb3JzW2lkXSAmJiB0eXBlb2YgZXJyb3JzW2lkXSA9PT0gJ29iamVjdCcgJiYgKGVycm9yc1tpZF1bdGhpcy5sb2NhbGVdIHx8IGVycm9yc1tpZF1bJ2RlZmF1bHQnXSkpIHtcbiAgICAgIHJldHVybiBlcnJvcnNbaWRdO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9nZXRBUnVsZUJ5RXJyb3JzKGVycm9yczogeyBba2V5OiBzdHJpbmddOiBhbnkgfSkge1xuICAgIC8vIFRPRE/vvJrlpITnkIZlcnJvcnPkuLpudWxsXG4gICAgbGV0IHJlc0lkOiBzdHJpbmc7XG4gICAgbGV0IHJlc1J1bGUgPSBudWxsO1xuICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKGVycm9ycykpIHtcbiAgICAgIGlmICh0aGlzLl9tZXNzYWdlT3B0c1trZXldKSB7XG4gICAgICAgIGlmIChyZXNSdWxlKSB7XG4gICAgICAgICAgY29uc3QgcHJpb3JpdHkgPSByZXNSdWxlLnByaW9yaXR5IHx8IDA7XG4gICAgICAgICAgaWYgKHRoaXMuX21lc3NhZ2VPcHRzW2tleV0ucHJpb3JpdHkgJiYgdGhpcy5fbWVzc2FnZU9wdHNba2V5XS5wcmlvcml0eSA+IHByaW9yaXR5KSB7XG4gICAgICAgICAgICByZXNJZCA9IGtleTtcbiAgICAgICAgICAgIHJlc1J1bGUgPSB0aGlzLl9tZXNzYWdlT3B0c1trZXldO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNJZCA9IGtleTtcbiAgICAgICAgICByZXNSdWxlID0gdGhpcy5fbWVzc2FnZU9wdHNba2V5XTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4geyByZXNJZDogcmVzSWQsIHJlc1J1bGU6IHJlc1J1bGUgfTtcbiAgfVxuXG4gIF91cGRhdGVQYXJlbnQoKSB7XG4gICAgaWYgKHRoaXMuX3BhcmVudCkge1xuICAgICAgLy8gVE9ET1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX3NldFVwZGF0ZVN0cmF0ZWd5KCk6IHZvaWQge1xuICAgIGlmICghQXJyYXkuaXNBcnJheSh0aGlzLl9ydWxlcykgJiYgdHlwZW9mIHRoaXMuX3J1bGVzID09PSAnb2JqZWN0JyAmJiB0aGlzLl9ydWxlcy51cGRhdGVPbikge1xuICAgICAgKHRoaXMuX2NkLmNvbnRyb2wgYXMgYW55KS5fdXBkYXRlT24gPSB0aGlzLl9ydWxlcy51cGRhdGVPbjtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgX3VwZGF0ZVZhbHVlQW5kVmFsaWRpdHkoKSB7XG4gICAgaWYgKHRoaXMuX2NkICYmIHRoaXMuX2NkLmNvbnRyb2wpIHtcbiAgICAgIHRoaXMuX2NkLmNvbnRyb2wudXBkYXRlVmFsdWVBbmRWYWxpZGl0eSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX3VwZGF0ZVZhbGlkYXRvcnMobmV3VmFsaWRhdG9yOiBWYWxpZGF0b3JGbiB8IFZhbGlkYXRvckZuW10gfCBudWxsKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX2NkICYmIHRoaXMuX2NkLmNvbnRyb2wpIHtcbiAgICAgIHRoaXMuX2NkLmNvbnRyb2wuc2V0VmFsaWRhdG9ycyhuZXdWYWxpZGF0b3IpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX3VwZGF0ZUFzeW5jVmFsaWRhdG9ycyhuZXdWYWxpZGF0b3I6IEFzeW5jVmFsaWRhdG9yRm4gfCBBc3luY1ZhbGlkYXRvckZuW10gfCBudWxsKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX2NkICYmIHRoaXMuX2NkLmNvbnRyb2wpIHtcbiAgICAgIHRoaXMuX2NkLmNvbnRyb2wuc2V0QXN5bmNWYWxpZGF0b3JzKG5ld1ZhbGlkYXRvcik7XG4gICAgfVxuICB9XG5cbiAgYWJzdHJhY3QgdXBkYXRlU3RhdHVzQW5kTWVzc2FnZVRvVmlldyhzdGF0dXM6IGFueSk6IHZvaWQ7XG59XG5cbmNvbnN0IGRDb250cm9sRXJyb3JTdGF0dXNIb3N0ID0ge1xuICAnW2NsYXNzLmRldnVpLWVycm9yXSc6ICdkQ2xhc3NFcnJvcicsXG4gICdbY2xhc3MuZGV2dWktc3VjY2Vzc10nOiAnZENsYXNzU3VjY2VzcycsXG4gICdbY2xhc3MuZGV2dWktd2FybmluZ10nOiAnZENsYXNzV2FybmluZycsXG59O1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6IGBbZFZhbGlkYXRlUnVsZXNdW2Zvcm1Hcm91cE5hbWVdLFtkVmFsaWRhdGVSdWxlc11bZm9ybUFycmF5TmFtZV0sW2RWYWxpZGF0ZVJ1bGVzXVtuZ01vZGVsR3JvdXBdLFxuICAgICAgICAgIFtkVmFsaWRhdGVSdWxlc11bZm9ybUdyb3VwXSxbZFZhbGlkYXRlUnVsZXNdZm9ybTpub3QoW25nTm9Gb3JtXSksW2RWYWxpZGF0ZVJ1bGVzXVtuZ0Zvcm1dYCxcbiAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9uby1ob3N0LW1ldGFkYXRhLXByb3BlcnR5Ki9cbiAgaG9zdDogZENvbnRyb2xFcnJvclN0YXR1c0hvc3QsXG4gIGV4cG9ydEFzOiAnZFZhbGlkYXRlUnVsZXMnLFxufSlcbmV4cG9ydCBjbGFzcyBERm9ybUdyb3VwUnVsZURpcmVjdGl2ZSBleHRlbmRzIERBYnN0cmFjdENvbnRyb2xSdWxlRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG4gIEBJbnB1dCgnZFZhbGlkYXRlUnVsZXMnKSBydWxlczogRFZhbGlkYXRlUnVsZXM7XG4gIEBPdXRwdXQoKSBkUnVsZXNTdGF0dXNDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgcHJpdmF0ZSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgY29uc3RydWN0b3IoQFNlbGYoKSBjZDogQ29udHJvbENvbnRhaW5lciwgQE9wdGlvbmFsKCkgQEhvc3QoKSBAU2tpcFNlbGYoKSBwYXJlbnREaXI6IERGb3JtR3JvdXBSdWxlRGlyZWN0aXZlLCBwcml2YXRlIGkxOG46IEkxOG5TZXJ2aWNlKSB7XG4gICAgc3VwZXIoY2QsIHBhcmVudERpcik7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmkxOG5Gb3JtVGV4dCA9IHRoaXMuaTE4bi5nZXRJMThuVGV4dCgpLmZvcm07XG4gICAgdGhpcy5sb2NhbGUgPSB0aGlzLmkxOG4uZ2V0STE4blRleHQoKS5sb2NhbGU7XG5cbiAgICB0aGlzLmkxOG5cbiAgICAgIC5sYW5nQ2hhbmdlKClcbiAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSlcbiAgICAgIC5zdWJzY3JpYmUoKGRhdGE6IEkxOG5JbnRlcmZhY2UpID0+IHtcbiAgICAgICAgdGhpcy5pMThuRm9ybVRleHQgPSBkYXRhLmZvcm07XG4gICAgICAgIHRoaXMubG9jYWxlID0gZGF0YS5sb2NhbGU7XG4gICAgICB9KTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xuICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcbiAgfVxuXG4gIHNldEVycm9yTWVzc2FnZUJ5Q2hpbGQobXNnOiBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMuZXJyb3JNZXNzYWdlKSB7XG4gICAgICB0aGlzLmVycm9yTWVzc2FnZSA9IG1zZztcbiAgICB9XG4gIH1cblxuICB1cGRhdGVTdGF0dXNBbmRNZXNzYWdlVG9WaWV3KHN0YXR1czogYW55KTogdm9pZCB7XG4gICAgLy8gZG8gbm90aGluZ1xuICB9XG59XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tkVmFsaWRhdGVSdWxlc11bZm9ybUNvbnRyb2xOYW1lXSxbZFZhbGlkYXRlUnVsZXNdW25nTW9kZWxdLFtkVmFsaWRhdGVSdWxlc11bZm9ybUNvbnRyb2xdJyxcbiAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9uby1ob3N0LW1ldGFkYXRhLXByb3BlcnR5Ki9cbiAgaG9zdDogZENvbnRyb2xFcnJvclN0YXR1c0hvc3QsXG4gIGV4cG9ydEFzOiAnZFZhbGlkYXRlUnVsZXMnLFxufSlcbmV4cG9ydCBjbGFzcyBERm9ybUNvbnRyb2xSdWxlRGlyZWN0aXZlIGV4dGVuZHMgREFic3RyYWN0Q29udHJvbFJ1bGVEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcbiAgQElucHV0KCdkVmFsaWRhdGVSdWxlcycpIHJ1bGVzOiBEVmFsaWRhdGVSdWxlcztcbiAgQE91dHB1dCgpIGRSdWxlc1N0YXR1c0NoYW5nZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBASW5wdXQoJ2RWYWxpZGF0ZVBvcENvbmZpZycpIHBvcENvbmZpZzogRFBvcENvbmZpZztcblxuICBwb3BvdmVyQ29tcG9uZW50UmVmOiBDb21wb25lbnRSZWY8UG9wb3ZlckNvbXBvbmVudD47XG4gIHByaXZhdGUgZGVzdHJveSQgPSBuZXcgU3ViamVjdCgpO1xuICBwb3BNZXNzYWdlOiBzdHJpbmc7IC8vIOacgOe7iOaYvuekuueahG1lc3NhZ2VcblxuICBnZXQgc2hvd1R5cGUoKSB7XG4gICAgcmV0dXJuICh0aGlzLmZ1bGxSdWxlcyBhcyB7IG1lc3NhZ2VTaG93VHlwZTogc3RyaW5nIH0pLm1lc3NhZ2VTaG93VHlwZSB8fCAncG9wb3Zlcic7XG4gIH1cblxuICBnZXQgcG9wUG9zaXRpb24oKSB7XG4gICAgcmV0dXJuICh0aGlzLmZ1bGxSdWxlcyBhcyB7IHBvcFBvc2l0aW9uOiBhbnkgfSkucG9wUG9zaXRpb24gfHwgWydyaWdodCcsICdib3R0b20nXTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICBAU2VsZigpIGNkOiBOZ0NvbnRyb2wsXG4gICAgICAgICAgQE9wdGlvbmFsKCkgQEhvc3QoKSBwcml2YXRlIGRGb3JtSXRlbTogRm9ybUl0ZW1Db21wb25lbnQsXG4gICAgICAgICAgQE9wdGlvbmFsKCkgQEhvc3QoKSBAU2tpcFNlbGYoKSBwYXJlbnREaXI6IERGb3JtR3JvdXBSdWxlRGlyZWN0aXZlLFxuICAgICAgICAgIHByaXZhdGUgaTE4bjogSTE4blNlcnZpY2UsXG4gICAgICAgICAgcHVibGljIHRyaWdnZXJFbGVtZW50UmVmOiBFbGVtZW50UmVmLFxuICAgICAgICAgIHByaXZhdGUgb3ZlcmxheUNvbnRhaW5lclJlZjogT3ZlcmxheUNvbnRhaW5lclJlZixcbiAgICAgICAgICBwcml2YXRlIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyXG4gICkge1xuICAgIHN1cGVyKGNkLCBwYXJlbnREaXIpO1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5zZXRJMThuVGV4dCgpO1xuICAgIHRoaXMuX3JlZ2lzdGVyRm9jdXNDaGFuZ2UoKTtcbiAgfVxuXG4gIHNldEkxOG5UZXh0KCkge1xuICAgIHRoaXMuaTE4bkZvcm1UZXh0ID0gdGhpcy5pMThuLmdldEkxOG5UZXh0KCkuZm9ybTtcbiAgICB0aGlzLmxvY2FsZSA9IHRoaXMuaTE4bi5nZXRJMThuVGV4dCgpLmxvY2FsZTtcblxuICAgIHRoaXMuaTE4blxuICAgICAgLmxhbmdDaGFuZ2UoKVxuICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKVxuICAgICAgLnN1YnNjcmliZSgoZGF0YTogSTE4bkludGVyZmFjZSkgPT4ge1xuICAgICAgICB0aGlzLmkxOG5Gb3JtVGV4dCA9IGRhdGEuZm9ybTtcbiAgICAgICAgdGhpcy5sb2NhbGUgPSBkYXRhLmxvY2FsZTtcbiAgICAgIH0pO1xuICB9XG5cbiAgX3JlZ2lzdGVyRm9jdXNDaGFuZ2UoKSB7XG4gICAgbWVyZ2UoZnJvbUV2ZW50KHRoaXMudHJpZ2dlckVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ2ZvY3VzaW4nKSwgZnJvbUV2ZW50KHRoaXMudHJpZ2dlckVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ2ZvY3Vzb3V0JykpXG4gICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpXG4gICAgICAuc3Vic2NyaWJlKChldmVudDogRXZlbnQpID0+IHtcbiAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT09ICdmb2N1c2luJykge1xuICAgICAgICAgIHRoaXMuc2hvd1BvcE1lc3NhZ2UoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ2ZvY3Vzb3V0Jykge1xuICAgICAgICAgIHRoaXMuaGlkZVBvcE1lc3NhZ2UoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH1cblxuICBfdXBkYXRlRm9ybUNvbnRhaW5lcihzdGF0dXMsIG1lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmICh0aGlzLmRGb3JtSXRlbSkge1xuICAgICAgdGhpcy5kRm9ybUl0ZW0udXBkYXRlRmVlZGJhY2soc3RhdHVzLCBtZXNzYWdlKTtcbiAgICB9XG4gIH1cblxuICBfdXBkYXRlUG9wTWVzc2FnZShzdGF0dXM6IERGb3JtQ29udHJvbFN0YXR1cywgbWVzc2FnZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5wb3BNZXNzYWdlID0gc3RhdHVzID09PSAnZXJyb3InID8gbWVzc2FnZSA6IG51bGw7IC8vIOaaguS4jeaPkOS+m+mZpGVycm9yTWVzc2FnZeWkluaPkOekulxuICAgIGlmICh0aGlzLnBvcG92ZXJDb21wb25lbnRSZWYpIHtcbiAgICAgIHRoaXMuaGlkZVBvcE1lc3NhZ2UoKTtcbiAgICAgIHRoaXMuc2hvd1BvcE1lc3NhZ2UoKTtcbiAgICB9XG4gIH1cblxuICB1cGRhdGVTdGF0dXNBbmRNZXNzYWdlVG9WaWV3KHN0YXR1czogYW55KTogdm9pZCB7XG4gICAgbGV0IGNvbnRyb2xTdGF0dXMgPSBudWxsO1xuICAgIGxldCBtZXNzYWdlID0gbnVsbDtcbiAgICBpZiAodGhpcy5zaG93U3RhdHVzKSB7XG4gICAgICBbY29udHJvbFN0YXR1cywgbWVzc2FnZV0gPSB0aGlzLmdldEZvcm1Db250cm9sU3RhdHVzQW5kTWVzc2FnZShzdGF0dXMpO1xuICAgIH1cblxuICAgIC8qIOWbvemZheWMlumAgumFjSAqL1xuICAgIGlmIChtZXNzYWdlICYmIHR5cGVvZiBtZXNzYWdlID09PSAnb2JqZWN0Jykge1xuICAgICAgbWVzc2FnZSA9IG1lc3NhZ2VbdGhpcy5sb2NhbGVdIHx8IG1lc3NhZ2VbJ2RlZmF1bHQnXSB8fCBudWxsO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnNob3dUeXBlID09PSAncG9wb3ZlcicpIHtcbiAgICAgIHRoaXMuX3VwZGF0ZVBvcE1lc3NhZ2UoY29udHJvbFN0YXR1cywgbWVzc2FnZSk7XG4gICAgICB0aGlzLl91cGRhdGVGb3JtQ29udGFpbmVyKGNvbnRyb2xTdGF0dXMsIG51bGwpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5zaG93VHlwZSA9PT0gJ3RleHQnKSB7XG4gICAgICB0aGlzLl91cGRhdGVGb3JtQ29udGFpbmVyKGNvbnRyb2xTdGF0dXMsIG1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIGdldEZvcm1Db250cm9sU3RhdHVzQW5kTWVzc2FnZShuZ1N0YXR1czogYW55KSB7XG4gICAgbGV0IHN0YXR1cyA9IG51bGw7XG4gICAgbGV0IG1lc3NhZ2UgPSBudWxsO1xuICAgIGlmIChuZ1N0YXR1cyA9PT0gJ0lOVkFMSUQnKSB7XG4gICAgICBzdGF0dXMgPSAnZXJyb3InO1xuICAgICAgbWVzc2FnZSA9IHRoaXMuZXJyb3JNZXNzYWdlO1xuICAgIH0gZWxzZSBpZiAobmdTdGF0dXMgPT09ICdQRU5ESU5HJykge1xuICAgICAgc3RhdHVzID0gJ3BlbmRpbmcnO1xuICAgIH0gZWxzZSBpZiAobmdTdGF0dXMgPT09ICdWQUxJRCcpIHtcbiAgICAgIHN0YXR1cyA9ICdzdWNjZXNzJztcbiAgICB9XG4gICAgcmV0dXJuIFtzdGF0dXMsIG1lc3NhZ2VdO1xuICB9XG5cbiAgY3JlYXRlUG9wb3Zlcih0eXBlOiAnZXJyb3InIHwgJ3dhcm5pbmcnLCBjb250ZW50OiBzdHJpbmcpIHtcbiAgICB0aGlzLnBvcG92ZXJDb21wb25lbnRSZWYgPSB0aGlzLm92ZXJsYXlDb250YWluZXJSZWYuY3JlYXRlQ29tcG9uZW50KFxuICAgICAgdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoUG9wb3ZlckNvbXBvbmVudClcbiAgICApO1xuICAgIE9iamVjdC5hc3NpZ24odGhpcy5wb3BvdmVyQ29tcG9uZW50UmVmLmluc3RhbmNlLCB7XG4gICAgICBjb250ZW50OiBjb250ZW50LFxuICAgICAgdHJpZ2dlckVsZW1lbnRSZWY6IHRoaXMudHJpZ2dlckVsZW1lbnRSZWYsXG4gICAgICBwb3NpdGlvbjogdGhpcy5wb3BQb3NpdGlvbixcbiAgICAgIHBvcFR5cGU6IHR5cGUsXG4gICAgICBwb3BNYXhXaWR0aDogdGhpcy5wb3BDb25maWc/LnBvcE1heFdpZHRoIHx8IDIwMCxcbiAgICAgIGFwcGVuZFRvQm9keTogdHJ1ZSxcbiAgICAgIHpJbmRleDogdGhpcy5wb3BDb25maWc/LnpJbmRleCB8fCAxMDYwLFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHNob3dQb3BNZXNzYWdlKCkge1xuICAgIHRoaXMuc2hvd1BvcCgnZXJyb3InLCB0aGlzLnBvcE1lc3NhZ2UpO1xuICAgIGlmICh0aGlzLnBvcE1lc3NhZ2UpIHtcbiAgICAgIHRoaXMuX3VwZGF0ZUZvcm1Db250YWluZXIobnVsbCwgbnVsbCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGhpZGVQb3BNZXNzYWdlKCkge1xuICAgIHRoaXMuaGlkZVBvcCgpO1xuICAgIGlmICh0aGlzLnBvcE1lc3NhZ2UpIHtcbiAgICAgIHRoaXMuX3VwZGF0ZUZvcm1Db250YWluZXIodGhpcy5zaG93RXJyb3IgPyAnZXJyb3InIDogbnVsbCwgbnVsbCk7XG4gICAgfVxuICB9XG5cbiAgc2hvd1BvcCh0eXBlLCBtZXNzYWdlKSB7XG4gICAgdGhpcy5oaWRlUG9wKCk7XG4gICAgdGhpcy5jcmVhdGVQb3BvdmVyKHR5cGUsIG1lc3NhZ2UpO1xuICB9XG5cbiAgaGlkZVBvcCgpIHtcbiAgICBpZiAodGhpcy5wb3BvdmVyQ29tcG9uZW50UmVmKSB7XG4gICAgICB0aGlzLmRlc3Ryb3lQb3AoKTtcbiAgICB9XG4gIH1cblxuICBkZXN0cm95UG9wKCkge1xuICAgIGlmICh0aGlzLnBvcG92ZXJDb21wb25lbnRSZWYpIHtcbiAgICAgIHRoaXMucG9wb3ZlckNvbXBvbmVudFJlZi5kZXN0cm95KCk7XG4gICAgICB0aGlzLnBvcG92ZXJDb21wb25lbnRSZWYgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuZGVzdHJveVBvcCgpO1xuICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xuICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcbiAgfVxufVxuIl19