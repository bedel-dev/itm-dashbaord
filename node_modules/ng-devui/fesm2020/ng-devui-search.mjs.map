{"version":3,"file":"ng-devui-search.mjs","sources":["../../devui/search/search.component.ts","../../devui/search/search.component.html","../../devui/search/search.module.ts","../../devui/search/ng-devui-search.ts"],"sourcesContent":["import {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  EventEmitter,\n  forwardRef,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  Renderer2,\n  ViewChild\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { I18nInterface, I18nService } from 'ng-devui/i18n';\nimport { fromEvent, Subject, Subscription } from 'rxjs';\nimport { debounceTime, filter, map, takeUntil } from 'rxjs/operators';\n\n@Component({\n  selector: 'd-search',\n  templateUrl: './search.component.html',\n  styleUrls: ['./search.component.scss'],\n  exportAs: 'search',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  preserveWhitespaces: false,\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => SearchComponent),\n      multi: true,\n    },\n  ],\n})\nexport class SearchComponent implements ControlValueAccessor, OnInit, OnDestroy, AfterViewInit {\n  constructor(private renderer: Renderer2, private i18n: I18nService, private cdr: ChangeDetectorRef, private el: ElementRef) {\n  }\n\n  /**\n   * 【可选】下拉选框尺寸\n   */\n  @Input() size: '' | 'sm' | 'lg';\n  /**\n   * 【可选】下拉默认显示文字\n   */\n  @Input() placeholder: string;\n  @Input() maxLength = Number.MAX_SAFE_INTEGER;\n  @Input() isKeyupSearch = false;\n  @Input() delay = 300;\n  @Input() disabled = false;\n  @Input() cssClass: string;\n  @Input() iconPosition = 'right';\n  @Input() noBorder = false;\n  @Input() autoFocus = false;\n  @Output() searchFn = new EventEmitter<string>();\n  @ViewChild('filterInput', { static: true }) filterInputElement: ElementRef;\n  @ViewChild('line') lineElement: ElementRef;\n  @ViewChild('clearIcon') clearIconElement: ElementRef;\n  i18nCommonText: I18nInterface['common'];\n  i18nSubscription: Subscription;\n  clearIconExit = false;\n  width: number;\n  destroy$ = new Subject();\n  private onChange = (_: any) => null;\n  private onTouch = () => null;\n\n  ngOnInit() {\n    this.setI18nText();\n  }\n\n  registerOnChange(fn: any): void {\n    this.onChange = fn;\n  }\n\n  registerOnTouched(fn: any): void {\n    this.onTouch = fn;\n  }\n\n  writeValue(value: any = ''): void {\n    this.renderer.setProperty(this.filterInputElement.nativeElement, 'value', value);\n    this.renderClearIcon();\n  }\n\n  setI18nText() {\n    this.i18nCommonText = this.i18n.getI18nText().common;\n    this.i18nSubscription = this.i18n.langChange()\n      .pipe(takeUntil(this.destroy$))\n      .subscribe((data) => {\n        this.i18nCommonText = data.common;\n        this.cdr.markForCheck();\n      });\n  }\n\n  clearText() {\n    this.renderer.setProperty(this.filterInputElement.nativeElement, 'value', '');\n    if (this.onChange) {\n      this.onChange('');\n    }\n    this.searchFn.emit('');\n    this.filterInputElement.nativeElement.focus();\n    this.renderClearIcon();\n  }\n\n  inputChange(value, event?) {\n    this.renderClearIcon();\n    // 此函数不能删除，需要给filterInput.value赋值，从而控制clear的显隐。因为registerFilterChange对clear的显隐控制不起作用。\n  }\n\n  inputBlur() {\n    this.onTouch();\n  }\n\n  clickSearch(term) {\n    if (!this.disabled) {\n      this.searchFn.emit(term);\n    }\n  }\n\n  registerFilterChange() {\n    fromEvent(this.filterInputElement.nativeElement, 'input')\n      .pipe(\n        takeUntil(this.destroy$),\n        map((e: any) => e.target.value),\n        debounceTime(this.delay))\n      .subscribe((value) => {\n        this.onChange(value);\n        if (this.isKeyupSearch) {\n          this.searchFn.emit(value);\n        }\n      });\n\n    fromEvent(this.filterInputElement.nativeElement, 'keydown').pipe(\n      takeUntil(this.destroy$),\n      filter((keyEvent: KeyboardEvent) => keyEvent.key === 'Enter'),\n      debounceTime(this.delay),\n    ).subscribe((keyEvent) => {\n      this.searchFn.emit(this.filterInputElement.nativeElement.value);\n    });\n  }\n\n  ngAfterViewInit() {\n    this.registerFilterChange();\n    this.renderClearIcon();\n  }\n\n  renderClearIcon() {\n    if (this.iconPosition === 'right') {\n      if (this.filterInputElement.nativeElement.value && this.lineElement && this.clearIconElement) {\n        this.clearIconExit = true;\n      } else if (this.lineElement && this.clearIconElement) {\n        this.clearIconExit = false;\n      }\n    } else {\n      if (this.filterInputElement.nativeElement.value && this.clearIconElement) {\n        this.clearIconExit = true;\n      } else if (this.clearIconElement) {\n        this.clearIconExit = false;\n      }\n    }\n    this.cdr.markForCheck();\n  }\n\n  ngOnDestroy() {\n    this.destroy$.next(true);\n  }\n}\n","<div class=\"devui-search\">\n  <input\n    #filterInput\n    [dAutoFocus]=\"autoFocus\"\n    [placeholder]=\"placeholder || i18nCommonText?.searchPlaceholder\"\n    (change)=\"inputChange(filterInput.value, $event)\"\n    (keyup)=\"inputChange(filterInput.value, $event)\"\n    [attr.maxlength]=\"maxLength\"\n    [disabled]=\"disabled\"\n    (blur)=\"inputBlur()\"\n    type=\"text\"\n    class=\"devui-input {{ cssClass }}\"\n    [ngClass]=\"{\n      'devui-input-sm': size === 'sm',\n      'devui-input-lg': size === 'lg',\n      'devui-clear-exit': clearIconExit,\n      'devui-icon-left': iconPosition === 'left',\n      'devui-search-no-border': noBorder === true\n    }\"\n  />\n  <span\n    class=\"devui-search-icon\"\n    [ngClass]=\"{ 'devui-search-icon-sm': size === 'sm', 'devui-search-icon-lg': size === 'lg', 'devui-icon-left': iconPosition === 'left' }\"\n    (click)=\"clickSearch(filterInput.value)\"\n  >\n    <svg\n      width=\"16px\"\n      height=\"16px\"\n      viewBox=\"0 0 16 16\"\n      version=\"1.1\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n      class=\"svg-icon-search\"\n    >\n      <g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n        <path\n          d=\"M7,0 C10.8659932,0 14,3.13400675 14,7 C14,8.57190212 13.4818819,10.0227913 12.6071076,11.1912056 L15.7071068,14.2928932 C16.0976311,14.6834175 16.0976311,15.3165825 15.7071068,15.7071068 C15.3466228,16.0675907 14.7793918,16.0953203 14.3871006,15.7902954 L14.2928932,15.7071068 L11.1912056,12.6071076 C10.0227913,13.4818819 8.57190212,14 7,14 C3.13400675,14 5.5067062e-14,10.8659932 5.5067062e-14,7 C5.5067062e-14,3.13400675 3.13400675,0 7,0 Z M7,2 C4.23857625,2 2,4.23857625 2,7 C2,9.76142375 4.23857625,12 7,12 C9.76142375,12 12,9.76142375 12,7 C12,4.23857625 9.76142375,2 7,2 Z\"\n          id=\"椭圆形\"\n          fill=\"#71757F\"\n        ></path>\n      </g>\n    </svg>\n  </span>\n  <span\n    #line\n    *ngIf=\"iconPosition === 'right'\"\n    class=\"devui-search-line\"\n    [ngClass]=\"{ 'devui-search-line-sm': size === 'sm', 'devui-search-line-lg': size === 'lg', 'devui-clear-exit': clearIconExit }\"\n  >\n  </span>\n  <span\n    #clearIcon\n    (click)=\"clearText()\"\n    class=\"devui-search-clear\"\n    [ngClass]=\"{\n      'devui-search-clear-sm': size === 'sm',\n      'devui-search-clear-lg': size === 'lg',\n      'devui-clear-exit': clearIconExit,\n      'devui-icon-left': iconPosition === 'left'\n    }\"\n  >\n    <svg\n      width=\"16px\"\n      height=\"16px\"\n      viewBox=\"0 0 16 16\"\n      version=\"1.1\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n      class=\"svg-icon-clear\"\n    >\n      <g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n        <path\n          d=\"M8,1 C11.8659932,1 15,4.13400675 15,8 C15,11.8659932 11.8659932,15 8,15 C4.13400675,15 1,11.8659932 1,8 C1,4.13400675 4.13400675,1 8,1 Z M5.87867966,5.17157288 C5.68341751,4.97631073 5.36683502,4.97631073 5.17157288,5.17157288 C4.99800652,5.34513923 4.97872137,5.61456363 5.11371742,5.80943177 L5.17157288,5.87867966 L7.29218611,7.99929289 L5.17157288,10.1213203 C4.97631073,10.3165825 4.97631073,10.633165 5.17157288,10.8284271 C5.34513923,11.0019935 5.61456363,11.0212786 5.80943177,10.8862826 L5.87867966,10.8284271 L7.99929289,8.70639967 L10.1213203,10.8284271 C10.3165825,11.0236893 10.633165,11.0236893 10.8284271,10.8284271 C11.0019935,10.6548608 11.0212786,10.3854364 10.8862826,10.1905682 L10.8284271,10.1213203 L8.70710678,8 L10.8284271,5.87867966 C11.0236893,5.68341751 11.0236893,5.36683502 10.8284271,5.17157288 C10.6548608,4.99800652 10.3854364,4.97872137 10.1905682,5.11371742 L10.1213203,5.17157288 L8,7.29289322 L5.87867966,5.17157288 Z\"\n          id=\"形状\"\n          fill=\"#D5D5DB\"\n          fill-rule=\"nonzero\"\n        ></path>\n      </g>\n    </svg>\n  </span>\n</div>\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { DCommonModule } from 'ng-devui/common';\nimport { SearchComponent } from './search.component';\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    DCommonModule\n  ],\n  exports: [\n    SearchComponent,\n  ],\n  declarations: [\n    SearchComponent,\n  ]\n})\nexport class SearchModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}