{"version":3,"file":"ng-devui-fullscreen.mjs","sources":["../../devui/fullscreen/fullscreen.config.ts","../../devui/fullscreen/fullscreen.component.ts","../../devui/fullscreen/fullscreen.component.html","../../devui/fullscreen/fullscreen.module.ts","../../devui/fullscreen/ng-devui-fullscreen.ts"],"sourcesContent":["export const DEFAULT_MODE = 'immersive';\nexport const DEFAULT_ZINDEX = 10;\nexport const ESC_KEYCODE = 27;\n","import { DOCUMENT } from '@angular/common';\nimport { AfterViewInit, Component, ElementRef, EventEmitter, Inject, Input, OnDestroy, OnInit, Output } from '@angular/core';\nimport { DEFAULT_MODE, DEFAULT_ZINDEX, ESC_KEYCODE } from './fullscreen.config';\nimport { FullscreenMode } from './fullscreen.type';\n\n@Component({\n  selector: 'd-fullscreen',\n  templateUrl: './fullscreen.component.html',\n  styleUrls: [ './fullscreen.component.scss' ],\n  preserveWhitespaces: false,\n})\nexport class FullscreenComponent implements OnInit, OnDestroy, AfterViewInit {\n  private currentTarget: HTMLElement;\n  private isFullscreen = false;\n\n  @Input() mode: FullscreenMode = DEFAULT_MODE;\n  @Input() zIndex = DEFAULT_ZINDEX;\n  /**\n   * @deprecated\n   */\n  @Input() target: HTMLElement;\n\n  @Output() fullscreenLaunch: EventEmitter<any> = new EventEmitter<any>();\n  document: Document;\n\n  constructor(\n    private elementRef: ElementRef,\n    @Inject(DOCUMENT) private doc: any\n  ) {\n    this.document = this.doc;\n  }\n\n  ngOnInit() {\n    this.document.addEventListener('fullscreenchange', this.onFullScreenChange);\n    this.document.addEventListener('MSFullscreenChange', this.onFullScreenChange);\n    this.document.addEventListener('webkitfullscreenchange', this.onFullScreenChange);\n    this.document.addEventListener('keydown', this.handleKeyDown);\n  }\n\n  ngAfterViewInit() {\n    const btnLaunch = this.elementRef.nativeElement.querySelector('[fullscreen-launch]');\n    if (btnLaunch) { btnLaunch.addEventListener('click', this.handleFullscreen); }\n  }\n\n  private launchNormalFullscreen(targetElement: HTMLElement) {\n    targetElement.classList.add('fullscreen');\n    if (this.zIndex) {\n      targetElement.setAttribute('style', `z-index: ${this.zIndex}`);\n    }\n  }\n\n  private exitNormalFullscreen(targetElement: HTMLElement) {\n    targetElement.classList.remove('fullscreen');\n    targetElement.style.zIndex = null;\n  }\n\n  private async launchImmersiveFullScreen(docElement: any) {\n    let fullscreenLaunch;\n    if (docElement.requestFullscreen) {\n      fullscreenLaunch = docElement.requestFullscreen();\n    } else if (docElement.mozRequestFullScreen) {\n      fullscreenLaunch = docElement.mozRequestFullScreen();\n    } else if (docElement.webkitRequestFullScreen) {\n      fullscreenLaunch = Promise.resolve(docElement.webkitRequestFullScreen());\n    } else if (docElement.msRequestFullscreen) {\n      fullscreenLaunch = Promise.resolve(docElement.msRequestFullscreen());\n    }\n    return await fullscreenLaunch.then(() => !!this.doc.fullscreenElement);\n  }\n\n  private async exitImmersiveFullScreen(doc: any) {\n    let fullscreenExit;\n    if (doc.exitFullscreen) {\n      fullscreenExit = doc.exitFullscreen();\n    } else if (doc.mozCancelFullScreen) {\n      fullscreenExit = doc.mozCancelFullScreen();\n    } else if (doc.webkitCancelFullScreen) {\n      fullscreenExit = Promise.resolve(doc.webkitCancelFullScreen());\n    } else if (doc.msExitFullscreen) {\n      fullscreenExit = Promise.resolve(doc.msExitFullscreen());\n    }\n    return await fullscreenExit.then(() => !!this.doc.fullscreenElement);\n  }\n\n  private onFullScreenChange = (event) => {\n    if (this.currentTarget) {\n      const targetElement: HTMLElement = this.currentTarget;\n      if (this.doc.fullscreenElement || this.doc.msFullscreenElement || this.doc.webkitFullscreenElement) { // 进入全屏\n        this.addFullScreenStyle();\n        this.launchNormalFullscreen(targetElement);\n      } else { // 退出全屏\n        this.removeFullScreenStyle();\n        this.currentTarget = null;\n        this.exitNormalFullscreen(targetElement);\n      }\n      // F11退出全屏时，需要将全屏状态传出去\n      const isFullscreen = !!(this.doc.fullscreenElement || this.doc.msFullscreenElement || this.doc.webkitFullscreenElement);\n      this.fullscreenLaunch.emit({\n        isFullscreen\n      });\n      this.isFullscreen = isFullscreen;\n    }\n  };\n\n  public handleFullscreen = async () => {\n    const targetElement = this.elementRef.nativeElement.querySelector('[fullscreen-target]');\n    let isFullscreen;\n    if (this.mode === 'normal') {\n      const fullscreen = targetElement.classList.contains('fullscreen');\n      if (!fullscreen) { // 进入全屏\n        this.addFullScreenStyle();\n        this.launchNormalFullscreen(targetElement);\n        isFullscreen = true;\n      } else { // 退出全屏\n        this.removeFullScreenStyle();\n        this.exitNormalFullscreen(targetElement);\n        isFullscreen = false;\n      }\n    } else {\n      this.currentTarget = targetElement;\n      if (this.doc.fullscreenElement || this.doc.msFullscreenElement || this.doc.webkitFullscreenElement) {\n        isFullscreen = await this.exitImmersiveFullScreen(this.doc);\n      } else {\n        isFullscreen = await this.launchImmersiveFullScreen(this.doc.documentElement);\n      }\n    }\n\n    this.isFullscreen = isFullscreen;\n    this.fullscreenLaunch.emit({\n      isFullscreen\n    });\n  };\n\n  private handleKeyDown = (event) => {\n    if (event.keyCode === ESC_KEYCODE) { // 按ESC键退出全屏\n      if (this.isFullscreen) {\n        const targetElement = this.elementRef.nativeElement.querySelector('[fullscreen-target]');\n        if (this.mode === 'normal') {\n          this.removeFullScreenStyle();\n          this.exitNormalFullscreen(targetElement);\n        } else {\n          if (this.doc.fullscreenElement) { this.exitImmersiveFullScreen(this.doc); }\n        }\n        this.fullscreenLaunch.emit({\n          isFullscreen: false\n        });\n        this.isFullscreen = false;\n      }\n    }\n  };\n\n  ngOnDestroy() {\n    this.document.removeEventListener('fullscreenchange', this.onFullScreenChange);\n    this.document.removeEventListener('MSFullscreenChange', this.onFullScreenChange);\n    this.document.removeEventListener('webkitfullscreenchange', this.onFullScreenChange);\n    this.document.removeEventListener('keydown', this.handleKeyDown);\n    const btnLaunch = this.elementRef.nativeElement.querySelector('[fullscreen-launch]');\n    if (btnLaunch) { btnLaunch.removeEventListener('click', this.handleFullscreen); }\n  }\n\n  private addFullScreenStyle() {\n    this.document.getElementsByTagName('html')[0].classList.add('devui-fullscreen');\n  }\n\n  private removeFullScreenStyle() {\n    this.document.getElementsByTagName('html')[0].classList.remove('devui-fullscreen');\n  }\n}\n","<div class=\"fullscreen-container\">\n  <ng-content select=\"[fullscreen-launch]\"></ng-content>\n  <ng-content select=\"[fullscreen-target]\"></ng-content>\n</div>\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { ButtonModule } from 'ng-devui/button';\nimport { FullscreenComponent } from './fullscreen.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    ButtonModule\n  ],\n  exports: [\n    FullscreenComponent\n  ],\n  declarations: [\n    FullscreenComponent\n  ]\n})\nexport class FullscreenModule {\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}