{"version":3,"file":"ng-devui-relative-time.mjs","sources":["../../devui/relative-time/relative-time.pipe.ts","../../devui/relative-time/relative-time.module.ts","../../devui/relative-time/ng-devui-relative-time.ts"],"sourcesContent":["import { OnDestroy, Pipe, PipeTransform } from '@angular/core';\nimport { I18nService } from 'ng-devui/i18n';\nimport * as datefns from 'date-fns';\nimport { Observable, of, Subject } from 'rxjs';\nimport { map, takeUntil } from 'rxjs/operators';\n\n@Pipe({\n  name: 'dRelativeTime'\n})\nexport class RelativeTimePipe implements PipeTransform, OnDestroy {\n  private _destroyed$ = new Subject();\n  constructor(private i18n: I18nService) {}\n\n  transform(\n    value: string | number | Date,\n    limit: number,\n    compareDate?: string | number | Date,\n    weekStartsOn: 0 | 1 | 2 | 3 | 4 | 6 | 5 = 1\n  ): Observable<string | number | Date> {\n    if (!value) {\n      return of('');\n    }\n    const threshold = {\n      month: 3, // at least 3 months using year.\n      week: 4, // at least 4 weeks using month.\n      day: 6, // at least 6 days using weeks.\n      hour: 6, // at least 6 hours using day.\n      minute: 59, // at least 59 minutes using hour.\n      second: 59 // at least 59 seconds using minute.\n    };\n\n    if (!datefns.isDate(value)) {\n      value = new Date(value);\n    }\n\n    const now = compareDate ? new Date(compareDate) : Date.now();\n\n    const startOfYearForTarget = datefns.startOfYear(<Date>value);\n    const startOfYearForToday = datefns.startOfYear(now);\n    const diffYears = datefns.differenceInYears(startOfYearForToday, startOfYearForTarget);\n    const absDiffYears = Math.abs(diffYears);\n\n    const startOfMonthForTarget = datefns.startOfMonth(<Date>value);\n    const startOfMonthForToday = datefns.startOfMonth(now);\n    const diffMonths = datefns.differenceInMonths(startOfMonthForToday, startOfMonthForTarget);\n    const absDiffMonths = Math.abs(diffMonths);\n\n    const startOfWeekForTarget = datefns.startOfWeek(<Date>value, { weekStartsOn });\n    const startOfWeekForToday = datefns.startOfWeek(now, { weekStartsOn });\n    const diffWeeks = datefns.differenceInWeeks(startOfWeekForToday, startOfWeekForTarget);\n    const absDiffWeeks = Math.abs(diffWeeks);\n\n    const startOfDayForTarget = datefns.startOfDay(<Date>value);\n    const startOfDayForToday = datefns.startOfDay(now);\n    const diffDays = datefns.differenceInDays(startOfDayForToday, startOfDayForTarget);\n    const absDiffDays = Math.abs(diffDays);\n\n    const diffHours = datefns.differenceInHours(now, <Date>value);\n    const absDiffHours = Math.abs(diffHours);\n\n    const diffMinutes = datefns.differenceInMinutes(now, <Date>value);\n    const absDiffMinutes = Math.abs(diffMinutes);\n\n    const diffSeconds = datefns.differenceInSeconds(now, <Date>value);\n    const absDiffSeconds = Math.abs(diffSeconds);\n\n    return this.i18n.langChange().pipe(\n      map((data) => {\n        if (absDiffSeconds > limit) {\n          return new Date(value);\n        }\n        const i18nCommonText = data['relativeTime'];\n        if (absDiffYears > 0 && absDiffMonths > threshold.month) {\n          return  diffYears > 0 ? i18nCommonText.yearsAgo(absDiffYears) : i18nCommonText.yearsLater(absDiffYears);\n        } else if (absDiffMonths > 0 && absDiffWeeks >= threshold.week) {\n          return  diffMonths > 0 ? i18nCommonText.monthsAgo(absDiffMonths) : i18nCommonText.monthsLater(absDiffMonths);\n        } else if (absDiffWeeks > 0 && absDiffDays > threshold.day) {\n          return  diffWeeks > 0 ? i18nCommonText.weeksAgo(absDiffWeeks) : i18nCommonText.weeksLater(absDiffWeeks);\n        } else if (absDiffDays > 0 && absDiffHours > threshold.hour) {\n          return  diffDays > 0 ? i18nCommonText.daysAgo(absDiffDays) : i18nCommonText.daysLater(absDiffDays);\n        } else if (absDiffHours > 0 && absDiffMinutes > threshold.minute) {\n          return absDiffHours + (diffHours > 0 ? i18nCommonText.hoursAgo : i18nCommonText.hoursLater);\n        } else if (absDiffMinutes > 0 && absDiffSeconds > threshold.second) {\n          return absDiffMinutes + (diffMinutes > 0 ? i18nCommonText.minutesAgo : i18nCommonText.minutesLater);\n        } else if (diffSeconds || diffSeconds === 0) {\n          return diffSeconds >= 0 ? i18nCommonText.justnow : i18nCommonText.later;\n        } else {\n          return '';\n        }\n      }),\n      takeUntil(this._destroyed$)\n    );\n  }\n\n  ngOnDestroy() {\n    this._destroyed$.next();\n    this._destroyed$.complete();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { RelativeTimePipe } from './relative-time.pipe';\n\n@NgModule({\n  declarations: [\n    RelativeTimePipe\n  ],\n  exports: [\n    RelativeTimePipe\n  ]\n})\nexport class RelativeTimeModule { }\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}