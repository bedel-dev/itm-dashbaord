{"version":3,"file":"ng-devui-rate.mjs","sources":["../../devui/rate/rate.component.ts","../../devui/rate/rate.component.html","../../devui/rate/rate.module.ts","../../devui/rate/ng-devui-rate.ts"],"sourcesContent":["import { ChangeDetectorRef, Component, forwardRef, Input, OnInit, TemplateRef } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\n\n@Component({\n  selector: 'd-rate',\n  templateUrl: './rate.component.html',\n  styleUrls: ['./rate.component.scss'],\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => RateComponent),\n      multi: true\n    }\n  ],\n  preserveWhitespaces: false,\n})\nexport class RateComponent implements OnInit, ControlValueAccessor {\n  /**\n   * @deprecated\n   * 用readonly替代\n  */\n  @Input() set read(value) {\n    this.readonly = value;\n  }\n  @Input() readonly = false;\n\n  @Input() count = 5;\n  @Input() color = '';\n  /**\n   * @deprecated\n   * 用character替代\n  */\n  @Input() icon = '';\n  @Input() character: string | TemplateRef<any> = '';\n  /**\n   * @deprecated\n   * 用color替代\n  */\n  @Input() set type(value) {\n    this.color = `var(--devui-${value})`;\n  }\n  @Input() allowHalf = false;\n  @Input() allowClear = false;\n  totalLevel_array = [];\n  chooseValue: number;\n  width = '';\n  onChange: (value: number) => void;\n  onTouched: () => void;\n\n  constructor(\n    private cdr: ChangeDetectorRef\n  ) { }\n\n  ngOnInit(): void {\n    for (let i = 0; i < this.count; i++) {\n      this.totalLevel_array.push({ width: '0' });\n    }\n  }\n\n  get isCharacterTemplate() {\n    return this.character instanceof TemplateRef;\n  }\n\n  get characterTemplate(): TemplateRef<any> {\n    return this.character as TemplateRef<any>;\n  }\n  // 只读模式配置\n  setStaticRating() {\n    const half_star = this.chooseValue % 1;\n    const int_current_level = Math.floor(this.chooseValue);\n    this.setChange(0, int_current_level + 1, '100%');\n    if (half_star > 0) {\n      this.totalLevel_array[int_current_level + 1]['width'] = half_star * 100 + '%';\n      this.setChange(int_current_level + 2, this.count, '0');\n    } else {\n      this.setChange(int_current_level + 1, this.count, '0');\n    }\n  }\n\n  // 动态模式配置\n  setDynamicRating() {\n    const halfStar = this.chooseValue % 1;\n    const wholeStar = Math.floor(this.chooseValue);\n    this.setChange(0, wholeStar + 1, '100%');\n    if (this.allowHalf && halfStar) {\n      this.setChange(wholeStar + 1, wholeStar + 2, '50%');\n      this.setChange(wholeStar + 2, this.count, '0');\n    } else if (this.allowClear && this.chooseValue === -1) {\n      this.setChange(0, this.count, '0');\n    } else {\n      this.setChange(wholeStar + 1, this.count, '0');\n    }\n  }\n\n  hoverToggle(event, index?: number, reset = false) {\n    if (this.readonly) {\n      return;\n    }\n    if (reset) {\n      // chooseValue从index取值故比真实值小1\n      if (this.chooseValue >= -0.5) {\n        this.setDynamicRating();\n      } else {\n        this.setChange(0, this.count, '0');\n      }\n    } else {\n      this.setChange(0, index, '100%');\n      if (this.allowHalf && (event.offsetX * 2 <= event.target.clientWidth)) {\n        this.setChange(index, index + 1, '50%');\n      } else {\n        this.setChange(index, index + 1, '100%');\n      }\n      this.setChange(index + 1, this.count, '0');\n    }\n  }\n  // 根据mouseMove，mouseLeave,select等操作，改变颜色与是否选中\n  setChange(start, end, width) {\n    for (let i = start; i < end; i++) {\n      this.totalLevel_array[i]['width'] = width;\n    }\n  }\n\n  selectValue(event, index) {\n    if (this.readonly) {\n      return;\n    }\n    this.setChange(0, index, '100%');\n    const prevValue = this.chooseValue;\n\n    if (this.allowHalf && (event.offsetX * 2 <= event.target.clientWidth)) {\n      this.chooseValue = index - 0.5;\n    } else {\n      this.chooseValue = index;\n    }\n\n    if (this.allowClear && this.chooseValue === prevValue) {\n      this.chooseValue = -1;\n      this.setChange(0, this.count, '0');\n      this.onChange(0);\n    } else {\n      if (this.allowHalf && (event.offsetX * 2 <= event.target.clientWidth)) {\n        this.setChange(index, index + 1, '50%');\n      } else {\n        this.setChange(index, index + 1, '100%');\n      }\n      this.setChange(index + 1, this.count, '0');\n      this.onChange(this.chooseValue + 1);\n    }\n\n    this.onTouched();\n  }\n\n  registerOnChange(fn: (_: number) => void): void {\n    this.onChange = fn;\n  }\n\n  registerOnTouched(fn: () => void): void {\n    this.onTouched = fn;\n  }\n\n  writeValue(value: number | null): void {\n    this.chooseValue = value - 1;\n    if (this.readonly) {\n      this.setStaticRating();\n    } else {\n      this.setDynamicRating();\n    }\n  }\n}\n","<div class=\"devui-star-container\" (mouseleave)=\"hoverToggle($event, chooseValue, true)\">\n  <div\n    *ngFor=\"let item of totalLevel_array; let i = index\"\n    class=\"devui-star-align devui-pointer\"\n    [ngClass]=\"{ 'devui-only-read': readonly }\"\n    (mouseover)=\"hoverToggle($event, i)\"\n    (click)=\"selectValue($event, i)\"\n  >\n    <span class=\"devui-star-color {{ icon }}\">\n      <ng-container *ngIf=\"!isCharacterTemplate\">{{ character }}</ng-container>\n      <ng-container *ngIf=\"isCharacterTemplate\">\n        <ng-container *ngTemplateOutlet=\"characterTemplate\"></ng-container>\n      </ng-container>\n      <svg\n        *ngIf=\"!icon && !character\"\n        width=\"16px\"\n        height=\"16px\"\n        viewBox=\"0 0 16 16\"\n        version=\"1.1\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n      >\n        <g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n          <g fill=\"#E3E5E9\" id=\"Mask\">\n            <polygon\n              points=\"8 12.7603585 3.67376208 14.3147912 3.81523437 9.71994835 1 6.0857977 5.41367261 4.80046131 8 1 10.5863274 4.80046131 15 6.0857977 12.1847656 9.71994835 12.3262379 14.3147912\"\n            ></polygon>\n          </g>\n        </g>\n      </svg>\n    </span>\n    <span class=\"devui-star-color-active devui-active-star {{ icon }}\" [style.color]=\"color\" [style.width]=\"item.width\">\n      <ng-container *ngIf=\"!isCharacterTemplate\">{{ character }}</ng-container>\n      <ng-container *ngIf=\"isCharacterTemplate\">\n        <ng-container *ngTemplateOutlet=\"characterTemplate\"></ng-container>\n      </ng-container>\n      <svg\n        *ngIf=\"!icon && !character\"\n        width=\"16px\"\n        height=\"16px\"\n        viewBox=\"0 0 16 16\"\n        version=\"1.1\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n      >\n        <g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n          <g [style.fill]=\"color\" id=\"Mask\">\n            <polygon\n              points=\"8 12.7603585 3.67376208 14.3147912 3.81523437 9.71994835 1 6.0857977 5.41367261 4.80046131 8 1 10.5863274 4.80046131 15 6.0857977 12.1847656 9.71994835 12.3262379 14.3147912\"\n            ></polygon>\n          </g>\n        </g>\n      </svg>\n    </span>\n  </div>\n  <div style=\"clear: both\"></div>\n</div>\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { RateComponent } from './rate.component';\n\n@NgModule({\n  imports: [CommonModule, FormsModule],\n  exports: [RateComponent],\n  declarations: [RateComponent],\n  providers: [],\n})\nexport class RateModule { }\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}