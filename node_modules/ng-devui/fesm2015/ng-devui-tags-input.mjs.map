{"version":3,"file":"ng-devui-tags-input.mjs","sources":["../../devui/tags-input/tags.input.component.ts","../../devui/tags-input/tags.input.component.html","../../devui/tags-input/tags.input.module.ts","../../devui/tags-input/ng-devui-tags-input.ts"],"sourcesContent":["import {\n  AfterViewInit,\n  Component,\n  ElementRef,\n  EventEmitter,\n  forwardRef,\n  Input,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  Output,\n  SimpleChanges,\n  TemplateRef,\n  ViewChild\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { I18nInterface, I18nService } from 'ng-devui/i18n';\nimport { ToggleMenuContainerComponent, ToggleMenuListComponent, ToggleMenuSearchComponent } from 'ng-devui/toggle-menu';\nimport { DevConfigService, WithConfig } from 'ng-devui/utils';\nimport { isEmpty } from 'lodash-es';\nimport { BehaviorSubject, fromEvent, Observable, of, Subscription } from 'rxjs';\nimport { debounceTime, map, switchMap } from 'rxjs/operators';\n\n@Component({\n  selector: 'd-tags-input',\n  templateUrl: './tags.input.component.html',\n  styleUrls: ['./tags.input.component.scss'],\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => TagsInputComponent),\n      multi: true,\n    },\n  ],\n  exportAs: 'TagsInput',\n  preserveWhitespaces: false,\n})\nexport class TagsInputComponent implements ControlValueAccessor, OnInit, OnDestroy, OnChanges, AfterViewInit {\n  /**\n   * 【必选】记录输入的标签\n   */\n  @Input() tags = [];\n  /**\n   * 【可选】disabled 灰化状态\n   */\n  @Input() disabled = false;\n  /**\n   * 【可选】使用的属性名\n   */\n  @Input() displayProperty = 'name';\n  /**\n   * 【可选】输入的placeholder\n   */\n  @Input() placeholder = '';\n  /**\n   * 【可选】达到最大值时可自定义placeholder\n   */\n  @Input() maxPlaceholder: string;\n  /**\n   * 【可选】输入标签的最小长度\n   */\n  @Input() minLength = 3;\n  /**\n   * 【可选】输入标签的最大长度\n   */\n  @Input() maxLength: number = Number.MAX_SAFE_INTEGER;\n  /**\n   * 【可选】标签的最小个数\n   */\n  @Input() minTags = 0;\n  /**\n   * 【可选】标签的最大个数\n   */\n  @Input() maxTags: number = Number.MAX_SAFE_INTEGER;\n  /**\n   * 【可选】输入框的spellcheck\n   */\n  @Input() spellcheck = true;\n  /**\n   * 【可选】是否appendToBody\n   */\n  @Input() appendToBody = false;\n  /**\n   * 【可选】是否虚拟滚动\n   */\n  @Input() virtualScroll = false;\n  /**\n   * 【可选】下拉选项\n   */\n  @Input() suggestionList: any = [];\n  /**\n   * 【可选】是否按空格添加tag\n   */\n  @Input() isAddBySpace = true;\n  /**\n   * 【可选】默认两行显示，false 则单行显示\n   */\n  @Input() multiline = true;\n  /**\n   * 【可选】已选中标签容器最大高度\n   */\n  @Input() maxHeight: string;\n  /**\n   * 【可选】大小写敏感\n   */\n  @Input() caseSensitivity = false;\n  @Input() itemTemplate: TemplateRef<any>;\n  @Input() checkBeforeAdd: (newTag: string) => boolean | Promise<boolean> | Observable<boolean>;\n  @Input() @WithConfig() showAnimation = true;\n  /**\n   * 输出函数，当选中某个选项项后，将会调用此函数，参数为当前选择项的值。如果需要获取所有选择状态的值，请参考(ngModelChange)方法\n   */\n  @Output() valueChange = new EventEmitter<any>();\n  @ViewChild('tagsInputWrapper', { static: true }) tagsInputWrapperItem: ElementRef;\n  @ViewChild(ToggleMenuContainerComponent) selectBoxContainer: ToggleMenuContainerComponent;\n  @ViewChild(ToggleMenuListComponent) selectBox: ToggleMenuListComponent;\n  @ViewChild(ToggleMenuSearchComponent) searchBox: ToggleMenuSearchComponent;\n\n  get getPlaceHolder() {\n    const maxPlaceholder =\n      this.maxPlaceholder === undefined ? `${this.i18nTagsInputText.tagsReachMaxNumber}${this.maxTags}` : this.maxPlaceholder;\n    return this.selectedItems.length >= this.maxTags ? maxPlaceholder : this.placeholder;\n  }\n\n  newTag = '';\n  availableOptions = [];\n  selectedItems = [];\n  /**\n   * 对于用户传入的suggestionList不做修改，数据的操作在_suggestionList上进行\n   */\n  _suggestionList = [];\n  newTagValid = false;\n  isReduce = false;\n  isOpen = false;\n  inputEvent: any;\n  blurEventSubscription: Subscription;\n  valueParser: (item: any) => any;\n  searchFn: (term: string) => Observable<Array<{ id: string | number; option: any }>>;\n\n  private DEBONCE_TIME = 300;\n  private sourceSubscription: BehaviorSubject<any>;\n  private KEYS: any = {\n    backspace: 8,\n    tab: 9,\n    enter: 13,\n    escape: 27,\n    space: 32,\n    up: 38,\n    down: 40,\n    left: 37,\n    right: 39,\n    delete: 46,\n    comma: 188,\n  };\n  private i18nSubscription: Subscription;\n  public i18nCommonText: I18nInterface['common'];\n  public i18nTagsInputText: I18nInterface['tagsInput'];\n  private onChange = (_: any) => null;\n  private onTouch = () => null;\n\n  constructor(private i18n: I18nService, private devConfigService: DevConfigService) {\n    this.valueParser = (item) => (typeof item === 'object' ? item[this.displayProperty] || '' : String(item) ? item.toString() : '');\n  }\n\n  private setI18nText() {\n    this.i18nCommonText = this.i18n.getI18nText().common;\n    this.i18nTagsInputText = this.i18n.getI18nText().tagsInput;\n    this.i18nSubscription = this.i18n.langChange().subscribe((data) => {\n      this.i18nCommonText = data.common;\n      this.i18nTagsInputText = data.tagsInput;\n    });\n  }\n\n  writeValue(value: any): void {\n    if (!value) {\n      return;\n    }\n    this.tags = value;\n    this.isReduce = false;\n    this.reduceSuggestionList();\n  }\n\n  registerOnChange(fn: any): void {\n    this.onChange = fn;\n  }\n\n  registerOnTouched(fn: any): void {\n    this.onTouch = fn;\n  }\n\n  ngOnInit() {\n    this.setI18nText();\n    this.newTag = '';\n    this._suggestionList = [...this.suggestionList];\n    this.searchFn = (term: any) => {\n      return of(\n        (this._suggestionList ? this._suggestionList : []).filter((item) =>\n          term === ''\n            ? true\n            : this.caseSensitivity\n              ? item[this.displayProperty].indexOf(term) !== -1\n              : item[this.displayProperty].toLowerCase().indexOf(term.toLowerCase()) !== -1\n        )\n      );\n    };\n    this.registerFilterChange();\n  }\n\n  ngAfterViewInit() {\n    if (this.searchBox) {\n      const inputDom = this.searchBox.el.nativeElement.querySelector('input');\n      // input失焦不冒泡，直接监听事件处理会早于list中点击事件传递到该组件，因此增加debounceTime待下拉列表关闭后判断是否插入标签\n      this.blurEventSubscription = fromEvent(inputDom, 'blur')\n        .pipe(debounceTime(this.DEBONCE_TIME))\n        .subscribe(() => {\n          if (this.isOpen) {\n            return;\n          }\n          if (!isEmpty(this.newTag)) {\n            this.addTag();\n          }\n        });\n    }\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes && changes.suggestionList && changes.suggestionList.currentValue) {\n      this._suggestionList = [...this.suggestionList];\n      this.reduceSuggestionList();\n      if (this.sourceSubscription && this.searchFn) {\n        this.sourceSubscription.next('');\n      }\n    }\n    if (changes && changes.tags && changes.tags.currentValue) {\n      this.reduceSuggestionList();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.sourceSubscription) {\n      this.sourceSubscription.unsubscribe();\n    }\n    if (this.blurEventSubscription) {\n      this.blurEventSubscription.unsubscribe();\n    }\n    if (this.i18nSubscription) {\n      this.i18nSubscription.unsubscribe();\n    }\n  }\n\n  registerFilterChange() {\n    this.sourceSubscription = new BehaviorSubject<any>('');\n    this.sourceSubscription\n      .pipe(\n        map((term) => {\n          this.tagIsValid();\n          return term;\n        }),\n        switchMap((term) => this.searchFn(term))\n      )\n      .subscribe((options) => {\n        this.availableOptions = options;\n        if (this.selectBoxContainer) {\n          this.selectBoxContainer.updatePosition();\n        }\n        if (this.selectBox) {\n          this.selectBox.resetIndex(!options.length);\n        }\n      });\n  }\n\n  reduceSuggestionList() {\n    this.selectedItems = this.tags.map((option, id) => ({ option, id }));\n    if (this.isReduce) {\n      return;\n    }\n    if (this.suggestionList.length > 0) {\n      this.isReduce = true;\n      // 使用用户最初传入的数据来进行过滤\n      this._suggestionList = this.suggestionList.filter((suggestion) => {\n        return (\n          this.selectedItems.findIndex(({ option }) =>\n            this.caseSensitivity\n              ? option[this.displayProperty] === suggestion[this.displayProperty]\n              : option[this.displayProperty].toLowerCase() === suggestion[this.displayProperty].toLowerCase()\n          ) === -1\n        );\n      });\n      if (this.sourceSubscription && this.searchFn) {\n        this.sourceSubscription.next('');\n      }\n    }\n  }\n\n  host_click() {\n    if (!this.disabled) {\n      const dom = this.searchBox.el.nativeElement.querySelector('input');\n      if (dom && this.selectBox) {\n        dom.focus();\n        this.selectBox.resetIndex(false);\n      }\n    }\n  }\n\n  passEvent(data) {\n    const { event, type } = data;\n    switch (type) {\n    case 'keydown.enter':\n    case 'blur':\n      // keydown.enter 和 keydown 都接收会重复处理\n      // 点击会聚焦input，input失焦事件不会冒泡，单独处理\n      break;\n    case 'keydown': {\n      const hotkeys = [this.KEYS.enter, this.KEYS.tab];\n      if (this.isAddBySpace) {\n        hotkeys.push(this.KEYS.space);\n      }\n      if (hotkeys.includes(event.keyCode)) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (this.selectBox?.selectIndex !== -1) {\n          this.addSuggestionByIndex(this.selectBox.selectIndex, this.availableOptions[this.selectBox.selectIndex]);\n        } else {\n          this.addTag();\n        }\n      }\n      break;\n    }\n    default:\n      this.inputEvent = { event, type };\n    }\n  }\n\n  addSuggestionByIndex(index, value) {\n    if (\n      index < 0 ||\n      index >= this.availableOptions.length ||\n      this.maxTags <= this.selectedItems.length ||\n      this.selectedItems.findIndex(({ option }) =>\n        this.caseSensitivity\n          ? option[this.displayProperty] === value[this.displayProperty]\n          : option[this.displayProperty].toLowerCase() === value[this.displayProperty].toLowerCase()\n      ) !== -1\n    ) {\n      return;\n    }\n    this.canAdd(value).then((result) => {\n      if (!result) {\n        return;\n      }\n      this.checkMaxTags(this.availableOptions[index]);\n      this.onChange(this.selectedItems.map((tagItem) => tagItem.option));\n      this.valueChange.emit(this.availableOptions[index]);\n      const suggestionListIndex = this._suggestionList.findIndex((item) =>\n        this.caseSensitivity\n          ? item[this.displayProperty] === value[this.displayProperty]\n          : item[this.displayProperty].toLowerCase() === value[this.displayProperty].toLowerCase()\n      );\n      this._suggestionList.splice(suggestionListIndex, 1);\n      this.delayResetNewTag();\n      this.sourceSubscription.next('');\n    });\n  }\n\n  removeTag(data) {\n    const { index } = data;\n    // 立即移除会导致toggle-menu-container无法判断event.target是否在容器中，从而关闭下拉菜单\n    setTimeout(() => {\n      if (index < 0 || index >= this.selectedItems.length) {\n        return;\n      }\n      // onPush下 数组长度变化不会触发变更检测\n      this.availableOptions = [...this.availableOptions, this.selectedItems[index]?.option];\n      this._suggestionList = this.availableOptions;\n      const tag = this.selectedItems[index].option;\n      this.selectedItems.splice(index, 1);\n      if (this.selectedItems.length === 0) {\n        this.selectBoxContainer.updatePosition();\n      }\n      this.onChange(this.selectedItems.map((tagItem) => tagItem.option));\n      this.valueChange.emit(tag);\n    });\n  }\n\n  tagIsValid() {\n    const tag = this.newTag;\n    const tmp = this.displayProperty;\n    const result =\n      tag &&\n      tag.length >= this.minLength &&\n      tag.length <= this.maxLength &&\n      this._suggestionList.findIndex((item) =>\n        this.caseSensitivity ? item[tmp] === tag : item[tmp].toLowerCase() === tag.toLowerCase()\n      ) === -1 &&\n      this.selectedItems.findIndex(({ option }) =>\n        this.caseSensitivity ? option[tmp] === tag : option[tmp].toLowerCase() === tag.toLowerCase()\n      ) === -1 &&\n      !this.isEmptyString(tag);\n    this.newTagValid = tag === '' || !!result;\n    return result;\n  }\n\n  isEmptyString(tag) {\n    const temp = tag.match(/\\s/g);\n    if (temp) {\n      return tag.length === temp.length;\n    } else {\n      return false;\n    }\n  }\n\n  addTag() {\n    this.canAdd()\n      .then((result) => {\n        if (result && this.maxTags > this.selectedItems.length) {\n          if (this.tagIsValid()) {\n            const obj = {};\n            obj[this.displayProperty] = this.newTag;\n            this.checkMaxTags(obj);\n            this.onChange(this.selectedItems.map((tagItem) => tagItem.option));\n            this.valueChange.emit(this.newTag);\n          }\n        } else {\n          this.newTagValid = false;\n        }\n      })\n      .finally(() => this.delayResetNewTag());\n    this.sourceSubscription.next('');\n  }\n\n  canAdd(value?) {\n    let checkResult = Promise.resolve(true);\n    if (this.checkBeforeAdd) {\n      const result: any = this.checkBeforeAdd(value || this.newTag);\n      if (typeof result !== 'undefined') {\n        if (result.then) {\n          checkResult = result;\n        } else if (result.subscribe) {\n          checkResult = (result as Observable<boolean>).toPromise();\n        } else {\n          checkResult = Promise.resolve(result);\n        }\n      }\n    }\n    return checkResult;\n  }\n\n  checkMaxTags(tag) {\n    this.selectedItems.push({ id: this.selectedItems.length, option: tag });\n    if (this.selectedItems.length >= this.maxTags) {\n      this.isOpen = false;\n    }\n  }\n\n  setValue({ option, index }) {\n    this.addSuggestionByIndex(index, option);\n  }\n\n  searchInputValueChange(event) {\n    if (this.selectBox) {\n      this.selectBox.selectIndex = -1;\n    }\n    this.newTag = (event || '').trim();\n    this.sourceSubscription.next(this.newTag);\n  }\n\n  toggleChangeFn(event) {\n    if (!event) {\n      this.onTouch();\n    }\n    this.isOpen = event;\n  }\n\n  delayResetNewTag() {\n    setTimeout(() => {\n      // 放在timeout里是因为如果用空格添加tag，会导致添加之后输入框里有个空格。\n      this.newTag = '';\n    }, 50);\n  }\n}\n","<div #tagsInputWrapper class=\"devui-tags-host {{ multiline ? '' : 'init-inline' }}\" tabindex=\"-1\" (click)=\"host_click()\">\n  <d-toggle-menu-container\n    [isOpen]=\"isOpen\"\n    [appendToBody]=\"appendToBody\"\n    [selectWrapper]=\"tagsInputWrapperItem\"\n    [disabled]=\"disabled || selectedItems?.length >= maxTags\"\n    [toggleOnFocus]=\"true\"\n    [showAnimation]=\"showAnimation\"\n    [closeScope]=\"'blank'\"\n    (passEvent)=\"passEvent($event)\"\n    (toggleChange)=\"toggleChangeFn($event)\"\n  >\n    <d-toggle-menu-label\n      [multiItems]=\"selectedItems\"\n      [mode]=\"'multiple-line'\"\n      [valueParser]=\"valueParser\"\n      [disabled]=\"disabled\"\n      [maxHeight]=\"maxHeight\"\n      (removeChange)=\"removeTag($event)\"\n    ></d-toggle-menu-label>\n    <d-toggle-menu-search\n      *ngIf=\"!disabled\"\n      [inputValue]=\"newTag\"\n      [searchPlaceholder]=\"getPlaceHolder\"\n      [searchFn]=\"searchFn\"\n      [spellcheck]=\"spellcheck\"\n      [isShowSearchIcon]=\"false\"\n      [disabled]=\"disabled || selectedItems?.length >= maxTags\"\n      [inputWidth]=\"multiline ? '' : 'auto'\"\n      [delay]=\"0\"\n      (searchInputValueChange)=\"searchInputValueChange($event)\"\n    ></d-toggle-menu-search>\n    <d-toggle-menu-list\n      [eventHandle]=\"inputEvent\"\n      [options]=\"availableOptions\"\n      [value]=\"selectedItems\"\n      [virtualScroll]=\"virtualScroll\"\n      [hasSelectIndex]=\"true\"\n      [isFiltering]=\"newTag?.length > 0\"\n      [listItemTemplate]=\"listItem\"\n      [closeScope]=\"'blank'\"\n      (toggleChange)=\"toggleChangeFn($event)\"\n      (valueChange)=\"setValue($event)\"\n    >\n      <ng-template #listItem let-item=\"item\" let-index=\"index\" let-selectIndex=\"selectIndex\" let-choose=\"choose\">\n        <d-toggle-menu-list-item\n          [item]=\"item\"\n          [index]=\"index\"\n          [selectIndex]=\"selectIndex\"\n          [highlightToggle]=\"false\"\n          [customTemplate]=\"itemTemplate\"\n          [filterKey]=\"displayProperty\"\n          (chooseItem)=\"choose($event)\"\n        ></d-toggle-menu-list-item>\n      </ng-template>\n    </d-toggle-menu-list>\n  </d-toggle-menu-container>\n</div>\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { ToggleMenuModule } from 'ng-devui/toggle-menu';\nimport { TagsInputComponent } from './tags.input.component';\n@NgModule({\n  imports: [CommonModule, FormsModule, ToggleMenuModule],\n  exports: [TagsInputComponent],\n  declarations: [TagsInputComponent],\n})\nexport class TagsInputModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}